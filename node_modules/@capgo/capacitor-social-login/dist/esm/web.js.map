{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,iBAAiB,CAAC;AAE5C,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AAepD,OAAO,EAAE,mBAAmB,EAAE,MAAM,qBAAqB,CAAC;AAC1D,OAAO,EAAE,iBAAiB,EAAE,MAAM,mBAAmB,CAAC;AACtD,OAAO,EAAE,kBAAkB,EAAE,MAAM,oBAAoB,CAAC;AAExD,MAAM,OAAO,cAAe,SAAQ,SAAS;IAQ3C;QACE,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,cAAc,GAAG,IAAI,iBAAiB,EAAE,CAAC;QAC9C,IAAI,CAAC,aAAa,GAAG,IAAI,gBAAgB,EAAE,CAAC;QAC5C,IAAI,CAAC,gBAAgB,GAAG,IAAI,mBAAmB,EAAE,CAAC;QAClD,IAAI,CAAC,eAAe,GAAG,IAAI,kBAAkB,EAAE,CAAC;QAEhD,sEAAsE;QACtE,IAAI,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,eAAe,CAAC,EAAE,CAAC;YACzD,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;YACrC,IAAI,CAAC,mBAAmB,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;gBACzC,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC,CAAC;gBACxD,MAAM,CAAC,KAAK,EAAE,CAAC;YACjB,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAEO,KAAK,CAAC,mBAAmB;;QAC/B,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC1C,MAAM,QAAQ,GAAG,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC;QACtE,IAAI,QAAQ,GAAkB,IAAI,CAAC;QACnC,IAAI,KAAyB,CAAC;QAE9B,IAAI,QAAQ,EAAE,CAAC;YACb,IAAI,CAAC;gBACH,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;gBACpC,QAAQ,GAAG,MAAA,MAAM,CAAC,QAAQ,mCAAI,IAAI,CAAC;gBACnC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;YACvB,CAAC;YAAC,WAAM,CAAC;gBACP,QAAQ,GAAG,QAAQ,KAAK,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC;YACnD,CAAC;QACH,CAAC;QAED,IAAI,MAAM,GAA2C,IAAI,CAAC;QAE1D,QAAQ,QAAQ,EAAE,CAAC;YACjB,KAAK,SAAS;gBACZ,MAAM,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;gBACpE,MAAM;YACR,KAAK,QAAQ,CAAC;YACd;gBACE,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC,GAAG,CAAC,CAAC;gBACtD,MAAM;QACV,CAAC;QAED,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,OAAO;QACT,CAAC;QAED,IAAI,OAAO,IAAI,MAAM,EAAE,CAAC;YACtB,MAAM,gBAAgB,GAAG,QAAQ,aAAR,QAAQ,cAAR,QAAQ,GAAI,IAAI,CAAC;YAC1C,MAAA,MAAM,CAAC,MAAM,0CAAE,WAAW,CACxB;gBACE,IAAI,EAAE,aAAa;gBACnB,QAAQ,EAAE,gBAAgB;gBAC1B,KAAK,EAAE,MAAM,CAAC,KAAK;aACpB,EACD,MAAM,CAAC,QAAQ,CAAC,MAAM,CACvB,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,MAAA,MAAM,CAAC,MAAM,0CAAE,WAAW,iBAEtB,IAAI,EAAE,gBAAgB,EACtB,QAAQ,EAAE,MAAM,CAAC,QAAQ,IACtB,MAAM,CAAC,MAAM,GAElB,MAAM,CAAC,QAAQ,CAAC,MAAM,CACvB,CAAC;QACJ,CAAC;QAED,MAAM,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,OAA0B;;QACzC,MAAM,YAAY,GAAoB,EAAE,CAAC;QAEzC,IAAI,MAAA,OAAO,CAAC,MAAM,0CAAE,WAAW,EAAE,CAAC;YAChC,YAAY,CAAC,IAAI,CACf,IAAI,CAAC,cAAc,CAAC,UAAU,CAC5B,OAAO,CAAC,MAAM,CAAC,WAAW,EAC1B,OAAO,CAAC,MAAM,CAAC,IAAI,EACnB,OAAO,CAAC,MAAM,CAAC,YAAY,EAC3B,OAAO,CAAC,MAAM,CAAC,WAAW,CAC3B,CACF,CAAC;QACJ,CAAC;QAED,IAAI,MAAA,OAAO,CAAC,KAAK,0CAAE,QAAQ,EAAE,CAAC;YAC5B,YAAY,CAAC,IAAI,CACf,IAAI,CAAC,aAAa,CAAC,UAAU,CAC3B,OAAO,CAAC,KAAK,CAAC,QAAQ,EACtB,OAAO,CAAC,KAAK,CAAC,WAAW,EACzB,OAAO,CAAC,KAAK,CAAC,sBAAsB,CACrC,CACF,CAAC;QACJ,CAAC;QAED,IAAI,MAAA,OAAO,CAAC,QAAQ,0CAAE,KAAK,EAAE,CAAC;YAC5B,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,EAAE,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;QACvG,CAAC;QAED,IAAI,MAAA,OAAO,CAAC,OAAO,0CAAE,QAAQ,EAAE,CAAC;YAC9B,YAAY,CAAC,IAAI,CACf,IAAI,CAAC,eAAe,CAAC,UAAU,CAC7B,OAAO,CAAC,OAAO,CAAC,QAAQ,EACxB,OAAO,CAAC,OAAO,CAAC,WAAW,EAC3B,OAAO,CAAC,OAAO,CAAC,aAAa,EAC7B,OAAO,CAAC,OAAO,CAAC,UAAU,EAC1B,OAAO,CAAC,OAAO,CAAC,QAAQ,CACzB,CACF,CAAC;QACJ,CAAC;QAED,MAAM,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;IAClC,CAAC;IAED,KAAK,CAAC,KAAK,CACT,OAA+C;QAE/C,QAAQ,OAAO,CAAC,QAAQ,EAAE,CAAC;YACzB,KAAK,QAAQ;gBACX,OAAO,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAA6D,CAAC;YAChH,KAAK,OAAO;gBACV,OAAO,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAA6D,CAAC;YAC/G,KAAK,UAAU;gBACb,OAAO,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,OAAO,CAAC,OAA+B,CAGxE,CAAC;YACL,KAAK,SAAS;gBACZ,OAAO,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,OAAO,CAAC,OAAc,CAGtD,CAAC;YACL;gBACE,MAAM,IAAI,KAAK,CAAC,aAAa,OAAO,CAAC,QAAQ,4BAA4B,CAAC,CAAC;QAC/E,CAAC;IACH,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,OAAkE;QAC7E,QAAQ,OAAO,CAAC,QAAQ,EAAE,CAAC;YACzB,KAAK,QAAQ;gBACX,OAAO,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC;YACtC,KAAK,OAAO;gBACV,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,CAAC;YACrC,KAAK,UAAU;gBACb,OAAO,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,CAAC;YACxC,KAAK,SAAS;gBACZ,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC;YACvC;gBACE,MAAM,IAAI,KAAK,CAAC,cAAc,OAAO,CAAC,QAAQ,qBAAqB,CAAC,CAAC;QACzE,CAAC;IACH,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,OAA0B;QACzC,QAAQ,OAAO,CAAC,QAAQ,EAAE,CAAC;YACzB,KAAK,QAAQ;gBACX,OAAO,IAAI,CAAC,cAAc,CAAC,UAAU,EAAE,CAAC;YAC1C,KAAK,OAAO;gBACV,OAAO,IAAI,CAAC,aAAa,CAAC,UAAU,EAAE,CAAC;YACzC,KAAK,UAAU;gBACb,OAAO,IAAI,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC;YAC5C,KAAK,SAAS;gBACZ,OAAO,IAAI,CAAC,eAAe,CAAC,UAAU,EAAE,CAAC;YAC3C;gBACE,MAAM,IAAI,KAAK,CAAC,kBAAkB,OAAO,CAAC,QAAQ,qBAAqB,CAAC,CAAC;QAC7E,CAAC;IACH,CAAC;IAED,KAAK,CAAC,oBAAoB,CAAC,OAAiC;QAC1D,QAAQ,OAAO,CAAC,QAAQ,EAAE,CAAC;YACzB,KAAK,QAAQ;gBACX,OAAO,IAAI,CAAC,cAAc,CAAC,oBAAoB,EAAE,CAAC;YACpD,KAAK,OAAO;gBACV,OAAO,IAAI,CAAC,aAAa,CAAC,oBAAoB,EAAE,CAAC;YACnD,KAAK,UAAU;gBACb,OAAO,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,CAAC;YACtD,KAAK,SAAS;gBACZ,OAAO,IAAI,CAAC,eAAe,CAAC,oBAAoB,EAAE,CAAC;YACrD;gBACE,MAAM,IAAI,KAAK,CAAC,4BAA4B,OAAO,CAAC,QAAQ,qBAAqB,CAAC,CAAC;QACvF,CAAC;IACH,CAAC;IAED,KAAK,CAAC,OAAO,CAAC,OAAqB;QACjC,QAAQ,OAAO,CAAC,QAAQ,EAAE,CAAC;YACzB,KAAK,QAAQ;gBACX,OAAO,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;YACvC,KAAK,OAAO;gBACV,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,CAAC;YACtC,KAAK,UAAU;gBACb,OAAO,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,OAAO,CAAC,OAA+B,CAAC,CAAC;YAChF,KAAK,SAAS;gBACZ,OAAO,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;YACxC;gBACE,MAAM,IAAI,KAAK,CAAC,eAAgB,OAAe,CAAC,QAAQ,qBAAqB,CAAC,CAAC;QACnF,CAAC;IACH,CAAC;IAED,KAAK,CAAC,oBAAoB,CAAiC,OAG1D;QACC,MAAM,IAAI,KAAK,CAAC,8BAA8B,OAAO,CAAC,IAAI,qBAAqB,CAAC,CAAC;IACnF,CAAC;IAED,KAAK,CAAC,gBAAgB;QACpB,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;IAC5B,CAAC;;AAxNuB,8BAAe,GAAG,4BAA4B,CAAC","sourcesContent":["import { WebPlugin } from '@capacitor/core';\n\nimport { AppleSocialLogin } from './apple-provider';\nimport type {\n  SocialLoginPlugin,\n  InitializeOptions,\n  LoginOptions,\n  AuthorizationCode,\n  AuthorizationCodeOptions,\n  isLoggedInOptions,\n  ProviderResponseMap,\n  FacebookLoginOptions,\n  ProviderSpecificCall,\n  ProviderSpecificCallOptionsMap,\n  ProviderSpecificCallResponseMap,\n  LoginResult,\n} from './definitions';\nimport { FacebookSocialLogin } from './facebook-provider';\nimport { GoogleSocialLogin } from './google-provider';\nimport { TwitterSocialLogin } from './twitter-provider';\n\nexport class SocialLoginWeb extends WebPlugin implements SocialLoginPlugin {\n  private static readonly OAUTH_STATE_KEY = 'social_login_oauth_pending';\n\n  private googleProvider: GoogleSocialLogin;\n  private appleProvider: AppleSocialLogin;\n  private facebookProvider: FacebookSocialLogin;\n  private twitterProvider: TwitterSocialLogin;\n\n  constructor() {\n    super();\n\n    this.googleProvider = new GoogleSocialLogin();\n    this.appleProvider = new AppleSocialLogin();\n    this.facebookProvider = new FacebookSocialLogin();\n    this.twitterProvider = new TwitterSocialLogin();\n\n    // Set up listener for OAuth redirects if we have a pending OAuth flow\n    if (localStorage.getItem(SocialLoginWeb.OAUTH_STATE_KEY)) {\n      console.log('OAUTH_STATE_KEY found');\n      this.handleOAuthRedirect().catch((error) => {\n        console.error('Failed to finish OAuth redirect', error);\n        window.close();\n      });\n    }\n  }\n\n  private async handleOAuthRedirect(): Promise<void> {\n    const url = new URL(window.location.href);\n    const stateRaw = localStorage.getItem(SocialLoginWeb.OAUTH_STATE_KEY);\n    let provider: string | null = null;\n    let state: string | undefined;\n\n    if (stateRaw) {\n      try {\n        const parsed = JSON.parse(stateRaw);\n        provider = parsed.provider ?? null;\n        state = parsed.state;\n      } catch {\n        provider = stateRaw === 'true' ? 'google' : null;\n      }\n    }\n\n    let result: LoginResult | { error: string } | null = null;\n\n    switch (provider) {\n      case 'twitter':\n        result = await this.twitterProvider.handleOAuthRedirect(url, state);\n        break;\n      case 'google':\n      default:\n        result = this.googleProvider.handleOAuthRedirect(url);\n        break;\n    }\n\n    if (!result) {\n      return;\n    }\n\n    if ('error' in result) {\n      const resolvedProvider = provider ?? null;\n      window.opener?.postMessage(\n        {\n          type: 'oauth-error',\n          provider: resolvedProvider,\n          error: result.error,\n        },\n        window.location.origin,\n      );\n    } else {\n      window.opener?.postMessage(\n        {\n          type: 'oauth-response',\n          provider: result.provider,\n          ...result.result,\n        },\n        window.location.origin,\n      );\n    }\n\n    window.close();\n  }\n\n  async initialize(options: InitializeOptions): Promise<void> {\n    const initPromises: Promise<void>[] = [];\n\n    if (options.google?.webClientId) {\n      initPromises.push(\n        this.googleProvider.initialize(\n          options.google.webClientId,\n          options.google.mode,\n          options.google.hostedDomain,\n          options.google.redirectUrl,\n        ),\n      );\n    }\n\n    if (options.apple?.clientId) {\n      initPromises.push(\n        this.appleProvider.initialize(\n          options.apple.clientId,\n          options.apple.redirectUrl,\n          options.apple.useProperTokenExchange,\n        ),\n      );\n    }\n\n    if (options.facebook?.appId) {\n      initPromises.push(this.facebookProvider.initialize(options.facebook.appId, options.facebook.locale));\n    }\n\n    if (options.twitter?.clientId) {\n      initPromises.push(\n        this.twitterProvider.initialize(\n          options.twitter.clientId,\n          options.twitter.redirectUrl,\n          options.twitter.defaultScopes,\n          options.twitter.forceLogin,\n          options.twitter.audience,\n        ),\n      );\n    }\n\n    await Promise.all(initPromises);\n  }\n\n  async login<T extends LoginOptions['provider']>(\n    options: Extract<LoginOptions, { provider: T }>,\n  ): Promise<{ provider: T; result: ProviderResponseMap[T] }> {\n    switch (options.provider) {\n      case 'google':\n        return this.googleProvider.login(options.options) as Promise<{ provider: T; result: ProviderResponseMap[T] }>;\n      case 'apple':\n        return this.appleProvider.login(options.options) as Promise<{ provider: T; result: ProviderResponseMap[T] }>;\n      case 'facebook':\n        return this.facebookProvider.login(options.options as FacebookLoginOptions) as Promise<{\n          provider: T;\n          result: ProviderResponseMap[T];\n        }>;\n      case 'twitter':\n        return this.twitterProvider.login(options.options as any) as Promise<{\n          provider: T;\n          result: ProviderResponseMap[T];\n        }>;\n      default:\n        throw new Error(`Login for ${options.provider} is not implemented on web`);\n    }\n  }\n\n  async logout(options: { provider: 'apple' | 'google' | 'facebook' | 'twitter' }): Promise<void> {\n    switch (options.provider) {\n      case 'google':\n        return this.googleProvider.logout();\n      case 'apple':\n        return this.appleProvider.logout();\n      case 'facebook':\n        return this.facebookProvider.logout();\n      case 'twitter':\n        return this.twitterProvider.logout();\n      default:\n        throw new Error(`Logout for ${options.provider} is not implemented`);\n    }\n  }\n\n  async isLoggedIn(options: isLoggedInOptions): Promise<{ isLoggedIn: boolean }> {\n    switch (options.provider) {\n      case 'google':\n        return this.googleProvider.isLoggedIn();\n      case 'apple':\n        return this.appleProvider.isLoggedIn();\n      case 'facebook':\n        return this.facebookProvider.isLoggedIn();\n      case 'twitter':\n        return this.twitterProvider.isLoggedIn();\n      default:\n        throw new Error(`isLoggedIn for ${options.provider} is not implemented`);\n    }\n  }\n\n  async getAuthorizationCode(options: AuthorizationCodeOptions): Promise<AuthorizationCode> {\n    switch (options.provider) {\n      case 'google':\n        return this.googleProvider.getAuthorizationCode();\n      case 'apple':\n        return this.appleProvider.getAuthorizationCode();\n      case 'facebook':\n        return this.facebookProvider.getAuthorizationCode();\n      case 'twitter':\n        return this.twitterProvider.getAuthorizationCode();\n      default:\n        throw new Error(`getAuthorizationCode for ${options.provider} is not implemented`);\n    }\n  }\n\n  async refresh(options: LoginOptions): Promise<void> {\n    switch (options.provider) {\n      case 'google':\n        return this.googleProvider.refresh();\n      case 'apple':\n        return this.appleProvider.refresh();\n      case 'facebook':\n        return this.facebookProvider.refresh(options.options as FacebookLoginOptions);\n      case 'twitter':\n        return this.twitterProvider.refresh();\n      default:\n        throw new Error(`Refresh for ${(options as any).provider} is not implemented`);\n    }\n  }\n\n  async providerSpecificCall<T extends ProviderSpecificCall>(options: {\n    call: T;\n    options: ProviderSpecificCallOptionsMap[T];\n  }): Promise<ProviderSpecificCallResponseMap[T]> {\n    throw new Error(`Provider specific call for ${options.call} is not implemented`);\n  }\n\n  async getPluginVersion(): Promise<{ version: string }> {\n    return { version: 'web' };\n  }\n}\n"]}