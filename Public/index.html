<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="app.title">Iskanje Restavracij - Gourmet & Experience</title>

  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
  
  <link
    rel="stylesheet"
    type="text/css"
    href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css"
  />
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script> 
  
  <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.11.5/i18next.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-http-backend/2.5.2/i18nextHttpBackend.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.1/i18nextBrowserLanguageDetector.min.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
/* =================================================================
// ‚≠ê PISAVA 'CREAMCAKE' - OTF format (Brez presledka)
// ================================================================= */
@font-face {
  /* Uporabimo ime brez presledka */
  font-family: 'CreamCake';
  
  /* ‚≠ê POPRAVEK POTI: Uporabimo relativno pot (odpravi zmedo z absolutno potjo /) ‚≠ê */
  src: url('./fonts/Cream Cake.woff2') format('opentype'); 
  
  font-weight: normal;
  font-style: normal;
  font-display: swap; 
}

    
    /*
     * ========================================================================
     * I. STILI ZA PASICO PI≈†KOTKOV (KRITIƒåNI STILI - NA ZAƒåETKU)
     * ========================================================================
     */
    
    /* Osnovno resetiranje/stil za celotno stran - prilagojeno va≈°emu telesu */
    body {
        font-family: Arial, sans-serif;
    }

    /* Pasica za soglasje (glavni vsebnik) */
    .cookie-banner {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 50;
        padding: 1rem; /* p-4 */
        transition: all 0.5s ease-in-out;
    }

    /* Stanje, ko je pasica skrita */
    .cookie-banner.hidden {
        display: none;
    }

    /* Kontejner vsebine pasice */
    .banner-content {
        max-width: 64rem; /* max-w-4xl (1024px) */
        margin-left: auto;
        margin-right: auto;
        background-color: #ffffff; /* bg-white */
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
        border-radius: 3rem; /* rounded-lg */
        padding: 1.25rem; /* p-5 */
        display: flex;
        flex-direction: column; /* flex-col */
        align-items: center;
        justify-content: space-between;
        row-gap: 0.75rem; /* space-y-3 */
        border: 2px solid #333;
    }

    /* Prilagoditev za veƒçje zaslone (md:flex-row) */
    @media (min-width: 768px) {
        .banner-content {
            flex-direction: row;
            row-gap: 0;
        }
    }

    /* Skupina besedila in ikone */
    .banner-text-group {
        display: flex;
        align-items: center;
        column-gap: 0.75rem; /* space-x-3 */
        color: #4b5563; /* text-gray-700 */
    }

    /* Ikona pi≈°kotka */
    .icon-cookie {
        height: 1.5rem; /* h-6 */
        width: 1.5rem; /* w-6 */
        color: #4edaa9; /* text-emerald-500 */
        flex-shrink: 0;
    }

    /* Sporoƒçilo */
    .text-message {
        font-size: 0.875rem; /* text-sm */
        margin: 0;
    }

    /* Povezava "Preberi veƒç" */
    .link-more-info {
        color: #4edaa9; /* text-emerald-600 */
        font-weight: 500; /* font-medium */
        margin-left: 0.25rem; /* ml-1 */
        text-decoration: none;
        transition: color 150ms ease-in-out;
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .link-more-info:hover {
        color: #4edaa9; /* hover:text-emerald-800 */
    }

    /* Skupina gumbov */
    .banner-button-group {
        display: flex;
        column-gap: 0.75rem; /* space-x-3 */
        flex-shrink: 0;
    }

    /* Osnovni stil za gumbe */
    .banner-button-group button {
        padding: 0.5rem 1rem; /* px-4 py-2 */
        font-size: 0.875rem; /* text-sm */
        font-weight: 600; /* font-semibold */
        border-radius: 5rem; /* rounded-lg */
        transition: background-color 150ms ease-in-out, box-shadow 150ms ease-in-out;
        border: none;
        cursor: pointer;
        /* Odstrani moder poudarek za mobilne naprave */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    /* Gumb za zavrnitev (Decline) */
    .btn-decline {
        color: #4b5563; /* text-gray-600 */
        background-color: #f3f4f6; /* bg-gray-100 */
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .btn-decline:hover {
        background-color: #e5e7eb; /* hover:bg-gray-200 */
    }

    /* Gumb za sprejem (Accept) */
    .btn-accept {
        color: #ffffff; /* text-white */
        background-color: #4edaa9; /* bg-emerald-600 */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-md */
    }

    .btn-accept:hover {
        background-color: #27a378; /* hover:bg-emerald-700 */
    }

    /* Animacija, da se pasica elegantno pojavi (slide-in-up) */
    .slide-in-up {
        animation: slideInUp 0.5s ease-out forwards;
    }
    @keyframes slideInUp {
        from { 
            transform: translateY(100%); 
            opacity: 0; 
        }
        to { 
            transform: translateY(0); 
            opacity: 1; 
        }
    }
    
    /*
 * ========================================================================
 * II. OSTALI STILI (MODALI, KARTICE, ITD.)
 * ========================================================================
 */

/* ===== MODAL ZA PRIJAVO / REGISTRACIJO (OSTANE NESPREMENJENO) ===== */
.login-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    overflow-y: auto;
}

.login-modal.active {
    display: flex;
}

.login-content {
    background: #fff;
    padding: 30px;
    border-radius: 16px;
    width: 350px;
    max-width: 90%;
    text-align: center;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
    position: relative;
    animation: fadeIn 0.3s ease;
    margin: 50px auto;
}

@media (max-width: 600px) {
    .login-content {
        padding: 20px;
        margin: 20px auto;
    }
}


@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.login-tabs {
    /* POPRAVEK: Uporabimo center in nastavimo razmak s spodnjim robom */
    display: flex !important; /* <--- DODANO ZA TESTIRANJE */
    justify-content: center !important; /* <--- DODANO ZA TESTIRANJE */
    margin-bottom: 20px;
}

.login-tab {
    /* ‚≠ê AGRESIVNEJ≈†I POPRAVEK: Veƒçji razmak in klikalno obmoƒçje */
    /* flex: 1; */
    padding: 10px 20px; /* POVEƒåANO horizontalno oblazinjenje za bolj≈°i dotik (20px) */
    margin: 0 15px;    /* POVEƒåAN horizontalni rob med zavihkoma (15px) */
    cursor: pointer;
    font-weight: bold;
    border-bottom: 2px solid transparent;
    transition: 0.2s;
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}

.login-tab.active {
    
    color: #076b6a;
    border-bottom: 2px solid #076b6a; /* Dodan border za aktiven tab */
}

.login-form {
    display: none;
}

.login-form.active {
    display: block;
}

/* ‚≠ê POPRAVLJEN BLOK: Vkljuƒçujemo tudi SELECT element ‚≠ê */
.login-form input,
.login-form select { /* ‚¨ÖÔ∏è KLJUƒåNA SPREMEMBA: Dodan 'select' */
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    border: 1px solid #ccc;
    border-radius: 8px;
    /* POPRAVEK ZA ZOOM: Nastavimo velikost pisave na 16px, da prepreƒçimo avtomatsko poveƒçavo */
    font-size: 16px !important;
    
    /* Zagotavljanje pravilne poravnave in videza za <select> */
    box-sizing: border-box; /* Kljuƒçno za ≈°irino 100% */
    -webkit-appearance: none; /* Odstrani privzete sloge brskalnika */
    -moz-appearance: none;
    appearance: none;
}
/* ‚≠ê KONEC POPRAVLJENEGA BLOKA ‚≠ê */

/* Dodatni stili za barvo besedila v spustnem meniju za bolj≈°i UX (neobvezno, a priporoƒçljivo) */
.login-form select:invalid {
    color: #888; /* Sivo, ko je izbrana privzeta/neveljavna opcija */
}

.login-form select:valid {
    color: #333; /* Temno, ko je izbrana veljavna opcija */
}

    /* ----------------------------------------------------------------- */
    /* üî• NOVI STILI ZA POGOJE IN ONEMOGOƒåEN GUMB üî• */
    /* ----------------------------------------------------------------- */

    .form-group-checkbox {
        display: flex;
        align-items: flex-start; /* Poravnaj kljukico in besedilo na zaƒçetek */
        margin-bottom: 15px; /* Dodamo malo razmika pod kljukico */
        text-align: left;
    }

    .form-group-checkbox input[type="checkbox"] {
        width: auto; /* Kljukica naj ne zavzame celotne ≈°irine */
        margin-right: 8px;
        margin-top: 3px; /* Lahka prilagoditev za vertikalno poravnavo */
        border-radius: 4px;
        accent-color: #076b6a; /* Barva kljukice */
                  /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .form-group-checkbox label {
        font-size: 0.85rem;
        color: #555;
        line-height: 1.4;
        cursor: pointer;
                  /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .form-group-checkbox a {
        color: #076b6a;
        font-weight: bold;
        text-decoration: none;
        transition: color 0.2s;
        
    }

    .form-group-checkbox a:hover {
        color: #076b6a;
        text-decoration: underline;
        
    }

    .required-star {
        color: red;
        margin-left: 2px;
        font-weight: bold;
    }

    /* Stil za gumb za oddajo */
    .login-form button {
      width: 100%; /* Nastavite ≈°irino na 100% za bolj≈°i mobilni videz */
      padding: 10px;
      border: none;
      border-radius: 8px;
      background-color: #076b6a;
      color: #f3f3f3;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
                /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .login-form button:hover:not(:disabled) {
      background-color: #076b6a;
    }

    /* Poseben stil, ko je gumb onemogoƒçen (disabled) */
    .login-form button:disabled {
        background-color: #cccccc; /* Svetlo siva, da je oƒçitno onemogoƒçeno */
        color: #888888;
        cursor: not-allowed;
        box-shadow: none;
    }
    
    /* ----------------------------------------------------------------- */
    /* üî• KONEC NOVIH STILOV üî• */
    /* ----------------------------------------------------------------- */

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
      color: #333;
      border-radius: 50%;
      display: flex; /* Uporabimo flexbox za centriranje X-a */
      justify-content: center; /* Centriraj X horizontalno */
      align-items: center; /* Centriraj X vertikalno */
      transition: background-color 0s ease, color 0s ease;
      z-index: 10000;

      /* >>> KLJUƒåNE SPREMEMBE ZA CENTRIRANJE ZNAKA 'X' <<< */
      line-height: 1; /* Pomembno: Odstranimo privzeti razmik vrstic, ki potiska X navzdol */
      /* ƒåe je X ≈°e vedno malo previsoko/prenizko, lahko prilagodite s tem: */
      /* transform: translateY(-1px); */ /* Poskusi to, ƒçe je potrebno malo navzgor/navzdol */
    }

      
        
        /* ===== MODAL ZA TRAJANJE OBISKA (NOV STIL) ===== */
        .duration-modal {
          display: none;
          position: fixed;
          z-index: 9999;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7); /* Temnej≈°e ozadje za opozorilo */
          justify-content: center;
          align-items: center;
          overflow-y: auto;
        }

        .duration-modal.active {
          display: flex;
        }

        .duration-content {
          background: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 380px;
          max-width: 90%;
          text-align: left;
          box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
          position: relative;
          animation: fadeIn 0.3s ease;
          margin: 50px auto;
        }

        .duration-content h3 {
            color: #0c3c36;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4rem;
            text-align: center;
        }

        .duration-content label {
            display: block;
            margin-bottom: 0px;
            font-weight: bold;
            color: #333;
            font-size: 0.9rem;
        }
        
        .duration-opcije {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .duration-opcija {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #333;
        }
        
        .duration-opcija:hover {
            border-color: #148a86;
            background-color: #ffffff;
        }

        .duration-opcija input[type="radio"] {
            margin-right: 15px;
            /* Skrijemo standardni radio gumb in ga stiliziramo */
            appearance: none; 
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #aaa;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }
        
        .duration-opcija input[type="radio"]:checked {
            border-color: #333;
        }
        
        .duration-opcija input[type="radio"]:checked::before {
            content: '';
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block;
        }
        
        .duration-opcija.selected {
            border-color: #076b6a;
            background-color: #076b6a; /* Dodamo rahel odtenek za bolj≈°o vidljivost izbrane opcije */
            /* Zamenjaj barvo poudarka za la≈æjo berljivost */
            border-color: #076b6a; 
            /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }
        
        .duration-opcija.selected input[type="radio"]:checked {
            border-color: #e1e1e1;
        }

        .duration-opcija.selected input[type="radio"]:checked::before {
            background-color: #e1e1e1;
        }


        .gumb-potrdi-trajanje {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #148a86;
            color: #f2f2f2;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }

        .gumb-potrdi-trajanje:hover {
            background-color: #076b6a;
        }
        /* Slogi za opomnik o QR kodi in toƒçkah znotraj modalnega okna */
.duration-content .qr-reminder-text {
    margin-top: 15px; /* Odmik od gumba */
    font-size: 1em;
    color: #666; /* Nevtralno sivo besedilo */
    text-align: center;
    border-top: 1px solid #dddddd; /* Ne≈æna loƒçilna ƒçrta nad besedilom */
    padding-top: 15px;
}
        
        /* ======================================================= */
        /* V. CUSTOM WARNING MODAL - NOVO OBLIKOVANJE ZA OPOZORILO */
        /* ======================================================= */
        
        .warning-modal {
          display: none;
          position: fixed;
          z-index: 10000; /* Najvi≈°ji z-index */
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          justify-content: center;
          align-items: center;
          overflow-y: auto;
          /* Dopolnitev stila za animacijo ob prikazu/skrivanju */
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        .warning-modal.active {
          display: flex;
          opacity: 1;
        }

        .warning-content {
          background: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 350px;
          max-width: 90%;
          text-align: center;
          box-shadow: 0 5px 30px rgba(0, 0, 0, 0.4);
          position: relative;
          animation: fadeIn 0.3s ease;
          margin: 50px auto;
          /* Dopolnitev: ƒåe je modal aktiven, se animacija izvede */
          transform: scale(0.95);
          transition: transform 0.3s ease;
        }

        .warning-modal.active .warning-content {
            transform: scale(1);
        }
        
        .warning-icon-wrapper {
            margin: 0 auto 20px;
            width: 60px;
            height: 60px;
            background-color: #ffedcc; /* Svetlo rumeno/oran≈æno ozadje */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ffcc66;
        }

        .warning-icon {
            font-size: 32px;
            color: #ff9900; /* Moƒçna oran≈æna barva ikone (fas fa-exclamation-triangle) */
        }

        .warning-content h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .warning-content p {
            color: #555;
            margin-bottom: 25px;
        }

        .gumb-razumem {
            width: 60%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background-color: #20c0bd; /* Uporabimo glavno barvo projekta */
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .gumb-razumem:hover {
            background-color: #076b6a;
        }

        /* ===== GUMBI V GLAVI (OSTANE NESPREMENJENO) ===== */
        .gumb-prijava, 
        .gumb-profil, 
        /*... ostalo oblikovanje od tu naprej ostane popolnoma nespremenjeno ...*/
        .gumb-odjava {
          display: inline-flex;
          align-items: center;
          gap: 10px;
          padding: 4px 12px;
          border-radius: 25px;
          font-weight: bold;
          text-decoration: none;
          transition: background-color 0.2s, color 0.2s, border-color 0.2s;
          white-space: nowrap;
          font-size: 14px;
        }

        .gumb-prijava,
        .gumb-profil {
          background-color: #333;
          color: white;
          border: 1px solid #333;
        }

        .gumb-prijava:hover, 
        .gumb-profil:hover {
          background-color: #575757;
          border-color: #575757;
        }
        
        .gumb-odjava {
          background-color: transparent;
          color: #333;
          border: 1px solid #333;
        }
        
        .gumb-odjava:hover {
          background-color: #dadada;
          color: #575757;
          border-color: #575757;
        }

        .profil-ovoj {
          display: flex;
          align-items: center;
          gap: 10px; 
        }
        
     /* ===== KARTICA RESTAVRACIJE (PRILJUBLJENO - VEƒåJA KARTICA) ===== */
        .kartica {
            border: 1px solid #ececec;
            
            /* SPREMENJENO: Loƒçene lastnosti za radius vsakega vogala */
            border-top-left-radius: 10px;    /* Radius zgoraj levo */
            border-top-right-radius: 10px;   /* Radius zgoraj desno */
            border-bottom-right-radius: 10px; /* Radius spodaj desno */
            border-bottom-left-radius: 10px;  /* Radius spodaj levo */
            
            /* Prej≈°nja enotna lastnost: border-radius: 10px; */
            
            overflow: hidden; 
            box-shadow: 10 5px 5px rgb(0, 0, 0);
            transition: transform 0.0s, box-shadow 0.0s;
            background-color: rgb(255, 255, 255);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }

        .kartica:hover {
            transform: translateY(0px);
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.0);
        }

        .kartica-slika {
            width: 100%;
            height: 150px; 
            object-fit: cover;
            background-color: #f5f5f5; 
        }

        .kartica-vsebina {
            padding: 15px;
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
        }

        .kartica-vsebina h3 {
            font-size: 1rem; 
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            
        }
        
        /* NOVI STIL: Ovoj za oceno in oddaljenost */
        .info-ocena-oddaljenost {
            display: flex;
            flex-wrap: wrap; /* Kljuƒçno za prelom vrstice */
            justify-content: space-between; /* Kljuƒçno za loƒçitev ocene in razdalje */
            align-items: center;
            margin-bottom: 0px;
            padding-bottom: 0px;
            border-bottom: 0px solid #e0e0e0;
        }

        .kartica-vsebina .ocena {
            /* INTERNA OCENA: Order 1 (levo zgoraj) */
            order: 1; 
            font-size: 0.9rem;
            color: #333; 
            margin: 0;
            font-weight: bold;
        }

        .kartica-vsebina .ocena span.ocena-stevilka {
            color: #333; 
            font-weight: bold;
            margin-left: 0px;
            font-size: 1.1rem;
        }
        
        /* Stil za navidezno oddaljenost */
        .oddaljenost {
            /* RAZDALJA: Order 2 (desno zgoraj, ob interni oceni) */
            order: 2; 
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 2px;
            margin-right: 5px;
        }
        .oddaljenost i {
            color: #1f1f1f; /* Ikona v modri barvi */
        }

        /* Stil za Google oceno na kartici */
        .kartica .google-ocena {
            /* GOOGLE OCENA: Order 3 in 100% ≈°irina (nova vrstica) */
            order: 3; 
            width: 100%; 
            
            font-size: 0.8rem;
            font-weight: bold; 
            color: #333; 
            margin-top: 10px; 
            margin-bottom: 0;
            display: flex;
            align-items: center;
        }

        .kartica .google-ocena .fab.fa-google {
            font-size: 0.9em; 
            margin-right: 4px; 
            color: #4285F4; /* Googlova modra */
        }


        /* Stil za polje razpolo≈æljivosti (Ostane na dnu) */
        .razpolozljivost-ovoj {
            margin-top: auto; /* Pritisne ga na dno */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 0px;
            border-radius: 6px;
            background-color: white; /* Svetlo zeleno/turkizno ozadje */
            border: 1px solid white;
        }

        .razpolozljivost-ovoj strong {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .razpolozljivost-ovoj span {
            font-size: 0.85rem;
            font-weight: bold;
            color: #1a9e9a; /* Temnej≈°a zelena/turkizna */
        }

        .razpolozljivost-ovoj.zasedeno {
             background-color: white; /* Svetlo rdeƒçe ozadje */
             border: 1px solid white;
        }

        .razpolozljivost-ovoj.zasedeno span {
            color: #dc3545; 
        }
        
        /* Gumb rezervacija (ƒçe bi bil) */
        .gumb-rezervacija {
            display: block;
            width: 100%;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            background-color: #20c0bd; 
            color: white;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.2s;
            margin-top: 10px; 
            cursor: pointer;
        }

        .gumb-rezervacija:hover {
            background-color: #1a9e9a;
        }
        
   /* ======================================================= */
/* NOVO: KARTICA IZPOSTAVLJENO (MANJ≈†A KARTICA) */
/* ======================================================= */
.kartica-izpostavljeno {
    /* Nadomesti pravila osnovne .kartica */
    display: flex;
    flex-direction: column;
    overflow: hidden;
    
    /* SPREMENJENO: Loƒçene lastnosti za radius vsakega vogala */
    border-top-left-radius: 10px;    /* Radius zgoraj levo */
    border-top-right-radius: 10px;   /* Radius zgoraj desno */
    border-bottom-right-radius: 10px; /* Radius spodaj desno */
    border-bottom-left-radius: 10px;  /* Radius spodaj levo */
    
    /* Prej≈°nja enotna lastnost: border-radius: 10px; */
    
    width: 100%;
    height: 250px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    background-color: #88d82d; /* Svetlo ozadje */
    transition: box-shadow 0.2s, transform 0.2s;
    border: 0px solid #333;
}

.kartica-izpostavljeno:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(0px);
    
    
}

/* SPREMENJENO: Zmanj≈°ano na 50px za ≈°e manj≈°o vi≈°ino slike */
.kartica-izpostavljeno .slika-kartice {
    width: 100%;
    height: 220px; 
    background-size: cover;
    background-position: center;
    background-color: #f5f5f5;
    
    /* ‚≠ê KLJUƒåNA SPREMEMBA 1: Nastavitev relativnega pozicioniranja za otro≈°ke elemente */
    position: relative;
}

/* ‚≠ê KLJUƒåNA SPREMEMBA 2: STILI ZA OKROGLO OZNAKO POPUSTA (POPRAVLJENO) */
.kartica-izpostavljeno .slika-kartice .oznaka-ponudbe {
    position: absolute; 
    top: 10px;          
    right: 10px;        
    
    /* Oblikovanje za okroglo obliko */
    background-color: #88d82d; /* Rdeƒça/izstopajoƒça barva za popust */
    color: #131313;               /* Belo besedilo */
    
    /* üî• KLJUƒåNA SPREMEMBA: Enak padding za krog (vi≈°ina == ≈°irina) */
    padding: 8px; 
    
    /* üî• KLJUƒåNA SPREMEMBA: Nastavitev za popolnoma okroglo obliko */
    border-radius: 50%;
    
    font-size: 0.9rem;
    font-weight: 700;
    
    /* Odstranimo text-transform, ker se morda ne prilega */
    text-transform: none; 
    
    /* Dodatni stili */
    z-index: 10; 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
    
    /* Po ≈æelji, da besedilo bolje stoji na sredini */
    line-height: 1; 
    display: flex;
    align-items: center;
    justify-content: center;
    width: 45px; /* Fiksna ≈°irina in vi≈°ina za popoln krog */
    height: 45px;
}
/* ---------------------------------------------------- */


/* SPREMENJENO: Zmanj≈°an padding na 6px */
.kartica-izpostavljeno .vsebina-kartice-izpostavljeno {
    padding: 10px; 
    text-align: center;
}

/* SPREMENJENO: Zmanj≈°ana velikost pisave na 0.85rem */
.kartica-izpostavljeno .vsebina-kartice-izpostavljeno h3 {
    font-size: 0.9rem; 
    font-weight: 600;
    margin: 0;
    color: #333;
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis; 
    
}
    

    
    /* ======================================================= */
    /* MODAL PODROBNOSTI RESTAVRACIJE (OSTANE NESPREMENJENO) */
    /* ======================================================= */
    .restavracija-modal {
        display: none; 
        position: fixed; 
        z-index: 9990; 
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto; 
        background-color: rgba(0, 0, 0, 0.7); 
        justify-content: center;
        align-items: flex-start; 
        padding: 50px 0; 
    }

    .restavracija-modal.active {
        display: flex;
    }

    .restavracija-vsebina {
        background-color: #fefefe;
        margin: auto; 
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 800px; 
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: modalSlide 0.4s ease-out;
        min-height: 450px;
    }
    
    @keyframes modalSlide {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
    }

/* GUMB ZA ZAPIRANJE (X) */
.gumb-zapri-restavracija {
    position: absolute;
    top: 15px;
    right: 15px;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 35px;
    font-weight: bold;
    cursor: pointer;
    z-index: 9991; 
    transition: background-color 0s;
    /* >>> KLJUƒåNI POPRAVEK ZA CENTRIRANJE ZNAKA 'X' <<< */
    line-height: 1; 
    /* Opcijski mikro-popravek, ƒçe je X ≈°e vedno rahlo prenizko zaradi pisave */
    /* Poskusite dodati to, ƒçe je potrebno: */
    /* transform: translateY(-1px); */ 
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}
.gumb-zapri-restavracija:hover {
    background-color: transparent;
}

    .slika-glava {
        width: 100%;
        height: 400px;
        background-size: cover;
        background-position: center;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        position: relative;
    }
    
    .podrobnosti-tekst {
        padding: 25px;
        padding-bottom: 0;
    }

    .podrobnosti-tekst h2 {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #333;
    }
    
    /* Prilagoditev velikosti naslova na mobilnem telefonu */
    @media (max-width: 600px) {
        .restavracija-vsebina {
            margin: 20px 10px; 
        }
        .podrobnosti-tekst h2 {
            font-size: 1.5rem;
        }
    }

    .info-vrstica {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        font-size: 0.95rem;
        color: #666;
        flex-wrap: wrap;
    }
    
    .info-vrstica > span {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .info-vrstica i {
        color: #333;
    }

    .opis-restavracije {
        font-size: 1rem;
        color: #555;
        line-height: 1.6;
        margin-bottom: 20px;
    }

 .gumb-rezerviraj-modal {
        display: block;
        width: 60%;
        padding: 10px;
        margin-top: 25px;
        text-align: center;
        border-radius: 20px;
        background-color: #169B99; 
        color: #f5f5f5;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        transition: background-color 0.2s;
        cursor: pointer;
        /* üëá DODAJTE TA KLJUƒåNI AGRESIVNI POPRAVEK ZA ANDROID üëá */
        border: none !important; /* Odstrani morebitne robove */
        outline: none !important; /* Odstrani fokusni obroƒç */
        box-shadow: none !important; /* Odstrani morebitno senco ob pritisku */
        -moz-appearance: none; /* Za Firefox/Starej≈°e brskalnike */
        -webkit-appearance: none; /* Za Chrome/Android */
        appearance: none; /* Standardno */
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }
    .gumb-rezerviraj-modal:hover {
        background-color: #148a86;
        color: white;
        font-size: 1rem;
        font-weight: 600;
    }
    /* üëá Tega NE potrebujete veƒç, saj so pravila ≈æe v osnovnem bloku! üëá */
    /* .gumb-rezerviraj-modal:focus {
        outline: none; 
        box-shadow: none; 
    } */
    /* üëÜ ZAKLJUƒåEK: ODSTRANITE TA BLOK üëÜ */

    /* ======================================================= */
    /* ZAVIHKE (TABS) - OSTANE NESPREMENJENO */
    /* ======================================================= */
    .modal-tabs {
        display: flex;
        border-bottom: 0px solid #ddd;
        margin-top: 15px;
        padding: 0 25px;
        background-color: #ffffff; 
        overflow-x: auto; 
        -webkit-overflow-scrolling: touch; 
    }
    
    .modal-tab {
        flex-shrink: 0; 
        padding: 5px 20px; 
        border-radius: 25px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600; 
        color: #333;
        border: 1px solid #076b6a;
        transition: color 0.0s, border-bottom-color 0.0s, background-color 0.0s;
        margin-right: 5px; 
        white-space: nowrap; 
        position: relative;
    }
    
    .modal-tab.active {
        color: #ffffff;
        border-bottom-color: none;
        background-color: #169B99;
        border-radius: 25px;
        margin-bottom: 0px; 
        box-shadow: 0 2px 10px rgba(49, 49, 49, 0.276);
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }
    
    .modal-tab:not(.active):hover {
        color: #333;
        background-color: #ffff;
    }

    .modal-vsebina-ovoj {
        padding: 25px;
    }
    
    .modal-vsebina-skrol {
        max-height: 60vh; 
        overflow-y: auto; 
        padding-right: 15px; 
    }
    
    @media (max-width: 600px) {
        .modal-vsebina-skrol {
            max-height: 70vh; 
        }
    }


    .tab-content {
        display: none;
        animation: tabFadeIn 0.3s ease;
        padding-top: 10px;
    }
    .tab-content.active {
        display: block;
    }

    @keyframes tabFadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Meni */
    .meni-seznam ul {
        list-style: none;
        padding: 0;
    }
    
    .meni-seznam ul li {
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }
    
    .meni-seznam ul li:last-child {
        border-bottom: none;
    }

    .meni-seznam ul li strong {
        display: block;
        color: #333;
        font-size: 14px;
        font-weight: 500; 
    }

/* Slike in Zemljevid */
.galerija-slike {
    /* 1. Kljuƒçno: Uporabite Flexbox za eno vodoravno vrstico */
    display: flex;
    
    /* 2. Kljuƒçno: Omogoƒçi vodoravno drsenje, ko vsebina prese≈æe ≈°irino */
    overflow-x: scroll;
    
    /* 3. Doloƒçite razmik med slikami */
    gap: 1rem; 
    
    /* Dodamo horizontalni padding le za vizualni odmik prve/zadnje slike od roba zaslona */
    padding-left: 1rem;
    padding-right: 1rem;
    
    /* Navpiƒçni prostor med glavno sliko in galerijo */
    margin-top: 1rem;
    
    /* POPRAVEK: Poveƒçan negativni rob na -2rem, da preglasi padding nadrejenega elementa */
    margin-left: -1.6rem; 
    margin-right: -1.6rem; 
    
    margin-bottom: 20px;
}

/* Pravila za posamezni element, ki vsebuje sliko */
.galerija-slike > div {
    flex-shrink: 0;
    
    /* Zagotovite FIKSNO kvadratno vi≈°ino: */
    width: 200px !important; 
    height: 200px !important; 
    
    position: relative;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
}

/* Pravila za IMG tag znotraj DIVa */
.galerija-slike img {
    /* Raztegnite sliko, da POPOLNOMA zapolni okvir */
    width: 100% !important; 
    height: 100% !important; 
    
    object-fit: cover !important; /* Zagotovite, da se izre≈æe in ne deformira */
    cursor: pointer;
    transition: opacity 0.3s;
}

.galerija-slike img:hover {
    opacity: 0.9;
}

    /* üî• POPRAVEK ZA LEAFLET: Ciljamo tudi na novi ovoj #map-container */
    .zemljevid-ovoj,
    #map-container {
        width: 100%;
        /* Poveƒçana vi≈°ina za bolj≈°i prikaz navodil za pot (Routing Machine) */
        height: 400px; 
        background-color: #eee;
        border-radius: 8px;
        overflow: hidden;
        /* Dodamo position, ƒçe je potrebno za z-index in absolutno pozicioniranje notranjih elementov Leafleta */
        position: relative; 
    }
    
    /* üî• NOVO PRAVILO: Zagotovimo, da Leaflet div zavzame celoten prostor */
    #leaflet-map {
        width: 100%;
        height: 100%;
        /* z-index je kljuƒçen, da se kontrolniki prika≈æejo nad vsem ostalim v modalu */
        z-index: 1000; 
    }

    /* Ohranjena pravila za stare iframe, ƒçe jih ≈°e kje uporabljate */
    .zemljevid-ovoj iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    /* PRILAGODITEV ZA MOBILNE NAPRAVE (do 480px) */
    @media (max-width: 480px) {
        .modal-tabs {
            padding: 0 10px; 
        }
        
        .modal-tab {
             padding: 10px 15px; 
        }
        
        .modal-vsebina-ovoj {
            padding: 15px; 
        }
        
        .podrobnosti-tekst {
            padding: 15px 15px 0 15px;
        }
        
        .slika-glava {
            height: 300px; 
        }
        
        .galerija-slike {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }
        .galerija-slike img {
            height: 100px;
        }
        
        /* üî• POPRAVEK ZA MOBILNI ZEMLJEVID */
        .zemljevid-ovoj,
        #map-container {
            height: 300px; /* Prilagoditev vi≈°ine za mobilni zaslon */
        }
    }
    
    /* ======================================================= */
    /* MOBILNI MENI LOGIKA ZA MOBILNI POGLED (do 768px) */
    /* ======================================================= */
    
    .hamburger-gumb {
        display: none;
        background: none;
        border: none;
        font-size: 26px;
        cursor: pointer;
        color: #f0f0f0;
        padding: 0;
        z-index: 1;
    }
    
    .mobilni-meni {
        display: none;
    }
    
    .glava .akcije {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    @media (max-width: 768px) {
        .glava {
            justify-content: space-between;
            padding: 10px 20px;
            position: relative; 
        }

        .glava .akcije {
            display: none; 
        }

        .hamburger-gumb {
            display: block; 
        }

        .mobilni-meni {
            position: absolute;
            top: 100%; 
            right: 0;
            width: 60%; 
            max-width: 200px;
            background-color: white;
            border-top: 0px solid #eee;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 999;
            padding: 15px;
            flex-direction: column;
            gap: 10px;
            transform: translateX(100%); 
            transition: transform 0.3s ease-out;
            border-bottom-left-radius: 8px;
        }

        .mobilni-meni.active {
            display: flex;
            transform: translateX(0); 
        }
        
        /* Gumbi Prijava/Odjava/Profil */
        .mobilni-meni .gumb-prijava {
            width: 55%;
            justify-content: center;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 20px;
            background-color: #575757; 
            border-color: #575757;
            align-self: center; 
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }
        
        .mobilni-meni .profil-ovoj {
             display: flex;
             flex-direction: column;
             gap: 10px;
             width: 100%;
             align-items: center; 
        }

        .mobilni-meni .gumb-profil,
        .mobilni-meni .gumb-odjava {
            width: 55%; 
            justify-content: center;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 20px;
            transition: all 0.2s;
            
        }
        
        .mobilni-meni .gumb-profil {
            background-color: #575757;
            border-color: #575757;
        }

        .mobilni-meni .gumb-odjava {
            color: #555;
            border: 1px solid #ccc;
        }

        .mobilni-meni .gumb-odjava:hover {
            background-color: #f5f5f5;
            color: #333;
            border-color: #aaa;
        }


        .mobilni-meni .jezik-ovoj {
            display: flex;
            align-items: center;
            padding: 10px 0;
            gap: 10px;
            border-top: 1px solid #eee;
            margin-top: 5px;
            padding-top: 15px;
            width: 100%;
            justify-content: center; 
        }
        
        /* POPRAVEK JEZIKA NA MOBILNEM: Manj≈°i, brez robov */
        .mobilni-meni .jezik-ovoj select {
            flex-grow: 0; /* Ne raste naj, da ostane majhen */
            width: auto;
            min-width: 60px; /* Minimalna ≈°irina */
            padding: 6px 8px; /* Zmanj≈°an padding */
            font-size: 14px;
            font-weight: bold;
            color: #555;
            background-color: #f7f7f7; /* Svetlo ozadje */
            border: none; /* Odstranjen okvir */
            border-radius: 6px; /* Majhen zaokro≈æen rob */
            appearance: none; 
            /* Uporabimo manj≈°o, diskretno pu≈°ƒçico */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23555%22%20d%3D%22M287%20197.8%20L146.2%2057%20L5.4%20197.8%20L48.6%20241%20L146.2%20143.4%20L243.8%20241%20L287%20197.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 5px center;
            background-size: 8px auto; /* Manj≈°a pu≈°ƒçica */
            padding-right: 20px; /* Dodaten padding za pu≈°ƒçico */
            box-shadow: none;
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }
        
        /* ƒåe je izbirnik jezika premajhen, ga centraliziramo */
        .mobilni-meni .jezik-ovoj i {
            color: #777;
        }
    }

    /* ========================================================= */
    /* üî•üî•üî• NOVO: STILI ZA REZERVACIJSKA POLJA V MODALU üî•üî•üî• */
    /* ========================================================= */

    .rezervacija-vnosna-polja {
        display: flex; /* Polja postavimo v vrsto */
        gap: 20px;
        margin: 20px 25px; /* Dodan razmik okoli polj (gor/dol, levo/desno) */
        padding: 15px 0;
        border-top: 0px solid #eee; 
        border: 0px solid #eee;
    }
    
    @media (max-width: 600px) {
        .rezervacija-vnosna-polja {
            flex-direction: column; /* Na mobilnem postavimo pod seboj */
            gap: 15px;
            margin: 15px 30px; 
            padding: 30px 0;
        }
    }

    .vnosno-polje {
        flex: 1; 
        display: flex;
        flex-direction: column;
        
    }

   .input-rezervacija {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 20px; /* Ohranimo zaobljene robove */
    font-size: 16px;
    cursor: pointer;
    background-color: white;
    width: 45%;
    box-shadow: 0 0px 4px rgba(60, 60, 60, 0.333);
    
    /* üëá DODANE LASTNOSTI ZA STANDARDIZACIJO VIDEZA SELECT ELEMENTA üëá */
    
    /* 1. Odstranitev privzetega videza (Kriv za razliko med Safarijem in Chromom) */
    -webkit-appearance: none; /* Za Safari/Chrome */
    -moz-appearance: none;    /* Za Firefox */
    appearance: none;         /* Standard */
    
    /* 2. Dodajanje pu≈°ƒçice po meri (ker je bila privzeta odstranjena) */
    /* Uporabimo pu≈°ƒçico SVG v Base64 */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23333333' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center; /* Premaknjeno nekoliko levo od roba */
    background-size: 12px;
    
    /* 3. Prepreƒçitev, da padding vpliva na velikost (preventivno) */
    box-sizing: border-box; 
    
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */ 
    
    /* üëá DODATKI, KI STE JIH ≈ΩE IMELI üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}

    .vnosno-polje label {
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
        font-size: 0.9rem;
    }
    
    /* Stil za kontejner, kamor se vstavijo gumbi (ure) */
    .proste-ure-rezultati {
        min-height: 40px; 
        padding: 15px 25px; /* Dodan padding, da je v enakem obmoƒçju kot vsebina modala */
        text-align: center;
    }
    
    @media (max-width: 600px) {
        .proste-ure-rezultati {
             padding: 15px 15px; 
        }
    }

    /* Kontejner za gumbe, ko jih JavaScript ustvari */
    .gumbi-proste-ure {
        display: flex;
        gap: 10px;
        flex-wrap: wrap; 
        justify-content: center;
        padding-top: 10px;
    }

    /* Stil za gumb ure (kljuƒçen, da se prika≈æejo lepi gumbi za ure) */
    .gumb-ura {
        background-color: #ffffff;
        color: #333;
        border: 1px solid #333;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s, border-color 0.2s;
        font-size: 14px;
        flex-shrink: 0;
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .gumb-ura:hover {
        background-color: #169B99;
        border: 1px solid #169B99; /* Rdeƒç rob kot poudarek */
    
    }

    /* Stil za izbran gumb ure */
    .gumb-ura.selected {
        background-color: #169B99; /* Barva poudarka */
        color: #333;
        border-color: #169B99;
        font-weight: bold;
    }
 /* =================================================== */
/* GLOBALNI STILI ZA NOGO (veliki zasloni) */
/* =================================================== */
.noga {
    background-color: #2c2c2c; /* Temna podlaga, kot na sliki */
    color: #cccccc;
    padding: 15px 5%; /* Horizontalni padding za odmik od robov */
    font-size: 14px;
}

.noga-vsebina {
    display: flex; /* Razporedi sekcije v vrsto na velikih zaslonih */
    justify-content: space-between;
    padding-bottom: 20px;
    border-bottom: 1px solid #444; /* Loƒçilo nad plaƒçili/avtorskimi pravicami */
}

.noga-sekcija {
    flex: 1; /* Enaka ≈°irina za vse sekcije na velikih zaslonih */
    padding-right: 20px;
}

.noga-naslov {
    color: #ffffff;
    font-size: 16px;
    margin-bottom: 15px;
    font-weight: bold;
    /* Poka≈æe, da je klikabilen */
    cursor: pointer; 
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}

.noga-linki {
    list-style: none;
    padding: 0;
    margin: 0;
    /* Povezave so privzeto vidne na velikih zaslonih */
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}

.noga-linki li {
    margin-bottom: 8px;
}

.noga-linki a {
    color: #cccccc;
    text-decoration: none;
    transition: color 0.2s;
}

.noga-linki a:hover {
    color: #ffffff;
}

/* Skrijemo ikono preklopa na velikih zaslonih (ƒçe je bila prej vkljuƒçena) */
.noga-naslov:after {
    content: none !important;
}

/* =================================================== */
/* DODATNA INFORMACIJA (Plaƒçila in Avtorske pravice) */
/* =================================================== */
.noga-dodatno-info {
    padding-top: 20px;
}

.noga-dodatno-info p {
    margin-bottom: 10px;
    color: #a0a0a0;
}

.noga-avtorske-pravice {
    text-align: center;
    padding-top: 15px;
    font-size: 12px;
}

.stripe-logo img {
    height: 20px; 
    margin-right: 5px;
    /* Filtriramo, da so ikone bele, ƒçe so originali barvni */
    filter: invert(80%); 
}

/* --------------------------------------------------- */
/* MOBILNI PRIKAZ (MEDIA QUERY: do 768px) */
/* Omogoƒça akordion za posamezne sekcije */
/* --------------------------------------------------- */
@media screen and (max-width: 768px) {
    
    /* 0. Osnovna noga (footer) */
    footer {
        /* Odstranimo ƒçrni rob, ki je bil prej viden */
        border-top: none !important;
        /* Nastavimo ozadje noge (ko je zaprta) na BELO */
        background-color: #ffffff !important; /* <--- POPRAVEK: Da se znebi≈° ƒçrnega roba in skrije≈° nogo v belo */
    }

    /* 1. Gumb za preklop (tri pike) */
    .footer-toggle-btn {
        display: block; 
        width: 100%;
        background: none;
        border: none;
        color: black; /* <--- POPRAVEK: Nastavi barvo teksta v gumbu na ƒçrno */
        text-align: right;
        padding: 10px 0;
        cursor: pointer;
        outline: none;
        margin-bottom: 5px;
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }
    
    /* Barva ikone (tri pikice) */
    .footer-toggle-btn svg {
        vertical-align: middle;
        color: #000000; /* <--- POPRAVEK: Nastavi barvo ikone na ƒåRNO, da se vidi na belem ozadju */
        
    }
    
    /* 2. Skrivanje celotne vsebine (.noga-vsebina-skrita) */
    .noga-vsebina-skrita {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out;
        padding: 0;
        border-top: none; 
        
        /* Barva vsebine noge, ko je skrita (za splo≈°no uporabo, ni nujno potrebna) */
        background-color: #000000; /* Barva ozadja, ko se odpre - verjetno ƒçrna, kot sedaj */
    }

    /* Prikaz celotne vsebine, ko je gumb aktiven (ODPRTA NOGA) */
    .noga-vsebina-skrita.active {
        max-height: 2000px; 
        padding-top: 15px;
        padding-bottom: 15px;
        border-top: 1px solid #444; /* Standardna ƒçrna loƒçilna ƒçrta (kot sedaj) */
        background-color: #000000; /* <--- POPRAVEK: Poskrbimo, da je ozadje ƒåRNO, ko se raz≈°iri */
        color: white; /* <--- DODATEK: Tekst mora biti BEL, ko je ozadje ƒçrno */
    }
    
    /* 3. Preureditev vsebine znotraj skrite sekcije */
    .noga-vsebina {
        display: block; 
        border-bottom: none; 
        padding-bottom: 0;
    }
    
    /* Sekcije znotraj noge naj bodo med seboj loƒçene (loƒçilne ƒçrte morajo biti vidne na ƒçrnem ozadju) */
    .noga-sekcija {
        border-bottom: 1px solid #444; /* ƒårte so ƒçrne/temne */
        padding: 10px 0;
        padding-right: 0;
    }
    
    /* üõ†Ô∏è POPRAVEK ZA AKORDION: Omogoƒçi preklapljanje s pomoƒçjo JS */
    .noga-linki {
        /* Sedaj mora biti privzeto skrito za akordion */
        max-height: 0 !important; 
        overflow: hidden !important; 
        transition: max-height 0.3s ease-out !important;
        padding-top: 0 !important; 
    }

    /* üõ†Ô∏è STANJE PRIKAZA: Ko JS doda razred active */
    .noga-linki.active {
        max-height: 500px !important; /* Dovolj visoko, da se prika≈æe */
        padding-top: 10px !important; 
    }

    /* Odstranimo ikono za preklop akordiona na posameznih naslovih */
    .noga-naslov:after {
        content: none !important;
    }
    
    /* Poskrbimo, da je prostor okoli plaƒçil videti dobro */
    .noga-dodatno-info {
        border-top: 1px solid #444; 
        padding-top: 15px;
        padding-bottom: 5px;
    }
}

/* 4. Skrijemo gumb na namiznem prikazu */
@media screen and (min-width: 769px) {
    .footer-toggle-btn {
        display: none;
    }
}
/* ========================================= */
/* OBLIKOVANJE ZA TOASTER OBVESTILA */
/* ========================================= */

#toaster-container {
    position: fixed;
    top: 20px; /* Ali bottom: 20px, ƒçe ≈æelite, da so spodaj */
    right: 20px;
    z-index: 10000; /* Poskrbite, da je nad vsem */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.toast {
    padding: 15px 20px;
    color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.3s ease-out, transform 0.4s ease-out;
    max-width: 300px;
    min-width: 200px;
}

.toast.show {
    opacity: 1;
    transform: translateX(0);
}

.toast.success {
    background-color: #148a86; /* Zelena za uspeh */
}

.toast.error {
    background-color: #f44336; /* Rdeƒça za napako */
}

.toast.info {
    background-color: #0464b2; /* Modra za info */
}

.toast.warning {
    background-color: #c47500; /* Oran≈æna za opozorilo */
}

.toast-icon {
    margin-right: 10px;
}
/* ========================================= */
/* POPRAVLJEN STIL ZA GUMB NAZAJ (Kot na profilni strani) */
/* ========================================= */

.gumb-nazaj {
    /* Za vsak primer, da se prepisjo obstojeca pravila */
    all: unset; /* Odstrani vsa obstojeƒça stila brskalnika/predloge */
    
    /* Postavitev */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    
    /* Velikost in oblika kroga */
    width: 35px; /* Malce manj≈°i krog */
    height: 35px;
    border-radius: 50%; /* Naredi krog */
    
    /* Barve in obroba */
    background-color: #333; /* Prosojno ozadje */
    border: 1px solid #333; /* Tanek ƒçrn okvir */
    color: #ffffff; /* ƒårna pu≈°ƒçica */
    
    /* Pisava in velikost pu≈°ƒçice */
    font-family: Arial, sans-serif; /* Ali pisava, ki jo uporabljate drugje */
    font-size: 18px; /* Malce manj≈°a pu≈°ƒçica */
    font-weight: normal; /* Manj debela pu≈°ƒçica */
    
    /* Prepreƒçimo izbiro teksta (pu≈°ƒçice) */
    user-select: none;
    
    /* Dodamo malo razmika od robov, da ni stisnjen */
    margin: 0 10px; /* Ali prilagodite po potrebi */

    /* Omogoƒçimo pozicioniranje, ƒçe bo potrebno */
    position: relative;
    z-index: 10;
}

/* Ob pritisku */
.gumb-nazaj:hover {
    background-color: #717171; /* Rahlo sivo ozadje ob hoverju */
    border-color: #717171; /* Malce temnej≈°i okvir */
    color: #ffffff; /* Malce temnej≈°a pu≈°ƒçica */
}

/* Stil za vsebnik, da gumb ni na levi stisnjen do konca (opcijsko) */
.gumb-nazaj-vsebnik {
    padding-left: 20px; /* Ali kakorkoli drugaƒçe centrirate/poravnate */
    padding-bottom: 10px;
    /* ƒåe je treba, lahko dodate 'position: relative;' ali 'display: flex;' za bolj≈°e pozicioniranje */
}
/* ODSTRANI MODER OKVIR PRI DOTIKU V NATIVE ANDROIDU */
/* To pravilo odstrani privzeti highlight, ki ga ustvarja WebView na Androidu */
* {
    -webkit-tap-highlight-color: transparent !important;
    /* Opomba: ƒåe zgornje ne deluje, poskusite dodati ≈°e spodnje */
    outline: none !important;
}
/* ============================================= */
/* STILIRANJE MODALNEGA OKNA (Socialna Prijava)  */
/* ============================================= */

/* Stil za loƒçilno ƒçrto "Ali pa se prijavite z:" */
.social-login-separator {
    text-align: center;
    margin: 15px 0;
    font-size: 0.9em;
    color: #888;
    position: relative;
}

.social-login-separator span {
    background-color: #fff;
    padding: 0 10px;
    position: relative;
    z-index: 10;
}

.social-login-separator::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #ddd;
    z-index: 5;
}

/* Stil za container gumbov */
.social-login-buttons {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    justify-content: center;
}

/* Splo≈°ni stil socialnih gumbov */
.gumb-prijava-social {
    flex: 1; /* Omogoƒçi, da se gumba razdelita enakomerno */
    padding: 10px 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
    background-color: #fff;
    color: #333;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* Razmik med ikono in besedilom */
}

.gumb-prijava-social:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
}

/* Stil za Google gumb (ikona) */
.gumb-prijava-social i.fa-google {
    color: #fafafa; /* Google rdeƒça */
}

/* Stil za Apple gumb */
.gumb-prijava-social.apple {
    background-color: #000;
    color: #fff;
    border-color: #000;
}

.gumb-prijava-social.apple i.fa-apple {
    color: #fff;
}
/* ================================================= */
/* 7. SLOGI ZA VELIKO AKCIJSKO SLIKO (NEW FEATURE) */
/* ================================================= */

.velika-akcija-slika {
    /* OMEJITEV ≈†IRINE: Namesto 100vw zdaj uporablja fiksno ≈°irino (npr. 90%) 
       ali maksimalno ≈°irino (npr. 1200px) in avtomatski rob za centriranje. */
    width: 90%; 
    max-width: 1200px;
    margin: 2rem auto; /* Centriranje z avtomatskim robom in dodajanje razmika */
    
    /* Vi≈°ina (nastavljiva) */
    height: 70vh; /* Vi≈°ina na desktopu (prilagodite po ≈æelji) */
    
   /* DODATEK: Nastavljiv radius vsakega vogala posebej */

/* ƒåe ≈æelite nadzorovati vsak vogal posebej, uporabite te lastnosti:
   Vrstni red je: Zgoraj levo, Zgoraj desno, Spodaj desno, Spodaj levo
*/

/* Primer nastavitve: */
border-top-left-radius: 20px;
border-top-right-radius: 20px;
border-bottom-right-radius: 20px;
border-bottom-left-radius: 20px;

/* Prej≈°nja enotna vrednost je zdaj zakomentirana:
   border-radius: 50px;
*/

overflow: hidden; /* Zagotovi, da se ozadje ne razlije ƒçez zaobljene robove */
    
    background-image: url('Oglasna-slika.png'); /* Uporabite pravo sliko! */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    
    /* Flexbox za centriranje vsebine znotraj sekcije */
    display: flex;
    justify-content: center;
    align-items: center;
    
    /* Dodamo temen prekrivni sloj za bolj≈°o berljivost teksta (gradient od temnega proti bolj temnemu) */
    position: relative; /* KLJUƒåNO: Nastavi element za referenco absolutno pozicioniranemu otroku (.ikona-ospredje) */
    padding: 2rem;
    box-sizing: border-box;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0); /* Neobvezno: za lep≈°i vizualni uƒçinek */
}

/* DODATEK: Stil za IKONO (Slika-app.png) v ospredju */
.ikona-ospredje {
    /* Pozicionira element glede na najbli≈æjega star≈°a z position: relative (.velika-akcija-slika) */
    position: absolute; 
    
    /* Postavitev v desni spodnji kot z 20px odmikom */
    right: 20px; 
    bottom: 20px; 
    
    /* Velikost ikone. Spreminjajte width/height za prilagoditev velikosti! */
    width: 100px; /* Prilagodite ≈°irino za poveƒçanje/zmanj≈°anje */
    height: auto; 
    
    /* Z-index zagotovi, da je ikona vidna nad vso vsebino in prekrivnim slojem */
    z-index: 10; 
    
    /* Neobvezno: Dodajte rahel radius, da ikona ni ostro kvadratna */
    border-radius: 15px; 
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}


.velika-akcija-slika::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(130, 247, 35, 0.078); /* Temen prekrivni sloj */
    z-index: 1;
}

.akcija-vsebina {
    position: relative;
    z-index: 2; /* Postavi vsebino nad prekrivni sloj */
    text-align: center;
    max-width: 800px;
    padding: 1rem;
    margin-bottom: 0; /* Odstranjeno, ker gumba ni veƒç */
}

.akcija-vsebina h2 {
    font-size: clamp(1.5rem, 4vw, 3rem); /* Odzivna velikost naslova */
    font-weight: 600;
    color: #fefefe; /* Svetel tekst za kontrast */
    margin-bottom: 0.5rem;
    text-shadow: 1px 1px 3px rgba(255, 255, 255, 0);
}

.akcija-vsebina h3 {
    font-size: clamp(1.5rem, 2vw, 1.8rem); /* Odzivna velikost podnaslova */
    margin-bottom: 0; /* Odstranjeno, ker gumba ni veƒç */
    font-weight: 400;
    color: #88d82d; /* Svetel tekst za kontrast */
}

/* ODSTRANJENA sta bila .gumb-odkrij in .gumb-odkrij:hover bloka */


/* ======================================= */
/* PRILAGODITEV ZA MOBILNE NAPRAVE (PWA) */
/* ======================================= */

@media (max-width: 768px) {
    .velika-akcija-slika {
        /* Poveƒçamo vi≈°ino, da je na mobilnih napravah bolj opazno */
        height: 50vh; 
        /* Na mobilnem lahko uporabimo skoraj polno ≈°irino, vendar pustimo majhen rob za PWA izgled */
        width: 95%; 
        margin-left: auto; /* Ponovno centriranje */
        margin-right: auto; /* Ponovno centriranje */
        padding: 1rem;
    }
    
    /* Prilagoditev velikosti ikone za mobilne naprave */
    .ikona-ospredje {
        width: 100px; /* Manj≈°a ikona na mobilnih napravah */
        right: 10px;
        bottom: 10px;
    }

    .akcija-vsebina {
        padding: 0.5rem;
    }
}
/* Dodano oblikovanje za kartico z oceno (Review Card) */
.review-card {
    /* Uporaba tega stila je bolj≈°a kot samo 'border-b' */
    border: 1px solid #fefefe; /* Lahka siva obroba okoli kartice */
    border-radius: 20px; /* Zaobljeni robovi kartice */
    padding: 1.5rem; /* Notranji rob znotraj okvirja */
    margin-bottom: 1.5rem; /* Razmik med karticami */
    margin-left: 0.5rem; /* Razmik med karticami */
    background-color: #ffffff; /* Belo ozadje za vsako kartico */
    box-shadow: 0 3px 12px rgba(0, 0, 0, 0.267); /* Ne≈æna senca za 'dvignjen' videz */
}

/* Stilizacija imena avtorja in datuma znotraj review-card */
.review-card .author-name {
    font-weight: bold;
    color: var(--rmlk-modra); /* Uporabimo va≈°o modro barvo za poudarek */
    font-size: 1.1em;
    margin-bottom: 0.25rem;
    display: block; /* Omogoƒça, da ime zavzame svojo vrstico */
}

.review-card .review-date {
    color: #6c757d; /* Diskretna siva za datum */
    font-size: 0.9em;
    margin-bottom: 0.75rem;
    display: block;
}

/* Stilizacija zvezdic, ƒçe so v loƒçenem elementu (npr. <span class="stars">) */
/* V va≈°i kodi je to verjetno ≈æe narejeno s slikami ali znaki, ki jih je treba preveriti */
.review-card .stars {
    color: #ffc107; /* Zlata barva za zvezdice */
    font-size: 1.1em;
    margin-right: 0.5rem;
}

/* Stilizacija besedila komentarja */
.review-card .review-text {
    margin-top: 1rem;
    color: #333333;
}
/* Definirajte to spremenljivko na vrhu va≈°e datoteke :root {} */
/* :root { --rmlk-siva: #f4f4f4; } */

/* --- NOVI SLOGI ZA SEKCIJO GOURMET EXPLORE --- */
.gourmet-explore {
    padding: 0rem 2rem 2rem;
    text-align: center;
}

.gourmet-explore h2 {
    color: var(--rmlk-modra);
    margin-bottom: 1.5rem;
    font-size: 1.2rem;
    font-weight: 700;
    color: #333
}

/* Nastavljiv border-radius za vsak vogal */
.country-card {
    --card-radius-tl: 10px;
    --card-radius-tr: 10px;
    --card-radius-bl: 10px;
    --card-radius-br: 10px;

    position: relative;
    border-top-left-radius: var(--card-radius-tl);
    border-top-right-radius: var(--card-radius-tr);
    border-bottom-left-radius: var(--card-radius-bl);
    border-bottom-right-radius: var(--card-radius-br);

    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease;

    /* Popravek: proporcialna vi≈°ina */
    aspect-ratio: 4 / 3; /* ≈°irina : vi≈°ina */
    width: 100%;
}


/* Grid kartic */
.country-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
}

/* Hover efekt */
.country-card:hover {
    box-shadow: 0 8px 25px rgba(14, 43, 78, 0.25);
}

.card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.45s ease;
    position: relative;
    z-index: 2; /* nad silhueto */
}

.country-card:hover .card-image {
    transform: scale(1.03);
}

.card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.281);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 0.3s ease;
    z-index: 3; /* nad sliko in silhueto */
}

.country-card:hover .card-overlay {
    background: rgba(14, 43, 78, 0.55);
}

.card-title {
    color: #fff;
    font-size: 1.2rem;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    z-index: 4;
}

/* --- RESPONSIVE: Na telefonih vi≈°ina kartice manj≈°a --- */
@media (max-width: 768px) {
    .country-card {
        aspect-ratio: 1 / 1; /* kvadrat na mobilnih */
    }

    .country-cards-container {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    /* Silhueta manj≈°a na telefonih */
    .country-card[data-experience-code="wine"] .wine-silhouette {
        width: 50px;
    }
}

/* Stil za veliko sekcijo akcije */
.velika-akcija-slika {
    margin-bottom: 2rem;
}

/* --- NOVI SLOGI ZA REZULTATE V MODALU --- */
.restavracija-vsebina #modalResultsContainer {
    z-index: 10;
    padding: 1rem 1rem 0 1rem;
    padding-right: 0;
}

#modalResultsContainer h3 {
    color: var(--rmlk-modra);
    margin-bottom: 1rem;
    font-size: 1.5rem;
    font-weight: 700;
    border-bottom: 2px solid #ddd;
    padding-bottom: 10px;
}

.mreza-rezultatov-modal {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;

    max-height: 70vh;
    overflow-y: auto;
    padding-right: 15px;
    padding-bottom: 1rem;
}

.mreza-rezultatov-modal .kartica {
    margin: 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.restavracija-vsebina #modalSlika.hidden,
.restavracija-vsebina .podrobnosti-tekst.hidden {
    display: none !important;
}

/* Uporaba SVG clipPath za silhueto steklenice */
.country-card[data-experience-code="wine"] .bottle-clipped {
    clip-path: url(#maskBottle);
    -webkit-clip-path: url(#maskBottle); /* za Chrome/Safari */
}
/* Dodajte to v va≈° <style> blok ali styles.css */
@keyframes highlight-flash {
    0% { box-shadow: 0 0 0 0 rgba(32, 192, 189, 0.7); border: 2px solid rgba(32, 192, 189, 0.5); }
    50% { box-shadow: 0 0 15px 5px rgba(32, 192, 189, 0.9); border: 2px solid #20c0bd; }
    100% { box-shadow: 0 0 0 0 rgba(32, 192, 189, 0); border: 2px solid transparent; }
}

.highlighted-card {
    animation: highlight-flash 1.5s ease-out;
}
/* =================================================================
// ‚≠ê POSODOBLJEN CSS ZA ANIMIRANI SPLASH SCREEN (CAPACITOR ONLY) ‚≠ê
// ================================================================= */

/* CONTAINER ZA WEB SPLASH SCREEN */
#splashScreenWeb {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* Barva ozadja je KONSTANTNO turkizna */
    background-color: #076b6a; 
    
    /* ‚≠ê KLJUƒåNO POPRAVLJENO: Privzeto skrij, da se ne prika≈æe na SPLETNI STRANI ‚≠ê */
    display: none !important; 
    
    justify-content: center;
    align-items: center;
    z-index: 9999;
    /* ‚≠ê FONT SIZE POPRAVEK: Ekstremno zmanj≈°ano na 2.5rem ‚≠ê */
    font-size: 3rem; 
    
    /* Barva besedila je KONSTANTNO bela */
    color: white; 
    overflow: hidden;
    pointer-events: none;
    /* Odstranili smo prehod background-color, saj ga ni! */
    transition: opacity 0.5s ease; 
    opacity: 1; 
}

/* ‚≠ê NOVO: Ta razred doda JavaScript SAMO v mobilni aplikaciji, da ga prika≈æe ‚≠ê */
.show-on-mobile#splashScreenWeb {
    display: flex !important; 
}

/* Osnovni stil za vse dele logotipa */
#splashScreenWeb span {
    opacity: 0; 
    transform: translateY(20px);
    transition: opacity 0.3s ease, transform 0.3s ease; 
    display: inline-block;
    
    color: white !important; 
    /* ‚≠ê PISAVA: Uporabljamo CreamCake brez presledka! ‚≠ê */
    font-family: 'CreamCake', Arial, sans-serif !important; 
    font-weight: 500;
}


/* ‚≠ê POSPE≈†ITEV ANIMACIJE: Zamiki med ƒçrkami so skraj≈°ani na 0.2s ‚≠ê */

/* Animacija: R (fade-in in premik) - 0.5s */
.logo-part-1 {
    animation: fade-in 0.5s ease-out 0.2s forwards;
}

/* Animacija: e (fade-in in premik) - 0.7s */
.logo-part-2 {
    animation: fade-in 0.5s ease-out 0.7s forwards;
}

/* Animacija: n (fade-in in premik) - 0.9s */
.logo-part-3 {
    animation: fade-in 0.5s ease-out 0.9s forwards;
}

/* Animacija: t (fade-in in premik) - 1.1s */
.logo-part-4 {
    animation: fade-in 0.5s ease-out 1.1s forwards;
}

/* Animacija: y (fade-in in premik) - 1.3s */
.logo-part-5 {
    animation: fade-in 0.5s ease-out 1.3s forwards;
}

/* Animacija: o (fade-in in premik) - 1.5s (Konec pri 1.5s + 0.5s = 2.0s) */
.logo-part-6 {
    animation: fade-in 0.5s ease-out 1.5s forwards;
}

/* Definicija CSS Keyframes */
@keyframes fade-in {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* =================================================================
// ‚≠ê RAZRED ZA PREHOD BARV (ODSTRANJEN) ‚≠ê
// ================================================================= */
/* =======================================================
   ‚òÖ 1. GLAVNI KOLEDAR
   ======================================================= */
.pika-single {
    width: 260px;                /* POPRAVEK ‚Äì veƒç prostora, niƒç veƒç manj≈°anja */
    transform: scale(1.20);     /* poveƒçaj ali zmanj≈°a vrednost */
    transform-origin: top left;
    background: #fff;
    border-radius: 12px;
    border: 1px solid #ddd;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    font-family: var(--font-family);
}

/* =======================================================
   ‚òÖ 2. GLAVA KOLEDARJA (MESec / LETO)
   ======================================================= */
.pika-title {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center;
    width: 100% !important;
    padding: 12px 16px !important;
    background: #ffffff;
    border-bottom: 1px solid #eee;
    box-sizing: border-box;
}

.pika-label {
    font-size: 17px !important;
    font-weight: 600 !important;
}

/* Pu≈°ƒçice */
.pika-prev,
.pika-next {
    color: var(--accent-color);
    opacity: 0.8;
    font-size: 18px;
    padding: 8px;
    cursor: pointer;
}

.pika-prev:hover,
.pika-next:hover {
    opacity: 0.5;
}

/* =======================================================
   ‚òÖ 3. DNEVI V TEDNU
   ======================================================= */
.pika-table {
    width: 100% !important;
    table-layout: fixed !important;
}

.pika-table thead th {
    font-size: 12px;
    color: #333;
    padding: 8px 0;
    font-weight: 500;
    text-align: center;
}

/* =======================================================
   ‚òÖ 4. CELICE DNEVOV
   ======================================================= */
.pika-table th,
.pika-table td {
    width: calc(100% / 7) !important;
    padding: 6px 0 !important;
    text-align: center !important;
}

/* =======================================================
   ‚òÖ 5. ≈†TEVILKE (DNEVI)
   ======================================================= */
.pika-button {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    width: 32px !important;
    height: 32px !important;
    line-height: 32px !important;
    margin: 0 auto !important;
    font-size: 14px !important;
    color: #333;
    background: none !important;
    border-radius: 50%;
    transition: 0.15s;
}

/* =======================================================
   ‚òÖ 6. DANES (rob)
   ======================================================= */
.is-today .pika-button {
    color: #000 !important;
    font-weight: 700;
    border-radius: 50% !important;
    width: 28px !important;
    height: 28px !important;
    line-height: 28px !important;
    border: 2px solid #333 !important;
    background: none !important;
}

/* =======================================================
   ‚òÖ 7. IZBRAN DAN ‚Äî POLNA TURKIZNA BARVA
   ======================================================= */
.is-selected .pika-button {
    background: #076b6a !important;
    color: #fff !important;
    border-radius: 50% !important;
    width: 36px !important;
    height: 36px !important;
    line-height: 36px !important;
    font-weight: 600;
    border: 2px solid #076b6a !important;
}

/* =======================================================
   ‚òÖ 8. HOVER
   ======================================================= */
.pika-button:hover {
    background: #076b6a !important;
    color: #fff !important;
    border-radius: 50%;
}

/* =======================================================
   ‚òÖ 9. ZUNANJI & DISABLED
   ======================================================= */
.is-outside-current-month .pika-button {
    color: rgba(0,0,0,0.45) !important;
}

.is-disabled .pika-button {
    color: #ccc !important;
    opacity: 0.7;
}
/* Va≈°a obstojeƒça (pravilna) koda za PRIVZETO SKRIVANJE */
#capacitorTaskbar {
    display: none !important; 
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    /* Poveƒçamo vi≈°ino, da se prilega poudarjen gumb */
    height: 65px; 
    background-color: #076b6a;
    /* Uporabimo bolj subtilno/ƒçisto senco za modern videz */
    border-top: none; 
    box-shadow: 0 -4px 12px rgba(0,0,0,0.1); 
    z-index: 1000;
}

/* üåü KLJUƒåNA NOV KOS KODE: Prikaz in oblikovanje za mobilno aplikacijo! üåü */
#capacitorTaskbar.is-mobile {
    display: flex !important; 
    justify-content: space-around; 
    align-items: center; 
}

/* Stil za posamezen element znotraj vrstice */
.taskbar-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-decoration: none;
    color: #ededed; /* Barva neaktivne ikone */
    font-size: 0.7rem;
    font-weight: 500;
    padding: 5px 0; /* POPRAVEK: Odstranimo horizontalni padding, da ima besedilo veƒç prostora */
    /* Poveƒçamo manj≈°o fleksibilnost in ciljno obmoƒçje */
    flex-grow: 1; 
    max-width: 25%;
    transition: color 0.3s;
}

/* üåü POPRAVEK: Stil za IKONO znotraj taskbar-item üåü */
/* To zagotovi, da so ikone veƒçje in bolj izrazite */
.taskbar-item i {
    font-size: 1.4rem; /* Poveƒça velikost same ikone */
    margin-bottom: 2px; /* Doda malo prostora med ikono in besedilom */
    line-height: 1; 
}

/* Aktivni element ali poudarek (za Domov/Aktivno) */
.taskbar-item.active,
.taskbar-item:hover {
    color: #ededed; /* Modra akcentna barva (prilagodite!) */
}

/* ---------------------------------------------------- */
/* üöÄ NOVI STILI ZA SREDINSKI GUMB "SCAN & EARN" üöÄ */
/* ---------------------------------------------------- */

.scan-btn-ovoj {
    /* To ustvari prostor nad navigacijo, kot na sliki */
    margin-top: -30px; 
    display: flex;
    justify-content: center;
    align-items: center;
    width: 80px; /* ≈†irina za polkrog */
    height: 80px; /* Vi≈°ina za polkrog */
}

.scan-btn {
    /* Stil za sam gumb/krog */
    display: flex;
    justify-content: center;
    align-items: center;
    width: 60px; 
    height: 60px;
    border-radius: 50%; /* Naredi krog */
    background-color: #88d82d; /* Modra barva ozadja (prilagodite!) */
    color: #2e2e2e;
    box-shadow: 0 4px 10px rgba(39, 39, 39, 0.339); /* Poudarjena senca */
    font-size: 1.6rem; /* POPRAVEK: Poveƒçana velikost ikone */
    text-decoration: none;
    transition: transform 0.2s, box-shadow 0.2s;
}

.scan-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(4, 75, 62, 0.6);
}


/* Dodamo ≈°e en stil za Tri pikice, ƒçe ga potrebujete za mobilni meni */
.taskbar-item .fas.fa-ellipsis-h {
    font-size: 1.2rem; 
}
/* V VA≈†O CSS DATOTEKO (style.css) */

.app-download-content {
    text-align: center;
    padding: 20px;
}

.app-download-content h2 {
    margin-bottom: 10px;
}

.app-download-content p {
    margin-bottom: 30px;
    color: #666;
}

.app-store-links {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
}

.store-link {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    color: white; /* Barva teksta na gumbu */
    min-width: 150px;
}

.play-store {
    background-color: #000000; /* ƒårna za Google Play */
}

.app-store {
    background-color: #007aff; /* Modra za Apple */
}

.store-link i, .store-link img {
    margin-right: 10px;
    font-size: 24px;
}

.small-info {
    margin-top: 40px;
    font-size: 0.9em;
    color: #888;
}
/* --- A. Splo≈°na pravila za mobilno ikono (Vedno vidna in obarvana) --- */

/* ‚≠ê NOVO: Velikost/Dimenzije celotnega klikabilnega obmoƒçja ikone (opcijsko) ‚≠ê */
.ikona-ai {
    /* Nastavite ≈°irino in vi≈°ino kontejnerja, da je la≈æje klikniti */
    width: 40px; 
    height: 40px; 
    display: flex;
    justify-content: center; /* Center ikone horizontalno */
    align-items: center; /* Center ikone vertikalno */
    /* Lahko dodate background-color: #f0f0f0; in border-radius: 50%; za krog */
}

/* ‚≠ê NOVO: Velikost in Barva same ikone (Glavno pravilo za spreminjanje) ‚≠ê */
.ikona-ai i.fas.fa-comment.fa-flip-horizontal { /* Zamenjano: fas.fa-comment (ovalna) + zrcalno */
    font-size: 30px;
    color: #88d82d;
    transition: transform 0.2s;
}

/* --- B. Skrivanje AI ikone na Desktopu --- */

#ai-chat-icon-mobile-global {
    /* Skrij to ikono v standardnem (desktop) pogledu */
    display: none; 
}


/* --- C. Pravila za Mobilni Pogled (GLAVNI POPRAVEK) --- */

@media (max-width: 768px) {
    
    /* Prikaz ikone: */
    #ai-chat-icon-mobile-global {
        display: block !important; 
    }

    /* ‚≠ê KLJUƒåNA FLEXBOX PRAVILA ZA HEADR GLAVO ‚≠ê */
    header.glava {
        display: flex;
        align-items: center; /* Navpiƒçna poravnava */
        justify-content: space-between; /* Razporedi logotip na levo in ikone na desno */
        padding: 10px 15px; /* Dodajte robove, ƒçe jih ≈°e nimate */
    }
    
    /* 1. Poravnava ikon na desno stran: */
    #ai-chat-icon-mobile-global {
        margin-left: auto; /* Potisne AI ikono skrajno na desno */
        margin-right: 60px; /* POVEƒåANO: Ustvari veƒçji razmik med AI ikono in hamburger gumbom */
        padding: 5px
    }
    
    /* ‚≠ê NOV DEL: PRAVILA ZA CAPACITOR (Header Safe Area) ‚≠ê */
    body.is-capacitor-app header.glava {
        /* Poveƒçajte polnilo na vrhu za statusno vrstico OS */
        padding-top: calc(10px + env(safe-area-inset-top));
    }
    
    /* Prav tako lahko izbolj≈°ate poravnavo gumba za hamburger (kar smo obravnavali prej) */
    #hamburgerGumb {
        display: flex;
        align-items: center; 
        justify-content: center;
        width: 40px; 
        height: 40px; 
        padding: 0; 
    }
    
    /* ƒåe imate elemente, ki so namenjeni samo za desktop, jih skrijte */
    #desktopAkcije {
        display: none;
    }
}

/* ========================================= */
/* --- D. CSS PRAVILA ZA AI POGOVORNO OKNO (CHAT WIDGET) --- */
/* ========================================= */

#aiChatModal {
    /* Skrije se, dokler ga JS funkcija toggleChat() ne prika≈æe */
    display: none; 
    
    /* ‚≠ê KLJUƒåNO: Nastavi fiksno pozicijo (spodaj desno) ‚≠ê */
    position: fixed; 
    z-index: 1000; 
    
    /* Namizne dimenzije (DEFAULT) */
    left: auto; 
    top: auto; 
    right: 20px; 
    bottom: 150px; 
    width: 300px; 
    height: 400px; 
    
    /* ODSTRANIMO zatemnjeno ozadje (da se ne zatemni) */
    background-color: transparent; 
    overflow: visible; 
}

/* Okno z vsebino (Content Box) */
.chat-modal-content {
    background-color: #ffffff; 
    color: #2a2a2a; 
    padding: 0;
    width: 100%; 
    height: 100%; 
    max-width: none; 
    margin: 0;
    display: flex;
    flex-direction: column;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); 
    overflow: hidden;
}


/* ======================================================== */
/* ‚≠ê PRILAGODITEV ZA CAPACITOR/MOBILNI POGLED (80% VELIKOST) ‚≠ê */
/* Okno sedaj zavzame 80% ≈°irine in vi≈°ine. */
/* ======================================================== */
body.is-capacitor-app #aiChatModal {
    /* Uporabi 80% ≈°irine zaslona (10% rob na vsaki strani) */
    width: 80%; 
    
    /* Centriranje s 10% robovi */
    right: 10%; 
    left: 10%; 

    /* Doloƒçimo TOP in BOTTOM, ki doloƒçata VI≈†INO (pribli≈æno 80vh). */
    top: calc(10vh + env(safe-area-inset-top)); /* 10% od vrha + safe area */
    bottom: calc(30vh + env(safe-area-inset-bottom)); /* 10% od dna + safe area */
    
    /* ‚≠ê‚≠ê‚≠ê KLJUƒåNI POPRAVEK: DODAJANJE ANIMACIJE ‚≠ê‚≠ê‚≠ê */
    /* To omogoƒça gladko premikanje elementa, ko ga JS dinamiƒçno dvigne nad tipkovnico. */
    transition: bottom 0.3s ease-out; 
    
    /* Odstranimo transformacijo, ƒçe je bila kje nastavljena */
    transform: none; 
}


@media (max-width: 500px) {
    #aiChatModal {
        /* Ta pravila veljajo za standardne mobilne brskalnike */
        width: 90%; 
        height: 75vh; 
        right: 5%; 
        bottom: 5%;
        left: 5%;
        top: 5%;
    }
    
    /* ‚≠ê PREGLASITEV!
       Tudi za manj≈°e zaslone v Capacitorju obdr≈æimo 80% velikost in dinamiƒçen bottom. */
    body.is-capacitor-app #aiChatModal {
        width: 80%; 
        right: 10%; 
        left: 10%;
        top: calc(10vh + env(safe-area-inset-top));
        bottom: calc(30vh + env(safe-area-inset-bottom));
        
        /* ‚≠ê‚≠ê POPRAVEK: Dodamo transition tudi v tem @media bloku ‚≠ê‚≠ê */
        transition: bottom 0.3s ease-out; 
        
        transform: none;
    }
}


/* ========================================= */
/* --- E. NADALJEVANJE OBLIKOVANJA (HEADER & FOOTER) --- */
/* ========================================= */

.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background-color: #076b6a;
    border-bottom: 1px solid #076b6a;
}

.chat-header h3 {
    margin: 0;
    font-size: 1.2em;
    color: #f2f2f2; 
}

.close-chat-btn {
    color: #f2f2f2;
    font-size: 25px;
    font-weight: bold;
    background: none;
    border: none;
    cursor: pointer;
    line-height: 1;
    padding: 0 5px;
}

.chat-body {
    flex-grow: 1; 
    padding: 15px;
    overflow-y: auto; 
}

.chat-input {
    display: flex;
    padding: 15px;
    background-color: #ffffff;
    border-top: 0px solid #ddd;
}

/* ============================================================== */
/* ‚≠ê OBLIKOVANJE MIKROFONA IN GUMBA ZA PO≈†ILJANJE (BREZ OZADJA) ‚≠ê */
/* ============================================================== */

/* SKUPNA PRAVILA ZA OBA GUMBA V ƒåETU (#mic-button in #send-button) */
.chat-input #mic-button,
.chat-input #send-button {
    /* Naredi gumb okrogel in transparenten */
    background-color: transparent; 
    border: none;
    padding: 0; 
    width: 40px; 
    height: 40px; 
    display: flex; 
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    
    /* Barva pisave na gumbu (ƒçe ni v spanu) */
    color: #88d82d;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
}

/* Hover efekt za transparentne gumbe */
.chat-input #mic-button:hover,
.chat-input #send-button:hover {
    background-color: #ffffff; /* Rahlo sivo ozadje ob hoverju */
}

/* POSEBNO OBLIKOVANJE ZA MIKROFON (da ostane rob med njim in vnosnim poljem) */
.chat-input #mic-button {
    margin-right: 10px;
}

/* Velikost IKON ZNOTRAJ gumbov (Mic in Send) */
.chat-input #mic-button .material-icons,
.chat-input #send-button .material-icons {
    font-size: 28px; 
    color: #88d82d; /* Primarna zelena barva */
    transition: color 0.2s, transform 0.2s;
}

/* Barvna sprememba IKONE ob hoverju */
.chat-input #mic-button:hover .material-icons,
.chat-input #send-button:hover .material-icons {
    color: #70b925; /* Temnej≈°i odtenek zelene ob hoverju */
}


/* Stili za input field so nespremenjeni */
.chat-input input[type="text"] {
    flex-grow: 1;
    padding: 12px; 
    border: 0px solid #ddd; /* Dodan ne≈æen rob */
    border-radius: 25px; /* Bolj zaobljeni robovi */
    margin-right: 10px;
    background-color: #ffffff;
    color: #000000;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05); /* Rahla senca */
}


/* ========================================= */
/* --- F. OBLIKOVANJE SPOROƒåIL (USER IN LEO) --- */
/* ========================================= */

.chat-message {
    padding: 8px 12px;
    margin-bottom: 10px;
    max-width: 80%;
    border-radius: 18px;
    line-height: 1.4;
    word-wrap: break-word; /* Zlom dolgih besed */
}

/* ‚≠ê SPOROƒåILA UPORABNIKA ‚≠ê */
.chat-message.user-message {
    background-color: #f0f0f0; /* Svetlo sivo ozadje */
    color: #2a2a2a;
    align-self: flex-end; /* Poravnano na desno */
    margin-left: auto;
    border-radius: 18px 18px 4px 18px; /* Zaobljeni robovi, oster spodaj desno */
}

/* ‚≠ê SPOROƒåILA AI (LEO) ‚≠ê */
.chat-message.ai-message {
    background-color: #88d82d; /* Va≈°a ≈æelena zelena barva */
    color: #2a2a2a; /* Temnej≈°e besedilo za kontrast */
    align-self: flex-start; /* Poravnano na levo */
    margin-right: auto;
    border-radius: 18px 18px 18px 4px; /* Zaobljeni robovi, oster spodaj levo */
}


/* ‚≠ê ANIMACIJA NALAGANJA (LOADING DOTS) - POSODOBITEV ‚≠ê */
/* To ustvarja bolj gladek horizontalni uƒçinek namesto utripanja/izginjanja. */

/* To je primarno za vidno polje pike/pikic */
#ai-loading-message p::after {
    content: '...'; 
    display: inline-block;
    margin-left: 5px;
    font-weight: bold;
    /* Poglej Keyframes spodaj: */
    animation: simple-dots-animation 1.5s infinite; 
}

@keyframes simple-dots-animation {
    0% {
        opacity: 0.2; /* Zelo bleda */
    }
    50% {
        opacity: 1.0; /* Polno vidna */
    }
    100% {
        opacity: 0.2; /* Zelo bleda, in ponovi */
    }
}
/* ========================================================== */
/* Oblikovanje MODALNEGA OKNA ZA PONASTAVITEV GESLA */
/* ========================================================== */

.reset-password-view {
    /* Uporaba fleksibilnega box modela za centriranje elementov */
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 30px 20px; /* Notranji robovi */
    text-align: center;
    max-width: 350px; /* Najveƒçja ≈°irina okna */
    margin: auto; /* Centriranje v primeru, da ni polni zaslon */
}

.reset-password-view h3 {
    font-size: 1.8em;
    color: #333; /* Temno siva barva naslova */
    margin-bottom: 10px;
    font-weight: 700;
}

.reset-password-view p {
    color: #666;
    margin-bottom: 25px;
    font-size: 0.95em;
    line-height: 1.4;
}

/* --- Oblikovanje vnosnega polja in gumbov (velja za 1. fazo: Email) --- */

#zahtevaResetForm {
    width: 100%;
}

.reset-password-view input[type="email"] {
    width: 100%;
    padding: 12px 15px;
    margin-bottom: 15px;
    border: 1px solid #ccc; /* Svetlo siv okvir */
    border-radius: 8px; /* Zaobljeni robovi */
    font-size: 1em;
    box-sizing: border-box; /* Kljuƒçno za pravilno ≈°irino */
    transition: border-color 0.3s;
}

.reset-password-view input[type="email"]:focus {
    border-color: #076b6a; /* Barva poudarka ob fokusu (Va≈°a barva blagovne znamke) */
    outline: none;
    box-shadow: 0 0 5px rgba(7, 107, 106, 0.3);
}

/* --- Oblikovanje gumba "Po≈°lji navodila" --- */

#posljiResetNavodila {
    width: 100%;
    padding: 12px;
    background-color: #076b6a; /* Barva blagovne znamke */
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#posljiResetNavodila:hover {
    background-color: #054f4e; /* Temnej≈°a barva ob prehodu z mi≈°ko */
}

/* --- Sporoƒçilo o statusu (Uspeh/Napaka) --- */

.status-message {
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 5px;
    font-size: 0.9em;
    text-align: center;
    min-height: 20px; /* Ohranite prostor */
}

/* Specificne barve za uspeh in napako (po potrebi) */
#resetStatus.success {
    background-color: #e6ffed; /* Svetlo zelena */
    color: #008000; /* Temno zelena */
    border: 1px solid #c8e6c9;
}

#resetStatus.error {
    background-color: #ffe6e6; /* Svetlo rdeƒça */
    color: #cc0000; /* Temno rdeƒça */
    border: 1px solid #e6c8c8;
}

/* --- Povezava za nazaj na prijavo --- */

.back-to-login-container {
    margin-top: 20px;
}

#nazajNaPrijavoLink {
    color: #076b6a; /* Enaka barva kot gumb */
    text-decoration: none;
    font-size: 0.9em;
    font-weight: 500;
    transition: color 0.3s;
}

#nazajNaPrijavoLink:hover {
    color: #054f4e;
    text-decoration: underline;
}

/* ========================================================== */
/* ‚≠ê DODANO: Oblikovanje KORAKA 2: Vnos kode in novega gesla ‚≠ê */
/* ========================================================== */

#confirmResetFields {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

#confirmResetFields p.mt-20 {
    margin-top: 0; /* Prepreƒçimo dodaten rob, ƒçe je ≈æe rob predhodnega elementa */
    margin-bottom: 20px;
}

/* Skupni stil za vnosna polja za kodo in novo geslo */
#confirmResetFields input {
    width: 100%;
    padding: 12px 15px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1em;
    box-sizing: border-box;
    transition: border-color 0.3s;
}

#confirmResetFields input:focus {
    border-color: #076b6a;
    outline: none;
    box-shadow: 0 0 5px rgba(7, 107, 106, 0.3);
}

/* Specifiƒçen stil za vnos kode (da ni predolgo) */
#resetCode {
    /* ƒåe ≈æelite, da je polje kode o≈æje in centrirano: */
    max-width: 150px; 
    text-align: center;
    letter-spacing: 5px; /* Razmik med ≈°tevilkami za bolj≈°o berljivost */
}

/* Stil za gumb za potrditev */
#potrdiNovoGeslo {
    width: 100%;
    padding: 12px;
    background-color: #076b6a;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#potrdiNovoGeslo:hover {
    background-color: #054f4e;
}
/* ========================================================== */
/* Oblikovanje GUMBA za Pozabljeno Geslo (Namesto Linka) */
/* ========================================================== */

.forgot-password-container {
    width: 100%; /* Da se lahko centriramo, ƒçe ≈æelimo */
    margin-top: 15px; /* Razmik od gumba za prijavo zgoraj */
    text-align: center;
}

#pozabljenoGesloLink {
    /* Spremenimo ga v inline-block, da lahko nastavljamo ≈°irino/padding */
    display: inline-block; 
    
    /* Gumbni videz */
    padding: 8px 15px;
    background-color: transparent; /* Brez ozadja, saj je to sekundarni gumb */
    
    /* Stil obrobe (Outline Button) */
    border: 1px solid #076b6a; 
    border-radius: 8px; 
    
    /* Tekst stil */
    color: #076b6a; /* Barva teksta */
    text-decoration: none; /* Odstranimo podƒçrtaj linka */
    font-size: 0.9em;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
}

#pozabljenoGesloLink:hover {
    background-color: #076b6a; /* Ozadje se obarva ob prehodu mi≈°ke */
    color: white; /* Tekst postane bel */
    text-decoration: none;
}
/* ========================================================== */
/* Oblikovanje GUMBA/LINKA za "Nazaj na prijavo" */
/* ========================================================== */

.back-to-login-container {
    width: 100%;
    margin-top: 30px; /* Veƒçji rob na vrhu, da se loƒçi od gumba za potrditev gesla */
    text-align: center;
}

#nazajNaPrijavoLink {
    display: inline-flex; /* Uporabimo flex, da lahko poravnamo pu≈°ƒçico in tekst */
    align-items: center;
    gap: 5px; /* Razmik med pu≈°ƒçico in tekstom */
    
    padding: 8px 15px;
    background-color: transparent;
    
    /* Sekundarni/Nevtralni stil gumba */
    border: 1px solid #ccc; /* Svetlo siv okvir */
    border-radius: 8px;
    
    /* Tekst stil */
    color: #333; /* Temnej≈°i, nevtralen tekst */
    text-decoration: none;
    font-size: 0.9em;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.3s, border-color 0.3s, color 0.3s;
}

#nazajNaPrijavoLink:hover {
    background-color: #f0f0f0; /* Rahlo sivo ozadje ob hoverju */
    border-color: #076b6a; /* Poudarek z barvo blagovne znamke ob hoverju */
    color: #076b6a;
}
/* Stil za vsebnik zemljevida (omogoƒça relativno pozicioniranje) - OSTANE NESPREMENJENO */
.zemljevid-ovoj {
    position: relative;
    width: 100%;
    /* Dodajte fiksno vi≈°ino, da bo zemljevid viden */
    height: 350px; 
    overflow: hidden; /* Skrije morebitne robove */
    border-radius: 8px; /* Po ≈æelji zaokro≈æite robove */
}

/* Stil za iframe/zemljevid (zasede celoten vsebnik) - OSTANE NESPREMENJENO */
#modalZemljevid {
    width: 100%;
    height: 100%;
    border: 0;
}

/* ----------------------------------------------------------------- */
/* üî• POPRAVLJEN STIL ZA GUMB (Absolutno pozicioniran krog) üî• */
/* ----------------------------------------------------------------- */

.gumb-navigacija { 
    /* Absolutno pozicioniranje znotraj .zemljevid-ovoj */
    position: absolute;
    bottom: 50px; /* 10px od spodnjega roba */
    right: 50px; /* 10px od desnega roba */
    z-index: 10; /* Zagotovi, da je nad iframe-om */
    
    /* Fiksne dimenzije za krog */
    width: 60px; 
    height: 60px; 
    padding: 0; /* Odstranimo notranji rob */
    
    /* Centriranje ikone */
    display: flex; 
    align-items: center; 
    justify-content: center; 
    
    /* Oblikovanje gumba */
    background-color: #076b6a; 
    color: white;
    font-size: 1.2rem; /* Velikost ikone */
    font-weight: bold;
    border-radius: 50%; /* Naredi gumb popoln krog */
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); /* Malo moƒçnej≈°a senca, da izstopa */
    border: 3px solid #ffffff;
}

.gumb-navigacija i {
    font-size: 1.4rem; 
    margin: 0; /* Odstranimo vse robove okoli ikone */
}

.gumb-navigacija:active {
    background-color: #044f4e;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
}
/* Ta selektor je izjemno specifiƒçen: cilja na vso Font Awesome ikono */
.gumb-priljubljeno-modal .favorite-icon {
    /* To bi moralo biti dovolj, ƒçe ni drugega moƒçnej≈°ega pravila */
    color: #e74c3c; 
}







 </style>
</head>

<body>
    
<div id="splashScreenWeb">
    <span class="logo-part-1">R</span>
    <span class="logo-part-2">e</span>
    <span class="logo-part-3">n</span> 
    <span class="logo-part-4">t</span> 
    <span class="logo-part-5">y</span> 
    <span class="logo-part-6">o</span> 
</div>
    
    <header class="glava">
        <div class="logotip">
            <a href="#" id="map-icon-link" class="icon-link">
                <i class="fas fa-map-marked-alt map-icon" aria-label="Prika≈æi zemljevid"></i>
            </a>
        </div>

        <div id="map-modal" class="map-overlay">
            <div class="map-content">
                <button id="close-map-btn" class="close-btn">&times;</button>
                <div id="large-map-container">
                    <p style="text-align: center; padding-top: 50px;"></p>
                </div>
            </div>
        </div>
        
  <div class="akcije" id="desktopAkcije">
  
    <div id="ai-chat-icon-desktop" onclick="toggleChat()" style="cursor: pointer; margin-right: 15px;" class="ikona-ai">
        <i class="fas fa-comment fa-flip-horizontal" aria-label="AI Pomoƒçnik"></i> 
    </div>
    
  
  <div class="jezik-ovoj" id="jezikOvojDesktop">
    <i class="fas fa-globe"></i>
    <select class="izbira-jezika" id="izbiraJezikaDesktop">
         <option value="sl">SL</option>
                    <option value="en">EN</option>
                    <option value="de">DE</option>
                    <option value="hr">HR</option>
                    <option value="it">IT</option>
                    <option value="fr">FR</option>
                    <option value="hu">HU</option>
                    <option value="cz">CZ</option>
                    <option value="es">ES</option>
                    <option value="et">ET</option>
                    <option value="nl">NL</option>
                    <option value="pt">PT</option>
                    <option value="sk">SK</option>
    </select>
  </div>
</div>

        
   <div id="ai-chat-icon-mobile-global" onclick="toggleChat()" style="cursor: pointer; margin-right: 25px;" class="ikona-ai mobilna-vidna">
        <i class="fas fa-comment fa-flip-horizontal" aria-label="AI Pomoƒçnik"></i> 
    </div>

<button class="hamburger-gumb" id="hamburgerGumb">
    <i class="fas fa-user-circle"></i> 
</button>

        <div class="mobilni-meni" id="mobilniMeni">
            <a href="#" id="odpriPrijavoMobilni" class="gumb-prijava" data-i18n="header.login">
                <i class="fas fa-user"></i> Prijava
            </a>

            <div class="profil-ovoj" id="profilMeniMobilni" style="display: none;">
                <a href="profil.html" class="gumb-profil" data-i18n="header.profile">
                    <i class="fas fa-user-circle"></i> Moj Profil
                </a>
                <a href="#" id="gumbOdjavaMobilni" class="gumb-odjava" data-i18n="header.logout">
                    <i class="fas fa-sign-out-alt"></i> Odjava
                </a>
            </div>
            
            <div class="jezik-ovoj" id="jezikOvojMobilni">
                <i class="fas fa-globe"></i>
                <select class="izbira-jezika" id="izbiraJezikaMobilni">
                    <option value="sl">SL</option>
                    <option value="en">EN</option>
                    <option value="de">DE</option>
                    <option value="hr">HR</option>
                    <option value="it">IT</option>
                    <option value="fr">FR</option>
                    <option value="hu">HU</option>
                    <option value="cz">CZ</option>
                    <option value="es">ES</option>
                    <option value="et">ET</option>
                    <option value="nl">NL</option>
                    <option value="pt">PT</option>
                    <option value="sk">SK</option>
                </select>
            </div>
        </div>
        

</header>
<div id="aiChatModal" class="chat-modal-overlay">
    <div class="chat-modal-content">

        <div class="chat-header">
            <h3>Leo</h3>
            <button class="close-chat-btn" onclick="toggleChat()">&times;</button>
        </div>

        <div class="chat-body">
            <p>Hi there!</p>
        </div>

        <div class="chat-input">
            <input type="text" id="user-input" placeholder="Vnesite sporoƒçilo...">
            <button id="send-button">
                <span class="material-icons">send</span>
            </button>
        </div>

    </div>
</div>

    <main>
        <section class="naslovna-slika">
          <h1 data-i18n="hero.title">Gourmet & Experience</h1>
        </section>

        <section class="iskalnik-sekcija">
          <form class="iskalnik">
            <div class="iskalnik-polje">
              <label for="restavracija_mesto" data-i18n="search.restaurant_city_label">Restavracija ali mesto</label>
              <input type="text" id="restavracija_mesto" data-i18n="[placeholder]search.restaurant_city_placeholder" placeholder="Vnesite ime ali mesto">
            </div>

            <div class="iskalnik-polje skrij-polje">
              <label for="datum" data-i18n="search.date_label">Datum</label>
              <input type="text" id="datum" data-i18n="[placeholder]search.date_placeholder" placeholder="Izberite datum">
            </div>

            <div class="iskalnik-polje skrij-polje">
              <label for="stevilo_oseb" data-i18n="search.persons_label">≈†tevilo oseb</label>
              <select id="stevilo_oseb">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
              </select>
            </div>

            <div class="iskalnik-polje">
              <label for="cas" data-i18n="search.time_label">ƒåas rezervacije</label>
              <select id="cas">
                <option value="" disabled selected data-i18n="search.select_time">Izberi ƒças</option>
                <option value="18.0">18:00</option>
                <option value="19.0">19:00</option>
                <option value="20.0">20:00</option>
              </select>
            </div>

            <button type="submit" class="gumb-isci" data-i18n="search.search_button">I≈°ƒçi</button>
          </form>
        </section>

       <section class="hitra-iskanja">
    <h2 data-i18n="quick_search.title">Hitra izbira kuhinje</h2>
    <div class="gumbi-kategorij">
        <a href="#" class="gumb-kategorija" data-kuhinja="Mesna" data-i18n="cuisine.meat">Mesne jedi</a>
        
        <a href="#" class="gumb-kategorija" data-kuhinja="Vegi" data-i18n="cuisine.vegetarian">Vegetarijanske jedi</a>
        
        <a href="#" class="gumb-kategorija" data-kuhinja="Ribja" data-i18n="cuisine.fish">Ribje jedi</a>
        
        <a href="#" class="gumb-kategorija" data-kuhinja="Pijaƒça" data-i18n="cuisine.drinks">Pijaƒça</a>
        <a href="#" class="gumb-kategorija" data-kuhinja="Brunch" data-i18n="cuisine.brunch">Brunch</a>
    </div>
</section>

        <section class="kartice-restavracij hidden" id="rezultatiIskanjaSekcija">
            
            <div class="gumb-nazaj-vsebnik">
                <button id="gumbNazaj" class="gumb-nazaj ikona-nazaj" onclick="handlePrikaziPrivzete()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            
            <h2 id="naslovRezultatov" data-i18n="results.search_title">Rezultati iskanja</h2>
            <div class="mreza-kartic" id="rezultatiIskanja">
            </div>
        </section>

        <section class="kartice-restavracij" id="privzeteRestavracijeSekcija">
            <h2 data-i18n="results.popular_title">Priljubljeno v va≈°i bli≈æini</h2>
            <div class="mreza-kartic" id="restavracije-container">
                <div id="statusKartice" style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">Nalaganje...</div>
            </div>
        </section>

        <section class="kartice-restavracij kartice-izpostavljeno">
            <h3 data-i18n="results.featured_title">Izpostavljeno</h3>
            
            <div class="mreza-kartic" id="mrezaIzpostavljenoKartic">
                <div id="statusIzpostavljenoKartice" style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">Nalaganje...</div>
            </div>
        </section>
        
        <section class="velika-akcija-slika" id="akcijeBanner">
            
            <img src="Simbol-app.png" alt="Slika aplikacije/ikona" class="ikona-ospredje">

            <div class="akcija-vsebina">
                <h2 data-i18n="action_banner.title">Aktualne Akcije in Posebna Ponudba</h2>
            </div>
        </section>

        <section class="gourmet-explore" id="gourmetExploreSection">
            <h2 data-i18n="gourmet_explore.title">Razi≈°ƒçi nepozabna do≈æivetja</h2>
            <div class="country-cards-container">
                
               <a href="experience.html?code=fine-dining" class="country-card" data-experience-code="fine-dining">
    <img src="Fine-dining.png" alt="Vrhunska kulinarika" class="card-image">
    <div class="card-overlay">
        <span class="card-title" data-i18n="experience.fine_dining">Vrhunska kulinarika</span>
    </div>
</a>

   <a href="wine.html" class="country-card-link">
        <div class="country-card" data-experience-code="wine">
            <div class="wine-silhouette"></div> 
            <img src="Wine-tasting.png" alt="Degustacija vin" class="card-image">
            <div class="card-overlay">
                <span class="card-title" data-i18n="experience.wine">Degustacija vin</span>
            </div>
        </div>
    </a>

    <a href="sea.html" class="country-card-link">
        <div class="country-card" data-experience-code="sea">
            <img src="Wine-tasting.png" alt="Morska do≈æivetja" class="card-image">
            <div class="card-overlay">
                <span class="card-title" data-i18n="experience.sea">Morska do≈æivetja</span>
            </div>
        </div>
    </a>

    <a href="romantic.html" class="country-card-link">
        <div class="country-card" data-experience-code="romantic">
            <img src="Romanticna-dozivetja.png" alt="Romantiƒçna do≈æivetja" class="card-image">
            <div class="card-overlay">
                <span class="card-title" data-i18n="experience.romantic">Romantiƒçna do≈æivetja</span>
            </div>
        </div>
    </a>

</section>


    
</main>
    
   <div id="restavracijaModal" class="restavracija-modal">
    <div class="restavracija-vsebina">
        <span class="gumb-zapri-restavracija" id="zapriRestavracijaModal">√ó</span>
        
        <div id="modalSlika" class="slika-glava"></div>
        
       <div style="padding: 0 25px;">
            
            <div id="galerijaSlike" class="galerija-slike">
                </div>
</div>
      <div class="podrobnosti-tekst">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h2 id="modalIme" style="margin-bottom: 0;">Ime Restavracije</h2>
        
       <button 
    id="modalFavoriteToggle" 
    class="gumb-priljubljeno-modal" 
    data-id="" 
    style="background: none; border: none; cursor: pointer; color: #e74c3c; font-size: 1.2rem; display: flex; align-items: center; gap: 5px;"
>
    <i class="favorite-icon fa-heart far"></i> 
    <span style="font-size: 1rem; font-weight: bold;"></span>
</button>
        </div>
    
   <div class="info-vrstica">
        <span id="modalKuhinja"><i class="fas fa-utensils"></i> Kuhinja</span>
        <span id="modalLokacija"><i class="fas fa-map-marker-alt"></i> Mesto</span>
        <span id="modalOcena"><i class="fas fa-star"></i> Ocena</span>
    </div>

            <p id="modalOpis" class="opis-restavracije">Opis restavracije...</p>

            </div>
        
        <div class="rezervacija-vnosna-polja">
            <div class="vnosno-polje">
                <label for="modalOsebe" data-i18n="modal.reservation_persons">≈†t. oseb:</label>
                <select id="modalOsebe" class="input-rezervacija">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                </select>
            </div>

            <div class="vnosno-polje">
                <label for="modalDatum" data-i18n="modal.reservation_date">Datum:</label>
                <input type="text" id="modalDatum" class="input-rezervacija" placeholder="" readonly>
            </div>

            <input type="hidden" data-reserv-id="" value="">
            
        </div>

        <div style="padding: 0 25px 25px 25px;">
            <div id="prosteUreRezultati" class="proste-ure-rezultati" style="margin-bottom: 15px; padding-top: 15px; text-align: center;">
                <p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>
            </div>
            
            <button class="gumb-rezerviraj-modal" data-i18n="modal.reserve_button">Rezerviraj mizo</button>
        </div>
        
        <div class="modal-tabs">
            <div class="modal-tab active" data-tab="meni" data-i18n="modal.tab_menu">Meni</div>
            <div class="modal-tab" data-tab="aktualnaPonudba" data-i18n="modal.tab_special_offer">Aktualna Ponudba</div> 
            <div class="modal-tab" data-tab="galerija" data-i18n="modal.tab_gallery">Zemljevid</div>
            <div class="modal-tab" data-tab="ocene" data-i18n="modal.tab_reviews">Ocene (0)</div>
        </div>

        <div class="modal-vsebina-ovoj">
            <div class="modal-vsebina-skrol">
                <div id="tabMeni" class="tab-content active">
                    <div class="meni-seznam">
                        <ul id="modalMeni">
                            </ul>
                    </div>
                </div>

                <div id="tabAktualnaPonudba" class="tab-content">
                    <h4 data-i18n="modal.special_offer_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Posebna ponudba restavracije</h4>
                    <p id="modalAktualnaPonudbaOpis" data-i18n="modal.special_offer_default">
                        Trenutno ni aktivne posebne ponudbe ali sezonskega menija.
                    </p>
                    </div>

                <div id="tabGalerija" class="tab-content">
                    <h4 data-i18n="modal.map_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; margin-top: 20px;">Zemljevid Lokacije</h4>
                    
                    <div class="zemljevid-ovoj">
                        <iframe id="modalZemljevid" src="about:blank" allowfullscreen="" loading="lazy" aria-label="Zemljevid lokacije restavracije"></iframe>
                        
                    </div>
                    
  <div style="text-align: center; margin-top: 15px; margin-bottom: 15px;">
    <button 
        id="navigacija-gumb-modal"  
        class="gumb-navigacija" 
        onclick="startNavigation(this)" 
        data-lat=""  data-lon=""  >
        <i class="fas fa-location-arrow"></i>
    </button>
</div>
                    </div>

                <div id="tabOcene" class="tab-content">
                    <p data-i18n="modal.no_reviews">Trenutno ni na voljo podrobnih ocen za prikaz.</p>
                </div>
            </div>
        </div>
        
        </div>
</div>
    
<div class="login-modal" id="loginModal">
    <div class="login-content">
      <span class="close-modal" id="zapriModal">√ó</span>

      <div id="loginRegisterView"> 
        
        <div class="login-tabs">
          <div class="login-tab active" id="tabPrijava" data-i18n="modal.login_tab">Prijava</div>
          <div class="login-tab" id="tabRegistracija" data-i18n="modal.register_tab">Registracija</div>
        </div>

        <form class="login-form active" id="formPrijava">
          <input type="email" id="prijavaEmail" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po≈°ta" required>
          <input type="password" data-i18n="[placeholder]modal.password_placeholder" placeholder="Geslo" required>
          
          <p id="prijavaStatus" class="status-message" style="color:red;"></p>
          
          <button type="submit" data-i18n="modal.login_button">Prijavi se</button>
          
          <div class="prijava-info-text">
              <p data-i18n="">
                  Prosimo, uporabite va≈° e-po≈°tni naslov in geslo za dostop.
              </p>
          </div>

          <div class="forgot-password-container">
              <a href="#" id="pozabljenoGesloLink" data-i18n="modal.forgot_password_link">Pozabljeno geslo?</a>
          </div>
        </form>

        <form class="login-form" id="formRegistracija">
            <input type="text" data-i18n="[placeholder]modal.name_placeholder" placeholder="Ime in priimek" required>
            <input type="email" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po≈°ta" required>
            <input type="password" data-i18n="[placeholder]modal.password_placeholder" placeholder="Geslo" required>
            
            <select id="drzava" name="drzava" required>
                <option value="" disabled selected data-i18n="registration.country_placeholder">Izberi dr≈æavo (EU)</option>
                
                <option value="Avstrija">Avstrija</option>
                <option value="Belgija">Belgija</option>
                <option value="Bolgarija">Bolgarija</option>
                <option value="Ciper">Ciper</option>
                <option value="ƒåe≈°ka">ƒåe≈°ka</option>
                <option value="Danska">Danska</option>
                <option value="Estonija">Estonija</option>
                <option value="Finska">Finska</option>
                <option value="Francija">Francija</option>
                <option value="Grƒçija">Grƒçija</option>
                <option value="Hrva≈°ka">Hrva≈°ka</option>
                <option value="Irska">Irska</option>
                <option value="Italija">Italija</option>
                <option value="Latvija">Latvija</option>
                <option value="Litva">Litva</option>
                <option value="Luksemburg">Luksemburg</option>
                <option value="Mad≈æarska">Mad≈æarska</option>
                <option value="Malta">Malta</option>
                <option value="Nemƒçija">Nemƒçija</option>
                <option value="Nizozemska">Nizozemska</option>
                <option value="Poljska">Poljska</option>
                <option value="Portugalska">Portugalska</option>
                <option value="Romunija">Romunija</option>
                <option value="Slova≈°ka">Slova≈°ka</option>
                <option value="Slovenija">Slovenija</option>
                <option value="≈†panija">≈†panija</option>
                <option value="≈†vedska">≈†vedska</option>
            </select>
            <div class="form-group-checkbox">
                <input type="checkbox" id="pogojiStrinjanje" name="pogojiStrinjanje" required>
                <label for="pogojiStrinjanje">
                    <span data-i18n="registration.pogoji_strinjanje">Strinjam se s </span>
                    <a href="splosni-pogoji.html" target="_blank" data-i18n="registration.splosni_pogoji_link">Splo≈°nimi pogoji</a>
                    <span data-i18n="registration.in_politiko"> in </span>
                    <a href="politika-zasebnosti.html" target="_blank" data-i18n="registration.politika_zasebnosti_link">Politiko zasebnosti</a>.
                    <span class="required-star">*</span>
                </label>
            </div>
            <button type="submit" data-i18n="modal.register_button">Ustvari raƒçun</button>
        </form>
        
      </div>
    <div id="forgotPasswordView" style="display: none;" class="reset-password-view">
    <h3 data-i18n="auth.reset_title">Ponastavitev Gesla</h3>
    
    <p id="navodilaEmail" data-i18n="auth.reset_instructions">Vnesite va≈° e-po≈°tni naslov za po≈°iljanje navodil za ponastavitev.</p>

    <form id="zahtevaResetForm">
        <input type="email" id="resetEmail" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po≈°ta" required>
        
        <p id="resetStatus" class="status-message"></p>

        <button type="submit" id="posljiResetNavodila" data-i18n="auth.send_instructions_button">Po≈°lji navodila</button>
    </form>
    
    <div id="confirmResetFields" style="display: none;">
        
        <p class="mt-20" data-i18n="auth.confirm_instructions">Vnesite 6-mestno kodo, ki ste jo prejeli na e-po≈°to, in novo geslo.</p>

        <input 
            type="text" 
            id="resetCode" 
            placeholder="PIN (OTP)" 
            maxlength="6" 
            inputmode="numeric" 
            required>
        
        <input 
            type="password" 
            id="newPassword" 
            placeholder="Novo Geslo" 
            data-i18n="[placeholder]auth.new_password_placeholder" 
            required>
        
        <button type="button" id="potrdiNovoGeslo" data-i18n="auth.confirm_password_button">Potrdi novo geslo</button>
    </div>

    <div class="back-to-login-container">
        <a href="#" id="nazajNaPrijavoLink" data-i18n="auth.back_to_login_link">Nazaj na prijavo</a>
    </div>
</div>
      </div>
</div>
  
 <div class="duration-modal" id="durationModal">
      <div class="duration-content">
          <span class="close-modal" id="zapriDurationModal">√ó</span>
          
          <h3 data-i18n="modal.reservation_modal.title">Izberite trajanje obiska</h3>
          
          <label data-i18n="modal.reservation_modal.duration_label">Kako dolgo ≈æelite ostati?</label>
          
          <div class="duration-opcije" id="durationOpcije">
              
              <div class="duration-opcija" data-duration="0.5">
                  <input type="radio" id="dur_0_5" name="duration" value="0.5">
                  <label for="dur_0_5" data-i18n="modal.reservation_modal.duration_0_5h">Pol ure (30 min)</label>
              </div>
              
              <div class="duration-opcija selected" data-duration="1.0">
                  <input type="radio" id="dur_1" name="duration" value="1.0" checked>
                  <label for="dur_1" data-i18n="modal.reservation_modal.duration_1h">1 ura</label>
              </div>
              
              <div class="duration-opcija" data-duration="1.5">
                  <input type="radio" id="dur_1_5" name="duration" value="1.5">
                  <label for="dur_1_5" data-i18n="modal.reservation_modal.duration_1_5h">1 ura in pol (90 min)</label>
              </div>
              
              <div class="duration-opcija" data-duration="2.0">
                  <input type="radio" id="dur_2" name="duration" value="2.0">
                  <label for="dur_2" data-i18n="modal.reservation_modal.duration_2h">2 uri</label>
              </div>
          </div>
          
          <button id="potrdiTrajanjeGumb" class="gumb-potrdi-trajanje" data-i18n="modal.reservation_modal.confirm_button">Potrdi trajanje in nadaljuj</button>
          
          <p class="qr-reminder-text" data-i18n="modal.reservation_modal.qr_reminder">
              Ne pozabite: ob prihodu skenirajte QR kodo in pridobite toƒçke!
          </p>
      </div>
  </div>

  <div class="warning-modal" id="warningModal">
      <div class="warning-content">
          <div class="warning-icon-wrapper">
              <i class="fas fa-exclamation-triangle warning-icon"></i>
          </div>
          
          <h3 data-i18n="warning.title">Opozorilo</h3>
          
          <p id="warningMessage" data-i18n="warning.default_message">
            Prosimo, da upo≈°tevate, da so prikazane informacije o razpolo≈æljivosti in cenah zgolj informativne narave.
          </p>
          
          <button id="gumbRazumem" class="gumb-razumem" data-i18n="warning.understand_button">Razumem</button>
      </div>
  </div>

<footer class="noga">
    <button id="footerToggleBtn" class="footer-toggle-btn" aria-expanded="false" aria-controls="nogaVsebinaSkrita" aria-label="Prika≈æi/Skrij vsebino noge">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
    </button>
    
    <div id="nogaVsebinaSkrita" class="noga-vsebina-skrita">
        <div class="noga-vsebina">

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="o-rentyo-vsebina" data-i18n="footer.about_company_title">O Rentyo Gourmet</h4>
                <ul id="o-rentyo-vsebina" class="noga-linki">
                    <li><a href="o-nas.html" data-i18n="footer.about_us" data-i18n-href="footer.about_us_href">O nas</a></li>
                    <li><a href="kontakt.html" data-i18n="footer.contact" data-i18n-href="footer.contact_href">Kontakt</a></li>
                    <li><a href="kariera.html" data-i18n="footer.career" data-i18n-href="footer.career_href">Kariera</a></li>
                    <li><a href="mediji.html" data-i18n="footer.media_press" data-i18n-href="footer.media_press_href">Mediji / Press kotiƒçek</a></li>
                </ul>
            </div>

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="pravne-info-vsebina" data-i18n="footer.legal_info_title">Pravne Informacije</h4>
                <ul id="pravne-info-vsebina" class="noga-linki">
                    <li><a href="politika-zasebnosti.html" data-i18n="footer.privacy_policy" data-i18n-href="footer.privacy_policy_href">Politika zasebnosti</a></li>
                    <li><a href="politika-piskotkov.html" data-i18n="footer.cookie_policy" data-i18n-href="footer.cookie_policy_href">Politika Pi≈°kotkov</a></li>
                    <li><a href="pogoji-uporabe.html" data-i18n="footer.terms_of_use" data-i18n-href="footer.terms_of_use_href">Pogoji Uporabe</a></li>
                    <li><a href="pravno-obvestilo.html" data-i18n="footer.legal_notice" data-i18n-href="footer.legal_notice_href">Pravno Obvestilo</a></li>
                    <li><a href="pravne-informacije.html" data-i18n="footer.legal_info_title" data-i18n-href="footer.legal_info_href">Pravne Informacije</a></li>
                </ul>
            </div>
            
            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="partnerstva-vsebina" data-i18n="footer.partnerships_title">Partnerstva</h4>
                <ul id="partnerstva-vsebina" class="noga-linki">
                    <li><a href="za-partnerje.html" data-i18n="footer.for_partners" data-i18n-href="footer.for_partners_href">Za Partnerje</a></li>
                </ul>
            </div>

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="social-vsebina" data-i18n="footer.connect_title">Pove≈æi se z nami</h4>
                <ul id="social-vsebina" class="noga-linki">
                    <li><a href="https://www.facebook.com/people/Rentyo-Gourmet/61581337694663/" target="_blank">Facebook</a></li>
                    <li><a href="https://www.instagram.com/rentyo.gourmet/" target="_blank">Instagram</a></li>
                    <li><a href="https://www.tiktok.com/@rentyo_travel?lang=sl" target="_blank">TikTok</a></li>
                    <li><a href="https://linkedin.com/company/rentyogourmet" target="_blank">LinkedIn</a></li>
                    <li><a href="https://wa.me/385989023144" target="_blank">WhatsApp</a></li>
                    <li><a href="mailto:info@rentyo.eu">Email</a></li>
                </ul>
            </div>
        </div> <div class="noga-dodatno-info" style="text-align: center; font-size: 0.875rem; margin-bottom: 1rem;">
            
            <p style="margin-bottom: 0.5rem;">
                <span data-i18n="footer.payment_info_prefix">Varno plaƒçilo, ki ga omogoƒça</span>
                <a href="" target="_blank" style="text-decoration: none; color: inherit; font-weight: bold;">Stripe</a>.
            </p>
            
            <div class="stripe-logo" style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                <a href="" target="_blank" aria-label="Stripe Payment Processing">
                    <img src="Stripe.png" alt="Stripe" style="display:inline-block; height: 45px;"> 
                </a>
                
                <a href="#" aria-label="Visa Card Accepted" style="cursor: default;">
                    <img src="Visa.png" alt="Visa" style="display:inline-block; height: 24px;">
                </a>
                
                <a href="#" aria-label="Mastercard Accepted" style="cursor: default;">
                    <img src="Mastercard.png" alt="Mastercard" style="display:inline-block; height: 24px;">
                </a>
            </div>
        </div>
        
        <div class="noga-avtorske-pravice" style="text-align: center; font-size: 0.875rem;">
            <span data-i18n="footer.copyright_text">¬© 2025 Rentyo Gourmet. Vse pravice pridr≈æane.</span>
        </div>
    </div>
</footer>

<div id="capacitorTaskbar" class="capacitor-only">
    
    <a href="index.html" class="taskbar-item active">
        <i class="fas fa-home"></i> 
        <span data-i18n="">Domov</span>
    </a>
    
    <div class="scan-btn-ovoj">
        <a href="profil.html#aktualne-rezervacije" class="scan-btn" title="Aktualne rezervacije (Scan & Earn)">
            <i class="fas fa-qrcode"></i> 
        </a>

    </div>
        <a href="profil.html#priljubljene" class="taskbar-item">
        <i class="fas fa-heart"></i>
        <span data-i18n="">Priljubljene</span>
    </a>
    
    <a href="info-legal.html" class="taskbar-item">
        <i class="fas fa-bars"></i>
        <span data-i18n="">Rezervacije</span>
    </a>
    
</div>

<div id="cookie-consent-banner" class="cookie-banner hidden" style="display: none !important;" data-capacitor-remove-on-native="true">
    <div class="banner-content">
        
        <div class="banner-text-group">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon-cookie" viewBox="0 0 20 20" fill="currentColor" width="24" height="24">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" />
            </svg>
            
            <p class="text-message">
                <span data-i18n="cookieConsent.message"></span>
                
                <a 
                    href="#" 
                    class="link-more-info" 
                    data-i18n-url="cookieConsent.moreInfoLink.url"
                    data-i18n="cookieConsent.moreInfoLink.text">
                </a>
            </p>
        </div>

        <div class="banner-button-group">
            <button id="decline-cookies" class="btn-decline" data-i18n="cookieConsent.buttons.0.text">
                </button>
            
            <button id="accept-cookies" class="btn-accept" data-i18n="cookieConsent.buttons.1.text">
                </button>
        </div>
    </div>
</div>

    </div>
</div>


  


<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script> 

<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pikaday@1.8.0/css/pikaday.css">
<script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>

<script>
// =================================================================
// ‚≠ê GLOBALNA DEFINICIJA PLUGIN-a ZA POTISNA OBVESTILA ‚≠ê
//    (Odstranjena Social Login logika in nevarna destrukturiranja)
// =================================================================

// ‚≠ê VAREN DOSTOP: ƒåe je Capacitor prisoten, pridobimo PushNotifications plugin.
//    ƒåe Plugins ali PushNotifications ≈°e nista nalo≈æena, bo spremenljivka undefined, 
//    kar prepreƒçi zru≈°itev programa (TypeError).
const PushNotifications = 
    window.Capacitor && 
    window.Capacitor.Plugins 
    ? window.Capacitor.Plugins.PushNotifications
    : undefined;

// App in SocialLogin plugini so popolnoma odstranjeni.


// ==========================================================
// ‚≠ê NOVO: LOGIKA ZA DEEP LINKS (Obravnava URL-jev) - VAREN DOSTOP ‚≠ê
// ==========================================================

// ‚≠ê 1. VAREN DOSTOP DO PLUGIN-a ‚≠ê
const App = 
    window.Capacitor && 
    window.Capacitor.Plugins 
    ? window.Capacitor.Plugins.App
    : undefined;

if (App) {
    App.addListener('appUrlOpen', (data) => {
        const url = data.url;

        // Preverite, ali URL ustreza poti za ponastavitev gesla
        if (url && url.includes('/reset-password/')) {
            
            // Izlu≈°ƒçi ≈æeton (token) iz URL-ja
            // Regex i≈°ƒçe kar koli, kar sledi /reset-password/
            const tokenMatch = url.match(/\/reset-password\/(.+)/);
            const token = tokenMatch ? tokenMatch[1] : null;

            if (token) {
                console.log("Deep link uspe≈°no prestre≈æen! Token:", token);
                
                // ‚≠ê KLJUƒåNO: Preusmerite uporabnika na HTML stran z ≈æetonom kot parametrom ‚≠ê
                window.location.href = `reset-password.html?token=${token}`; 

            } else {
                console.error("Deep link zaznan, a ≈æeton ni bil najden.");
            }
        }
    });
}
// ==========================================================

const initializePushNotifications = async () => {
    
    console.error('!!!!!!!!!!!!!!!!!! STARTING PUSH INITIALIZATION JS CODE !!!!!!!!!!!!!!!!!!');

    // ‚≠ê NOVO: Preverjanje prisotnosti vtiƒçnika PushNotifications
    if (!PushNotifications) {
        console.error('PushNotifications plugin not available or not correctly synced.');
        return;
    }

    console.log('Registering for push notifications...');

    // 1. NAJPREJ NASTAVIMO VSE POSLU≈†ALCE (LISTENERS)

    PushNotifications.addListener('registration', (token) => {
        console.error('*** USPE≈†NO PRIDOBLJEN ≈ΩETON! ***', token.value);
    });

    PushNotifications.addListener('registrationError', (err) => {
        console.error('Error during registration: ', err.error);
        alert('NAPAKA PRI REGISTRACIJI! ' + JSON.stringify(err));
    });

    PushNotifications.addListener('pushNotificationReceived', (notification) => {
        console.log('Foreground notification:', notification);
        alert('Novo Obvestilo:\n' + notification.title + '\n' + notification.body);
    });

    PushNotifications.addListener('pushNotificationActionPerformed', (notification) => {
        console.log('Notification action performed:', notification);
    });


    // 2. SEDAJ ZAƒåNEMO PROCES PRIDOBITVE DOVOLJENJA IN REGISTRACIJE
    
    // Zahteva za dovoljenje
    const permStatus = await PushNotifications.requestPermissions();

    if (permStatus.receive === 'granted') {
        await PushNotifications.register();
    } else {
        console.error('Permission not granted for push notifications');
        return;
    }

};

window.addEventListener('load', initializePushNotifications);


// TUKAJ SE NADALJUJE OSTALA GLOBALNA KODA
</script>
<script>
// =================================================================
// 0. GLOBALNE INICIALIZACIJE IN OSNOVNE SPREMENLJIVKE
// =================================================================

// üö® KRITIƒåNO: MANJKAJOƒåA DEFINICIJA, KI JE POVZROƒåILA NAPAKO
const pikadayLangs = {
    sl: {
        months        : ['Januar','Februar','Marec','April','Maj','Junij','Julij','Avgust','September','Oktober','November','December'],
        weekdays      : ['Nedelja','Ponedeljek','Torek','Sreda','ƒåetrtek','Petek','Sobota'],
        weekdaysShort : ['Ned','Pon','Tor','Sre','ƒået','Pet','Sob']
    },
    en: {
        months        : ['January','February','March','April','May','June','July','August','September','October','November','December'],
        weekdays      : ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],
        weekdaysShort : ['Sun','Mon','Tue','Wed','Thu','Fri','Sat']
    },
    de: {
        months        : ['Januar','Februar','M√§rz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'],
        weekdays      : ['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'],
        weekdaysShort : ['So','Mo','Di','Mi','Do','Fr','Sa']
    },
    hr: {
        months        : ['Sijeƒçanj','Veljaƒça','O≈æujak','Travanj','Svibanj','Lipanj','Srpanj','Kolovoz','Rujan','Listopad','Studeni','Prosinac'],
        weekdays      : ['Nedjelja','Ponedjeljak','Utorak','Srijeda','ƒåetvrtak','Petak','Subota'],
        weekdaysShort : ['Ned','Pon','Uto','Sri','ƒået','Pet','Sub']
    },
    it: {
        months        : ['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],
        weekdays      : ['Domenica','Luned√¨','Marted√¨','Mercoled√¨','Gioved√¨','Venerd√¨','Sabato'],
        weekdaysShort : ['Dom','Lun','Mar','Mer','Gio','Ven','Sab']
    },
    fr: {
        months        : ['Janvier','F√©vrier','Mars','Avril','Mai','Juin','Juillet','Ao√ªt','Septembre','Octobre','Novembre','D√©cembre'],
        weekdays      : ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
        weekdaysShort : ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam']
    },
    hu: {
        months        : ['Janu√°r','Febru√°r','M√°rcius','√Åprilis','M√°jus','J√∫nius','J√∫lius','Augusztus','Szeptember','Okt√≥ber','November','December'],
        weekdays      : ['Vas√°rnap','H√©tf≈ë','Kedd','Szerda','Cs√ºt√∂rt√∂k','P√©ntek','Szombat'],
        weekdaysShort : ['V','H','K','Sze','Cs','P','Szo']
    },
    cz: { // ƒåe≈°ƒçina
        months        : ['Leden','√önor','B≈ôezen','Duben','Kvƒõten','ƒåerven','ƒåervenec','Srpen','Z√°≈ô√≠','≈ò√≠jen','Listopad','Prosinec'],
        weekdays      : ['Nedƒõle','Pondƒõl√≠','√öter√Ω','St≈ôeda','ƒåtvrtek','P√°tek','Sobota'],
        weekdaysShort : ['Ne','Po','√öt','St','ƒåt','P√°','So']
    },
    sk: { // Slova≈°ƒçina
        months        : ['Janu√°r','Febru√°r','Marec','Apr√≠l','M√°j','J√∫n','J√∫l','August','September','Okt√≥ber','November','December'],
        weekdays      : ['Nedeƒæa','Pondelok','Utorok','Streda','≈†tvrtok','Piatok','Sobota'],
        weekdaysShort : ['Ne','Po','Ut','St','≈†t','Pi','So']
    },
    es: { // ≈†pan≈°ƒçina
        months        : ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],
        weekdays      : ['Domingo','Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado'],
        weekdaysShort : ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b']
    },
    pt: { // Portugal≈°ƒçina
        months        : ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],
        weekdays      : ['Domingo','Segunda','Ter√ßa','Quarta','Quinta','Sexta','S√°bado'],
        weekdaysShort : ['Dom','Seg','Ter','Qua','Qui','Sex','S√°b']
    },
    nl: { // Nizozem≈°ƒçina
        months        : ['Januari','Februari','Maart','April','Mei','Juni','Juli','Augustus','September','Oktober','November','December'],
        weekdays      : ['Zondag','Maandag','Dinsdag','Woensdag','Donderdag','Vrijdag','Zaterdag'],
        weekdaysShort : ['Zo','Ma','Di','Wo','Do','Vr','Za']
    },
    et: { // Eston≈°ƒçina
        months        : ['Jaanuar','Veebruar','M√§rts','Aprill','Mai','Juuni','Juuli','August','September','Oktoober','November','Detsember'],
        weekdays      : ['P√ºhap√§ev','Esmasp√§ev','Teisip√§ev','Kolmap√§ev','Neljap√§ev','Reede','Laup√§ev'],
        weekdaysShort : ['P√ºh','Esm','Tei','Kol','Nel','Ree','Lau']
    }
};

// API BASE URL
const API_BASE_URL = 'https://rentyo-gourmet-spletna-stran.onrender.com/api';
const TOGGLE_FAVORITE_API_URL = `${API_BASE_URL}/restavracije/uporabnik/priljubljene/toggle`;
const FAVORITES_API_URL = `${API_BASE_URL}/restavracije/uporabnik/priljubljene`;

// GLOBALNE SPREMENLJIVKE ZA PODATKE IN STANJE
let allRestavracije = [];
let MOCK_IZPOSTAVLJENO_RAW = []; 
let currentFilterKuhinja = ''; 
let globalSelectedTime = null; 
let currentRestaurantId = null; 
let globalSelectedMizaId = null; 
let globalSelectedMizaIme = null;
let globalFavoritesList = [];

// üî• NOVA GLOBALNA SPREMENLJIVKA ZA ZEMLJEVID (Leaflet)
let map = null; 

// üî• NOVE GLOBALNE SPREMENLJIVKE ZA LOKACIJO IZBRANE RESTAVRACIJE (Za Navigacijo)
let globalRestaurantLat = null; 
let globalRestaurantLon = null;

// üî• NOVA GLOBALNA SPREMENLJIVKA ZA LOKACIJO UPORABNIKA
let userLocation = null; 
const DEFAULT_LAT = 46.0569; // Ljubljana, kot privzeto, ƒçe ni lokacije
const DEFAULT_LON = 14.5058;
const FALLBACK_IMAGE_URL = 'https://placehold.co/300x200?text=Slika+ni+na+voljo';
const MAX_DISTANCE_KM = 100;


// GLOBALNE DEFINICIJE DOM ELEMENTOV (Ohranjene, ƒçe so definirane v HTML)
const modal = document.getElementById("loginModal");
const closeBtn = document.getElementById("zapriModal");
const tabPrijava = document.getElementById("tabPrijava");
const tabRegistracija = document.getElementById("tabRegistracija");
const formPrijava = document.getElementById("formPrijava");
const formRegistracija = document.getElementById("formRegistracija");
const openBtnDesktop = document.getElementById("odpriPrijavoDesktop");
const profilMeniDesktop = document.getElementById("profilMeniDesktop");
const gumbOdjavaDesktop = document.getElementById("gumbOdjavaDesktop");
const openBtnMobilni = document.getElementById("odpriPrijavoMobilni");
const profilMeniMobilni = document.getElementById("profilMeniMobilni");
const gumbOdjavaMobilni = document.getElementById("gumbOdjavaMobilni");
const mobilniMeni = document.getElementById('mobilniMeni'); 
const hamburgerGumb = document.getElementById('hamburgerGumb');
const mrezaKarticDiv = document.getElementById('restavracije-container'); 
const statusKarticeDiv = document.getElementById('statusKartice');
const mrezaIzpostavljenoKarticDiv = document.getElementById('mrezaIzpostavljenoKartic');
const restavracijaModal = document.getElementById('restavracijaModal');
const zapriRestavracijaModal = document.getElementById('zapriRestavracijaModal');
const modalSlika = document.getElementById('modalSlika');
const modalIme = document.getElementById('modalIme');
const modalKuhinja = document.getElementById('modalKuhinja');
const modalLokacija = document.getElementById('modalLokacija');
const modalOcena = document.getElementById('modalOcena');
const modalOpis = document.getElementById('modalOpis');
const modalTabs = document.querySelectorAll('.modal-tab');
const modalMeni = document.getElementById('modalMeni');
const galerijaSlikeDiv = document.getElementById('galerijaSlike');
const modalZemljevid = document.getElementById('modalZemljevid');
const durationModal = document.getElementById("durationModal");
const zapriDurationModal = document.getElementById("zapriDurationModal");
const durationOpcije = document.getElementById("durationOpcije");
const potrdiTrajanjeGumb = document.getElementById("potrdiTrajanjeGumb");
const warningModal = document.getElementById("warningModal");
const gumbRazumem = document.getElementById("gumbRazumem");
const modalDatumInput = document.getElementById('modalDatum');
const modalOsebeInput = document.getElementById('modalOsebe');
const gumbRezervirajModal = document.querySelector('.gumb-rezerviraj-modal'); 
const iskalnik = document.querySelector('.iskalnik');
const prosteUreRezultati = document.getElementById('prosteUreRezultati'); 
const tabOcene = document.getElementById('tabOcene'); 
// üî• POPRAVLJENI ID-ji iz va≈°ega HTML-ja
const googleLoginBtn = document.getElementById('google-sign-in-btn'); 
const appleLoginBtn = document.getElementById('apple-sign-in-btn');
const chatModal = document.getElementById('aiChatModal');
const FAVORITE_RED_COLOR = '#e74c3c';

// ==========================================================
// ‚≠ê NOVE DEFINICIJE ZA PONASTAVITEV GESLA (IZ HTML-ja) ‚≠ê
// ==========================================================
// Globalni elementi, ki smo jih definirali v HTML
const loginRegisterView = document.getElementById('loginRegisterView');
const forgotPasswordView = document.getElementById('forgotPasswordView');
const pozabljenoGesloLink = document.getElementById('pozabljenoGesloLink'); // Link "Pozabljeno geslo?"
const nazajNaPrijavoLink = document.getElementById('nazajNaPrijavoLink');     // Link "Nazaj na prijavo"
const zahtevaResetForm = document.getElementById('zahtevaResetForm');
const resetEmailInput = document.getElementById('resetEmail');
const resetStatus = document.getElementById('resetStatus');
const prijavaEmailInput = document.getElementById('prijavaEmail'); // Predpostavka: ≈æe definirano
const posljiResetNavodilaBtn = document.getElementById('posljiResetNavodila'); // Gumb za po≈°iljanje
// üëáüëáüëá TI ELEMENTI SO MANJKALI IN POVZROƒåALI NAPAKE üëáüëáüëá
const confirmResetFields = document.getElementById('confirmResetFields'); // DIV za vnos kode in gesla
const resetCodeInput = document.getElementById('resetCode');             // Vnosno polje za 6-mestno kodo
const newPasswordInput = document.getElementById('newPassword');         // Vnosno polje za novo geslo
const potrdiNovoGesloBtn = document.getElementById('potrdiNovoGeslo');   // Gumb za potrditev novega gesla
</script>

<script>
 
// =========================================================
// üî• 1. PRIDOBITEV TOKENA üî•
// =========================================================

/**
 * Pridobi shranjeni JWT token iz localStorage.
 */
function getUserToken() {
    let token = localStorage.getItem('zeton');
    if (!token) {
        token = localStorage.getItem('auth-token');
    }
    
    if (token && token !== 'fake-token') {
        console.log(`[AUTH] Token uspe≈°no pridobljen. (Dol≈æina: ${token.length})`);
        return token;
    } else {
        console.warn("[AUTH] Opozorilo: JWT token ni najden/veljaven v localStorage.");
        return null;
    }
}

// Globalna spremenljivka, ki hrani pridobljeni token
const zeton = getUserToken();


// =========================================================
// üî• 2. FUNKCIJE ZA POSODOBITEV VIZUALNEGA STANJA IN NALAGANJE (POPRAVLJENO) üî•
// =========================================================

/**
 * Posodobi ikone priljubljenih na VSEH karticah na strani glede na globalFavoritesList.
 * To obarva srƒçke v rdeƒç okvir (ne-priljubljeno) ali polno rdeƒço (priljubljeno).
 */
const posodobiVizualnoStanjePriljubljenih = () => {
    // Poi≈°ƒçe elemente, ki vsebujejo 'data-id' (restavracija ID)
    document.querySelectorAll('[data-id]').forEach(element => {
        const restavracijaId = element.getAttribute('data-id');
        // Predvidevamo, da je ikona znotraj elementa z razredom '.favorite-icon'
        const icon = element.querySelector('.favorite-icon'); 
        
        if (restavracijaId && icon) {
             const isFavorite = globalFavoritesList.includes(restavracijaId);

            // 1. Nastavi barvo vedno na rdeƒço
            icon.style.color = FAVORITE_RED_COLOR;

            // ‚≠ê DODATNO ZAGOTOVILO ZA FONT AWESOME DELOVANJE ‚≠ê
            // Prepriƒçamo se, da je osnovni razred 'fa-heart' vedno prisoten
            icon.classList.add('fa-heart');

            // 2. Nastavi razred za polno/prazno srce
            if (isFavorite) {
                // Priljubljena -> Polno rdeƒçe srce (fas / fa-solid)
                icon.classList.remove('far', 'fa-regular'); // Odstrani obrobo
                icon.classList.add('fas', 'fa-solid'); // Dodaj polno obliko
            } else {
                // Ni priljubljena -> Rdeƒça obroba (far / fa-regular)
                icon.classList.remove('fas', 'fa-solid'); // Odstrani polno obliko
                icon.classList.add('far', 'fa-regular'); // Dodaj obrobo
            }
        }
    });
};


/**
 * Pridobi seznam ID-jev priljubljenih restavracij trenutnega uporabnika in ga shrani.
 */
const naloziPriljubljeneRestavracije = async () => {
    if (!zeton) {
        console.warn("[FAVORITES] Uporabnik ni prijavljen, preskakujem nalaganje priljubljenih.");
        return;
    }

    try {
        const response = await fetch(FAVORITES_API_URL, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${zeton}`
            }
        });

        if (response.ok) {
            const data = await response.json();
            // Predpostavljamo, da API vrne { favorites: ['id1', 'id2', ...] }
            globalFavoritesList = Array.isArray(data.favorites) ? data.favorites : [];

            console.log(`[FAVORITES] Uspe≈°no nalo≈æenih ${globalFavoritesList.length} priljubljenih restavracij.`);

            // KLJUƒåNO: Po nalaganju seznama posodobimo vmesnik
            posodobiVizualnoStanjePriljubljenih();

        } else {
            globalFavoritesList = [];
            console.error(`[FAVORITES] Napaka pri nalaganju priljubljenih: ${response.status}`);
        }
    } catch (error) {
        console.error("[FAVORITES] Kritiƒçna napaka pri nalaganju priljubljenih:", error);
    }
};


// =========================================================
// üî• 3. FUNKCIJA ZA PREKLOP PRILJUBLJENIH (POSODOBLJENA) üî•
// =========================================================

/**
 * Preklopi stanje restavracije med priljubljeno in navadno.
 * @param {string} restavracijaId ID restavracije.
 */
const toggleFavorite = async (restavracijaId) => {

    if (!zeton) {
        prikaziSporocilo('warning', 'Prijava je potrebna za shranjevanje priljubljenih!');
        return;
    }

    try {
        const response = await fetch(TOGGLE_FAVORITE_API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${zeton}`
            },
            body: JSON.stringify({ restavracijaId })
        });

        if (response.ok) {
            const data = await response.json();

            // Posodobitev globalnega seznama
            if (data.action === 'added') {
                if (!globalFavoritesList.includes(restavracijaId)) {
                    globalFavoritesList.push(restavracijaId);
                }
                prikaziSporocilo('success', 'Restavracija dodana med priljubljene.');
            } else if (data.action === 'removed') {
                globalFavoritesList = globalFavoritesList.filter(id => id !== restavracijaId);
                prikaziSporocilo('success', 'Restavracija odstranjena iz priljubljenih.');
            }

            // üî• KLJUƒåNO: Po uspe≈°ni API operaciji posodobi vmesnik
            // To popravi vizualno stanje (fas/far) na VSEH elementih
            posodobiVizualnoStanjePriljubljenih();

        } else {
            const errorData = await response.json().catch(() => ({ msg: response.statusText }));
            prikaziSporocilo('error', `Napaka pri priljubljenih: ${errorData.msg || response.statusText}`);
        }
    } catch (error) {
        console.error("Kritiƒçna napaka pri shranjevanju priljubljenih:", error);
        prikaziSporocilo('error', 'Napaka stre≈ænika pri shranjevanju priljubljenih.');
    }
};

// =========================================================
// üî• 4. EVENT LISTENER (DODANA LOKALNA VIZUALNA POTRDITEV) üî•
// =========================================================

document.body.addEventListener('click', (e) => {
    const favoriteButton = e.target.closest('#modalFavoriteToggle'); 

    if (favoriteButton) {
        e.stopPropagation();

        const restavracijaId = favoriteButton.getAttribute('data-id');
        const icon = favoriteButton.querySelector('.favorite-icon'); // üî• Pridobimo referenco na ikono

        if (restavracijaId && icon) {
            // ‚≠ê LOKALNI VIZUALNI POUDAREK (Takoj≈°nja sprememba na polno rdeƒçe)
            // To slu≈æi kot takoj≈°nja vizualna potrditev uporabniku
            
            // ƒåe trenutno ni polno, ga naredimo polno in rdeƒçe (fas/fa-solid)
            if (icon.classList.contains('far') || icon.classList.contains('fa-regular')) {
                icon.classList.remove('far', 'fa-regular');
                icon.classList.add('fas', 'fa-solid');
            } else {
                // ƒåe je ≈æe polno, ga naredimo obrobo (kar simulira odstranitev)
                icon.classList.remove('fas', 'fa-solid');
                icon.classList.add('far', 'fa-regular');
            }
            
            // Barvo ponovno nastavimo (za vsak primer)
            icon.style.color = FAVORITE_RED_COLOR;
            
            // Spro≈æi API klic, ki bo po potrditvi s stre≈ænika poklical posodobiVizualnoStanjePriljubljenih()
            // To bo vizualno stanje POPRAVILO NA PRAVEGA (tudi ƒçe pride do napake na stre≈æniku)
            if (typeof toggleFavorite === 'function') {
                toggleFavorite(restavracijaId);
            }
        }
    }
});
// =========================================================

// =================================================================
// ‚≠ê NOV BLOK ZA OPTIMIZACIJO CAPACITOR APLIKACIJE ‚≠ê
//    (Odstranjena vsa logika za Web Splash Screen)
// =================================================================

// Opomba: Ta blok je sedaj namenjen samo prilagoditvi DOM elementov za Capacitor okolje.

if (window.Capacitor && window.Capacitor.isNativePlatform()) {
    
    // ---------------------------------------------------------------------
    // VSA LOGIKA, KI SE IZVAJA TAKOJ (Odstranjena: ni veƒç potrebna)
    // ---------------------------------------------------------------------

    
    // ---------------------------------------------------------------------
    // DOMContentLoaded LOGIKA (Za ostale aspekte in ƒçi≈°ƒçenje)
    // ---------------------------------------------------------------------

    document.addEventListener('DOMContentLoaded', () => {

        // 1. Logika za skritje oglasne sekcije 'akcijeBanner' (Ta se izvede vedno)
        // Ta del je ohranjen, saj ni povezan s Splash Screenom.
        const akcijeBanner = document.getElementById('akcijeBanner');
        if (akcijeBanner) {
            akcijeBanner.remove(); 
            console.log("Capacitor App: Oglasna sekcija 'akcijeBanner' je uspe≈°no odstranjena.");
        }

        // Vsa ostala logika (preverjanje zastavice, ƒçasovniki, klici SplashScreen.hide()) 
        // je odstranjena, ker se sedaj zana≈°amo na Native Splash Screen in 
        // avtomatsko skrivanje.
        
    }); // Zapira document.addEventListener('DOMContentLoaded', ...)

} // Zapira if (window.Capacitor && window.Capacitor.isNativePlatform())


// =================================================================
// I. POMO≈ΩNE FUNKCIJE IN GEOLOKACIJA 
// =================================================================

function generateStarsHTML(rating) {
    const fullStar = '‚òÖ'; 
    const maxStars = 5;
    const roundedRating = Math.round(rating);

    let starsHTML = '';
    for (let i = 1; i <= maxStars; i++) {
        if (i <= roundedRating) {
            starsHTML += `<span style="color: #076b6a;">${fullStar}</span>`;
        } else {
            starsHTML += `<span style="color: #e0e0e0;">${fullStar}</span>`;
        }
    }
    return starsHTML;
}

/**
 * Izraƒçuna razdaljo med dvema koordinatama (Haversinova formula)
 * @returns Razdalja v kilometrih (km).
 */
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Polmer Zemlje v kilometrih
    const dLat = (lat2 - lat1) * (Math.PI / 180);
    const dLon = (lon2 - lon1) * (Math.PI / 180);
    const a = 
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = R * c; // Razdalja v km
    return distance;
}

const prikaziSporocilo = (msg, type = 'info', duration = 4000) => { 
    console.log(`[Toaster Sporoƒçilo] ${type}: ${msg}`);
    
    const container = document.getElementById('toaster-container');
    if (!container) {
        console.error("Toaster container (id='toaster-container') ni najden v HTML-ju.");
        return;
    }

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let iconClass = '';
    if (type === 'success') iconClass = 'fas fa-check-circle';
    else if (type === 'error') iconClass = 'fas fa-exclamation-triangle';
    else if (type === 'warning') iconClass = 'fas fa-exclamation-circle';
    else iconClass = 'fas fa-info-circle'; 

    toast.innerHTML = `
        <div>
            <span class="toast-icon"><i class="${iconClass}"></i></span>
            <span>${msg}</span>
        </div>
    `;

    container.prepend(toast); 
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 10); 

    setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => {
            toast.remove();
        }, { once: true });
    }, duration);
    
    toast.addEventListener('click', () => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => {
            toast.remove();
        }, { once: true });
    });
};

const preimenujOsebe = () => {
    const select = document.getElementById("stevilo_oseb");
    if (select && typeof i18next !== "undefined") {
        Array.from(select.options).forEach((option) => {
            const count = parseInt(option.value);
            const translationKey = "search.person_singular"; 
            option.textContent = i18next.t(translationKey, { count: count });
        });
    }
};

function generirajCasovneOpcije() {
  const select = document.getElementById("cas");
  if (!select) return; 

  // Praznjenje seznama, da se zagotovi, da ni podvojenih opcij
  // Opomba: ƒåe imate prvo opcijo ("Izberi ƒças") v HTML, to izpustite ali jo dodajte nazaj
  select.innerHTML = ''; 

  // Generiranje samo polnih ur (od 10:00 do 23:00)
  for (let h = 10; h <= 23; h++) {
    // Vidni tekst za uporabnika (npr. 10:00)
    let displayTime = `${h.toString().padStart(2, "0")}:00`;
    
    // Vrednost za backend (npr. 10.0, 19.0)
    let decimalValue = h.toFixed(1); 
    
    // Dodajanje opcije v <select>
    select.add(new Option(displayTime, decimalValue));
  }
  
  // Nastavitev privzete izbrane vrednosti na 19.0 (19:00)
  select.value = "19.0"; 
}

const updateContent = () => {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const options = el.getAttribute("data-i18n-options") ? JSON.parse(el.getAttribute("data-i18n-options")) : {};

    if (key.startsWith("[placeholder]")) el.placeholder = i18next.t(key.replace("[placeholder]", ""), options);
    else el.textContent = i18next.t(key, options);
  });
  if(i18next && i18next.exists("app.title")) document.title = i18next.t("app.title");
  preimenujOsebe();
};

const getAuthHeaders = () => {
    const headers = { 'Content-Type': 'application/json' };
    const token = localStorage.getItem('zeton');
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    return headers;
};

const formatirajDatumZaBackend = (datumPrikaz) => {
    if (!datumPrikaz || datumPrikaz.length !== 10) return null;
    try {
        const [dan, mesec, leto] = datumPrikaz.split('.');
        // API priƒçakuje format YYYY-MM-DD
        return `${leto}-${mesec.padStart(2, '0')}-${dan.padStart(2, '0')}`;
    } catch (e) {
        console.error("Napaka pri formatiranju datuma:", e);
        return null;
    }
};

/**
 * Pridobitev lokacije uporabnika in preraƒçun razdalj.
 */
function getUserLocation() {
    const storedLocation = localStorage.getItem('userLocation');
    if (storedLocation) {
        userLocation = JSON.parse(storedLocation);
        console.log("Lokacija pridobljena iz localStorage.");
        return; 
    }
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                userLocation = {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
                localStorage.setItem('userLocation', JSON.stringify(userLocation));
                console.log(`Lokacija uspe≈°no pridobljena in shranjena: ${userLocation.lat}, ${userLocation.lon}`);
                // Po pridobitvi lokacije ponovno renderiramo restavracije, da se posodobi razdalja
                filterAndRenderRestavracije();
            },
            (error) => {
                console.warn(`Napaka pri pridobivanju lokacije: ${error.message}`);
                userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON };
                prikaziSporocilo(i18next.t('messages.location_denied') || 'Lokacija ni na voljo. Razdalje so izraƒçunane iz privzete toƒçke.', 'warning');
            },
            { enableHighAccuracy: false, timeout: 5000, maximumAge: 0 }
        );
    } else {
        console.log("Geolokacija v brskalniku ni podprta.");
        userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON };
    }
}

// =================================================================
// üîë DODANE FUNKCIJE ZA VARNO SHRANJEVANJE (Secure Storage)
// =================================================================

const SECURE_STORAGE_NAME = 'RentyoApp';
const TOKEN_KEY = 'zeton'; // Uporabite isti kljuƒç kot prej

// ASINHRONO BRANJE ≈ΩETONA (nadomesti localStorage.getItem)
const getSecureToken = async () => {
    // Fallback na LocalStorage, ƒçe vtiƒçnik ni na voljo (npr. v brskalniku)
    if (!window.plugins || !window.plugins.securestorage) {
        return localStorage.getItem(TOKEN_KEY); 
    }
    
    return new Promise((resolve, reject) => {
        const ss = window.plugins.securestorage;
        // 1. Inicializiraj
        ss.init(() => {
            // 2. Preberi
            ss.get(resolve, (err) => {
                 // ƒåe je napaka (npr. kljuƒç ne obstaja), vrni null
                resolve(null);
            }, TOKEN_KEY);
        }, (err) => {
            // ƒåe se init ne izvede, vrni null
            resolve(null); 
        }, SECURE_STORAGE_NAME);
    }).catch(() => null); 
};

// ASINHRONO NASTAVLJANJE ≈ΩETONA (nadomesti localStorage.setItem)
const setSecureToken = async (token) => {
    if (!window.plugins || !window.plugins.securestorage) {
        localStorage.setItem(TOKEN_KEY, token);
        return;
    }
    
    return new Promise((resolve, reject) => {
        const ss = window.plugins.securestorage;
        ss.init(() => {
            ss.set(resolve, reject, TOKEN_KEY, token);
        }, (err) => {
            console.error("Napaka pri inicializaciji/nastavljanju secure tokena. Uporabljen LocalStorage (Fallback).", err);
            localStorage.setItem(TOKEN_KEY, token); // Fallback na LocalStorage
            resolve();
        }, SECURE_STORAGE_NAME);
    }).catch(() => {
        // Kritiƒçna napaka shranjevanja
        localStorage.setItem(TOKEN_KEY, token); // Fallback
    });
};


// ASINHRONO BRISANJE ≈ΩETONA (nadomesti localStorage.removeItem)
const removeSecureToken = async () => {
    if (!window.plugins || !window.plugins.securestorage) {
        localStorage.removeItem(TOKEN_KEY);
        return;
    }
    
    return new Promise((resolve, reject) => {
        const ss = window.plugins.securestorage;
        // Odstranimo ≈æeton ne glede na init status (ƒçe je ≈æe bil init)
        ss.remove(resolve, reject, TOKEN_KEY);
    }).catch(() => {
        // Napaka pri brisanju ni kritiƒçna
    });
};


// ==========================================================
// II. LOGIKA PRIJAVE/ODJAVE, MODALOV IN SOCIALNA PRIJAVA
// ==========================================================

// FUNKCIJA SPREMENJENA V ASINHRONO
const setLoginStatus = async (isLoggedIn) => { 
    if (!isLoggedIn) {
        await removeSecureToken(); // ‚úÖ Varno brisanje ≈æetona
        
        // Ostale LocalStorage elemente pustimo nedotaknjene
        localStorage.removeItem('jeLastnik');
        localStorage.removeItem('telefon'); 
        localStorage.removeItem('ime'); 
    }
    
    if (isLoggedIn) {
        if(openBtnDesktop) openBtnDesktop.style.display = "none"; 
        if(profilMeniDesktop) profilMeniDesktop.style.display = "flex"; 
        if(openBtnMobilni) openBtnMobilni.style.display = "none"; 
        if(profilMeniMobilni) profilMeniMobilni.style.display = "flex"; 
    } else {
        if(openBtnDesktop) openBtnDesktop.style.display = "flex"; 
        if(profilMeniDesktop) profilMeniDesktop.style.display = "none"; 
        if(openBtnMobilni) openBtnMobilni.style.display = "flex"; 
        if(profilMeniMobilni) profilMeniMobilni.style.display = "none"; 
    }
};

// FUNKCIJA SPREMENJENA V ASINHRONO
const checkInitialLoginStatus = async () => {
    const zeton = await getSecureToken(); // ‚úÖ Asinhrono branje
    const isLoggedIn = zeton !== null && zeton !== undefined;
    
    // Ker je setLoginStatus asinhron, ga kliƒçemo neposredno
    setLoginStatus(isLoggedIn);
};
checkInitialLoginStatus(); 

/**
 * Skupna funkcija za obravnavo socialne prijave (Google/Apple)
 * @param {string} provider - 'google' ali 'apple'
 */
const handleSocialLogin = async (provider) => { // DODAN 'async' za delo z pluginom

    // Predpostavljamo, da je SocialLogin plugin uvo≈æen, npr.: const { SocialLogin } = Plugins;
    
    if (provider === 'google') {
        try {
            // ‚≠ê NATIƒåNI KLIC PLUGINA ZA GOOGLE PRIJAVO ‚≠ê
            const result = await SocialLogin.google({ 
                clientId: '656400083949-nuj4kg2rvofjjecmtcoo29191erlkula.apps.googleusercontent.com', // Web Client ID
                redirectUri: 'com.googleusercontent.apps.656400083949-nuj4kg2rvofjjecmtcoo29191erlkula:/oauth2redirect', // App Scheme
                scopes: ['profile', 'email'],
                android: {
                    redirectUri: 'com.googleusercontent.apps.656400083949-nuj4kg2rvofjjecmtcoo29191erlkula:/oauth2redirect'
                }
            });

            const idToken = result.idToken; 
            
            // ‚≠ê KLIC STRE≈ΩNIKA ZA POTRDITEV TOKENA (backend) ‚≠ê
            // Ko dobimo token, ga po≈°ljemo nazaj na na≈° API.
            const res = await fetch(`${API_BASE_URL}/auth/social-login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: idToken, provider: 'google' })
            });

            const data = await res.json();

            if (res.ok) {
                // ‚úÖ Varno shranjevanje ≈æetona
                await setSecureToken(data.zeton);
                
                // Shranjevanje ostalih podatkov ostane v LocalStorage
                const jeLastnikString = data.jeLastnik === true || data.jeLastnik === 'true' ? 'true' : 'false';
                localStorage.setItem('jeLastnik', jeLastnikString);
                if (data.ime) localStorage.setItem('ime', data.ime);
                if (data.telefon) localStorage.setItem('telefon', data.telefon);
                
                setLoginStatus(true);
                prikaziSporocilo(i18next.t('messages.login_success') || 'Uspe≈°na prijava!', 'success');
            } else {
                prikaziSporocilo(data.msg || i18next.t('messages.social_login_failed') || 'Prijava neuspe≈°na.', 'error');
            }

        } catch (error) {
            // Opomba: Veƒçina napak Capgo plugina (npr. uporabnik prekliƒçe) pride sem
            console.error('Napaka pri Google prijavi preko plugina:', error);
            prikaziSporocilo(i18next.t('messages.social_login_failed') || 'Prijava z Google neuspe≈°na ali preklicana.', 'error');
        }
    } else if (provider === 'apple') {
        // Za Apple ali druge ponudnike, ki niso obdelani znotraj Capgo plugina (ali potrebujejo stre≈æni≈°ki tok):
        const callbackUrl = encodeURIComponent(window.location.href);
        window.location.href = `${API_BASE_URL}/auth/${provider}?redirectUrl=${callbackUrl}`;
    }
};

/**
 * Preveri URL ob nalaganju strani za podatke o prijavi (ƒçe nas je stre≈ænik preusmeril nazaj).
 */
const checkUrlForAuthToken = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const zeton = urlParams.get('zeton');
    const jeLastnik = urlParams.get('jeLastnik');
    const ime = urlParams.get('ime');
    const telefon = urlParams.get('telefon');
    const status = urlParams.get('status');

    if (zeton) {
        // ‚úÖ Varno shranjevanje ≈æetona (ne more biti async tukaj, zato kliƒçemo .then)
        setSecureToken(zeton);

        // Pretvori jeLastnik v boolean
        if (jeLastnik !== null) {
            // ‚≠ê KLJUƒåNO: Shranimo kot string 'true' ali 'false' za doslednost
            const jeLastnikString = jeLastnik === 'true' || jeLastnik === '1' ? 'true' : 'false';
            localStorage.setItem('jeLastnik', jeLastnikString);
        } else {
            localStorage.removeItem('jeLastnik');
        }
        if (ime) localStorage.setItem('ime', ime);
        if (telefon) localStorage.setItem('telefon', telefon);

        setLoginStatus(true);
        prikaziSporocilo(i18next.t('messages.login_success') || 'Uspe≈°na prijava!', 'success');
        
        // Oƒçisti URL parametre
        const newUrl = window.location.pathname; 
        window.history.replaceState({}, document.title, newUrl);
        
        // Ponovno nalaganje restavracij ali kaj podobnega, ƒçe je potrebno
        // filterAndRenderRestavracije(); 
    } else if (status === 'error') {
        const msg = urlParams.get('msg') || i18next.t('messages.social_login_failed') || 'Prijava z zunanjim ponudnikom neuspe≈°na.';
        prikaziSporocilo(msg, 'error');
        // Oƒçisti URL parametre
        const newUrl = window.location.pathname; 
        window.history.replaceState({}, document.title, newUrl);
    }
};


// --- LISTENERJI (Se izvedejo ob DOMContentLoaded) ---
document.addEventListener('DOMContentLoaded', () => { 
    
    // ‚≠ê NOVO: DEFINICIJA ELEMENTOV ZA PONASTAVITEV GESLA (Pred DOMContentLoaded jih ni bilo) ‚≠ê
    // Opomba: Te definicije so v va≈°em izvirniku, ƒçeprav so globalno ≈æe definirane, jih pustimo.
    const loginRegisterView = document.getElementById('loginRegisterView'); 
    const forgotPasswordView = document.getElementById('forgotPasswordView');
    const pozabljenoGesloLink = document.getElementById('pozabljenoGesloLink');
    const nazajNaPrijavoLink = document.getElementById('nazajNaPrijavoLink');
    
    const zahtevaResetForm = document.getElementById('zahtevaResetForm');
    const resetEmailInput = document.getElementById('resetEmail');
    const resetStatus = document.getElementById('resetStatus');
    const prijavaEmailInput = document.getElementById('prijavaEmail');
    const sendResetEmailBtn = document.getElementById('posljiResetNavodila'); // Ta ID je v HTML-ju
    
    // Predpostavimo, da je API_BASE_URL definirana in da so:
    // const API_BASE_URL = '/api'; 
    // const confirmResetFields = document.getElementById('confirmResetFields');
    // const resetCodeInput = document.getElementById('resetCode');
    // const newPasswordInput = document.getElementById('newPassword');
    // const potrdiNovoGesloBtn = document.getElementById('potrdiNovoGeslo');

    // Preveri, ali so v URL-ju parametri prijave (Za social login)
    checkUrlForAuthToken();

    // Dodaj poslu≈°alce za Google in Apple z uporabo pravilnih ID-jev
    if (googleLoginBtn) {
        googleLoginBtn.addEventListener('click', () => handleSocialLogin('google'));
    }
    if (appleLoginBtn) {
        appleLoginBtn.addEventListener('click', () => handleSocialLogin('apple'));
    }

    const openModalListeners = [openBtnDesktop, openBtnMobilni].filter(btn => btn !== null);
    openModalListeners.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            if(modal) modal.classList.add("active");
            if(mobilniMeni) mobilniMeni.classList.remove('active'); 
        });
    });

    if(closeBtn) closeBtn.addEventListener("click", () => modal.classList.remove("active"));
    if(modal) window.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.remove("active");
    });

    // ‚≠ê POPRAVEK: Preklapljanje med zavihki naj sedaj skrije 'forgotPasswordView', ƒçe je viden ‚≠ê
    if (tabPrijava && tabRegistracija && formPrijava && formRegistracija) {
        tabPrijava.addEventListener("click", () => {
          tabPrijava.classList.add("active");
          tabRegistracija.classList.remove("active");
          formPrijava.classList.add("active");
          formRegistracija.classList.remove("active");

          // Skrije pogled za ponastavitev gesla (ƒçe je bil viden)
          if(forgotPasswordView) forgotPasswordView.style.display = 'none';
          if(loginRegisterView) loginRegisterView.style.display = 'block';
        });

        tabRegistracija.addEventListener("click", () => {
          tabRegistracija.classList.add("active");
          tabPrijava.classList.remove("active");
          formRegistracija.classList.add("active");
          formPrijava.classList.remove("active");

          // Skrije pogled za ponastavitev gesla (ƒçe je bil viden)
          if(forgotPasswordView) forgotPasswordView.style.display = 'none';
          if(loginRegisterView) loginRegisterView.style.display = 'block';
        });
    }

    if (formRegistracija) {
        const pogojiCheckbox = document.getElementById('pogojiStrinjanje');
        const gumbRegistracija = formRegistracija.querySelector('button[type="submit"]');

        if (pogojiCheckbox && gumbRegistracija) {
            gumbRegistracija.disabled = !pogojiCheckbox.checked;
            pogojiCheckbox.addEventListener('change', function() {
                gumbRegistracija.disabled = !this.checked;
            });
        }
    }
    
    // ==========================================================
    // ‚≠ê NOVE FUNKCIONALNOSTI ZA PONASTAVITEV GESLA (POPOLNI POPRAVEK) ‚≠ê
    // ==========================================================
    
    // 1. LOGIKA PRIKAZOVANJA/SKRIVANJA (Toggle)
    
    // Pojdi na formular za ponastavitev gesla
    if (pozabljenoGesloLink && forgotPasswordView && loginRegisterView) {
        pozabljenoGesloLink.addEventListener('click', (e) => {
            e.preventDefault();
            
            // 1. Skrij glavni pogled (Prijava/Registracija) in poka≈æi pogled za ponastavitev
            loginRegisterView.style.display = 'none';
            forgotPasswordView.style.display = 'block'; 

            // 2. Zagotovi, da je najprej vidna le faza E-maila (1. korak)
            if (zahtevaResetForm) zahtevaResetForm.style.display = 'block';
            if (confirmResetFields) confirmResetFields.style.display = 'none'; // ‚≠ê Dodano!

            // 3. Poskusi avtomatiƒçno izpolniti e-mail
            if (prijavaEmailInput && resetEmailInput && prijavaEmailInput.value) {
                 resetEmailInput.value = prijavaEmailInput.value;
            }
            
            // 4. Poƒçisti statusna sporoƒçila
            if (resetStatus) resetStatus.textContent = ''; 
        });
    }

    // Vrnitev na formular za prijavo
    if (nazajNaPrijavoLink && forgotPasswordView && loginRegisterView) {
        nazajNaPrijavoLink.addEventListener('click', (e) => {
            e.preventDefault();
            forgotPasswordView.style.display = 'none';
            loginRegisterView.style.display = 'block';
            
            // Avtomatsko preklopi na zavihek Prijava
            if (tabPrijava) tabPrijava.click();
        });
    }

    // 2. KLIC NA BACKEND (/forgot-password) - ZAHTEVA ZA KODO
    if (zahtevaResetForm && sendResetEmailBtn && confirmResetFields) {
        zahtevaResetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = resetEmailInput.value;
            if (!email) {
                if(resetStatus) {
                    resetStatus.style.color = 'red';
                    resetStatus.textContent = 'Prosimo, vnesite e-mail naslov.';
                }
                return;
            }

            // Priprava za klic
            if (resetStatus) {
                resetStatus.style.color = 'black';
                resetStatus.textContent = 'Po≈°iljam navodila...';
            }
            if(sendResetEmailBtn) sendResetEmailBtn.disabled = true;

            try {
                const res = await fetch(`${API_BASE_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const data = await res.json();

                if (res.ok) {
                    // ‚≠ê USPEH KORAKA 1: Preklop pogleda na vnos kode in gesla
                    if (resetStatus) {
                        resetStatus.style.color = 'green';
                        resetStatus.textContent = data.message || 'Koda je poslana. Prosimo, vnesite jo spodaj z novim geslom.';
                    }

                    // Skrij 1. korak (e-mail formular) in prika≈æi 2. korak (OTP/geslo)
                    zahtevaResetForm.style.display = 'none';
                    confirmResetFields.style.display = 'block'; // ‚≠ê Dodano!

                } else {
                    if (resetStatus) {
                        resetStatus.style.color = 'red';
                        resetStatus.textContent = data.message || `Napaka stre≈ænika: ${res.status}. Poskusite znova.`;
                    }
                }

            } catch (error) {
                console.error('Napaka omre≈æja:', error);
                if (resetStatus) {
                    resetStatus.style.color = 'red';
                    resetStatus.textContent = 'Napaka pri povezavi z omre≈æjem.';
                }
            } finally {
                // Gumb omogoƒçi nazaj, samo ƒçe klic ni bil uspe≈°en (tj. ƒçe je formular ≈°e viden)
                if (zahtevaResetForm.style.display !== 'none') {
                    if(sendResetEmailBtn) sendResetEmailBtn.disabled = false;
                }
            }
        });
    }

    // 3. KLIC NA BACKEND (/reset-password/confirm) - POTRDITEV KODE IN NOVO GESLO
    if (potrdiNovoGesloBtn) {
        potrdiNovoGesloBtn.addEventListener('click', async () => {
            
            // ‚≠ê Zberemo vse podatke
            const email = resetEmailInput.value;
            const otpCode = resetCodeInput.value.trim();
            const newPassword = newPasswordInput.value;

            // Osnovna validacija
            if (!email || otpCode.length !== 6 || newPassword.length < 6) {
                if(resetStatus) {
                    resetStatus.style.color = 'red';
                    resetStatus.textContent = 'Prosimo, vnesite 6-mestno kodo in geslo (min 6 znakov).';
                }
                return;
            }

            // Priprava za klic
            if (resetStatus) {
                resetStatus.style.color = 'black';
                resetStatus.textContent = 'Potrjevanje kode in ponastavitev gesla...';
            }
            potrdiNovoGesloBtn.disabled = true;

            try {
                const res = await fetch(`${API_BASE_URL}/auth/reset-password/confirm`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, otpCode, newPassword })
                });

                const data = await res.json();

                if (res.ok) {
                    // ‚≠ê USPEH: Ponastavitev gesla je uspe≈°na
                    if (resetStatus) {
                        resetStatus.style.color = 'green';
                        resetStatus.textContent = data.message || 'Geslo je bilo uspe≈°no ponastavljeno! Preusmerjam na prijavo...';
                    }
                    
                    // Po uspe≈°ni ponastavitvi preusmeri nazaj na prijavo po 3 sekundah
                    setTimeout(() => {
                        if (nazajNaPrijavoLink) nazajNaPrijavoLink.click();
                    }, 3000);

                } else {
                    // NAPAKA (npr. napaƒçna ali potekla koda)
                    if (resetStatus) {
                        resetStatus.style.color = 'red';
                        resetStatus.textContent = data.error || data.message || `Napaka: Koda ni pravilna ali je potekla.`;
                    }
                }

            } catch (error) {
                console.error('Napaka omre≈æja pri potrditvi gesla:', error);
                if (resetStatus) {
                    resetStatus.style.color = 'red';
                    resetStatus.textContent = 'Napaka pri povezavi z omre≈æjem med potrjevanjem.';
                }
            } finally {
                potrdiNovoGesloBtn.disabled = false;
            }
        });
    }

    // ==========================================================
    
    // Nadaljevanje va≈°e obstojeƒçe kode:
    
    if(formPrijava) formPrijava.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = formPrijava.querySelector('input[type="email"]').value;
        // ‚úÖ POPRAVLJENO: 'formPrija' spremenjeno v 'formPrijava'
        const geslo = formPrijava.querySelector('input[type="password"]').value; 
        try {
            const res = await fetch(`${API_BASE_URL}/auth/prijava`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, geslo })
            });
            const data = await res.json();
            if (res.ok) {
                await setSecureToken(data.zeton); // ‚úÖ Varno shranjevanje ≈æetona
                
                const jeLastnikAPI = data.zelastnik !== undefined ? data.zelastnik : data.jeLastnik; 
                
                // ‚≠ê POPRAVEK: Shranjevanje lastnika kot string 'true' ali 'false' (ostane LocalStorage)
                const jeLastnikString = jeLastnikAPI === true || jeLastnikAPI === 'true' ? 'true' : 'false';
                localStorage.setItem('jeLastnik', jeLastnikString); 
                
                if (data.ime) localStorage.setItem('ime', data.ime); 
                if (data.telefon) localStorage.setItem('telefon', data.telefon); 
                
                setLoginStatus(true); 
                if(modal) modal.classList.remove("active");
                prikaziSporocilo(i18next.t('messages.login_success') || 'Uspe≈°na prijava!', 'success');
            } else {
                prikaziSporocilo(data.msg || i18next.t('messages.login_failed') || 'Prijava neuspe≈°na.', 'error');
            }
        } catch (err) {
            console.error("Napaka pri klicu prijave:", err);
            prikaziSporocilo(i18next.t('messages.server_error') || 'Napaka stre≈ænika pri prijavi.', 'error');
        }
    });

    if(formRegistracija) formRegistracija.addEventListener("submit", async (e) => {
    e.preventDefault();
    const pogojiCheckbox = document.getElementById('pogojiStrinjanje');
    if (!pogojiCheckbox || !pogojiCheckbox.checked) {
        prikaziSporocilo(i18next.t('messages.pogoji_required') || 'Za registracijo morate sprejeti Splo≈°ne pogoje.', 'error');
        return;
    }
    
    // ‚≠ê 1. ZAJEBAVANJE NOVEGA POLJA DR≈ΩAVA ‚≠ê
    const drzavaInput = document.getElementById('drzava'); // Uporabimo ID iz HTML select polja
    
    const imeInput = formRegistracija.querySelector('input[name="ime"]') || formRegistracija.querySelector('input[type="text"]');
    const emailInput = formRegistracija.querySelector('input[type="email"]');
    const gesloInput = formRegistracija.querySelector('input[type="password"]');
    
    const ime = imeInput ? imeInput.value.trim() : '';
    const email = emailInput ? emailInput.value.trim() : '';
    const geslo = gesloInput ? gesloInput.value.trim() : '';
    const drzava = drzavaInput ? drzavaInput.value.trim() : ''; // Zajem vrednosti dr≈æave

    // 2. DODANA VALIDACIJA ZA DR≈ΩAVO
    if (!ime || !email || !geslo || !drzava) { // Dodamo preverjanje za drzava
        prikaziSporocilo(i18next.t('messages.required_fields_missing') || 'Vnesite vsa polja, vkljuƒçno z dr≈æavo!', 'error');
        return; 
    }
    
    const jeLastnik = false; 
    const cena = 0; 
    const telefon = '040123456'; 
    
    try {
        const res = await fetch(`${API_BASE_URL}/auth/registracija`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            // ‚≠ê 3. DODAJANJE DR≈ΩAVE V TELO ZAHTEVE ‚≠ê
            body: JSON.stringify({ ime, email, geslo, jeLastnik, cena, telefon, drzava }) 
        });
        const data = await res.json();
        if (res.ok) {
            await setSecureToken(data.zeton); // ‚úÖ Varno shranjevanje ≈æetona
            
            // ‚≠ê POPRAVEK: Shranjevanje lastnika kot string 'false' za doslednost (ostane LocalStorage)
            localStorage.setItem('jeLastnik', 'false'); 
            
            localStorage.setItem('ime', ime); 
            localStorage.setItem('telefon', telefon); 
            
            setLoginStatus(true); 
            if(modal) modal.classList.remove("active");
            prikaziSporocilo(i18next.t('messages.registration_success') || 'Uspe≈°na registracija!', 'success');
        } else {
            prikaziSporocilo(data.msg || i18next.t('messages.registration_failed') || 'Registracija neuspe≈°na.', 'error');
        }
    } catch (err) {
        console.error("Napaka pri klicu registracije:", err);
        prikaziSporocilo(i18next.t('messages.server_error') || 'Napaka stre≈ænika pri registraciji.', 'error');
    }
});
        
    const logoutListeners = [gumbOdjavaDesktop, gumbOdjavaMobilni].filter(btn => btn !== null);
    logoutListeners.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            // setLoginStatus je ≈æe asinhron in bo poklical removeSecureToken
            setLoginStatus(false); 
            if(mobilniMeni) mobilniMeni.classList.remove('active'); 
            window.location.href = 'index.html'; 
        });
    });

    // üî• POPRAVEK ZA GLAVNI MOBILNI MENI (PROFILNI DROPDOWN V GLAVI)
// Predpostavljamo, da je 'mobilniMeni' pravi ID za va≈° dropdown (prej profilniDropdown)
if(hamburgerGumb && mobilniMeni) {
    hamburgerGumb.addEventListener('click', (e) => {
        
        // Uporabimo e.preventDefault(), ƒçe gumb ni <button> ampak <a>
        if (e) e.preventDefault(); 
        
        // 1. Preklopi razred 'active' za prikaz/skrivanje menija
        mobilniMeni.classList.toggle('active');
        
        // üö® KODA ZA SPREMINJANJE IKONE JE ODSTRANJENA!
        // Ikona <i class="fas fa-user-circle"></i> bo ostala ves ƒças enaka.
        
        // 2. Opcijsko: Prepreƒçi scroll, ko je meni odprt
        document.body.classList.toggle('menu-open', mobilniMeni.classList.contains('active'));
    });
}

    // LOGIKA REZERVACIJSKEGA MODALA (API klic)

const currentLang = i18next.language; 
let modalPicker = null; // hranimo globalno referenco

// FUNKCIJA: ponovno ustvari Pikaday koledar
function createModalPicker() {
    if (modalPicker) {
        modalPicker.destroy();
    }

    modalPicker = new Pikaday({
        field: modalDatumInput,
        format: 'DD.MM.YYYY',
        minDate: new Date(),
        i18n: pikadayLangs[i18next.language] || pikadayLangs['sl'],
        onSelect: function(date) {
            const dateStr = moment(date).format('DD.MM.YYYY'); 
            modalDatumInput.value = dateStr; 
            modalDatumInput.setAttribute('data-reserv-datum', dateStr);

            globalSelectedTime = null;

            if (prosteUreRezultati) {
                prosteUreRezultati.innerHTML =
                    '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
            }

            if (typeof updateContent === 'function') {
                updateContent();
            }
        },
        bound: true
    });
}


// -- Glavna inicializacija --
if (modalDatumInput && typeof Pikaday !== "undefined" && typeof moment !== "undefined") {

    // ‚≠ê KRITIƒåNA ZA≈†ƒåITA ZA ANDROID/CAPACITOR
    modalDatumInput.addEventListener('focus', (e) => {
        e.preventDefault();
    });

    // Ustvari zaƒçetni koledar
    createModalPicker();
}


// -- POSLU≈†ALNIK: ob spremembi jezika ponovno nalo≈æi koledar --
i18next.on('languageChanged', () => {
    createModalPicker();
});


    if (gumbRezervirajModal) {
        gumbRezervirajModal.onclick = null; 
        gumbRezervirajModal.addEventListener('click', () => {
            
            const izbranDatum = modalDatumInput ? modalDatumInput.value : null; 
            const steviloOseb = modalOsebeInput ? modalOsebeInput.value : null;

            if (globalSelectedTime && globalSelectedMizaId) { // ƒåe je ƒças in miza ≈æe izbrana
                odpriDurationModal();
                return;
            }

            if (!currentRestaurantId) {
                const errorMsg = i18next.t('messages.no_restaurant_selected') || 'Restavracija ni izbrana.';
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p style="color: red;">${errorMsg}</p>`;
                return;
            }

            if (!izbranDatum) {
                const warningMsg = i18next.t('messages.select_reservation_date') || 'Prosimo, izberite datum.';
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p style="color: red;">${warningMsg}</p>`;
                return;
            }
            
            if(prosteUreRezultati) {
                prosteUreRezultati.innerHTML = '';
                prosteUreRezultati.innerHTML = `<p data-i18n="messages.loading_availability">Preverjam razpolo≈æljivost...</p>`;
            }
            
            const datumZaBackend = formatirajDatumZaBackend(izbranDatum); 

            const dataToSend = {
                restavracijaId: currentRestaurantId,
                datum: datumZaBackend, 
                stevilo_oseb: parseInt(steviloOseb),
            };
            
            if (!datumZaBackend) {
                 console.error("Neveljaven datum za backend:", izbranDatum);
                 if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p class="alert alert-danger">Napaka: Neveljaven datum format. Izberite ponovno.</p>`;
                 return;
            }

            fetch(`${API_BASE_URL}/restavracije/proste_ure`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            })
            .then(async response => {
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Klic neuspe≈°en - Status:', response.status, 'Odgovor stre≈ænika:', errorText);
                    throw new Error(i18next.t('messages.server_error_detailed', { status: response.status }) || `Napaka stre≈ænika: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                
                let ureHTML = '';
                
                if (data.mize && data.mize.length > 0) {
                    const prikazaneUre = new Set();
                    ureHTML += `<p style="margin-bottom: 10px;" data-i18n="messages.available_times_found">Na voljo proste ure za ${izbranDatum}:</p>`;
                    ureHTML += '<div class="gumbi-proste-ure">';
                    
                    data.mize.forEach(miza => {
                        if (miza.prosteUre) { 
                             miza.prosteUre.forEach(ura => {
                                const uraFloat = parseFloat(ura);
                                const ure = Math.floor(uraFloat);
                                const minute = Math.round((uraFloat - ure) * 60);
                                const uraFormat = `${ure.toString().padStart(2, "0")}:${minute.toString().padStart(2, "0")}`;
                                
                                const mizaIdValue = miza.mizaId || miza._id || null; 
                                
                                // Prika≈æemo vse edinstvene ure, ne glede na mizo.
                                if (!prikazaneUre.has(uraFormat) && mizaIdValue) {
                                    const mizaIme = miza.ime || 'Miza'; 
                                    
                                    // Gumbu dodamo ID mize, da vemo, katero mizo rezerviramo
                                    ureHTML += `<button type="button" class="gumb-ura" data-time="${uraFormat}" data-miza-id="${mizaIdValue}" data-miza-ime="${mizaIme}">${uraFormat}</button>`;
                                    
                                    prikazaneUre.add(uraFormat);
                                }
                            });
                        }
                    });

                    ureHTML += '</div>';
                    
                } else {
                    ureHTML = `<p class="alert alert-warning">${data.msg || i18next.t('messages.no_times_available') || 'Na ≈æalost ni prostih ur.'}</p>`;
                }
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = ureHTML;
                updateContent(); 
                setupTimeSlotListeners(); 

            })
            .catch(error => {
                
                console.error('Konƒçna napaka pri pridobivanju prostih ur:', error.message);
                
                const errorMsg = error.message.includes('messages.server_error') 
                    ? error.message 
                    : (i18next.t('messages.server_error') || 'Napaka stre≈ænika pri preverjanju ur.'); 
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p class="alert alert-danger">${errorMsg}</p>`;
            });
            
        });
    }
}); // Konec DOMContentLoaded


// =================================================================
// III. LOGIKA SOGLASJA ZA PI≈†KOTKE
// =================================================================

const CONSENT_COOKIE_NAME = 'user_consent_given';
const BANNER_ID = 'cookie-consent-banner';
const EXPIRATION_DAYS = 365; 

// ---------------------------------------------
// Pomo≈æne funkcije
// ---------------------------------------------
function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for(let i=0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function setCookie(value) {
    const date = new Date();
    date.setTime(date.getTime() + (EXPIRATION_DAYS * 24 * 60 * 60 * 1000));
    const expires = "; expires=" + date.toUTCString();
    document.cookie = CONSENT_COOKIE_NAME + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
}

// ---------------------------------------------
// Glavna funkcija za inicializacijo
// ---------------------------------------------
function initializeCookieConsent() {
    const banner = document.getElementById(BANNER_ID);
    if (!banner) return console.error("Cookie banner element not found.");

    // ‚≠ê KLJUƒåNA IZBOLJ≈†AVA: Pasica ostane skrita v Native APP
    if (window.Capacitor && window.Capacitor.isNativePlatform()) {
        return; 
    }

    // Nadaljnja koda se izvaja SAMO, ƒçe je to spletna stran (WEB)
    const existingConsent = getCookie(CONSENT_COOKIE_NAME);

    if (!existingConsent) {
        // Pasica se prika≈æe (odstrani se razred 'hidden')
        banner.classList.remove('hidden');
        
        const content = banner.querySelector('.banner-content'); 
        if (content) {
            content.classList.add('slide-in-up');
        }

        const acceptBtn = document.getElementById('accept-cookies');
        if(acceptBtn) acceptBtn.addEventListener('click', () => {
            setCookie('accepted');
            banner.classList.add('hidden');
            console.log("Soglasje sprejeto.");
        });

        const declineBtn = document.getElementById('decline-cookies');
        if(declineBtn) declineBtn.addEventListener('click', () => {
            setCookie('declined');
            banner.classList.add('hidden');
            console.log("Soglasje zavrnjeno.");
        });

    } else {
        banner.classList.add('hidden');
    }
}


// ‚≠ê IZVAJANJE: AGRESIVNA NATIVE LOGIKA + OBRATNA LOGIKA ZA WEB

document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById(BANNER_ID);
    if (!banner) return;
    
    // 1. AGRESIVNO SKRIVANJE ZA NATIVE:
    if (window.Capacitor && window.Capacitor.isNativePlatform()) {
        banner.remove(); 
        console.log("Native detected. Pasica prisilno odstranjena iz DOM-a.");
        return; 
    }
    
    // 2. PRIKAZ ZA WEB: ƒåe smo na spletu, roƒçno odstranimo prisilni inline stil.
    banner.style.display = ''; 
    
    // Za≈æenemo obstojeƒço logiko, ki preveri pi≈°kotke in jo prika≈æe/skrije po potrebi.
    initializeCookieConsent();

    console.log("Web detected. Inline stil odstranjen, nadaljujemo z logiko pi≈°kotkov.");
});



// =================================================================
// IV. LOGIKA KARTIC RESTAVRACIJ 
// =================================================================

// 1. Renderiranje Ene Kartice (ZA PRILJUBLJENO)
function renderCard(restavracija) {
    const card = document.createElement('div');
    card.className = 'kartica';
    card.setAttribute('data-id', restavracija._id || restavracija.id);
    
    const restavracijaIme = restavracija.ime || restavracija.name || restavracija.title || restavracija.imeRestavracije || 'Neznano Ime';
    
    // Implementacija dinamiƒçne slike
    const urlGlavneSlike = (restavracija.galerija_slik && restavracija.galerija_slik.length > 0)
        ? restavracija.galerija_slik[0] // Uporabi prvo sliko za sliƒçico
        : FALLBACK_IMAGE_URL; 
        
    // Interna ocena 
    const internaOcena = restavracija.ocena_povprecje || 0;
    const ratingDisplay = `${generateStarsHTML(internaOcena)} <span class="ocena-stevilka">${(internaOcena).toFixed(1)}</span>`;

    // Googlova ocena
    const googleRating = restavracija.googleRating || 0;
    const googleReviewCount = restavracija.googleReviewCount || 0;
    
    let googleRatingHTML = '';
    if (googleRating > 0) {
        const translatedReviewsText = i18next.t('messages.google_reviews') || 'Google mnenj';
        
        googleRatingHTML = `
            <p class="google-ocena">
                <i class="fab fa-google" style="color: #4285F4;"></i> 
                <span>${googleRating.toFixed(1)}/5 (${googleReviewCount} ${translatedReviewsText})</span>
            </p>
        `;
    }
    
    // LOGIKA ZA IZRAƒåUN RAZDALJE
    let oddaljenostKm = '';
    const restavracijaLat = restavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const restavracijaLon = restavracija.lokacija?.coordinates?.[0] || DEFAULT_LON;
    
    if (userLocation) {
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            restavracijaLat, 
            restavracijaLon
        );
        
        oddaljenostKm = Math.round(distance).toString(); 

    } else {
        oddaljenostKm = i18next.t('results.distance_unknown') || '...';
    }
    
    let oddaljenostHTML = `<span class="oddaljenost"><i class="fas fa-location-arrow"></i> ${oddaljenostKm} km</span>`;
    if (oddaljenostKm === '...') {
         oddaljenostHTML = `<span class="oddaljenost" data-i18n="results.distance_unknown" style="opacity: 0.7;"><i class="fas fa-location-arrow"></i> ${oddaljenostKm}</span>`;
    }
    
    const status = restavracija.razpolozljivost_status || (Math.random() > 0.8 ? 'tomorrow' : 'available');
    const cas = restavracija.razpolozljivost_cas || '19:00';
    let razpolozljivostTextKey;
    let isAvailable = true;
    
    if (status === 'available') {
        razpolozljivostTextKey = i18next.t('results.available_today', { time: cas });
    } else if (status === 'tomorrow') {
        razpolozljivostTextKey = i18next.t('results.available_tomorrow', { time: cas });
        isAvailable = false; 
    } else {
        razpolozljivostTextKey = i18next.t('results.unavailable');
        isAvailable = false;
    }

    const razpolozljivostHTML = `
        <div class="razpolozljivost-ovoj ${!isAvailable ? 'zasedeno' : ''}">
            <p data-i18n="${status === 'available' ? 'results.available_today' : status === 'tomorrow' ? 'results.available_tomorrow' : 'results.unavailable'}" data-i18n-options='{"time": "${cas}"}'>${razpolozljivostTextKey}</p>
        </div>
    `;
    
    // Kartica HTML
    card.innerHTML = `
        <img src="${urlGlavneSlike}" alt="${restavracijaIme}" class="kartica-slika" onerror="this.onerror=null;this.src='${FALLBACK_IMAGE_URL}';">
        <div class="kartica-vsebina">
            <h3>${restavracijaIme}</h3>
            
            <div class="info-ocena-oddaljenost">
                <p class="ocena">${ratingDisplay}</p>
                
                ${googleRatingHTML} 
                
                ${oddaljenostHTML}
            </div>
            
            ${razpolozljivostHTML} 
        </div>
    `;
    
    card.addEventListener('click', (e) => {
        if (e.target.classList.contains('gumb-rezervacija')) {
             return;
        }
        prikaziPodrobnosti(restavracija);
    });
    
    return card;
}

// 2. Renderiranje Ene Kartice (ZA IZPOSTAVLJENO)
function renderFeaturedCard(restavracija) {
    const card = document.createElement('div');
    card.className = 'kartica kartica-izpostavljeno';
    card.setAttribute('data-id', restavracija._id || restavracija.id);
    
    // Predpostavimo, da je prikaziPodrobnosti funkcija za obravnavo klika
    card.addEventListener('click', () => prikaziPodrobnosti(restavracija)); 

    const restavracijaIme = restavracija.imeRestavracije || 'Neznano Ime';
    const slikaUrl = restavracija.urlSlike || restavracija.mainImageUrl || FALLBACK_IMAGE_URL; 
    
    // ‚≠ê NOVO: Pridobitev besedila popusta (polje 'popust' je vkluƒçeno v Controller Aggregate)
    const besediloPopusta = restavracija.popust || '-10%'; 

    card.innerHTML = `
        <div class="slika-kartice" style="background-image: url('${slikaUrl}')">
            
            <span class="oznaka-ponudbe">${besediloPopusta}</span>
            
        </div>
        <div class="vsebina-kartice-izpostavljeno">
            <h3>${restavracijaIme}</h3>
        </div>
    `;
    return card;
}

// 3. Filtriranje in Prikaz (KONƒåNA RE≈†ITEV Z Radijem 20 km)
function filterAndRenderRestavracije(optionalFilteredList) {
    if (!mrezaKarticDiv || !statusKarticeDiv) return;

    // Uporabljamo celoten seznam restavracij nalo≈æenih ob zagonu
    const listToRender = optionalFilteredList || allRestavracije;
    
    const filtered = listToRender.filter(r => {
        
        // =================================================================
        // ‚≠ê 1. NOVO: Logika 'Priljubljeno v bli≈æini' (Radij 20 km)
        // =================================================================
        if (currentFilterKuhinja === '') {
            
            // A. Preverjanje, ali imamo lokacijo uporabnika IN restavracije
            if (userLocation && r.lokacija?.coordinates) {
                
                // Koordinate restavracije (lon je 0, lat je 1)
                const restaurantLon = r.lokacija.coordinates[0];
                const restaurantLat = r.lokacija.coordinates[1];
                
                // Izraƒçunaj razdaljo (uporablja globalno funkcijo getDistance)
                const distance = getDistance(
                    userLocation.lat, 
                    userLocation.lon, 
                    restaurantLat, 
                    restaurantLon
                );
                
                // Vrni TRUE samo, ƒçe je razdalja znotraj 20 km
                return distance <= MAX_DISTANCE_KM; // Uporablja MAX_DISTANCE_KM = 20

            }
            
            // B. ƒåe nimamo lokacije uporabnika, restavracije v tem pogledu ne prika≈æemo.
            return false; 
        } 
        
        // =================================================================
        // 2. Filtriranje po tipu kuhinje (ƒçe je filter izbran)
        // =================================================================
        
        const filtriIzBaze = r.kuhinja_filtri; 

        // Preverimo, ali je polje Array in ali vsebuje aktivni filter
        if (Array.isArray(filtriIzBaze)) {
            // .includes() preveri ujemanje
            return filtriIzBaze.includes(currentFilterKuhinja);
        }
        
        // ƒåe polje manjka ali ni Array (dokument ni bil posodobljen), ga izloƒçi
        return false; 
    });

    // Prikaz in renderiranje rezultatov
    mrezaKarticDiv.innerHTML = '';
    statusKarticeDiv.textContent = '';
    
    // ƒåe ni najdenih rezultatov
    if (filtered.length === 0) {
        statusKarticeDiv.textContent = i18next.t('messages.no_restaurants_found') || 'Ni najdenih restavracij.';
        console.log("Filtriranje uspe≈°no, najdenih 0 restavracij za filter:", currentFilterKuhinja);
        return;
    }

    filtered.forEach(restavracija => {
        mrezaKarticDiv.appendChild(renderCard(restavracija));
    });
    
    // Potrdimo ≈°tevilo najdenih restavracij
    console.log(`Filtriranje uspe≈°no: Prikazujem ${filtered.length} restavracij za filter: ${currentFilterKuhinja}`);
    
    updateContent(); 
}

// 4. Prikaz Izpostavljenih Restavracij (POPRAVLJENO, uporablja featured: true)
function renderFeaturedRestavracije() {
    if (!mrezaIzpostavljenoKarticDiv) return;
    
    // üî• NOVO: Filtrirajte neposredno iz allRestavracije
    // Uporaba "!!" zagotavlja, da zajamemo 'true' ne glede na tip podatka, ki pride iz API-ja.
    const featuredList = allRestavracije.filter(r => !!r.featured || !!r.izpostavljeno);
    
    mrezaIzpostavljenoKarticDiv.innerHTML = '';
    
    // Uporabi novo, filtrirano featuredList
    if (featuredList.length === 0) {
        mrezaIzpostavljenoKarticDiv.innerHTML = '<div style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">' + (i18next.t('messages.no_restaurants_found') || 'Ni izpostavljenih restavracij.') + '</div>'; 
        return;
    }
    
    // Iteriraj ƒçez novo, filtrirano featuredList
    featuredList.forEach(restavracija => {
        mrezaIzpostavljenoKarticDiv.appendChild(renderFeaturedCard(restavracija));
    });
    
    // ƒåe je updateContent definirana
    if (typeof updateContent === 'function') updateContent();
}

// 5. Nastavitev Gumbov za Hitro Iskanje Listenerji (POPRAVLJENO ZA KLIC API)
function setupKuhinjaFiltersListeners() {
    
    // Uporabimo robusten selektor za vse gumbe, ki imajo data-kuhinja atribut
    const vsiGumbi = document.querySelectorAll('[data-kuhinja]');
    
    // LOGIRANJE ZDAJ MORA DELOVATI (ƒçe se funkcija izvede)
    console.log("üî• ≈†tevilo gumbov za kuhinjo najdenih za pripenjanje listenerjev:", vsiGumbi.length); 

    vsiGumbi.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            // DIAGNOSTIKA: Preverjanje, ali koda sploh pride sem.
            console.log("‚úÖ KLIK GUMBA: Filter:", btn.getAttribute('data-kuhinja')); 
            
            // Odstrani 'active' razred z vseh gumbov
            document.querySelectorAll('[data-kuhinja]').forEach(b => b.classList.remove('active'));
            
            const novaKuhinja = btn.getAttribute('data-kuhinja');
            let filterAktiven = false; // Status iskanja

            // Logika za vklop/izklop filtra (Toggle)
            if (currentFilterKuhinja === novaKuhinja) {
                // ƒåe je filter ≈æe enak, ga izklopimo
                currentFilterKuhinja = ''; 
                filterAktiven = false;
            } else {
                // ƒåe je nov filter, ga vklopimo
                btn.classList.add('active'); 
                currentFilterKuhinja = novaKuhinja;
                filterAktiven = true;
            }
            
            // ‚≠ê KLJUƒåNA SPREMEMBA: Kliƒçemo API za iskanje
            if (filterAktiven) {
                // ƒåe je filter vklopljen, i≈°ƒçemo preko API-ja. 
                // Posredujemo samo kuhinjo, ostali iskalni parametri so prazni/privzeti.
                // Uporabimo e za reference v handleIskanjeRestavracij.
                handleIskanjeRestavracij(e, '', '', '', 1, currentFilterKuhinja); 
            } else {
                // ƒåe je filter izklopljen, ponovno nalo≈æimo privzete restavracije (poln seznam)
                loadRestavracije();
            }
        });
    });
}

// 5.1 LISTENER ZA GLAVNI ISKALNIK (OSTANE NESPREMENJEN)
if (iskalnik) iskalnik.addEventListener('submit', (e) => {
    e.preventDefault();

    // Pridobivanje vrednosti iz forme 
    const mesto = document.getElementById('restavracija_mesto').value || '';
    const datum = document.getElementById('datum').value || '';
    const cas = document.getElementById('cas').value || '';
    const stevilo_oseb = document.getElementById('stevilo_oseb').value || '1'; 
    
    // KLIC PRAVE FUNKCIJE ZA API ISKANJE
    handleIskanjeRestavracij(e, mesto, datum, cas, stevilo_oseb); 
});


// 6. GLAVNA LOGIKA ISKANJA (KLIC API /isci)
async function handleIskanjeRestavracij(e, mesto, datum, cas, stevilo_oseb, kuhinjaKljuc = '') {
    
    const rezultatiContainer = document.getElementById('rezultatiIskanja');
    const searchSection = document.getElementById('rezultatiIskanjaSekcija');
    const defaultSection = document.getElementById('privzeteRestavracijeSekcija');

    // üëá LOGIKA PREKLAPLJANJA SEKCIJ
    if (defaultSection) defaultSection.classList.add('hidden');    // Skrijemo privzeto
    
    // ‚≠ê KLJUƒåNA SPREMEMBA: Sekcijo rezultatov skrijemo, dokler niso potrjeni rezultati.
    if (searchSection) searchSection.classList.add('hidden'); 
    
    if (rezultatiContainer) {
        // Prikaz sporoƒçila, da potrdimo, da se klic izvaja
        rezultatiContainer.innerHTML = `<div class="p-4 text-center text-blue-500">${i18next.t('messages.searching', { criteria: mesto || kuhinjaKljuc || '...' })}</div>`;
    }

    const datumZaBackend = formatirajDatumZaBackend(datum); 

    const searchParams = {
        mesto: mesto, 
        datum: datumZaBackend, // Formatiran datum za backend
        cas: cas,
        stevilo_oseb: parseInt(stevilo_oseb),
        kuhinja: kuhinjaKljuc 
    };
    
    const url = `${API_BASE_URL}/restavracije/isci`;

    try {
        const response = await fetch(url, {
            method: 'POST', 
            headers: getAuthHeaders(),
            body: JSON.stringify(searchParams)
        });

        const data = await response.json();

        // =======================================================
        // ‚≠ê POPRAVEK LOGIKE FRONT-ENDA ‚≠ê
        // =======================================================
        if (response.ok) {
            // Preverimo, ali je 'data' array in ima veƒç kot 0 elementov
            if (Array.isArray(data) && data.length > 0) {
                prikaziRezultate(data); // Po≈°ljemo celoten 'data' array funkciji prikaziRezultate
                
                // ‚≠ê KLJUƒåNO: Poka≈æemo celotno sekcijo z rezultati ≈°ele TUKAJ!
                if (searchSection) searchSection.classList.remove('hidden'); 
                
            } else {
                rezultatiContainer.innerHTML = `<div class="p-4 text-center text-gray-600">${i18next.t('messages.no_restaurants_found_criteria') || '≈Ωal nismo na≈°li restavracij, ki bi ustrezale va≈°im kriterijem.'}</div>`;
            }
        } else {
            console.error("API iskanje neuspe≈°no:", data);
            rezultatiContainer.innerHTML = `<div class="p-4 text-center text-red-600">${data.msg || i18next.t('messages.server_error_search') || 'Napaka stre≈ænika pri iskanju.'}</div>`;
        }

    } catch (error) {
        console.error("Napaka pri klicu iskanja restavracij:", error);
        rezultatiContainer.innerHTML = `<div class="p-4 text-center text-red-600">${i18next.t('messages.server_connection_error') || 'Napaka pri komunikaciji s stre≈ænikom.'}</div>`;
    }
}

// 6.1 POMO≈ΩNA FUNKCIJA ZA PRIKAZ REZULTATOV ISKANJA (OSTANE NESPREMENJENA)
function prikaziRezultate(restavracije) {
    const container = document.getElementById('rezultatiIskanja');
    if (!container) return; 

    container.innerHTML = '';
    
    restavracije.forEach(restavracija => {
        container.appendChild(renderCard(restavracija)); // Uporabite va≈°o funkcijo renderCard!
    });
    
    updateContent(); 
}


// 7. Glavna funkcija za nalaganje (POPRAVLJENO, SINHRONIZIRANO)
async function loadRestavracije() {
    if (!mrezaKarticDiv) return; 

    const API_CALL_URL = `${API_BASE_URL}/restavracije/privzeto`; 
    
    if(statusKarticeDiv) statusKarticeDiv.textContent = i18next.t('messages.searching', { criteria: '...' }) || 'I≈°ƒçem restavracije...'; 
    
    try {
        // ‚≠ê KORAK A: POƒåAKAJ NA NALOGANJE PRILJUBLJENIH
        // To zagotavlja, da je globalFavoritesList poln PREDEN se ri≈°ejo kartice.
        if (typeof naloziPriljubljeneRestavracije === 'function') {
             await naloziPriljubljeneRestavracije();
        }
        // **********************************************
        
        const response = await fetch(API_CALL_URL);
        
        if (!response.ok) {
            throw new Error(`Stre≈ænik je vrnil status ${response.status}`);
        }
        
        const data = await response.json();
        
        allRestavracije = data; 
        
        // Kartice se zaƒçnejo risati ≈†ELE ZDAJ, ko je globalFavoritesList ≈æe pripravljen.
        setupKuhinjaFiltersListeners();
        filterAndRenderRestavracije();
        renderFeaturedRestavracije(); 
        
        if(statusKarticeDiv) statusKarticeDiv.textContent = ''; 

    } catch (error) {
        console.error("Napaka pri nalaganju restavracij iz API-ja:", error);
        
        if(statusKarticeDiv) {
            statusKarticeDiv.textContent = i18next.t('messages.search_error') || 'Napaka pri nalaganju restavracij.'; 
            statusKarticeDiv.style.display = 'block';
        }
    }
}

// 8. LOGIKA PRIKAZA OCEN (PREJ MANJKAJOƒåA FUNKCIJA)
function renderReviews(reviews) {
    if (!tabOcene) return; 

    tabOcene.innerHTML = ''; // Poƒçisti prej≈°nje ocene
    
    if (!reviews || reviews.length === 0) {
        tabOcene.innerHTML = `<p class="p-4 text-center text-gray-500" data-i18n="modal.no_reviews">${i18next.t('modal.no_reviews') || 'Ta restavracija ≈°e nima ocen.'}</p>`;
        updateContent();
        return;
    }
    
    reviews.forEach(review => {
        const reviewElement = document.createElement('div');
        reviewElement.className = 'review-card border-b pb-4 mb-4'; 
        
        const ratingHtml = generateStarsHTML(review.ocena);
        const ime = review.uporabniskoIme || i18next.t('modal.anonymous_user') || 'Neznan Uporabnik';
        
        reviewElement.innerHTML = `
            <div class="flex items-center justify-between mb-2">
                <strong class="text-lg">${ime}</strong>
                <span class="text-sm text-gray-500">${new Date(review.datum).toLocaleDateString()}</span>
            </div>
            <div class="flex items-center mb-2">
                <span class="star-rating mr-2">${ratingHtml}</span>
                <span class="text-sm font-semibold text-gray-700">(${review.ocena.toFixed(1)})</span>
            </div>
            <p class="review-text text-gray-800">${review.komentar || ''}</p>
        `;
        
        tabOcene.appendChild(reviewElement);
    });
    
    updateContent(); // Posodobi morebitno i18n v notranjosti
}


// V. POPRAVKI IN DODATNA LOGIKA ZA NOGO (FOOTER)

document.addEventListener('DOMContentLoaded', () => { 
    
    // LOGIKA 1: Razkritje celotne vsebine noge (ƒçe imate gumb za celotno nogo)
    const footerToggleBtn = document.querySelector('.footer-toggle-btn');
    const nogaVsebinaSkrita = document.querySelector('.noga-vsebina-skrita');
    
    if (footerToggleBtn && nogaVsebinaSkrita) {
        footerToggleBtn.addEventListener('click', () => {
            nogaVsebinaSkrita.classList.toggle('active');
            
            const ikona = footerToggleBtn.querySelector('i') || footerToggleBtn.querySelector('svg');
            // Logika za menjavo ikone
            if (ikona) { /* ... */ }
        });
    }

    // LOGIKA 2: Akordion za posamezne sekcije v nogi (za naslove in linke)
    document.querySelectorAll('.noga-sekcija .noga-naslov').forEach(naslov => {
        naslov.addEventListener('click', (e) => {
            e.preventDefault(); 
            
            const linki = naslov.nextElementSibling; 

            if (linki && linki.classList.contains('noga-linki')) {
                linki.classList.toggle('active');
                naslov.classList.toggle('active');

                // Zapri druge sekcije
                document.querySelectorAll('.noga-sekcija .noga-linki').forEach(otherLinki => {
                    if (otherLinki !== linki && otherLinki.classList.contains('active')) {
                        otherLinki.classList.remove('active');
                        const otherNaslov = otherLinki.previousElementSibling;
                        if (otherNaslov) otherNaslov.classList.remove('active');
                    }
                });
            }
        });
    });
}); 


// ‚≠ê NOVO: POMO≈ΩNA FUNKCIJA ZA PRIDOBIVANJE POLNIH PODROBNOSTI RESTAVRACIJE ‚≠ê

async function getFullRestaurantDetails(id) {
    if (!id) return null;

    const endpoint = `${API_BASE_URL}/restavracije/${id}`; 
    
    try {
        const response = await fetch(endpoint);
        if (!response.ok) {
            throw new Error(`Napaka pri pridobivanju podrobnosti: ${response.statusText}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error("Napaka pri API klicu za podrobnosti restavracije:", error);
        return null;
    }
}


// VI. LOGIKA MODALA RESTAVRACIJE (DOPOLNJENA Z OCENAMI)

async function prikaziPodrobnosti(restavracija) {
    
    currentRestaurantId = restavracija._id || restavracija.id; 
    const reservIdInput = document.querySelector('[data-reserv-id]');
    if (reservIdInput) reservIdInput.value = currentRestaurantId; 

    // 1. PREVERJANJE IN PRIDOBIVANJE POPOLNIH PODATKOV
    let popolnaRestavracija = restavracija;
    // ‚≠ê POPRAVLJENO: Uporaba 'komentarji' namesto 'ocene' za preverjanje manjkajoƒçih podrobnosti
    const isMissingDetails = !restavracija.meni || !restavracija.galerija_slik || !restavracija.komentarji; 

    if (currentRestaurantId && isMissingDetails) {
        if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Nalaganje podrobnosti...'; 

        const fullData = await getFullRestaurantDetails(currentRestaurantId);
        
        if (fullData) {
            popolnaRestavracija = fullData; 
        } else {
            if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Neznano Ime';
            prikaziSporocilo('Napaka pri nalaganju celotnih podrobnosti restavracije.', 'error');
        }
    }

    
    const restavracijaIme = popolnaRestavracija.ime || popolnaRestavracija.imeRestavracije || 'Neznano Ime'; 
    const kuhinja = popolnaRestavracija.deviznaKuhinja || 'Neznano';
    
    const prvaSlikaIzGalerije = popolnaRestavracija.galerija_slik && popolnaRestavracija.galerija_slik.length > 0
        ? popolnaRestavracija.galerija_slik[0]
        : null;

    const slikaUrl = popolnaRestavracija.mainImageUrl || popolnaRestavracija.urlSlike || prvaSlikaIzGalerije || FALLBACK_IMAGE_URL;
    
    const opis = popolnaRestavracija.opis || popolnaRestavracija.glavniOpis || ''; 
    
    const lon = popolnaRestavracija.lokacija?.coordinates?.[0] || DEFAULT_LON; 
    const lat = popolnaRestavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const gpsString = `${lat.toFixed(4)},${lon.toFixed(4)}`; 

    // üî•üî•üî• KLJUƒåNO: SHRANJEVANJE KOORDINAT GLOBALNO ZA NAVIGACIJO üî•üî•üî•
    globalRestaurantLat = lat;
    globalRestaurantLon = lon;
    // üî•üî•üî• KONEC SHRANJEVANJA üî•üî•üî•

    // IZRAƒåUN RAZDALJE ZA MODALNO OKNO
    let prikazLokacije = '';

    if (userLocation) {
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            lat, 
            lon
        );
        
        const oddaljenostKm = Math.round(distance); 
        prikazLokacije = `<i class="fas fa-location-arrow"></i> ${oddaljenostKm} km`;
        
    } else {
        prikazLokacije = `<i class="fas fa-map-marker-alt"></i> ${gpsString}`;
    }
    
    // Polnjenje Glavnih podrobnosti
    if(modalSlika) modalSlika.style.backgroundImage = `url(${slikaUrl})`;
    if(modalIme) modalIme.textContent = restavracijaIme;
    if(modalKuhinja) modalKuhinja.innerHTML = `<i class="fas fa-utensils"></i> ${kuhinja}`;

    if(modalLokacija) modalLokacija.innerHTML = prikazLokacije; 

    if(modalOcena) modalOcena.innerHTML = `<i class="fas fa-star"></i> ${(popolnaRestavracija.ocena_povprecje || 0).toFixed(1)}`;
    if (modalOpis) {
    modalOpis.innerHTML = opis; 
}

    // Generiranje Menija (Uporaba POPOLNA_RESTAVRACIJA)
    if(modalMeni) {
        modalMeni.innerHTML = '';
        const menuObj = popolnaRestavracija.meni || {}; 
        
        let hasMenu = false;
        
        for (const kategorija in menuObj) {
            const items = menuObj[kategorija]; 
            
            if (kategorija === 'tedenska_ponudba') {
                continue; 
            }
            
            if (Array.isArray(items) && items.length > 0) {
                hasMenu = true;
                if (kategorija !== 'osnovni_meni') {
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = kategorija;
                    modalMeni.appendChild(categoryHeader);
                }

                const ul = document.createElement('ul');
                items.forEach(item => {
                    const li = document.createElement('li');
                    
                    let desnaVrednost = '';
                    if (item.cena !== undefined && item.cena !== null) {
                        desnaVrednost = `${item.cena} ‚Ç¨`; 
                    } else if (item.opis) {
                        desnaVrednost = item.opis; 
                    } else {
                        desnaVrednost = ''; 
                    }

                    li.innerHTML = `
                        <div style="display: flex; justify-content: space-between; width: 100%;">
                            <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                            <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                        </div>
                    `;
                    ul.appendChild(li);
                });
                modalMeni.appendChild(ul);
            }
        }
        
        if (!hasMenu) {
            modalMeni.innerHTML = '<li class="text-gray-500"><span data-i18n="modal.no_menu">Meni ≈°e ni na voljo.</span></li>';
        }
    }
    
    // Polnjenje zavihka Aktualna Ponudba 
    const ponudbaItems = popolnaRestavracija.meni?.tedenska_ponudba || [];
    const modalAktualnaPonudbaDiv = document.getElementById('tabAktualnaPonudba'); 
    
    if (modalAktualnaPonudbaDiv) {
        if (ponudbaItems.length > 0) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '0';
            ponudbaItems.forEach(item => {
                let desnaVrednost = '';
                if (item.cena !== undefined && item.cena !== null) {
                    desnaVrednost = `${item.cena} ‚Ç¨`;
                } else if (item.opis) {
                    desnaVrednost = item.opis;
                } else {
                    desnaVrednost = '';
                }

                const li = document.createElement('li');
                li.style.listStyle = 'none';
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                        <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                    </div>
                `;
                ul.appendChild(li);
            });
            modalAktualnaPonudbaDiv.innerHTML = '';
            modalAktualnaPonudbaDiv.appendChild(ul);
        } else {
            modalAktualnaPonudbaDiv.innerHTML = '<p class="text-gray-500"><span data-i18n="modal.no_special_offer">Aktualna ponudba trenutno ni na voljo.</span></p>';
        }
    }
    
  // Generiranje Galerije 
    if(galerijaSlikeDiv) {
        const galerijaSlikaURLS = popolnaRestavracija.galerija_slik || []; 
        
        let galerijaHTML = ''; 

        if (galerijaSlikaURLS.length > 0) {
            
            galerijaSlikaURLS.forEach(url => {
                galerijaHTML += `
                    <div class="relative rounded-lg overflow-hidden shadow-md">
                        <img 
                            src="${url}" 
                            alt="Slika restavracije" 
                            class="absolute top-0 left-0 w-full h-full object-cover cursor-pointer hover:opacity-90 transition duration-300"
                            onclick="openFullSizeImage('${url}')"
                        >
                    </div>
                `;
            });

            galerijaSlikeDiv.innerHTML = galerijaHTML; 

        } else {
            galerijaSlikeDiv.innerHTML = '<p class="text-gray-500 p-4">Ni slik za prikaz.</p>';
        }
    }

// Generiranje Zemljevida (OPOMBA: URL popravljen, vendar morate preveriti format, ki ga zahteva va≈° stre≈ænik)
    if (modalZemljevid) {
       modalZemljevid.src = `https://maps.google.com/maps?q=${lat},${lon}&z=15&output=embed`;
    }
    
    // ‚≠ê KLJUƒåNO: Klic funkcije za prikaz vseh ocen
    // ‚≠ê POPRAVLJENO: Uporaba kljuƒça 'komentarji', ki ga vrne API.
    renderReviews(popolnaRestavracija.komentarji); 
    

    // Resetiraj prikaz prostih ur
    if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
        '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
        
    globalSelectedTime = null; 
    globalSelectedMizaId = null; 
    
    // Resetiraj na prvi zavihek (Opis je bolj logiƒçen)
    const defaultTab = document.querySelector('.modal-tab[data-tab="opis"]');
    if(defaultTab) defaultTab.click();

    // Odpri modal
    if(restavracijaModal) restavracijaModal.classList.add('active');
    updateContent(); 
}

// Zapiranje modala (Ostane enako)
if(zapriRestavracijaModal) zapriRestavracijaModal.addEventListener('click', () => {
    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(modalZemljevid) modalZemljevid.src = 'about:blank';
    currentRestaurantId = null; 
    globalSelectedMizaId = null; 
});

if(restavracijaModal) window.addEventListener('click', (e) => {
    if (e.target === restavracijaModal) {
        restavracijaModal.classList.remove('active');
        if(modalZemljevid) modalZemljevid.src = 'about:blank';
        currentRestaurantId = null; 
        globalSelectedMizaId = null; 
    }
});

// LOGIKA ZAVIHKOV (Ostane enako)
modalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');
        modalTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        const targetElementId = `tab${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`;
        const targetElement = document.getElementById(targetElementId);
        if (targetElement) targetElement.classList.add('active');
    });
});


// =================================================================
// VII. LOGIKA REZERVACIJE IN TRAJANJA
// =================================================================

/**
 * Kritiƒçna funkcija za izvedbo API klica rezervacije.
 */
window.handleIzvedbaRezervacije = async (podatki) => {

    if (!localStorage.getItem('zeton')) {
        prikaziSporocilo(i18next.t('messages.login_required') || 'Za rezervacijo morate biti prijavljeni.', 'error');
        if(modal) modal.classList.add("active");
        return;
    }
    
    const url = `${API_BASE_URL}/restavracije/ustvari_rezervacijo`;

    try {
        prikaziSporocilo(i18next.t('messages.reserving', { cas: podatki.casStart, stevilo: podatki.stevilo_oseb }), 'info');

        const payload = {
            restavracijaId: podatki.restavracijaId,
            mizaId: podatki.mizaId,
            imeGosta: podatki.imeGosta,
            telefon: podatki.telefon,
            stevilo_oseb: parseInt(podatki.stevilo_oseb),
            datum: formatirajDatumZaBackend(podatki.datumPrikaz), 
            casStart: podatki.casStart, 
            trajanjeUr: podatki.trajanjeUr 
        };
        
        const response = await fetch(url, {
            method: 'POST',
            headers: getAuthHeaders(),
            body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (response.ok) {
            
            const uspehMsg = i18next.t('messages.reservation_success_minimal', { 
                cas: podatki.casStart
            }) || `Rezervacija uspe≈°na ob ${podatki.casStart}!`;
            
            prikaziSporocilo(uspehMsg, 'success');
            
            if(durationModal) durationModal.classList.remove('active');
            if(restavracijaModal) restavracijaModal.classList.remove('active');
            // Ponovno nalaganje restavracij, da se posodobi status razpolo≈æljivosti
            loadRestavracije();
        } else {
            prikaziSporocilo(data.msg || i18next.t('messages.reservation_failed') || 'Rezervacija ni uspela.', 'error');
        }

    } catch (error) {
        console.error('Napaka pri API klicu za rezervacijo:', error);
        prikaziSporocilo(i18next.t('messages.server_connection_error_retry') || 'Napaka stre≈ænika pri rezervaciji.', 'error');
    }
}


// Odpre modal za izbiro trajanja
window.odpriDurationModal = () => {
    if (!currentRestaurantId || !globalSelectedTime || !globalSelectedMizaId) { 
        console.error("Napaka: Ni izbrane restavracije, ƒçasa ali mize za rezervacijo.");
        prikaziSporocilo(i18next.t('messages.select_time_and_table_required') || "Napaka: Prosimo, izberite ƒças rezervacije in mizo.", 'error');
        if(restavracijaModal) restavracijaModal.classList.add('active'); 
        return;
    }

    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(durationModal) durationModal.classList.add('active');
}

// Zapre modal za izbiro trajanja
const zapriDurationModalHandler = () => {
    if(durationModal) durationModal.classList.remove('active');
    if(restavracijaModal) restavracijaModal.classList.add('active'); 
};
if(zapriDurationModal) zapriDurationModal.addEventListener('click', zapriDurationModalHandler);
if(durationModal) window.addEventListener("click", (e) => {
  if (e.target === durationModal) zapriDurationModalHandler();
});


// Vizualno oznaƒçevanje izbrane opcije in izbira radio gumba (Ostane enako)
if(durationOpcije) durationOpcije.querySelectorAll('.duration-opcija').forEach(opcijaDiv => {
    opcijaDiv.addEventListener('click', () => {
        durationOpcije.querySelectorAll('.duration-opcija').forEach(d => d.classList.remove('selected'));
        opcijaDiv.classList.add('selected');
        const radio = opcijaDiv.querySelector('input[type="radio"]');
        if (radio) radio.checked = true;
    });
});

// Handler za klik na gumb za uro
const timeButtonClickHandler = (e) => {
    const timeButtons = document.querySelectorAll('#prosteUreRezultati .gumb-ura');
    timeButtons.forEach(btn => btn.classList.remove('selected'));
    
    globalSelectedTime = e.target.getAttribute('data-time');
    globalSelectedMizaId = e.target.getAttribute('data-miza-id'); 
    globalSelectedMizaIme = e.target.getAttribute('data-miza-ime'); 
    
    e.target.classList.add('selected');
    odpriDurationModal(); 
};


// Listenerji za izbrano uro
function setupTimeSlotListeners() {
    const timeButtons = document.querySelectorAll('#prosteUreRezultati .gumb-ura');
    timeButtons.forEach(button => {
        button.removeEventListener('click', timeButtonClickHandler); 
        button.addEventListener('click', timeButtonClickHandler); 
    });
}

// Funkcija za potrditev rezervacije
const potrdiRezervacijo = () => {
    
    const modalDatumInput = document.getElementById('modalDatum'); 
    const modalOsebeInput = document.getElementById('modalOsebe'); 

    if (!currentRestaurantId) {
        alert(i18next.t('messages.no_restaurant_selected') || "Napaka: Restavracija ni izbrana!");
        return;
    }
    
    const datumPrikaz = modalDatumInput ? modalDatumInput.value : null; 
    const steviloOseb = modalOsebeInput ? modalOsebeInput.value : null; 
    const casStart = globalSelectedTime; 
    const mizaId = globalSelectedMizaId;
    const mizaIme = globalSelectedMizaIme;
    
    const izbranoTrajanjeElement = durationModal ? durationModal.querySelector('input[name="duration"]:checked') : null;
    // Privzeta vrednost 1.5, ƒçe ni izbire
    const trajanje = izbranoTrajanjeElement ? parseFloat(izbranoTrajanjeElement.value) : 1.5; 
    
    const imeGosta = localStorage.getItem('ime') || 'Testni Rezervant';
    const telefon = localStorage.getItem('telefon') || '040123456'; 
    
    if (!datumPrikaz || !casStart || !steviloOseb || !mizaId) { 
        
        prikaziSporocilo(i18next.t('messages.required_fields_missing_time_miza') || 'Izpolnite vsa polja in **IZBERITE URO/MIZO** na prej≈°njem koraku.', 'error');
        
        if(durationModal) durationModal.classList.remove('active');
        if(restavracijaModal) restavracijaModal.classList.add('active'); 
        return;
    }
    
    if(durationModal) durationModal.classList.remove('active');
    
    const rezervacijaPodatki = {
        restavracijaId: currentRestaurantId,
        datumPrikaz: datumPrikaz, 
        stevilo_oseb: steviloOseb, 
        casStart: casStart, 
        trajanjeUr: trajanje,
        mizaId: mizaId, 
        mizaIme: mizaIme,
        imeGosta: imeGosta,
        telefon: telefon,
    };

    handleIzvedbaRezervacije(rezervacijaPodatki);
}

// =================================================================
// VIII. LOGIKA OPOZORILNEGA OKNA
// =================================================================

function prikaziOpozoriloObZagonu() {
    // Prikaz opozorila samo, ƒçe ≈°e ni bilo potrjeno
    if (warningModal && !localStorage.getItem('warningDismissed')) {
        if (gumbRazumem) {
            warningModal.classList.add('active');
        }
    }
}

if(gumbRazumem) gumbRazumem.addEventListener('click', () => {
    if(warningModal) warningModal.classList.remove('active');
    localStorage.setItem('warningDismissed', 'true');
});


// Listener za gumb Potrdi Trajanje / Rezerviraj Mizo
if (potrdiTrajanjeGumb) {
    potrdiTrajanjeGumb.addEventListener('click', (e) => {
        e.preventDefault(); 
        potrdiRezervacijo();
    });
}

// =================================================================
// üî• FUNKCIJA ZA FOKUSIRANJE KARTICE IZ ZEMLJEVIDA
// OPOMBA: Ta funkcija je sedaj verjetno odveƒçna, ƒçe se namesto nje kliƒçe handleOdpriModalPodrobnosti,
// vendar jo pu≈°ƒçamo, ƒçe jo ≈°e kliƒçete kje drugje.
// =================================================================
function fokusirajKartico(restavracijaId) {
    if (!restavracijaId) {
        console.error("Napaka: Manjka ID restavracije za fokusiranje kartice.");
        return;
    }

    // 1. Poi≈°ƒçemo kontejner kartic
    const mrezaKarticDiv = document.getElementById('mrezaKarticDiv') || document.querySelector('.mreza-restavracij'); 

    if (!mrezaKarticDiv) {
        console.error("Fokus: Manjka kontejner kartic (ID: mrezaKarticDiv).");
        return;
    }
    
    // 2. Poi≈°ƒçemo ustrezno kartico po data-id
    const ciljnaKartica = mrezaKarticDiv.querySelector(`[data-id="${restavracijaId}"]`);
    
    if (ciljnaKartica) {
        
        // --- Vizualni poudarek (za nekaj sekund) ---
        ciljnaKartica.classList.add('fokus-animacija');
        
        // Odstranimo animacijo po 3 sekundah
        setTimeout(() => {
            ciljnaKartica.classList.remove('fokus-animacija');
        }, 3000); 

        // --- Pomik na kartico ---
        ciljnaKartica.scrollIntoView({
            behavior: 'smooth', 
            block: 'nearest',   
            inline: 'start'     
        });
        
        console.log(`Fokusirana kartica za ID: ${restavracijaId}`);
        
    } else {
        console.warn(`Kartica z ID: ${restavracijaId} ni najdena za fokusiranje.`);
    }
}


// =================================================================
// üî• NOVA FUNKCIJA: Po≈°iljanje rezervacije v bazo (Mini Rezervacija)
// Tukaj integrirajte kodo za komunikacijo z va≈°im backendom in MongoDB.
// =================================================================
function posljirezervacijo(restavracijaId, datum, cas, stOseb) {
    if (!restavracijaId || !datum || !stOseb) {
        // ƒåas (cas) nastavimo na privzeto vrednost, ƒçe ni input polja, zato ga ne preverjamo
        alert("Prosimo, izpolnite ≈°tevilo oseb in datum za rezervacijo.");
        return;
    }
    
    // Priprava formata datuma (ƒçe ≈æelite po≈°iljati v standardnem formatu YYYY-MM-DD)
    // Opomba: Input type="date" ≈æe vrne YYYY-MM-DD.
    
    console.log(`Poskus rezervacije za ID: ${restavracijaId}, Datum: ${datum}, ƒåas: ${cas}, Oseb: ${stOseb}`);

    // üî•üî• DODAJTE SVOJO FETCH KODO TUKAJ (npr. POST na /api/rezervacija) üî•üî•
    
    /*
    fetch('/api/rezervacija', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            restavracijaId: restavracijaId,
            datum: datum,
            cas: cas, // Npr. '19:00'
            stOseb: parseInt(stOseb) 
        })
    })
    // ... obdelava odgovora ...
    */
    
    // Za DEMO/Testiranje:
    alert(`Rezervacija za ${stOseb} oseb, ${datum} ob ${cas} (simulirano) uspe≈°na!`);
    
    // Opcijsko: osve≈æite prikaz
}


// =================================================================
// IX. ZAGON IN INITIALIZATION
// =================================================================

const setupLanguageSwitcher = () => {
// ... (Ostala koda funkcije setupLanguageSwitcher ostane nespremenjena) ...
  const selectDesktop = document.getElementById("izbiraJezikaDesktop");
  const selectMobilni = document.getElementById("izbiraJezikaMobilni");
  
  const selects = [selectDesktop, selectMobilni].filter(s => s !== null);

  if (selects.length === 0 || typeof i18next === 'undefined') return;

  const savedLang = localStorage.getItem('i18nextLng');
  const currentLang = savedLang || i18next.language;

  selects.forEach(select => select.value = currentLang); 

  selects.forEach(select => {
      select.addEventListener("change", (e) => {
        const newLang = e.target.value;
        localStorage.setItem('i18nextLng', newLang); 
        selects.filter(s => s !== e.target).forEach(s => s.value = newLang);
        
        i18next.changeLanguage(newLang, (err) => {
          if (err) return console.error(err);
          updateContent();
        });
      });
  });
};


// Glavna inicializacija, zagnana po nalaganju DOM-a, da ujame vse elemente
document.addEventListener('DOMContentLoaded', () => { 
    // ... (Inicializacija i18next, flatpickr in logika za map modal ostane nespremenjena) ...
    // ZAGON i18next
    if (typeof i18next !== 'undefined' && typeof i18nextHttpBackend !== 'undefined') {
        i18next.use(i18nextHttpBackend).init(
          {
            lng: localStorage.getItem('i18nextLng') || "sl",
            fallbackLng: "sl",
            backend: { loadPath: "./i18n/{{lng}}.json" },
          },
          (err) => {
            if (err) console.error(err);
            updateContent();
            setupLanguageSwitcher();
            generirajCasovneOpcije(); 
            
            // Inicializacija geolokacije pred nalaganjem restavracij
            getUserLocation();
            loadRestavracije(); 
            
            prikaziOpozoriloObZagonu(); 
          }
        );
    }
    
    const datumInput = document.getElementById('datum');
    const currentLang = i18next.language;

    // ZAGON DATE PICKERJA za iskalnik (Pikaday)
    // Preverimo, ali sta Pikaday in Moment.js na voljo
    if (datumInput && typeof Pikaday !== "undefined" && typeof moment !== "undefined") {
        
// ‚≠ê KRITIƒåNA ZA≈†ƒåITA ZA ANDROID/CAPACITOR:
// Prepreƒçi odpiranje nativnega koledarja/tipkovnice
datumInput.addEventListener('focus', (e) => {
    e.preventDefault(); 
    // e.target.blur();  <-- TO ODSTRANITE!
});

        new Pikaday({
            field: datumInput,
            // ‚úÖ POPRAVLJENO: Format brez presledkov
            format: 'DD.MM.YYYY', // Moment.js format (ustreza "d.m.Y")
            minDate: new Date(),
            i18n: pikadayLangs[currentLang] || pikadayLangs['sl'], // Uporaba lokalizacije
            onSelect: function(date) {
                // Poskrbimo za pravilen zapis v input polje
                // ‚úÖ POPRAVLJENO: Format brez presledkov
                datumInput.value = moment(date).format('DD.MM.YYYY');
            },
            bound: true // Koledar ostane znotraj vidnega obmoƒçja
        });
    }
// =========================================================
// X. LOGIKA ZA ZEMLJEVID (MAP MODAL) - VKLJUƒåENO Z LEAFLETOM!
// =========================================================
const mapIcon = document.getElementById('map-icon-link');
const mapModal = document.getElementById('map-modal');
// Uporabimo closeBtnMap, da ne pride do konflikta z morebitno globalno spremenljivko 'closeBtn'
const closeBtnMap = document.getElementById('close-map-btn'); 

// =========================================================
// üî•üî• KODA ZA DODAJANJE LOGOTIPA (CUSTOM LEAFLET CONTROL) - GLOBALNA DEFINICIJA üî•üî•
// =========================================================

// Pot do va≈°e slike logotipa (TODO: TO SPREMENITE V PRAVILNO POT!)
const logoUrl = 'Rentyo-gourmer-logo-zemljevid.png'; 
const logoAltText = 'Logotip podjetja';

// Definiramo nov Leaflet Control
const LogoControl = L.Control.extend({
    options: {
        position: 'topleft' // Privzeto nastavimo pozicijo
    },
    onAdd: function(map) {
        // Ustvarimo div za logotip
        const container = L.DomUtil.create('div', 'leaflet-control-logo');
        
        // Ustvarimo sliko (po ≈æelji lahko dodate tudi povezavo <a>)
        // POMEMBNO: 'leaflet-control-logo' MORATE STILIZIRATI Z CSS-om (ozadje, padding, senca)!
        container.innerHTML = `<img src="${logoUrl}" alt="${logoAltText}" style="width: 40px; height: auto;">`;
        
        // Prepreƒçi, da bi kliki na logotipu spro≈æili dejanja na zemljevidu (npr. pan/zoom)
        L.DomEvent.disableClickPropagation(container);
        L.DomEvent.on(container, 'contextmenu', L.DomEvent.stopPropagation);

        return container;
    },
    onRemove: function(map) {
        // Opcijsko ƒçi≈°ƒçenje
    }
});

// Funkcija za enostavno dodajanje kontrolnika
const addLogoControl = (map) => {
    new LogoControl({ position: 'topleft' }).addTo(map);
    console.log("Logotip kontrolnik dodan na zemljevid.");
};

// =========================================================
// üî• FUNKCIJE ZA LOKALIZACIJO UPORABNIKA üî•
// =========================================================

let userLocationMarker = null;
let userAccuracyCircle = null;

function onLocationFound(e) {
    const radius = e.accuracy / 2; 
    const latlng = e.latlng;

    // Odstranimo prej≈°nje oznake, ƒçe obstajajo
    if (userLocationMarker) {
        map.removeLayer(userLocationMarker);
    }
    if (userAccuracyCircle) {
        map.removeLayer(userAccuracyCircle);
    }

    // Centriranje zemljevida na uporabnikovo lokacijo (ostane nespremenjeno)
    map.setView(latlng, 13);
    
    // Dodajanje kroga, ki prikazuje natanƒçnost lokacije (ostane nespremenjeno)
    userAccuracyCircle = L.circle(latlng, radius, {
        color: '#066A69', 
        fillColor: '#066A69', 
        fillOpacity: 0.5,
        weight: 1
    }).addTo(map).bindPopup("Trenutno se nahajate znotraj tega obmoƒçja.");

    // üî•üî•üî• SPREMEMBA: NAMENITEV BESEDILA "You are here" Z IKONO OSEBE V POPUPU üî•üî•üî•
    const userIconHtml = '<i class="fa fa-user" style="color: #066A69; font-size: 24px;"></i>';
    
    userLocationMarker = L.marker(latlng)
        .addTo(map)
        // Namesto besedila vstavimo HTML kodo za ikono
        .bindPopup(userIconHtml)
        .openPopup(); 
    // Opomba: Ker ikona stoji sama, sem dodal barvo neposredno v stil.

    console.log(`Lokacija uporabnika uspe≈°no doloƒçena: Lat: ${latlng.lat}, Lng: ${latlng.lng}`);
}

function onLocationError(e) {
    console.warn(`Napaka pri doloƒçanju lokacije: ${e.message}`);
}

// =========================================================


// 1. Odpiranje modalnega okna ob kliku na ikono
if (mapIcon && mapModal) {
    mapIcon.addEventListener('click', function(e) {
        e.preventDefault(); // Prepreƒçi skok na vrh strani
        mapModal.style.display = "block";
        
        // KLJUƒåNA LOGIKA: Inicializacija Leaflet se zgodi samo enkrat
        if (map === null) {
            // Sredi≈°ƒçe Slovenije in zaƒçetni zoom (uporaba globalnih konstant)
            const centerCoordinates = [DEFAULT_LAT, DEFAULT_LON]; 
            const initialZoom = 8;
            
            // Inicializiramo zemljevid v divu 'large-map-container'
            map = L.map('large-map-container', { 
                zoomControl: false // üî•üî•üî• DODANA NASTAVITEV ZA SKRIVANJE GUMBOV +/-
            }).setView(centerCoordinates, initialZoom);
            
            // Dodamo OpenStreetMap plo≈°ƒçice
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // üî• Klic funkcije za dodajanje LOGOTIPA v zgornji levi kot
            addLogoControl(map);
            
            // Dodamo poslu≈°alce dogodkov za lokacijo
            map.on('locationfound', onLocationFound);
            map.on('locationerror', onLocationError);
            
            // üî•üî•üî• POZIV ZA DOLOƒåITEV LOKACIJE UPORABNIKA üî•üî•üî•
            map.locate({
                setView: false, // Dovolimo, da funkcija onLocationFound roƒçno centrira pogled
                maxZoom: 16, 
                watch: false, 
                enableHighAccuracy: true 
            });


            // ƒåe so restavracije ≈ΩE nalo≈æene, jih dodaj ob inicializaciji mape
            if (typeof allRestavracije !== 'undefined' && allRestavracije.length > 0) {
                console.log("Dodajanje markerjev ob inicializaciji mape (podatki ≈æe nalo≈æeni).");
                dodajMarkerjeRestavracij(map); // Klic brez drugega argumenta
            }
            
            console.log("Leaflet zemljevid inicializiran.");
        }
        
        // POMEMBNO: Prisili Leaflet, da se prerise (ker je bil prej skrit)
        setTimeout(() => {
             map.invalidateSize();
             
             // DODATNO ZAGOTOVILO: Ponovno preverimo in dodamo markerje, ƒçe jih ≈°e ni
             if (map !== null && typeof allRestavracije !== 'undefined' && allRestavracije.length > 0 && (!map.markers || map.markers.getLayers().length === 0)) {
                 console.log("Naknadno dodajanje markerjev, ker so podatki na voljo.");
                 dodajMarkerjeRestavracij(map);
             }
        }, 100); 

        console.log("Modalno okno z zemljevidom odprto.");
    });
}

// 2. Zapiranje modalnega okna ob kliku na gumb 'X'
if (closeBtnMap && mapModal) {
    closeBtnMap.addEventListener('click', function() {
        mapModal.style.display = "none";
        console.log("Modalno okno z zemljevidom zaprto.");
    });
}

// 3. Zapiranje modalnega okna ob kliku izven vsebine (na temno ozadje)
if (mapModal) {
    window.addEventListener('click', function(event) {
        if (event.target === mapModal) {
            mapModal.style.display = "none";
            console.log("Modalno okno z zemljevidom zaprto (klik izven).");
        }
    });
}

// =========================================================
// üõë ODSTRANJENA CELOTNA LOGIKA ZA ZAVIHKI V MODALU RESTAVRACIJE
// (Ta logika je pripadala modalu, ki ga sedaj ne potrebujemo)
// =========================================================


}); // Konec glavnega DOMContentLoaded bloka


// =================================================================
// VI. LOGIKA MODALA RESTAVRACIJE (VA≈†A ORIGINALNA FUNKCIJA)
// =================================================================

async function prikaziPodrobnosti(restavracija) {
    
    currentRestaurantId = restavracija._id || restavracija.id; 
    const reservIdInput = document.querySelector('[data-reserv-id]');
    if (reservIdInput) reservIdInput.value = currentRestaurantId; 

    // 1. PREVERJANJE IN PRIDOBIVANJE POPOLNIH PODATKOV
    let popolnaRestavracija = restavracija;
    // ‚≠ê POPRAVLJENO: Uporaba 'komentarji' namesto 'ocene' za preverjanje manjkajoƒçih podrobnosti
    const isMissingDetails = !restavracija.meni || !restavracija.galerija_slik || !restavracija.komentarji; 

    if (currentRestaurantId && isMissingDetails) {
        if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Nalaganje podrobnosti...'; 

        const fullData = await getFullRestaurantDetails(currentRestaurantId);
        
        if (fullData) {
            popolnaRestavracija = fullData; 
        } else {
            if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Neznano Ime';
            prikaziSporocilo('Napaka pri nalaganju celotnih podrobnosti restavracije.', 'error');
        }
    }

    
    const restavracijaIme = popolnaRestavracija.ime || popolnaRestavracija.imeRestavracije || 'Neznano Ime'; 
    const kuhinja = popolnaRestavracija.deviznaKuhinja || 'Neznano';
    
    const prvaSlikaIzGalerije = popolnaRestavracija.galerija_slik && popolnaRestavracija.galerija_slik.length > 0
        ? popolnaRestavracija.galerija_slik[0]
        : null;

    const slikaUrl = popolnaRestavracija.mainImageUrl || popolnaRestavracija.urlSlike || prvaSlikaIzGalerije || FALLBACK_IMAGE_URL;
    
    const opis = popolnaRestavracija.opis || popolnaRestavracija.glavniOpis || ''; 
    
    // üî• Pravilne koordinate, ki se uporabljajo povsod
    const lon = popolnaRestavracija.lokacija?.coordinates?.[0] || DEFAULT_LON; 
    const lat = popolnaRestavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const gpsString = `${lat.toFixed(4)},${lon.toFixed(4)}`; 
    
    
    // *************************************************************************
    // ‚≠ê DODANO: DINAMIƒåNA NASTAVITEV DATA-ATRIBUTOV NA GUMBU ZA NAVIGACIJO
    // Uporabimo ID, da se izognemo te≈æavam z document.querySelector
    // *************************************************************************
    const gumbNavigacija = document.getElementById('navigacija-gumb-modal'); 
    
    if (gumbNavigacija) {
        // Prepisovanje data-atributov z dinamiƒçnimi koordinatami
        gumbNavigacija.setAttribute('data-lat', lat);
        gumbNavigacija.setAttribute('data-lon', lon);
        
        console.log(`[NAVIGACIJA FIX] Gumb posodobljen z LAT=${lat}, LON=${lon}`);
    } else {
        console.warn("POZOR: Gumb z ID 'navigacija-gumb-modal' ni najden! Preverite HTML.");
    }
    // *************************************************************************
    // ‚≠ê KONEC DODANEGA BLOKA
    // *************************************************************************


    // IZRAƒåUN RAZDALJE ZA MODALNO OKNO
    let prikazLokacije = '';

    if (userLocation) {
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            lat, 
            lon
        );
        
        const oddaljenostKm = Math.round(distance); 
        prikazLokacije = `<i class="fas fa-location-arrow"></i> ${oddaljenostKm} km`;
        
    } else {
        prikazLokacije = `<i class="fas fa-map-marker-alt"></i> ${gpsString}`;
    }
    
   // Polnjenje Glavnih podrobnosti
if(modalSlika) modalSlika.style.backgroundImage = `url(${slikaUrl})`;

// =========================================================
// üî• VSTAVITE TA BLOK KODE TUKAJ (Znotraj prikaziPodrobnosti()) üî•
// =========================================================
// Predpostavljamo, da je 'currentRestaurantId' ID restavracije, ki jo prikazujemo
// in da je 'globalFavoritesList' globalno nalo≈æen seznam priljubljenih ID-jev.

// 1. Preverimo, ali je ta restavracija ≈æe na seznamu priljubljenih
const isFavorite = globalFavoritesList.includes(currentRestaurantId);

// 2. Doloƒçimo CSS razred in barvo glede na stanje:
const iconClass = isFavorite ? 'fas' : 'far'; // fas = polno srce, far = prazno srce
const iconColor = '#e74c3c'; // Rdeƒça za oba primera

// =========================================================
// üî• Nadaljevanje s sestavljanjem HTML niza (uporaba spremenljivk) üî•
// =========================================================



// Preveri, ali gumb ≈æe obstaja, preden ga ustvari
const existingButton = document.getElementById('modalFavoriteToggle');

if (!existingButton) {
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = favoriteButtonHTML;
    
    // Predvidevamo, da je '.podrobnosti-tekst' kontejner (parent element) za H2
    const detailsContainer = document.querySelector('.podrobnosti-tekst');
    if (detailsContainer) {
        detailsContainer.style.position = 'relative'; 
        detailsContainer.insertBefore(tempDiv.firstChild, detailsContainer.firstChild);
    }
} else {
    // ƒåe gumb ≈æe obstaja (modal se ponovno odpre), posodobi ID IN stanje
    existingButton.setAttribute('data-id', currentRestaurantId);
    
    // ‚≠ê KLJUƒåNO POPRAVILO: Roƒçna posodobitev stanja ikone za obstojeƒçi gumb
    const icon = existingButton.querySelector('.favorite-icon');
    if (icon) {
        if (isFavorite) {
            icon.classList.remove('far'); 
            icon.classList.add('fas'); 
        } else {
            icon.classList.remove('fas'); 
            icon.classList.add('far');
        }
    }
}
// Konec vstavljanja gumba
    
if(modalIme) modalIme.textContent = restavracijaIme;
if(modalKuhinja) modalKuhinja.innerHTML = `<i class="fas fa-utensils"></i> ${kuhinja}`;

if(modalLokacija) modalLokacija.innerHTML = prikazLokacije; 

if(modalOcena) modalOcena.innerHTML = `<i class="fas fa-star"></i> ${(popolnaRestavracija.ocena_povprecje || 0).toFixed(1)}`;
if (modalOpis) {
    modalOpis.innerHTML = opis; 
}

    // Generiranje Menija (Uporaba POPOLNA_RESTAVRACIJ A)
    if(modalMeni) {
        modalMeni.innerHTML = '';
        const menuObj = popolnaRestavracija.meni || {}; 
        
        let hasMenu = false;
        
        for (const kategorija in menuObj) {
            const items = menuObj[kategorija]; 
            
            if (kategorija === 'tedenska_ponudba') {
                continue; 
            }
            
            if (Array.isArray(items) && items.length > 0) {
                hasMenu = true;
                if (kategorija !== 'osnovni_meni') {
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = kategorija;
                    modalMeni.appendChild(categoryHeader);
                }

                const ul = document.createElement('ul');
                items.forEach(item => {
                    const li = document.createElement('li');
                    
                    let desnaVrednost = '';
                    if (item.cena !== undefined && item.cena !== null) {
                        desnaVrednost = `${item.cena} ‚Ç¨`; 
                    } else if (item.opis) {
                        desnaVrednost = item.opis; 
                    } else {
                        desnaVrednost = ''; 
                    }

                    li.innerHTML = `
                        <div style="display: flex; justify-content: space-between; width: 100%;">
                            <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                            <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                        </div>
                    `;
                    ul.appendChild(li);
                });
                modalMeni.appendChild(ul);
            }
        }
        
        if (!hasMenu) {
            modalMeni.innerHTML = '<li class="text-gray-500"><span data-i18n="modal.no_menu">Meni ≈°e ni na voljo.</span></li>';
        }
    }
    
    // Polnjenje zavihka Aktualna Ponudba 
    const ponudbaItems = popolnaRestavracija.meni?.tedenska_ponudba || [];
    const modalAktualnaPonudbaDiv = document.getElementById('tabAktualnaPonudba'); 
    
    if (modalAktualnaPonudbaDiv) {
        if (ponudbaItems.length > 0) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '0';
            ponudbaItems.forEach(item => {
                let desnaVrednost = '';
                if (item.cena !== undefined && item.cena !== null) {
                    desnaVrednost = `${item.cena} ‚Ç¨`;
                } else if (item.opis) {
                    desnaVrednost = item.opis;
                } else {
                    desnaVrednost = '';
                }

                const li = document.createElement('li');
                li.style.listStyle = 'none';
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                        <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                    </div>
                `;
                ul.appendChild(li);
            });
            modalAktualnaPonudbaDiv.innerHTML = '';
            modalAktualnaPonudbaDiv.appendChild(ul);
        } else {
            modalAktualnaPonudbaDiv.innerHTML = '<p class="text-gray-500"><span data-i18n="modal.no_special_offer">Aktualna ponudba trenutno ni na voljo.</span></p>';
        }
    }
    
  // Generiranje Galerije 
if(galerijaSlikeDiv) {
    const galerijaSlikaURLS = popolnaRestavracija.galerija_slik || []; 
    
    let galerijaHTML = ''; 

    if (galerijaSlikaURLS.length > 0) {
        
        galerijaSlikaURLS.forEach(url => {
            galerijaHTML += `
                <div class="relative rounded-lg overflow-hidden shadow-md">
                    <img 
                        src="${url}" 
                        alt="Slika restavracije" 
                        class="absolute top-0 left-0 w-full h-full object-cover cursor-pointer hover:opacity-90 transition duration-300"
                        onclick="openFullSizeImage('${url}')"
                    >
                </div>
            `;
        });

        galerijaSlikeDiv.innerHTML = galerijaHTML; 

    } else {
        galerijaSlikeDiv.innerHTML = '<p class="text-gray-500 p-4">Ni slik za prikaz.</p>';
    }
}

// Generiranje Zemljevida
if (modalZemljevid) {

    // prepreƒçi te≈æave s klikom kartice
    modalZemljevid.style.pointerEvents = "auto";
    modalZemljevid.style.display = "block";
    modalZemljevid.style.position = "relative";
    modalZemljevid.style.zIndex = "1";

    // izraƒçun bounding box za bli≈æji pogled (zoom ~16)
    const offset = 0.005; 

    const left = lon - offset;
    const right = lon + offset;
    const top = lat + offset;
    const bottom = lat - offset;

    modalZemljevid.src = 
        `https://www.openstreetmap.org/export/embed.html?bbox=${left},${bottom},${right},${top}&layer=mapnik&marker=${lat},${lon}`;
}

    
    // ‚≠ê KLJUƒåNO: Klic funkcije za prikaz vseh ocen
    // ‚≠ê POPRAVLJENO: Uporaba kljuƒça 'komentarji', ki ga vrne API.
    renderReviews(popolnaRestavracija.komentarji); 
    

    // Resetiraj prikaz prostih ur
    if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
        '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
        
    globalSelectedTime = null; 
    globalSelectedMizaId = null; 
    
    // Resetiraj na prvi zavihek (Opis je bolj logiƒçen)
    const defaultTab = document.querySelector('.modal-tab[data-tab="opis"]');
    if(defaultTab) defaultTab.click();

    // Odpri modal
    if(restavracijaModal) restavracijaModal.classList.add('active');
    updateContent(); 
}


// Zapiranje modala (Ostane enako)
if(zapriRestavracijaModal) zapriRestavracijaModal.addEventListener('click', () => {
    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(modalZemljevid) modalZemljevid.src = 'about:blank';
    currentRestaurantId = null; 
    globalSelectedMizaId = null; 
});

if(restavracijaModal) window.addEventListener('click', (e) => {
    if (e.target === restavracijaModal) {
        restavracijaModal.classList.remove('active');
        if(modalZemljevid) modalZemljevid.src = 'about:blank';
        currentRestaurantId = null; 
        globalSelectedMizaId = null; 
    }
});

// LOGIKA ZAVIHKOV (Ostane enako)
modalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');
        modalTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        const targetElementId = `tab${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`;
        const targetElement = document.getElementById(targetElementId);
        if (targetElement) targetElement.classList.add('active');
    });
});


// =================================================================
// POMO≈ΩNE FUNKCIJE (IZVEN DOMContentLoaded BLOKA) - TUKAJ JIH MORAMO IMETI!
// =================================================================

/**
 * üî•üî• NOVA POVEZOVALNA FUNKCIJA: handleOdpriModalPodrobnosti
 * PREMAKNJENA SEM, DA JE DOSTOPNA Leaflet markerjem in ne spro≈æa napake!
 * Poi≈°ƒçe celoten objekt restavracije in pokliƒçe va≈°o funkcijo prikaziPodrobnosti(objekt).
 * @param {Event | null} event - Dogodek klika (lahko je null za klic z zemljevida).
 * @param {string} restavracijaId - ID restavracije.
 */
function handleOdpriModalPodrobnosti(event, restavracijaId) {
    if (event) {
        event.preventDefault(); 
    }
    
    if (!restavracijaId) {
        console.error("Napaka: Manjka ID restavracije za odpiranje modala.");
        return;
    }

    // 1. Poi≈°ƒçemo objekt restavracije v globalnem polju allRestavracije
    const restavracijaObj = allRestavracije.find(r => (r._id === restavracijaId || r.id === restavracijaId));
    
    if (restavracijaObj) {
        console.log(`Prikazujem podrobnosti za restavracijo: ${restavracijaObj.ime || restavracijaObj.imeRestavracije}`);
        
        // 2. Kliƒçemo va≈°o originalno funkcijo za prikaz modala
        prikaziPodrobnosti(restavracijaObj);
        
    } else {
        console.error(`Napaka: Objekt restavracije z ID ${restavracijaId} ni bil najden v allRestavracije.`);
        if (typeof prikaziSporocilo === 'function') {
             prikaziSporocilo('Napaka: Podatki restavracije niso na voljo.', 'error');
        }
    }
}


/**
 * Pomo≈æna funkcija za zagotavljanje pravilne poti do slike.
 * Preveri, ali pot vsebuje 'images/', ƒçe ne, jo doda, razen ƒçe je ≈æe polna pot (npr. http/https).
 * @param {string} url - Relativna pot do slike.
 * @returns {string} Absolutna ali popravljena relativna pot.
 */
function getAbsoluteImageUrl(url) {
    if (!url || url.startsWith('http')) {
        return url;
    }
    // Preverite, ali pot ≈æe vsebuje "images/" ali je to ≈æe del poti
    if (url.startsWith('images/') || url.startsWith('/images/')) {
        return url;
    }
    // V primeru, da je podatek iz hotels.json (bled-mp-1.jpg)
    return `images/${url}`;
}


// Pomo≈æna funkcija za vrnitev na privzeto sekcijo
function handlePrikaziPrivzete() {
    const searchSection = document.getElementById('rezultatiIskanjaSekcija');
    const defaultSection = document.getElementById('privzeteRestavracijeSekcija');
    
    if (searchSection) {
        searchSection.classList.add('hidden');
    }
    
    if (defaultSection) {
        defaultSection.classList.remove('hidden'); 
        defaultSection.style.display = ''; 
    }
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}


/**
 * üõë ODSTRANJENA KLJUƒåNA FUNKCIJA: prikaziMeniPodatke
 */
/*
function prikaziMeniPodatke(restavracijaObjekt) { 
    // ... Stara logika za menije je odstranjena ...
}
*/


/**
 * üõë ODSTRANJENA IMPLEMENTACIJA ZA PRIKAZ MODALNEGA OKNA
 */
/*
function prikaziRestavracijoModal(restavracijaObjekt) {
    // ... Stara logika modala je odstranjena ...
}
*/


// =================================================================
// üî• POSODOBLJENA POMO≈ΩNA FUNKCIJA: Dodajanje markerjev (Tooltips + Odpiranje Modala)
// Markerji sedaj ob kliku odprejo modal s podrobnostmi (handleOdpriModalPodrobnosti).
// =================================================================
function dodajMarkerjeRestavracij(leafletMap) {
    const dataToUse = (typeof allRestavracije !== 'undefined' ? allRestavracije : []);
    
    if (!leafletMap || dataToUse.length === 0) {
        return;
    }

    // 1. Oƒçistimo stare markerje in inicializiramo featureGroup
    if (leafletMap.markers) {
        leafletMap.markers.clearLayers();
    } else {
        leafletMap.markers = L.featureGroup().addTo(leafletMap);
    }
    
    let bounds = []; 

    // 2. Iteriramo skozi vse restavracije
    dataToUse.forEach(restavracija => {
        if (restavracija.lokacija && restavracija.lokacija.coordinates && restavracija.lokacija.coordinates.length === 2) {
            
            const lng = parseFloat(restavracija.lokacija.coordinates[0]); 
            const lat = parseFloat(restavracija.lokacija.coordinates[1]); 
            
            // üî• ID, ki ga uporablja funkcija handleOdpriModalPodrobnosti
            const restavracijaId = restavracija._id || restavracija.id; 
            const restavracijaIme = restavracija.imeRestavracije || restavracija.ime || restavracija.title || 'Neznano Ime';
            
            const ocena = parseFloat(restavracija.ocena_povprecje || restavracija.googleRating || 0);
            const ocenaPrikaz = ocena > 0 ? ocena.toFixed(1) : 'N/A';
            
            // Dodan CSS razred 'map-poudarek' za la≈æje stiliziranje v CSS-ju
            let poudarek = ocena >= 4.5 ? '<p class="map-poudarek" style="color: #c90000; font-weight: bold; margin-top: 5px; margin-bottom: 0; font-size: 0.80em;">YOU MUST TRY</p>' : '';
            
            // --- TOOLTIP VSEBINA (Vizualni prikaz nad markerjem) ---
            const tooltipContent = `
                <div class="map-tooltip-content" style="text-align: center; padding: 5px;">
                    <p class="tooltip-name" style="font-weight: bold; margin: 0 0 5px 0; font-size: 1em;">${restavracijaIme}</p>
                    
                    <p class="tooltip-rating" style="margin: 0;">
                        <span style="color: gold; font-size: 1.2em;">‚òÖ</span> 
                        <span style="font-weight: 700; font-size: 1.4em;">${ocenaPrikaz}</span>
                    </p>
                    
                    ${poudarek}
                </div>
            `;
            
            const marker = L.marker([lat, lng]) 
                // Pove≈æemo Tooltip za prikaz imena/ocene
                .bindTooltip(tooltipContent, {
                    permanent: true,     
                    direction: 'top',    
                    offset: [0, -15], 
                    className: 'map-restaurant-tooltip' // Kljuƒçni razred za CSS
                });
                
            leafletMap.markers.addLayer(marker);
            
            // üî• KLJUƒåNO: Dodamo poslu≈°alca za klik za odpiranje modala!
            marker.on('click', function(e) {
                // ƒåe funkcija handleOdpriModalPodrobnosti ni definirana, prepreƒçimo, da se stran osve≈æi/skoƒçi na vrh.
                if (typeof handleOdpriModalPodrobnosti !== 'function') {
                    console.error("Napaka: Funkcija handleOdpriModalPodrobnosti ni dosegljiva. Preverite obseg definicije.");
                    return; // Prekinemo, ƒçe funkcija ne obstaja
                }

                // Prepreƒçimo morebitne privzete Leaflet dogodke za ta klik 
                if (e.originalEvent) {
                    e.originalEvent.stopPropagation();
                }

                // 1. ZAPIRANJE MODALA Z ZEMLJEVIDOM JE ODSTRANJENO! (Da ostane odprt)
                /* const mapModal = document.getElementById('map-modal');
                if (mapModal) {
                    mapModal.style.display = "none";
                }
                */
                
                // 2. Pokliƒçemo funkcijo za odpiranje modala podrobnosti
                // Sedaj je ta funkcija globalno dostopna in bo poklicala prikaziPodrobnosti
                handleOdpriModalPodrobnosti(null, restavracijaId); 
            });
            
            bounds.push([lat, lng]);
        }
    });

// 3. Prilagoditev pogleda (Zoom & Center)
    if (bounds.length > 0) {
        leafletMap.fitBounds(bounds, {
            padding: [0, 0] // üî• POPRAVLJENO: Padding nastavljen na 0, da se odstrani beli rob okoli zemljevida
        });
    }

}
// V VA≈†I JAVASCRIPT DATOTEKI: script.js

document.addEventListener('DOMContentLoaded', () => {
    
    // Obstojeƒça spremenljivka, ki preverja, ali je koda v mobilni aplikaciji (Capacitor)
    const isMobileApp = typeof window.Capacitor !== 'undefined'; 
    
    // =========================================================================
    // üöÄ NOVO: LOGIKA ZA DOLOƒåANJE VI≈†INE VARNEGA OBMOƒåJA (Status Bar)
    //         Injektiramo kot CSS variablo --safe-area-top
    // =========================================================================
    if (isMobileApp && window.Capacitor.isPluginAvailable('StatusBar')) {
        const { StatusBar } = window.Capacitor.Plugins;
        
        StatusBar.getInfo().then(info => {
            // Uporabimo safeAreaHeight, ki je na Androidu pogosto vi≈°ina Status Bara
            const safeAreaHeight = info.safeAreaHeight || 0;

            if (safeAreaHeight > 0) {
                 // üîë INJICIRAJTE VARNO VI≈†INO V CSS VARIABLO
                 // To omogoƒça CSS kodi, da uporabi: top: var(--safe-area-top);
                 document.documentElement.style.setProperty(
                     '--safe-area-top', 
                     `${safeAreaHeight}px`
                 );
                 console.log(`Nastavljena CSS variabla --safe-area-top: ${safeAreaHeight}px`);
                 
                 // Opcija: Takoj popravi CSS na glavi, ƒçe je na voljo
                 const headerElement = document.querySelector('.platform-android header');
                 if (headerElement) {
                     headerElement.style.setProperty('top', `var(--safe-area-top)`, 'important');
                 }
            }
        }).catch(err => {
            console.error('Napaka pri pridobivanju informacij StatusBar:', err);
        });
    }
    // =========================================================================
    
    const taskbar = document.getElementById('capacitorTaskbar');
    // NAJDEMO MODALNO OKNO ZA NADZOR VIDNOSTI
    const loginModal = document.getElementById('loginModal');
    // NOVO: Poi≈°ƒçemo obrazec za prijavo (ID v HTML je formPrijava)
    const loginForm = document.getElementById('formPrijava');
    
    // üí° NOVO: Poi≈°ƒçemo elemente za preklop
    const loginLink = document.getElementById('odpriPrijavoMobilni'); // Gumb "Prijava"
    const profileContainer = document.getElementById('profilMeniMobilni'); // Kontejner za "Moj Profil / Odjava"


    // =========================================================================
    // üõ†Ô∏è NOVO: FUNKCIJA ZA PREVERJANJE STATUSA PRIJAVE
    // =========================================================================
    function checkLoginStatus() {
        // ‚≠ê ZAMENJAJTE to s pravo logiko, ki preveri, ali je uporabnik prijavljen
        // Npr. preverjanje, ali obstaja avtentikacijski ≈æeton v LocalStorage ali SessionStorage
        const isAuthenticated = localStorage.getItem('authToken') !== null; 
        return isAuthenticated;
    }

    // =========================================================================
    // üõ†Ô∏è NOVO: FUNKCIJA ZA POSODOBITEV ELEMENTOV V ZAVIHKU
    // =========================================================================
    function updateMobileTaskbarUI() {
        const isLoggedIn = checkLoginStatus();

        if (isLoggedIn) {
            // Uporabnik je prijavljen
            if (loginLink) loginLink.style.display = 'none'; // Skrij "Prijava"
            
            // ‚≠ê POPRAVEK: Uporabite 'flex', da aktivirate Flexbox CSS pravila (gap, flex-direction)
            if (profileContainer) profileContainer.style.display = 'flex'; // Prika≈æi "Moj Profil / Odjava"
            
            console.log("UI posodobljen: Prikazan je profil.");
        } else {
            // Uporabnik ni prijavljen
            if (loginLink) loginLink.style.display = 'block'; // Prika≈æi "Prijava"
            if (profileContainer) profileContainer.style.display = 'none'; // Skrij "Moj Profil / Odjava"
            console.log("UI posodobljen: Prikazana je prijava.");
        }
    }


    if (taskbar && isMobileApp) {
        
        // =========================================================================
        // ‚≠ê OBSTAJEƒåA LOGIKA ZA CAPACITOR APP
        // =========================================================================
        document.body.classList.add('is-capacitor-app');
        taskbar.classList.add('is-mobile'); 
        
        const footer = document.querySelector('footer');
        if (footer) {
             footer.style.display = 'none'; 
        }
        
        const mainContent = document.querySelector('main');
        if (mainContent) {
            mainContent.style.paddingBottom = '65px'; 
        }

        // üí° POPRAVLJENO: LOGIKA ZA SKRIVANJE LOGIN MODALA NA CAPACITORJU OB ZAGONU
        if (loginModal) {
             // Modal sedaj ostane skrit, dokler se ne pokliƒçe s strani/gumba
             loginModal.style.display = 'none'; 
        }

        // üü¢ NOVO: LOGIKA ZA AKTIVACIJO GUMBA ZA PRIJAVO V CAPACITOR OKOLJU
        // Uporabljamo obstojeƒço spremenljivko 'loginLink' (odpriPrijavoMobilni)
        if (loginLink) {
            // Predpostavimo, da je to gumb, ki odpira modal s prijavno vsebino.
            loginLink.addEventListener('click', (e) => {
                e.preventDefault();
                
                if (loginModal) {
                    // Preverite, kateri 'display' stil potrebuje va≈° modal, obiƒçajno je 'block' ali 'flex'
                    loginModal.style.display = 'block'; 
                }
            });
            // Opomba: DOLOƒåANJE display stila se sedaj premakne v updateMobileTaskbarUI
        }
        
        // üöÄ KLIC FUNKCIJE OB ZAGONU (prvo doloƒçanje, kaj naj bo vidno)
        updateMobileTaskbarUI();
        // =========================================================================
    } 
    
    // =========================================================================
    // üí° POPRAVEK: LOGIKA ZA ZAPIRANJE MODALA PO USPE≈†NI PRIJAVI (SAMO V CAPACITOR OKOLJU)
    // =========================================================================

    if (loginForm && isMobileApp) {
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Prepreƒçimo privzeto obna≈°anje (osve≈æitev strani)

            // =======================================================================
            // ‚≠ê VSTAVITE SVOJO LOGIKO ZA PRIJAVO TUKAJ (NPR. AJAX KLIC NA STRE≈ΩNIK)
            // =======================================================================
            
            // VZOREC: Predpostavljamo, da je rezultat logike shranjen v spremenljivki 'prijavaUspe≈°na'
            const prijavaUspe≈°na = true; // ZAMENJAJTE 'true' Z REZULTATOM VA≈†E DEJANSKE PRIJAVNE LOGIKE!

            if (prijavaUspe≈°na) {
                // PRIMER: Shranimo ≈æeton (da checkLoginStatus deluje)
                localStorage.setItem('authToken', 'fake-token'); 
                
                // üöÄ ZAPRI MODALNO OKNO
                if (loginModal) {
                    loginModal.style.display = 'none';
                    // üü¢ NOVO: POSODOBI ELEMENTE ZAVIHKOV PO USPE≈†NI PRIJAVI
                    updateMobileTaskbarUI();
                }
            } else {
                // Obravnava napake pri prijavi (npr. napaƒçno geslo)
                console.warn("Prijava neuspe≈°na."); 
            }
        });
    }
    
    // -------------------------------------------------------------------------
    // üöÄ POPRAVLJENO: LOGIKA ZA ODJAVO (Poslu≈°alec dogodkov na gumbu za odjavo)
    // -------------------------------------------------------------------------
    const logoutButton = document.getElementById('gumbOdjavaMobilni'); 
    
    if (logoutButton) {
        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            
            // ‚≠ê LOGIKA ZA ODJAVO (odstranitev ≈æetona)
            localStorage.removeItem('authToken'); // Odstrani ≈æeton
            
            // üü¢ KLJUƒåNO: POSODOBI ELEMENTE ZAVIHKOV PO ODJAVI (prika≈æe "Prijava")
            updateMobileTaskbarUI();
            
            // Po odjavi lahko preusmeri≈° uporabnika na domaƒço stran:
            // window.location.href = '/';
            console.log("Uporabnik uspe≈°no odjavljen. UI posodobljen.");
        });
    }

    // =========================================================================
    // üí° OBSTAJEƒåA LOGIKA ZA WEB/PWA (ko se NE izvaja v Capacitorju)
    // =========================================================================

    if (!isMobileApp) {

        // üí° NOVO: LOGIKA ZA SKRIVANJE LOGIN MODALA NA WEB/PWA
        if (loginModal) {
            // Modal je privzeto skrit na Web/PWA. Poka≈æe se le ob kliku (pokliƒçe se showAppDownloadModal()).
            loginModal.style.display = 'none';
        }

        
        // 1. Poi≈°ƒçemo elemente v mobilnem meniju
        // const loginLink = document.getElementById('odpriPrijavoMobilni'); // ≈æe deklarirano zgoraj
        // const profileContainer = document.getElementById('profilMeniMobilni'); // ≈æe deklarirano zgoraj
        const mobilniMeni = document.getElementById('mobilniMeni');
        const jezikOvoj = document.getElementById('jezikOvojMobilni'); 
        
        // ... (preostala obstojeƒça logika za Web/PWA)
        
        // 2. Skrijemo standardne gumbe za prijavo in profil/odjavo
        if (loginLink) {
            loginLink.style.display = 'none';
        }
        if (profileContainer) {
            profileContainer.style.display = 'none';
        }
        
        // 3. Vstavimo nov gumb za prenos aplikacije na njihovo mesto
        if (mobilniMeni) {
            const downloadLink = document.createElement('a');
            downloadLink.href = "#";
            downloadLink.className = 'gumb-prenos-app';
            downloadLink.innerHTML = '<i class="fas fa-mobile-alt"></i> Download now';
            
            // Dodamo dogodek za prikaz modalnega okna
            downloadLink.addEventListener('click', (e) => {
                e.preventDefault();
                showAppDownloadModal(); 
            });

            // Vstavimo gumb takoj pred izbiro jezika (jezik ostane viden!)
            mobilniMeni.insertBefore(downloadLink, jezikOvoj);
        }
        
        // ƒåe gumb za prijavo/registracijo v glavi ostane viden na PWA/Web, 
        // mu dodamo dogodek, da pokliƒçe modalno okno za prenos.
        const loginModalOpener = document.getElementById('odpriPrijavoMobilni'); // ponovno uporabimo ID
        if(loginModalOpener) {
             loginModalOpener.addEventListener('click', (e) => {
                 e.preventDefault();
                 showAppDownloadModal();
             });
        }
    }

    // üí° DODATNO: Dodamo listener za standardni gumb za zapiranje modalnega okna 'zapriModal' (√ó)
    const zapriModalGumb = document.getElementById('zapriModal'); 
    if (zapriModalGumb && loginModal) {
        zapriModalGumb.addEventListener('click', () => {
            loginModal.style.display = 'none';
        });
    }

   // ------------------------------------------------------------------
// Logika za preklop zavihka na profil.html s pomoƒçjo URL-ja
// ------------------------------------------------------------------

function preklopiZavihekPoHashu() {
    if (!window.location.pathname.includes('profil.html')) {
        return;
    }

    const ciljniHash = window.location.hash.substring(1);

    // LOGIKA ZA AKTUALNE REZERVACIJE
    if (ciljniHash === 'aktualne-rezervacije') {
        // I≈°ƒçe gumb za zavihek z data-target="aktualne-rezervacije"
        const ciljniGumb = document.querySelector(`.profil-zavihek[data-target="${ciljniHash}"]`); 
        
        if (ciljniGumb) {
            ciljniGumb.click(); 
            history.replaceState(null, null, 'profil.html'); 
        } else {
            console.warn(`Zavihek Aktualne Rezervacije ni bil najden.`);
        }
    }

    // LOGIKA ZA PRILJUBLJENE
        // Hash: #priljubljene
        if (ciljniHash === 'priljubljene') { 
            // I≈°ƒçe gumb za zavihek z data-target="priljubljene"
            const ciljniGumb = document.querySelector(`.profil-zavihek[data-target="priljubljene"]`); 
            
            if (ciljniGumb) {
                ciljniGumb.click(); 
                history.replaceState(null, null, 'profil.html'); 
            } else {
                console.warn(`Zavihek Priljubljene ni bil najden.`);
        }
    }
}

preklopiZavihekPoHashu();
});


// =========================================================================
// ‚≠ê IMPLEMENTACIJA FUNKCIJE ZA PRIKAZ MODALNEGA OKNA ZA PRENOS APLIKACIJE
//    OPOMBA: Ta funkcija poka≈æe MODAL ZA PRENOS, NE za prijavo.
// =========================================================================

function showAppDownloadModal() {
    const loginModal = document.getElementById('loginModal');
    const loginContent = loginModal ? loginModal.querySelector('.login-content') : null;

    if (!loginModal || !loginContent) {
        console.error("Login modal ali vsebina nista bila najdena.");
        return;
    }

    // 1. Zamenjava vsebine z vabilom za prenos aplikacije
    loginContent.innerHTML = `
        <span class="close-modal" id="zapriModalPrenos">√ó</span>
        
        <div class="app-download-content">
            <h2 data-i18n="download.title">Prenesite na≈°o aplikacijo</h2>
            <p data-i18n="download.message">Za prijavo, registracijo in dostop do vseh funkcij je potrebna namestitev na≈°e izvorne aplikacije:</p>
            
            <div class="app-store-links">
                <a href="VA≈†A_POVEZAVA_DO_GOOGLE_PLAY" target="_blank" class="store-link play-store">
                    <i class="fab fa-google-play"></i> 
                    Google Play
                </a>
                <a href="VA≈†A_POVEZAVA_DO_APPLE_APP_STORE" target="_blank" class="store-link app-store">
                    <i class="fab fa-apple"></i>
                    App Store
                </a>
            </div>
            
            <p class="small-info" data-i18n="download.info">Dostop je mogoƒç samo preko aplikacije.</p>
        </div>
    `;

    // 2. Prikaz modalnega okna
    // Uporabimo 'flex' (ali 'block'), ki preglasi 'display: none', nastavljen v bloku !isMobileApp.
    loginModal.style.display = 'flex'; 
    
    // 3. Dodajanje listenerja za zapiranje modalnega okna na novem gumbu
    const zapriModalPrenos = document.getElementById('zapriModalPrenos');
    if (zapriModalPrenos) {
        zapriModalPrenos.addEventListener('click', () => {
            loginModal.style.display = 'none';
        }); 
    }

    // Za≈æenemo funkcijo ob nalaganju strani
    setTimeout(preklopiZavihekPoHashu, 100);
    
}
// ===========================================
// üî• GLAVNA IZVEDBENA KODA - POPRAVLJENA ZA MIKROFON
// ===========================================

// ‚≠ê PREDVIDENI URL ZA KLIC NA VA≈† NODE.JS BACKEND ‚≠ê
// Uporabljamo va≈° potrjeni API Base URL za Render in dodamo pot /assistant/ask
const RENDER_API_BASE_URL = 'https://rentyo-gourmet-spletna-stran.onrender.com/api';
const API_ENDPOINT = `${RENDER_API_BASE_URL}/assistant/ask`;

// ‚≠ê GLOBALNA SPREMENLJIVKA ZA SHRANJEVANJE PRIVZETE POZICIJE MODALA ‚≠ê
let defaultModalBottom = '10vh'; // Varnostna kopija




document.addEventListener('DOMContentLoaded', () => {
    
    const modal = document.getElementById('aiChatModal');
    
    // ‚≠ê LOGIKA ZA PRIDOBITEV IZRAƒåUNANE VREDNOSTI BOTTOM PO ZAGONU (V PIKSLIH) ‚≠ê
    if (modal) {
         // Kratka zamuda, da se prepriƒçamo, da je CSS izraƒçunan
         setTimeout(() => {
            // Pridobite dejansko izraƒçunano vrednost spodnjega roba (v pikslih)
            defaultModalBottom = window.getComputedStyle(modal).bottom;
            console.log('Izraƒçunan privzeti spodnji rob (defaultModalBottom):', defaultModalBottom);
        }, 200);
    }

    // Preverjanje, ali se aplikacija izvaja v Capacitorju
    if (window.Capacitor) {
        document.body.classList.add('is-capacitor-app');
        
        // ‚≠ê POSLU≈†ALCI ZA CAPACITOR TIPKOVNICO ‚≠ê
        if (window.Capacitor.Plugins && window.Capacitor.Plugins.Keyboard) {
            
            // Poslu≈°alec za Android/iOS, ko se tipkovnica poka≈æe
            Capacitor.Plugins.Keyboard.addListener('keyboardWillShow', info => {
                console.log('Tipkovnica se prikazuje, vi≈°ina:', info.keyboardHeight);
                // Posredujemo shranjeno privzeto vrednost
                handleKeyboard(true, info.keyboardHeight);
            });

            // Poslu≈°alec, ko se tipkovnica skrije
            Capacitor.Plugins.Keyboard.addListener('keyboardWillHide', () => {
                console.log('Tipkovnica se skriva.');
                handleKeyboard(false, 0);
            });
        }
        // ------------------------------------------
    }

    if (modal) {
        // Skrij modal ob zagonu (ƒçe CSS ni bil dovolj)
        modal.style.display = 'none';
        
        // ‚≠ê PRIPENJANJE FUNKCIONALNOSTI VNOSNEGA POLJA ‚≠ê
        // üî• POPRAVLJENO: Uporabimo ID-je za natanƒçno izbiro!
        const sendButton = modal.querySelector('#send-button');
        const inputField = modal.querySelector('#user-input'); // Predvidevam, da je ID dodan v HTML
        const micButton = modal.querySelector('#mic-button');

        if (sendButton && inputField) {
            // Pripenjanje funkcije na klik gumba Po≈°lji
            sendButton.addEventListener('click', handleSend);
            
            // Pripenjanje funkcije na pritisk tipke Enter v polju
            inputField.addEventListener('keypress', (event) => {
                // Preverimo, ƒçe je pritisnjena tipka Enter (kljuƒçno za klepetalnice)
                if (event.key === 'Enter') {
                    handleSend();
                    event.preventDefault(); // Prepreƒçi standardno obna≈°anje (npr. submit forme)
                }
            });
        }
        
        // ‚≠ê PRIKLOP FUNKCIONALNOSTI MIKROFONA ‚≠ê
        // POVEZANO NA NOVO FUNKCIJO startVoiceInput (definirana spodaj)
        if (micButton && typeof startVoiceInput === 'function') {
             micButton.addEventListener('click', startVoiceInput);
             console.log("‚úÖ Gumb za mikrofon je povezan s funkcijo startVoiceInput.");
        } else if (micButton) {
             console.warn("‚ùå Manjka funkcija startVoiceInput za mikrofon! (Preverite definicijo)");
        }
    }
    
    // ‚≠ê DODATEN KORAK: Zapiranje okna s tipko ESCAPE (izbolj≈°a UX)
    document.addEventListener('keydown', (event) => {
        if (modal && modal.style.display === 'block' && event.key === 'Escape') {
            toggleChat();
        }
    });
    
    // ‚≠ê KLJUƒåNO POPRAVILO: ZA≈ΩENEMO PRIDOBIVANJE LOKACIJE OB ZAGONU APLIKACIJE ‚≠ê
    // Pokliƒçemo jo s forceRefresh=true, da se posodobi iz localStorage/API.
    setTimeout(() => {
         getUserLocation(true);
    }, 1000);

});


/**
 * ‚≠ê NOVA FUNKCIJA: Prepoznavanje govora in po≈°iljanje na chat.
 * POSODOBLJENO: Prioritetna uporaba Capacitor Speech Recognition Vtiƒçnika (za re≈°evanje 'not allowed' napake).
 */
async function startVoiceInput() {
    const isCapacitorSR = window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.SpeechRecognition;
    const inputField = document.querySelector('#aiChatModal #user-input');
    const micButton = document.querySelector('#mic-button');
    const selectedLang = (typeof i18next !== 'undefined' && i18next.language) ? i18next.language : 'sl';
    const originalPlaceholder = selectedLang.startsWith('en') ? "Enter message..." : "Vnesite sporoƒçilo...";

    // --- Pomo≈æni funkciji za vizualno stanje ---
    const setListeningState = (isListening) => {
        if (isListening) {
            micButton.classList.add('recording');
            inputField.placeholder = "Poslu≈°am... Govorite, prosim...";
        } else {
            micButton.classList.remove('recording');
            inputField.placeholder = originalPlaceholder;
        }
    };
    // ---------------------------------------------


    // 1. ZAGON V CAPACITOR OKOLJU (ƒåe je vtiƒçnik SpeechRecognition name≈°ƒçen)
    if (isCapacitorSR) {
        try {
             const { SpeechRecognition } = window.Capacitor.Plugins;
             
             // Dinamiƒçna zahteva dovoljenja
             const available = await SpeechRecognition.available();
             if (!available.available) {
                 alert("Capacitor Speech Recognition ni na voljo na tej napravi.");
                 return;
             }
             
             const permission = await SpeechRecognition.requestPermission();
             
             if (permission.permission !== 'granted') {
                 alert("Dovoljenje za mikrofon je zavrnjeno s strani uporabnika.");
                 return;
             }
             
             // Za≈æenemo poslu≈°anje
             setListeningState(true);

             const options = {
                 language: selectedLang,
                 partialResults: false
             };

             SpeechRecognition.start(options)
                .then(result => {
                    setListeningState(false);
                    const transcript = result.matches[0];
                    if (transcript && transcript.trim() !== "") {
                        inputField.value = transcript;
                        handleSend();
                    }
                })
                .catch(error => {
                    setListeningState(false);
                    console.error('Capacitor Speech Recognition napaka:', error);
                    alert(`Capacitor Speech Recognition napaka: ${error.message}`);
                });
             
             return;
        
        } catch (error) {
            console.warn("Capacitor SpeechRecognition vtiƒçnik ne deluje. Posku≈°am Web Speech API.", error);
            // Nadaljujemo z brskalni≈°kim API-jem (toƒçka 2)
        }
    }


    // 2. ZAGON V BRSKALNIKU (Web Speech API - fallback)
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        alert("≈Ωal mi je, prepoznavanje govora ni podprto v tem brskalniku (potreben je HTTPS ali pa ni podprto).");
        return;
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = selectedLang;

    setListeningState(true);
    recognition.start();

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        if (transcript.trim() !== "") {
             inputField.value = transcript;
             handleSend();
        }
    };

    recognition.onerror = (event) => {
        setListeningState(false);
        console.error('Napaka pri prepoznavanju govora:', event.error);
        alert(`Napaka pri prepoznavanju govora: ${event.error}. Preverite, ali je brskalnik dovolil uporabo mikrofona.`);
    };

    recognition.onend = () => {
        setListeningState(false);
    };
}


/**
 * Funkcija preklopi vidnost pogovornega okna (Kliƒçe se iz HTML onclick="toggleChat()").
 * ‚≠ê POSODOBLJENO: Dodano preverjanje in uvodno sporoƒçilo (Leo).
 */
function toggleChat() {
    // 1. Poi≈°ƒçi element pogovornega okna in telo klepetalnice
    const modal = document.getElementById('aiChatModal');
    // Uporaba ID-ja na input fieldu
    const inputField = modal ? modal.querySelector('#user-input') : null;
    const chatBody = modal ? modal.querySelector('.chat-body') : null; // ‚≠ê NOVO
    
    const isCapacitor = (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.Keyboard);

    if (!modal || !chatBody) {
        console.error("Pogovorno okno ali telo klepetalnice ni najdeno.");
        return;
    }

    // 2. Preveri trenutno stanje in ga preklopi
    if (modal.style.display === 'block') {
        // Skrij okno
        modal.style.display = 'none';
        
        // ‚≠ê NOVO: Skrij tipkovnico ob zaprtju ‚≠ê
        if (isCapacitor) {
            Capacitor.Plugins.Keyboard.hide();
        }
        
        console.log('Pogovorno okno zaprto.');
    } else {
        // Prika≈æi okno
        modal.style.display = 'block';
        
        // ‚≠ê POPRAVEK: LOKALIZACIJA UVODNEGA SPOROƒåILA ‚≠ê
        if (chatBody.children.length === 0) {
            
            // Pridobitev trenutnega jezika (privzeto na 'sl')
            const currentLang = (typeof i18next !== 'undefined' && i18next.language) ? i18next.language : 'sl';
            
            let welcomeMessage;
            if (currentLang.startsWith('en')) {
                welcomeMessage = "Hello! I am Leo, your personal gourmet assistant. How can I help you today?";
            } else {
                welcomeMessage = "Pozdravljen/a! Sem Leo, tvoj osebni gurmanski asistent. Kako ti lahko pomagam danes?";
            }
            
            appendMessage(welcomeMessage, 'ai');
        }
        
        if (inputField) {
            // 1. Fokusiraj vnosno polje
            inputField.focus();
            
            // ‚≠ê NOVO: Prika≈æi tipkovnico ob odprtju ‚≠ê
            // Uporabimo setTimeout, da se prepriƒçamo, da je modal in fokus polja res stabilen, preden se odpre tipkovnica.
            if (isCapacitor) {
                 setTimeout(() => {
                    Capacitor.Plugins.Keyboard.show();
                 }, 50); // Kratka zamuda
            }
        }
        
        console.log('Pogovorno okno odprto.');
    }
}

/**
 * ‚≠ê POSODOBLJENA FUNKCIJA: Dodajanje sporoƒçila v pogovorno okno ‚≠ê
 * @param {string} text Sporoƒçilo, ki ga je treba prikazati.
 * @param {string} sender Po≈°iljatelj ('user' ali 'ai').
 * @param {boolean} isLoading Ali je to sporoƒçilo za nalaganje (ƒçe je, mu dodamo poseben ID/razred).
 */
function appendMessage(text, sender, isLoading = false) {
    const chatBody = document.querySelector('#aiChatModal .chat-body');
    if (!chatBody) return;

    // ƒåe je to sporoƒçilo za nalaganje IN ≈æe obstaja, ga ne dodajamo dvakrat
    if (isLoading && document.getElementById('ai-loading-message')) {
        return;
    }
    
    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message', sender + '-message');
    
    if (isLoading) {
        messageElement.id = 'ai-loading-message'; // Unikaten ID za la≈æje odstranjevanje
        messageElement.innerHTML = `<p>${text}<span class="loading-dots">. . .</span></p>`; // Dodamo pikice
    } else {
        messageElement.innerHTML = `<p>${text}</p>`;
    }
    
    chatBody.appendChild(messageElement);

    // Samodejno pomikanje na dno (ƒçe je vsebina dalj≈°a)
    chatBody.scrollTop = chatBody.scrollHeight;
}

/**
 * ‚≠ê NOVA FUNKCIJA: Za odstranitev sporoƒçila o nalaganju ‚≠ê
 */
function removeLoadingMessage() {
    const loadingMessage = document.getElementById('ai-loading-message');
    if (loadingMessage) {
        loadingMessage.remove();
    }
}


// ‚≠ê ZAMENJANA FUNKCIJA: HIBRIDNA FUNKCIJA ZA PRIDOBIVANJE UPORABNIKOVE LOKACIJE (ZA KARTICE IN AI) ‚≠ê
/**
 * Pridobi trenutno geolokacijo uporabnika z uporabo Capacitor ali Web API.
 * Posodobi globalno 'userLocation' (za kartice) in vrne format za AI ({ userLat, userLon }).
 * @param {boolean} forceRefresh Ali naj ignorira localStorage in prisili posodobitev.
 */
async function getUserLocation(forceRefresh = false) {
    
    // Pomo≈æna funkcija za obdelavo uspe≈°ne pozicije in posodobitev globalnega stanja
    const handleSuccess = (lat, lon) => {
        // ‚≠ê KLJUƒåNO ZA KARTICE: Nastavi GLOBALNO userLocation z lat/lon kljuƒçi ‚≠ê
        userLocation = { lat: lat, lon: lon };
        localStorage.setItem('userLocation', JSON.stringify(userLocation));
        console.log(`‚úÖ Lokacija uspe≈°no pridobljena in shranjena globalno: ${lat}, ${lon}`);
        
        // ‚≠ê Prika≈æe KM na karticah, ƒçe obstaja funkcija filterAndRenderRestavracije() ‚≠ê
        if (typeof filterAndRenderRestavracije === 'function') {
             filterAndRenderRestavracije();
        }
        
        // Vrni format, ki ga AI Chat priƒçakuje
        return { userLat: lat, userLon: lon };
    };

    const handleError = (message) => {
        console.warn(`‚ùå Napaka pri pridobivanju lokacije: ${message}`);
        userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON }; // Nastavi privzeto lokacijo za kartice
        // Tukaj se pokliƒçe funkcija prikaziSporocilo, ƒçe obstaja
        if (typeof prikaziSporocilo === 'function') {
             prikaziSporocilo('Lokacija ni na voljo. Razdalje so izraƒçunane iz privzete toƒçke.', 'warning');
        }
        return null;
    };
    
    // 1. Preveri Stored Location
    const storedLocation = localStorage.getItem('userLocation');
    if (storedLocation && !forceRefresh) {
        userLocation = JSON.parse(storedLocation);
        console.log("Lokacija pridobljena iz localStorage.");
        return { userLat: userLocation.lat, userLon: userLocation.lon };
    }
    
    // --- 2. Capacitor (za mobilno aplikacijo) ---
    if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.Geolocation) {
        try {
            const { Geolocation } = window.Capacitor.Plugins;
            
            // üî• POPRAVEK: enableHighAccuracy: TRUE za uporabo GPS-a üî•
            const position = await Geolocation.getCurrentPosition({ 
                enableHighAccuracy: true,    // Uporaba GPS za natanƒçnost do nekaj metrov
                timeout: 15000,              // Poveƒçan timeout (15 sekund) za dalj≈°e iskanje satelitov
                maximumAge: 0                // Prisilimo napravo, da ne uporabi stare lokacije
            });
            
            return handleSuccess(position.coords.latitude, position.coords.longitude);
        } catch (error) {
            console.error('‚ùå Napaka pri pridobivanju geolokacije (Capacitor):', error.message);
            // Nadaljujemo z Web API kot rezervo
        }
    }
    
    // --- 3. Web API (za brskalnik/PWA in rezervo v Capacitor) ---
    if ('geolocation' in navigator) {
        // Uporabite Promise za obdelavo asinhronosti
        return new Promise((resolve) => {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    resolve(handleSuccess(position.coords.latitude, position.coords.longitude));
                },
                (error) => {
                    resolve(handleError(error.message));
                },
                { enableHighAccuracy: false, timeout: 5000, maximumAge: 0 }
            );
        });
    }

    // --- 4. Konƒçni Neuspeh ---
    return handleError("Geolokacija ni podprta in ni shranjena.");
}


/**
 * ‚≠ê POSODOBLJENA ASINHRONA FUNKCIJA: Po≈°lje sporoƒçilo na backend in prika≈æe odgovor,
 * vkljuƒçno z geolokacijo, ƒçe je na voljo. ‚≠ê
 * * @param {string} prompt Sporoƒçilo uporabnika.
 * @param {string} languageCode Koda izbranega jezika ('sl', 'en', itd.). <--- NOVI PARAMETER
 */
async function fetchAiResponse(prompt, languageCode) {
    
    // ‚≠ê POPRAVEK: LOKALIZACIJA LOADING SPOROƒåILA ‚≠ê
    let loadingText;
    if (languageCode.startsWith('en')) {
        loadingText = "Leo";
    } else {
        loadingText = "Leo";
    }
    
    // 1. Prikaz "loading" sporoƒçila od AI, dokler ƒçaka na odgovor
    appendMessage(loadingText, 'ai', true);

    // ‚≠ê NOVI KORAK: POSKUS PRIDOBITVE LOKACIJE ‚≠ê
    // Kliƒçemo brez forceRefresh=true, da se uporabi ≈æe shranjena lokacija, razen ƒçe je napaka
    const locationData = await getUserLocation();
    
    // Priprava telesa zahteve - vedno vkljuƒçi prompt
    const requestBody = {
        prompt: prompt,
        languageCode: languageCode // <--- DODANO: KODA JEZIKA
    };
    
    // Dodamo koordinate, ƒçe so bile uspe≈°no pridobljene
    if (locationData) {
        requestBody.userLat = locationData.userLat;
        requestBody.userLon = locationData.userLon;
    }
    
    try {
        const response = await fetch(API_ENDPOINT, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            // ‚≠ê SPREMENJENO: Sedaj po≈°lje prompt, languageCode, userLat in userLon
            body: JSON.stringify(requestBody),
        });

        // Preverimo, ali je bil klic uspe≈°en (Status koda 200)
        if (!response.ok) {
            // Poskusimo dobiti podrobnej≈°o napako s stre≈ænika
            const errorText = await response.text();
            let errorMessage = `Status ${response.status}. Napaka na stre≈æniku.`;
            
            // Izbolj≈°ana obravnava napak, ki zajame HTML (Unexpected token <)
            try {
                const errorData = JSON.parse(errorText);
                errorMessage = errorData.error || errorMessage;
            } catch {
                // ƒåe je odgovor HTML, poka≈æemo informativnej≈°e sporoƒçilo
                if (errorText.trim().startsWith('<')) {
                     errorMessage = `Napaka pri komunikaciji: Stre≈ænik ni vrnil JSON-a. Preverite, ali je API pot pravilna: ${API_ENDPOINT}`;
                } else {
                     errorMessage = `Status ${response.status}. Napaka: ${errorText}`;
                }
            }
            throw new Error(errorMessage);
        }

        const data = await response.json();
        
        // 2. Poƒçistimo zaƒçasno sporoƒçilo in prika≈æemo pravi odgovor
        removeLoadingMessage();
        appendMessage(data.answer, 'ai'); // Prika≈æemo pravi odgovor
        
    } catch (error) {
        // Obravnavamo morebitne napake (omre≈æje, napaƒçen kljuƒç, stre≈ænik)
        console.error('Napaka pri komunikaciji z AI API-jem:', error);
        removeLoadingMessage();
        appendMessage(`≈Ωal mi je, pri≈°lo je do napake: ${error.message}. Prosim, poskusite znova. üòî`, 'ai');
    }
}


/**
 * ‚≠ê IZBOLJ≈†ANA FUNKCIJA: Obravnava po≈°iljanje sporoƒçila (zdaj kliƒçe backend API) ‚≠ê
 */
function handleSend() {
    // üî• POPRAVLJENO: Uporabimo ID za pridobitev vnosnega polja
    const inputField = document.querySelector('#aiChatModal #user-input');
    // Uporabimo .trim() za odstranitev belih presledkov in preverjanje, ali je vnos prazen
    const message = inputField.value.trim();
    
    if (message !== "") {
        // 1. Prikaz uporabnikovega sporoƒçila TAKOJ
        appendMessage(message, 'user');
        
        // 2. Poƒçistimo vnosno polje
        inputField.value = '';

        // ‚≠ê NOVO: Pridobitev trenutnega jezika preko i18next ‚≠ê
        // ƒåe i18next.language ni na voljo (ali i18next ≈°e ni inicializiran), privzeto uporabimo 'sl'.
        const selectedLang = (typeof i18next !== 'undefined' && i18next.language) ? i18next.language : 'sl';
        
        console.log('Sporoƒçilo poslano AI-ju v jeziku:', selectedLang);
        
        // 3. KLIC NA DEJANJSI AI API - POSREDUJEMO JEZIK
        fetchAiResponse(message, selectedLang); // <--- SPREMENJEN TUKAJ
    }
}


/**
 * ‚≠ê POPRAVLJENA FUNKCIJA: Prilagodi pozicijo pogovornega okna, ko se prika≈æe virtualna tipkovnica.
 */
function handleKeyboard(isOpen, keyboardHeight) {
    const modal = document.getElementById('aiChatModal');
    if (!modal) return;

    // Uporabimo shranjeno izraƒçunano vrednost iz DOMContentLoaded
    const modalBottomDefault = defaultModalBottom;
    
    // Nastavimo samo, ƒçe je aplikacija Capacitor in modal je prikazan
    if (window.Capacitor && modal.style.display === 'block') {
        
        // Opomba: CSS je ≈æe nastavljen z 'transition: bottom 0.3s ease-out'
        
        if (isOpen) {
            // Dodamo majhen varnostni rob, da se vnosno polje ne dotika tipkovnice.
            const OFFSET = 10;
            
            // Tipkovnica je odprta
            // Spodnji rob se premakne navzgor za vi≈°ino tipkovnice + rob
            modal.style.bottom = `${keyboardHeight + OFFSET}px`;
            
        } else {
            // Tipkovnica je zaprta

            // Vrnemo se na prvotno pozicijo (CSS nato doda env(safe-area-inset-bottom))
            modal.style.bottom = modalBottomDefault;
        }
    }
}
// ******************************************************************
// FUNKCIJA ZA NAVIGACIJO (Google Maps APP OPEN) - POPRAVLJENA
// ******************************************************************

function startNavigation(buttonElement) {
    
    // Sprememba: Koordinate beremo direktno iz data-atributov prejetega gumba (buttonElement)
    let lat = parseFloat(buttonElement.getAttribute('data-lat'));
    let lon = parseFloat(buttonElement.getAttribute('data-lon'));
    
    // Prej≈°nje branje globalnih spremenljivk se odstrani, saj je nezanesljivo.
    // let lat = globalRestaurantLat; 
    // let lon = globalRestaurantLon;

    if (isNaN(lat) || isNaN(lon) || lat === 0 || lon === 0) { 
        console.error("Koordinate restavracije niso na voljo. Preverite data-atribute gumba.");
        alert("Koordinat restavracije ni mogoƒçe najti.");
        return;
    }
    
    // 1. Definicija URL-jev z zagotovljenim formatom LAT, LON
    
    // A. Deep Link (Zagon nativne aplikacije)
    const deepLinkUrl = `geo:${lat},${lon}?q=${lat},${lon}`;
    
    // B. Fallback URL za splet (Popravljen URL)
    // Uporabite standardni Google Maps URL za smer:
    const fallbackWebUrl = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}&travelmode=driving`;
    // Opomba: ƒåe ≈æelite, da je zaƒçetni polo≈æaj **vedno** lokacija uporabnika, je ta URL najbolj≈°i.

    // 2. Zagon navigacije
    try {
        if (window.Capacitor) {
            console.log("Posku≈°am zagnati navigacijo (Deep Link):", deepLinkUrl);
            window.open(deepLinkUrl, '_system');
        } else {
            console.log("Posku≈°am zagnati navigacijo (Web Fallback):", fallbackWebUrl);
            window.open(fallbackWebUrl, '_blank'); 
        }

    } catch (e) {
        console.error("Napaka pri zagonu navigacije:", e);
        alert("Pri≈°lo je do napake pri zagonu navigacije. Poskusite znova.");
        window.open(fallbackWebUrl, '_blank');
    }
}
// window.startNavigation = startNavigation;
// Ta koda mora iti V DATOTEKO INDEX.HTML

document.addEventListener('DOMContentLoaded', async () => {
    // 1. Preverimo, ƒçe je v URL-ju ID za odpiranje restavracije
    const urlParams = new URLSearchParams(window.location.search);
    const restavracijaIdZaOdpiranje = urlParams.get('openRestavracijaId');

    if (restavracijaIdZaOdpiranje) {
        
        let restavracijaObjekt = null;
        
        // 2. Poskusimo pridobiti celoten objekt restavracije (Potrebujemo ga za prikaziPodrobnosti)
        if (typeof getFullRestaurantDetails === 'function') {
            restavracijaObjekt = await getFullRestaurantDetails(restavracijaIdZaOdpiranje);
        } else {
            console.warn('OPOZORILO: Funkcija getFullRestaurantDetails ni najdena. Modal se ne bo mogel odpreti z vsemi podrobnostmi.');
        }

        // 3. Preverimo, ali smo dobili objekt in ali je funkcija definirana
        // üî• POPRAVEK: Uporabljamo va≈°e dejansko ime funkcije prikaziPodrobnosti
        if (restavracijaObjekt && typeof prikaziPodrobnosti === 'function') {
            
            // 4. Odstranimo ID iz URL-ja (za ƒçistej≈°i URL)
            history.replaceState(null, '', location.pathname);

            // 5. Pokliƒçemo va≈°o funkcijo za odpiranje modala z CELOTNIM OBJEKTOM
            await prikaziPodrobnosti(restavracijaObjekt);
            
        } else if (restavracijaObjekt) {
            console.error('Napaka: Funkcija prikaziPodrobnosti ni definirana v index.html.');
        } else {
            console.warn('OPOZORILO: Restavracija s tem ID-jem ni bila najdena.');
        }
    }
    // ... ostala DOMContentLoaded koda v index.html
});




</script>
    <div id="toaster-container">
    </div>

</body>
</html>