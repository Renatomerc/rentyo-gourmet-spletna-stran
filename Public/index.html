<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="app.title">Iskanje Restavracij - Gourmet & Experience</title>

  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
  />
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.11.5/i18next.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-http-backend/2.5.2/i18nextHttpBackend.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.1/i18nextBrowserLanguageDetector.min.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
    /*
     * ========================================================================
     * I. STILI ZA PASICO PI≈†KOTKOV (KRITIƒåNI STILI - NA ZAƒåETKU)
     * ========================================================================
     */
    
    /* Osnovno resetiranje/stil za celotno stran - prilagojeno va≈°emu telesu */
    body {
        font-family: Arial, sans-serif;
    }

    /* Pasica za soglasje (glavni vsebnik) */
    .cookie-banner {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 50;
        padding: 1rem; /* p-4 */
        transition: all 0.5s ease-in-out;
    }

    /* Stanje, ko je pasica skrita */
    .cookie-banner.hidden {
        display: none;
    }

    /* Kontejner vsebine pasice */
    .banner-content {
        max-width: 64rem; /* max-w-4xl (1024px) */
        margin-left: auto;
        margin-right: auto;
        background-color: #ffffff; /* bg-white */
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
        border-radius: 3rem; /* rounded-lg */
        padding: 1.25rem; /* p-5 */
        display: flex;
        flex-direction: column; /* flex-col */
        align-items: center;
        justify-content: space-between;
        row-gap: 0.75rem; /* space-y-3 */
        border: 2px solid #333;
    }

    /* Prilagoditev za veƒçje zaslone (md:flex-row) */
    @media (min-width: 768px) {
        .banner-content {
            flex-direction: row;
            row-gap: 0;
        }
    }

    /* Skupina besedila in ikone */
    .banner-text-group {
        display: flex;
        align-items: center;
        column-gap: 0.75rem; /* space-x-3 */
        color: #4b5563; /* text-gray-700 */
    }

    /* Ikona pi≈°kotka */
    .icon-cookie {
        height: 1.5rem; /* h-6 */
        width: 1.5rem; /* w-6 */
        color: #4edaa9; /* text-emerald-500 */
        flex-shrink: 0;
    }

    /* Sporoƒçilo */
    .text-message {
        font-size: 0.875rem; /* text-sm */
        margin: 0;
    }

    /* Povezava "Preberi veƒç" */
    .link-more-info {
        color: #4edaa9; /* text-emerald-600 */
        font-weight: 500; /* font-medium */
        margin-left: 0.25rem; /* ml-1 */
        text-decoration: none;
        transition: color 150ms ease-in-out;
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .link-more-info:hover {
        color: #4edaa9; /* hover:text-emerald-800 */
    }

    /* Skupina gumbov */
    .banner-button-group {
        display: flex;
        column-gap: 0.75rem; /* space-x-3 */
        flex-shrink: 0;
    }

    /* Osnovni stil za gumbe */
    .banner-button-group button {
        padding: 0.5rem 1rem; /* px-4 py-2 */
        font-size: 0.875rem; /* text-sm */
        font-weight: 600; /* font-semibold */
        border-radius: 5rem; /* rounded-lg */
        transition: background-color 150ms ease-in-out, box-shadow 150ms ease-in-out;
        border: none;
        cursor: pointer;
        /* Odstrani moder poudarek za mobilne naprave */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    /* Gumb za zavrnitev (Decline) */
    .btn-decline {
        color: #4b5563; /* text-gray-600 */
        background-color: #f3f4f6; /* bg-gray-100 */
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .btn-decline:hover {
        background-color: #e5e7eb; /* hover:bg-gray-200 */
    }

    /* Gumb za sprejem (Accept) */
    .btn-accept {
        color: #ffffff; /* text-white */
        background-color: #4edaa9; /* bg-emerald-600 */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-md */
    }

    .btn-accept:hover {
        background-color: #27a378; /* hover:bg-emerald-700 */
    }

    /* Animacija, da se pasica elegantno pojavi (slide-in-up) */
    .slide-in-up {
        animation: slideInUp 0.5s ease-out forwards;
    }
    @keyframes slideInUp {
        from { 
            transform: translateY(100%); 
            opacity: 0; 
        }
        to { 
            transform: translateY(0); 
            opacity: 1; 
        }
    }
    
    /*
     * ========================================================================
     * II. OSTALI STILI (MODALI, KARTICE, ITD.)
     * ========================================================================
     */

    /* ===== MODAL ZA PRIJAVO / REGISTRACIJO (OSTANE NESPREMENJENO) ===== */
    .login-modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      overflow-y: auto; 
    }

    .login-modal.active {
      display: flex;
    }

    .login-content {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      width: 350px;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      animation: fadeIn 0.3s ease;
      margin: 50px auto; 
    }

    @media (max-width: 600px) {
        .login-content {
            padding: 20px;
            margin: 20px auto;
        }
    }


    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-tabs {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .login-tab {
      flex: 1;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
      border-bottom: 2px solid transparent;
      transition: 0.2s;
                /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .login-tab.active {
      
      color: #20c0bd;
      border-bottom: 2px solid #20c0bd; /* Dodan border za aktiven tab */
    }

    .login-form {
      display: none;
    }

    .login-form.active {
      display: block;
    }

    .login-form input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      /* POPRAVEK ZA ZOOM: Nastavimo velikost pisave na 16px, da prepreƒçimo avtomatsko poveƒçavo */
      font-size: 16px !important; 
    }

    /* ----------------------------------------------------------------- */
    /* üî• NOVI STILI ZA POGOJE IN ONEMOGOƒåEN GUMB üî• */
    /* ----------------------------------------------------------------- */

    .form-group-checkbox {
        display: flex;
        align-items: flex-start; /* Poravnaj kljukico in besedilo na zaƒçetek */
        margin-bottom: 15px; /* Dodamo malo razmika pod kljukico */
        text-align: left;
    }

    .form-group-checkbox input[type="checkbox"] {
        width: auto; /* Kljukica naj ne zavzame celotne ≈°irine */
        margin-right: 8px;
        margin-top: 3px; /* Lahka prilagoditev za vertikalno poravnavo */
        border-radius: 4px;
        accent-color: #20c0bd; /* Barva kljukice */
                  /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .form-group-checkbox label {
        font-size: 0.85rem;
        color: #555;
        line-height: 1.4;
        cursor: pointer;
                  /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .form-group-checkbox a {
        color: #20c0bd;
        font-weight: bold;
        text-decoration: none;
        transition: color 0.2s;
        
    }

    .form-group-checkbox a:hover {
        color: #169b99;
        text-decoration: underline;
        
    }

    .required-star {
        color: red;
        margin-left: 2px;
        font-weight: bold;
    }

    /* Stil za gumb za oddajo */
    .login-form button {
      width: 100%; /* Nastavite ≈°irino na 100% za bolj≈°i mobilni videz */
      padding: 10px;
      border: none;
      border-radius: 8px;
      background-color: #20c0bd;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
                /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .login-form button:hover:not(:disabled) {
      background-color: #169b99;
    }

    /* Poseben stil, ko je gumb onemogoƒçen (disabled) */
    .login-form button:disabled {
        background-color: #cccccc; /* Svetlo siva, da je oƒçitno onemogoƒçeno */
        color: #888888;
        cursor: not-allowed;
        box-shadow: none;
    }
    /* ----------------------------------------------------------------- */
    /* üî• KONEC NOVIH STILOV üî• */
    /* ----------------------------------------------------------------- */

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
      color: #333;
      border-radius: 50%;
      display: flex; /* Uporabimo flexbox za centriranje X-a */
      justify-content: center; /* Centriraj X horizontalno */
      align-items: center; /* Centriraj X vertikalno */
      transition: background-color 0s ease, color 0s ease;
      z-index: 10000;

      /* >>> KLJUƒåNE SPREMEMBE ZA CENTRIRANJE ZNAKA 'X' <<< */
      line-height: 1; /* Pomembno: Odstranimo privzeti razmik vrstic, ki potiska X navzdol */
      /* ƒåe je X ≈°e vedno malo previsoko/prenizko, lahko prilagodite s tem: */
      /* transform: translateY(-1px); */ /* Poskusi to, ƒçe je potrebno malo navzgor/navzdol */
    }

      
        
        /* ===== MODAL ZA TRAJANJE OBISKA (NOV STIL) ===== */
        .duration-modal {
          display: none;
          position: fixed;
          z-index: 9999;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7); /* Temnej≈°e ozadje za opozorilo */
          justify-content: center;
          align-items: center;
          overflow-y: auto;
        }

        .duration-modal.active {
          display: flex;
        }

        .duration-content {
          background: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 380px;
          max-width: 90%;
          text-align: left;
          box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
          position: relative;
          animation: fadeIn 0.3s ease;
          margin: 50px auto;
        }

        .duration-content h3 {
            color: #4edaa9;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4rem;
            text-align: center;
        }

        .duration-content label {
            display: block;
            margin-bottom: 0px;
            font-weight: bold;
            color: #333;
            font-size: 0.9rem;
        }
        
        .duration-opcije {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .duration-opcija {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #333;
        }
        
        .duration-opcija:hover {
            border-color: #4edaa9;
            background-color: #ffffff;
        }

        .duration-opcija input[type="radio"] {
            margin-right: 15px;
            /* Skrijemo standardni radio gumb in ga stiliziramo */
            appearance: none; 
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #aaa;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }
        
        .duration-opcija input[type="radio"]:checked {
            border-color: #333;
        }
        
        .duration-opcija input[type="radio"]:checked::before {
            content: '';
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block;
        }
        
        .duration-opcija.selected {
            border-color: #4edaa9;
            background-color: #4edaa9; /* Dodamo rahel odtenek za bolj≈°o vidljivost izbrane opcije */
            /* Zamenjaj barvo poudarka za la≈æjo berljivost */
            border-color: #4edaa9; 
            /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }
        
        .duration-opcija.selected input[type="radio"]:checked {
            border-color: #333;
        }

        .duration-opcija.selected input[type="radio"]:checked::before {
            background-color: #333;
        }


        .gumb-potrdi-trajanje {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #4edaa9;
            color: #333;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }

        .gumb-potrdi-trajanje:hover {
            background-color: #33b688;
        }
        
        /* ======================================================= */
        /* V. CUSTOM WARNING MODAL - NOVO OBLIKOVANJE ZA OPOZORILO */
        /* ======================================================= */
        
        .warning-modal {
          display: none;
          position: fixed;
          z-index: 10000; /* Najvi≈°ji z-index */
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          justify-content: center;
          align-items: center;
          overflow-y: auto;
          /* Dopolnitev stila za animacijo ob prikazu/skrivanju */
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        .warning-modal.active {
          display: flex;
          opacity: 1;
        }

        .warning-content {
          background: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 350px;
          max-width: 90%;
          text-align: center;
          box-shadow: 0 5px 30px rgba(0, 0, 0, 0.4);
          position: relative;
          animation: fadeIn 0.3s ease;
          margin: 50px auto;
          /* Dopolnitev: ƒåe je modal aktiven, se animacija izvede */
          transform: scale(0.95);
          transition: transform 0.3s ease;
        }

        .warning-modal.active .warning-content {
            transform: scale(1);
        }
        
        .warning-icon-wrapper {
            margin: 0 auto 20px;
            width: 60px;
            height: 60px;
            background-color: #ffedcc; /* Svetlo rumeno/oran≈æno ozadje */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ffcc66;
        }

        .warning-icon {
            font-size: 32px;
            color: #ff9900; /* Moƒçna oran≈æna barva ikone (fas fa-exclamation-triangle) */
        }

        .warning-content h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .warning-content p {
            color: #555;
            margin-bottom: 25px;
        }

        .gumb-razumem {
            width: 60%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background-color: #20c0bd; /* Uporabimo glavno barvo projekta */
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .gumb-razumem:hover {
            background-color: #169b99;
        }

        /* ===== GUMBI V GLAVI (OSTANE NESPREMENJENO) ===== */
        .gumb-prijava, 
        .gumb-profil, 
        /*... ostalo oblikovanje od tu naprej ostane popolnoma nespremenjeno ...*/
        .gumb-odjava {
          display: inline-flex;
          align-items: center;
          gap: 5px;
          padding: 4px 12px;
          border-radius: 25px;
          font-weight: bold;
          text-decoration: none;
          transition: background-color 0.2s, color 0.2s, border-color 0.2s;
          white-space: nowrap;
          font-size: 14px;
        }

        .gumb-prijava,
        .gumb-profil {
          background-color: #575757;
          color: white;
          border: 1px solid #575757;
        }

        .gumb-prijava:hover, 
        .gumb-profil:hover {
          background-color: #575757;
          border-color: #575757;
        }
        
        .gumb-odjava {
          background-color: transparent;
          color: #575757;
          border: 1px solid #575757;
        }
        
        .gumb-odjava:hover {
          background-color: #dadada;
          color: #575757;
          border-color: #575757;
        }

        .profil-ovoj {
          display: flex;
          align-items: center;
          gap: 10px; 
        }
        
      /* ===== KARTICA RESTAVRACIJE (PRILJUBLJENO - VEƒåJA KARTICA) ===== */
        .kartica {
            border: 1px solid #9b9b9b;
            border-radius: 10px;
            overflow: hidden; 
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.00);
            transition: transform 0.0s, box-shadow 0.0s;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }

        .kartica:hover {
            transform: translateY(0px);
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.0);
        }

        .kartica-slika {
            width: 100%;
            height: 150px; 
            object-fit: cover;
            background-color: #f5f5f5; 
        }

        .kartica-vsebina {
            padding: 15px;
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
        }

        .kartica-vsebina h3 {
            font-size: 0.9rem; 
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        /* NOVI STIL: Ovoj za oceno in oddaljenost */
        .info-ocena-oddaljenost {
            display: flex;
            flex-wrap: wrap; /* Kljuƒçno za prelom vrstice */
            justify-content: space-between; /* Kljuƒçno za loƒçitev ocene in razdalje */
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 0px solid #e0e0e0;
        }

        .kartica-vsebina .ocena {
            /* INTERNA OCENA: Order 1 (levo zgoraj) */
            order: 1; 
            font-size: 0.8rem;
            color: #333; 
            margin: 0;
            font-weight: bold;
        }

        .kartica-vsebina .ocena span.ocena-stevilka {
            color: #333; 
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* Stil za navidezno oddaljenost */
        .oddaljenost {
            /* RAZDALJA: Order 2 (desno zgoraj, ob interni oceni) */
            order: 2; 
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .oddaljenost i {
            color: #007bff; /* Ikona v modri barvi */
        }

        /* Stil za Google oceno na kartici */
        .kartica .google-ocena {
            /* GOOGLE OCENA: Order 3 in 100% ≈°irina (nova vrstica) */
            order: 3; 
            width: 100%; 
            
            font-size: 0.8rem;
            font-weight: bold; 
            color: #333; 
            margin-top: 5px; 
            margin-bottom: 0;
            display: flex;
            align-items: center;
        }

        .kartica .google-ocena .fab.fa-google {
            font-size: 0.9em; 
            margin-right: 4px; 
            color: #4285F4; /* Googlova modra */
        }


        /* Stil za polje razpolo≈æljivosti (Ostane na dnu) */
        .razpolozljivost-ovoj {
            margin-top: auto; /* Pritisne ga na dno */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 10px;
            border-radius: 6px;
            background-color: #f4f4f9; /* Svetlo zeleno/turkizno ozadje */
            border: 1px solid #f4f4f9;
        }

        .razpolozljivost-ovoj strong {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .razpolozljivost-ovoj span {
            font-size: 0.85rem;
            font-weight: bold;
            color: #1a9e9a; /* Temnej≈°a zelena/turkizna */
        }

        .razpolozljivost-ovoj.zasedeno {
             background-color: #f4f4f9; /* Svetlo rdeƒçe ozadje */
             border: 1px solid #f4f4f9;
        }

        .razpolozljivost-ovoj.zasedeno span {
            color: #dc3545; 
        }
        
        /* Gumb rezervacija (ƒçe bi bil) */
        .gumb-rezervacija {
            display: block;
            width: 100%;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            background-color: #20c0bd; 
            color: white;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.2s;
            margin-top: 10px; 
            cursor: pointer;
        }

        .gumb-rezervacija:hover {
            background-color: #1a9e9a;
        }
        
       /* ======================================================= */
    /* NOVO: KARTICA IZPOSTAVLJENO (MANJ≈†A KARTICA) */
    /* ======================================================= */
    .kartica-izpostavljeno {
        /* Nadomesti pravila osnovne .kartica */
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border-radius: 10px;
        width: 100%;
        height: 250px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        background-color: #4edaa9; /* Svetlo ozadje */
        transition: box-shadow 0.2s, transform 0.2s;
        border: 0px solid #333;
    }

    .kartica-izpostavljeno:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(0px);
        
        
    }

    /* SPREMENJENO: Zmanj≈°ano na 50px za ≈°e manj≈°o vi≈°ino slike */
    .kartica-izpostavljeno .slika-kartice {
        width: 100%;
        height: 220px; 
        background-size: cover;
        background-position: center;
        background-color: #f5f5f5;
    }

    /* SPREMENJENO: Zmanj≈°an padding na 6px */
    .kartica-izpostavljeno .vsebina-kartice-izpostavljeno {
        padding: 10px; 
        text-align: center;
    }

    /* SPREMENJENO: Zmanj≈°ana velikost pisave na 0.85rem */
    .kartica-izpostavljeno .vsebina-kartice-izpostavljeno h3 {
        font-size: 0.9rem; 
        font-weight: 600;
        margin: 0;
        color: #333;
        white-space: nowrap; 
        overflow: hidden;
        text-overflow: ellipsis; 
        
    }

    
    /* ======================================================= */
    /* MODAL PODROBNOSTI RESTAVRACIJE (OSTANE NESPREMENJENO) */
    /* ======================================================= */
    .restavracija-modal {
        display: none; 
        position: fixed; 
        z-index: 9990; 
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto; 
        background-color: rgba(0, 0, 0, 0.7); 
        justify-content: center;
        align-items: flex-start; 
        padding: 50px 0; 
    }

    .restavracija-modal.active {
        display: flex;
    }

    .restavracija-vsebina {
        background-color: #fefefe;
        margin: auto; 
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 900px; 
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: modalSlide 0.4s ease-out;
        min-height: 400px;
    }
    
    @keyframes modalSlide {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
    }

/* GUMB ZA ZAPIRANJE (X) */
.gumb-zapri-restavracija {
    position: absolute;
    top: 15px;
    right: 15px;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 35px;
    font-weight: bold;
    cursor: pointer;
    z-index: 9991; 
    transition: background-color 0s;
    /* >>> KLJUƒåNI POPRAVEK ZA CENTRIRANJE ZNAKA 'X' <<< */
    line-height: 1; 
    /* Opcijski mikro-popravek, ƒçe je X ≈°e vedno rahlo prenizko zaradi pisave */
    /* Poskusite dodati to, ƒçe je potrebno: */
    /* transform: translateY(-1px); */ 
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}
.gumb-zapri-restavracija:hover {
    background-color: transparent;
}

    .slika-glava {
        width: 100%;
        height: 250px;
        background-size: cover;
        background-position: center;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        position: relative;
    }
    
    .podrobnosti-tekst {
        padding: 25px;
        padding-bottom: 0;
    }

    .podrobnosti-tekst h2 {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #333;
    }
    
    /* Prilagoditev velikosti naslova na mobilnem telefonu */
    @media (max-width: 600px) {
        .restavracija-vsebina {
            margin: 20px 10px; 
        }
        .podrobnosti-tekst h2 {
            font-size: 1.5rem;
        }
    }

    .info-vrstica {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        font-size: 0.95rem;
        color: #666;
        flex-wrap: wrap;
    }
    
    .info-vrstica > span {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .info-vrstica i {
        color: #333;
    }

    .opis-restavracije {
        font-size: 1rem;
        color: #555;
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .gumb-rezerviraj-modal {
        display: block;
        width: 60%;
        padding: 10px;
        margin-top: 25px;
        text-align: center;
        border-radius: 20px;
        background-color: #4edaa9; 
        color: #333;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        transition: background-color 0.2s;
        cursor: pointer;
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }
    .gumb-rezerviraj-modal:hover {
        background-color: #39c292;
    }

    /* ======================================================= */
    /* ZAVIHKE (TABS) - OSTANE NESPREMENJENO */
    /* ======================================================= */
    .modal-tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-top: 15px;
        padding: 0 25px;
        background-color: #ffffff; 
        overflow-x: auto; 
        -webkit-overflow-scrolling: touch; 
    }
    
    .modal-tab {
        flex-shrink: 0; 
        padding: 6px 20px; 
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600; 
        color: #333;
        border-bottom: 3px solid transparent;
        transition: color 0.0s, border-bottom-color 0.0s, background-color 0.0s;
        margin-right: 5px; 
        white-space: nowrap; 
        position: relative;
    }
    
    .modal-tab.active {
        color: #333;
        border-bottom-color: none;
        background-color: #4edaa9;
        border-radius: 25px;
        margin-bottom: 0px; 
        box-shadow: 0 0px 0px rgba(0,0,0,0.05);
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }
    
    .modal-tab:not(.active):hover {
        color: #333;
        background-color: #ffff;
    }

    .modal-vsebina-ovoj {
        padding: 25px;
    }
    
    .modal-vsebina-skrol {
        max-height: 40vh; 
        overflow-y: auto; 
        padding-right: 15px; 
    }
    
    @media (max-width: 600px) {
        .modal-vsebina-skrol {
            max-height: 30vh; 
        }
    }


    .tab-content {
        display: none;
        animation: tabFadeIn 0.3s ease;
        padding-top: 10px;
    }

    .tab-content.active {
        display: block;
    }

    @keyframes tabFadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Meni */
    .meni-seznam ul {
        list-style: none;
        padding: 0;
    }
    
    .meni-seznam ul li {
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }
    
    .meni-seznam ul li:last-child {
        border-bottom: none;
    }

    .meni-seznam ul li strong {
        display: block;
        color: #333;
        font-size: 14px;
        font-weight: 500; 
    }

    /* Slike in Zemljevid */
    .galerija-slike {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); 
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .galerija-slike img {
        width: 100%;
        height: 100px; 
        object-fit: cover;
        border-radius: 8px;
    }

    /* üî• POPRAVEK ZA LEAFLET: Ciljamo tudi na novi ovoj #map-container */
    .zemljevid-ovoj,
    #map-container {
        width: 100%;
        /* Poveƒçana vi≈°ina za bolj≈°i prikaz navodil za pot (Routing Machine) */
        height: 400px; 
        background-color: #eee;
        border-radius: 8px;
        overflow: hidden;
        /* Dodamo position, ƒçe je potrebno za z-index in absolutno pozicioniranje notranjih elementov Leafleta */
        position: relative; 
    }
    
    /* üî• NOVO PRAVILO: Zagotovimo, da Leaflet div zavzame celoten prostor */
    #leaflet-map {
        width: 100%;
        height: 100%;
        /* z-index je kljuƒçen, da se kontrolniki prika≈æejo nad vsem ostalim v modalu */
        z-index: 1; 
    }

    /* Ohranjena pravila za stare iframe, ƒçe jih ≈°e kje uporabljate */
    .zemljevid-ovoj iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    /* PRILAGODITEV ZA MOBILNE NAPRAVE (do 480px) */
    @media (max-width: 480px) {
        .modal-tabs {
            padding: 0 10px; 
        }
        
        .modal-tab {
             padding: 10px 15px; 
        }
        
        .modal-vsebina-ovoj {
            padding: 15px; 
        }
        
        .podrobnosti-tekst {
            padding: 15px 15px 0 15px;
        }
        
        .slika-glava {
            height: 180px; 
        }
        
        .galerija-slike {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 5px;
        }
        .galerija-slike img {
            height: 80px;
        }
        
        /* üî• POPRAVEK ZA MOBILNI ZEMLJEVID */
        .zemljevid-ovoj,
        #map-container {
            height: 300px; /* Prilagoditev vi≈°ine za mobilni zaslon */
        }
    }
    
    /* ======================================================= */
    /* MOBILNI MENI LOGIKA ZA MOBILNI POGLED (do 768px) */
    /* ======================================================= */
    
    .hamburger-gumb {
        display: none;
        background: none;
        border: none;
        font-size: 26px;
        cursor: pointer;
        color: #222222;
        padding: 0;
        z-index: 1000;
    }
    
    .mobilni-meni {
        display: none;
    }
    
    .glava .akcije {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    @media (max-width: 768px) {
        .glava {
            justify-content: space-between;
            padding: 10px 20px;
            position: relative; 
        }

        .glava .akcije {
            display: none; 
        }

        .hamburger-gumb {
            display: block; 
        }

        .mobilni-meni {
            position: absolute;
            top: 100%; 
            right: 0;
            width: 60%; 
            max-width: 200px;
            background-color: white;
            border-top: 0px solid #eee;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 999;
            padding: 15px;
            flex-direction: column;
            gap: 10px;
            transform: translateX(100%); 
            transition: transform 0.3s ease-out;
            border-bottom-left-radius: 8px;
        }

        .mobilni-meni.active {
            display: flex;
            transform: translateX(0); 
        }
        
        /* Gumbi Prijava/Odjava/Profil */
        .mobilni-meni .gumb-prijava {
            width: 55%;
            justify-content: center;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 20px;
            background-color: #575757; 
            border-color: #575757;
            align-self: center; 
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }
        
        .mobilni-meni .profil-ovoj {
             display: flex;
             flex-direction: column;
             gap: 10px;
             width: 100%;
             align-items: center; 
        }

        .mobilni-meni .gumb-profil,
        .mobilni-meni .gumb-odjava {
            width: 55%; 
            justify-content: center;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 20px;
            transition: all 0.2s;
            
        }
        
        .mobilni-meni .gumb-profil {
            background-color: #575757;
            border-color: #575757;
        }

        .mobilni-meni .gumb-odjava {
            color: #555;
            border: 1px solid #ccc;
        }

        .mobilni-meni .gumb-odjava:hover {
            background-color: #f5f5f5;
            color: #333;
            border-color: #aaa;
        }


        .mobilni-meni .jezik-ovoj {
            display: flex;
            align-items: center;
            padding: 10px 0;
            gap: 10px;
            border-top: 1px solid #eee;
            margin-top: 5px;
            padding-top: 15px;
            width: 100%;
            justify-content: center; 
        }
        
        /* POPRAVEK JEZIKA NA MOBILNEM: Manj≈°i, brez robov */
        .mobilni-meni .jezik-ovoj select {
            flex-grow: 0; /* Ne raste naj, da ostane majhen */
            width: auto;
            min-width: 60px; /* Minimalna ≈°irina */
            padding: 6px 8px; /* Zmanj≈°an padding */
            font-size: 14px;
            font-weight: bold;
            color: #555;
            background-color: #f7f7f7; /* Svetlo ozadje */
            border: none; /* Odstranjen okvir */
            border-radius: 6px; /* Majhen zaokro≈æen rob */
            appearance: none; 
            /* Uporabimo manj≈°o, diskretno pu≈°ƒçico */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23555%22%20d%3D%22M287%20197.8%20L146.2%2057%20L5.4%20197.8%20L48.6%20241%20L146.2%20143.4%20L243.8%20241%20L287%20197.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 5px center;
            background-size: 8px auto; /* Manj≈°a pu≈°ƒçica */
            padding-right: 20px; /* Dodaten padding za pu≈°ƒçico */
            box-shadow: none;
                      /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
        }
        
        /* ƒåe je izbirnik jezika premajhen, ga centraliziramo */
        .mobilni-meni .jezik-ovoj i {
            color: #777;
        }
    }

    /* ========================================================= */
    /* üî•üî•üî• NOVO: STILI ZA REZERVACIJSKA POLJA V MODALU üî•üî•üî• */
    /* ========================================================= */

    .rezervacija-vnosna-polja {
        display: flex; /* Polja postavimo v vrsto */
        gap: 20px;
        margin: 20px 25px; /* Dodan razmik okoli polj (gor/dol, levo/desno) */
        padding: 15px 0;
        border-top: 1px solid #eee; 
        border-bottom: 1px solid #eee;
    }
    
    @media (max-width: 600px) {
        .rezervacija-vnosna-polja {
            flex-direction: column; /* Na mobilnem postavimo pod seboj */
            gap: 15px;
            margin: 15px 15px; 
            padding: 30px 0;
        }
    }

    .vnosno-polje {
        flex: 1; 
        display: flex;
        flex-direction: column;
        
    }

    .input-rezervacija {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 20px;
        font-size: 16px;
        cursor: pointer;
        background-color: white;
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */ 
    }

    .vnosno-polje label {
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
        font-size: 0.9rem;
    }
    
    /* Stil za kontejner, kamor se vstavijo gumbi (ure) */
    .proste-ure-rezultati {
        min-height: 40px; 
        padding: 15px 25px; /* Dodan padding, da je v enakem obmoƒçju kot vsebina modala */
        text-align: center;
    }
    
    @media (max-width: 600px) {
        .proste-ure-rezultati {
             padding: 15px 15px; 
        }
    }

    /* Kontejner za gumbe, ko jih JavaScript ustvari */
    .gumbi-proste-ure {
        display: flex;
        gap: 10px;
        flex-wrap: wrap; 
        justify-content: center;
        padding-top: 10px;
    }

    /* Stil za gumb ure (kljuƒçen, da se prika≈æejo lepi gumbi za ure) */
    .gumb-ura {
        background-color: #ffffff;
        color: #333;
        border: 1px solid #333;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s, border-color 0.2s;
        font-size: 14px;
        flex-shrink: 0;
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }

    .gumb-ura:hover {
        background-color: #4edaa9;
    
    }

    /* Stil za izbran gumb ure */
    .gumb-ura.selected {
        background-color: #4edaa9; /* Barva poudarka */
        color: #333;
        border-color: #33b688;
        font-weight: bold;
    }
 /* =================================================== */
/* GLOBALNI STILI ZA NOGO (veliki zasloni) */
/* =================================================== */
.noga {
    background-color: #2c2c2c; /* Temna podlaga, kot na sliki */
    color: #cccccc;
    padding: 15px 5%; /* Horizontalni padding za odmik od robov */
    font-size: 14px;
}

.noga-vsebina {
    display: flex; /* Razporedi sekcije v vrsto na velikih zaslonih */
    justify-content: space-between;
    padding-bottom: 20px;
    border-bottom: 1px solid #444; /* Loƒçilo nad plaƒçili/avtorskimi pravicami */
}

.noga-sekcija {
    flex: 1; /* Enaka ≈°irina za vse sekcije na velikih zaslonih */
    padding-right: 20px;
}

.noga-naslov {
    color: #ffffff;
    font-size: 16px;
    margin-bottom: 15px;
    font-weight: bold;
    /* Poka≈æe, da je klikabilen */
    cursor: pointer; 
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}

.noga-linki {
    list-style: none;
    padding: 0;
    margin: 0;
    /* Povezave so privzeto vidne na velikih zaslonih */
    /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
}

.noga-linki li {
    margin-bottom: 8px;
}

.noga-linki a {
    color: #cccccc;
    text-decoration: none;
    transition: color 0.2s;
}

.noga-linki a:hover {
    color: #ffffff;
}

/* Skrijemo ikono preklopa na velikih zaslonih (ƒçe je bila prej vkljuƒçena) */
.noga-naslov:after {
    content: none !important;
}

/* =================================================== */
/* DODATNA INFORMACIJA (Plaƒçila in Avtorske pravice) */
/* =================================================== */
.noga-dodatno-info {
    padding-top: 20px;
}

.noga-dodatno-info p {
    margin-bottom: 10px;
    color: #a0a0a0;
}

.noga-avtorske-pravice {
    text-align: center;
    padding-top: 15px;
    font-size: 12px;
}

.stripe-logo img {
    height: 20px; 
    margin-right: 5px;
    /* Filtriramo, da so ikone bele, ƒçe so originali barvni */
    filter: invert(80%); 
}

/* --------------------------------------------------- */
/* MOBILNI PRIKAZ (MEDIA QUERY: do 768px) */
/* Omogoƒça akordion za posamezne sekcije */
/* --------------------------------------------------- */
@media screen and (max-width: 768px) {
    
    /* 1. Gumb za preklop (tri pike) */
    .footer-toggle-btn {
        display: block; 
        width: 100%;
        background: none;
        border: none;
        color: white;
        text-align: right;
        padding: 10px 0;
        cursor: pointer;
        outline: none;
        margin-bottom: 5px;
        /* üëá DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH üëá */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* üëÜ ZAKLJUƒåEK DODATKOV üëÜ */
    }
    .footer-toggle-btn svg {
        vertical-align: middle;
        color: #cccccc; 
        
    }
    
    /* 2. Skrivanje celotne vsebine (.noga-vsebina-skrita) */
    .noga-vsebina-skrita {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out;
        padding: 0;
        border-top: none; 
    }

    /* Prikaz celotne vsebine, ko je gumb aktiven */
    .noga-vsebina-skrita.active {
        max-height: 2000px; 
        padding-top: 15px;
        padding-bottom: 15px;
        border-top: 1px solid #444; 
    }
    
    /* 3. Preureditev vsebine znotraj skrite sekcije */
    .noga-vsebina {
        display: block; 
        border-bottom: none; 
        padding-bottom: 0;
    }
    
    /* Sekcije znotraj noge naj bodo med seboj loƒçene */
    .noga-sekcija {
        border-bottom: 1px solid #444; 
        padding: 10px 0;
        padding-right: 0;
    }
    
    /* üõ†Ô∏è POPRAVEK ZA AKORDION: Omogoƒçi preklapljanje s pomoƒçjo JS */
    .noga-linki {
        /* Sedaj mora biti privzeto skrito za akordion */
        max-height: 0 !important; 
        overflow: hidden !important; 
        transition: max-height 0.3s ease-out !important;
        padding-top: 0 !important; 
    }

    /* üõ†Ô∏è STANJE PRIKAZA: Ko JS doda razred active */
    .noga-linki.active {
        max-height: 500px !important; /* Dovolj visoko, da se prika≈æe */
        padding-top: 10px !important; 
    }

    /* Odstranimo ikono za preklop akordiona na posameznih naslovih */
    .noga-naslov:after {
        content: none !important;
    }
    
    /* Poskrbimo, da je prostor okoli plaƒçil videti dobro */
    .noga-dodatno-info {
        border-top: 1px solid #444; 
        padding-top: 15px;
        padding-bottom: 5px;
    }
}

/* 4. Skrijemo gumb na namiznem prikazu */
@media screen and (min-width: 769px) {
    .footer-toggle-btn {
        display: none;
    }
}
/* ========================================= */
/* OBLIKOVANJE ZA TOASTER OBVESTILA */
/* ========================================= */

#toaster-container {
    position: fixed;
    top: 20px; /* Ali bottom: 20px, ƒçe ≈æelite, da so spodaj */
    right: 20px;
    z-index: 10000; /* Poskrbite, da je nad vsem */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.toast {
    padding: 15px 20px;
    color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.3s ease-out, transform 0.4s ease-out;
    max-width: 300px;
    min-width: 200px;
}

.toast.show {
    opacity: 1;
    transform: translateX(0);
}

.toast.success {
    background-color: #4CAF50; /* Zelena za uspeh */
}

.toast.error {
    background-color: #f44336; /* Rdeƒça za napako */
}

.toast.info {
    background-color: #2196F3; /* Modra za info */
}

.toast.warning {
    background-color: #ff9800; /* Oran≈æna za opozorilo */
}

.toast-icon {
    margin-right: 10px;
}

  </style>
</head>

<body>
  <header class="glava">
    <div class="logotip">
      <a href="#">
        <img src="Logo Rentyo gourmet.png" alt="Logotip Rentyo Gourmet" />
      </a>
    </div>
    
    <div class="akcije" id="desktopAkcije"> 
      <a href="#" id="odpriPrijavoDesktop" class="gumb-prijava" data-i18n="header.login">
        <i class="fas fa-user"></i> Prijava
      </a>

      <div class="profil-ovoj" id="profilMeniDesktop" style="display: none;">
        <a href="profil.html" class="gumb-profil" data-i18n="header.profile">
          <i class="fas fa-user-circle"></i> Moj Profil
        </a>
        <a href="#" id="gumbOdjavaDesktop" class="gumb-odjava" data-i18n="header.logout">
          <i class="fas fa-sign-out-alt"></i> Odjava
        </a>
      </div>
      <div class="jezik-ovoj" id="jezikOvojDesktop">
        <i class="fas fa-globe"></i>
        <select class="izbira-jezika" id="izbiraJezikaDesktop">
          <option value="sl">SL</option>
          <option value="en">EN</option>
          <option value="de">DE</option>
          <option value="hr">HR</option>
          <option value="it">IT</option>
          <option value="fr">FR</option>
        </select>
      </div>
    </div>
    
<button class="hamburger-gumb" id="hamburgerGumb">
    <i class="fas fa-ellipsis-h"></i>
</button>

    <div class="mobilni-meni" id="mobilniMeni">
        <a href="#" id="odpriPrijavoMobilni" class="gumb-prijava" data-i18n="header.login">
            <i class="fas fa-user"></i> Prijava
        </a>

        <div class="profil-ovoj" id="profilMeniMobilni" style="display: none;">
            <a href="profil.html" class="gumb-profil" data-i18n="header.profile">
                <i class="fas fa-user-circle"></i> Moj Profil
            </a>
            <a href="#" id="gumbOdjavaMobilni" class="gumb-odjava" data-i18n="header.logout">
                <i class="fas fa-sign-out-alt"></i> Odjava
            </a>
        </div>
        
        <div class="jezik-ovoj" id="jezikOvojMobilni">
            <i class="fas fa-globe"></i>
            <select class="izbira-jezika" id="izbiraJezikaMobilni">
                <option value="sl">SL</option>
                <option value="en">EN</option>
                <option value="de">DE</option>
                <option value="hr">HR</option>
                <option value="it">IT</option>
                <option value="fr">FR</option>
            </select>
        </div>
    </div>

  </header>

  <main>
    <section class="naslovna-slika">
      <h1 data-i18n="hero.title">Gourmet & Experience</h1>
    </section>

    <section class="iskalnik-sekcija">
      <form class="iskalnik">
        <div class="iskalnik-polje">
          <label for="restavracija_mesto" data-i18n="search.restaurant_city_label">Restavracija ali mesto</label>
          <input type="text" id="restavracija_mesto" data-i18n="[placeholder]search.restaurant_city_placeholder" placeholder="Vnesite ime ali mesto">
        </div>

        <div class="iskalnik-polje">
          <label for="datum" data-i18n="search.date_label">Datum</label>
          <input type="text" id="datum" data-i18n="[placeholder]search.date_placeholder" placeholder="Izberite datum">
        </div>

        <div class="iskalnik-polje">
          <label for="cas" data-i18n="search.time_label">ƒåas rezervacije</label>
          <select id="cas">
            <option value="" disabled selected data-i18n="search.select_time">Izberi ƒças</option>
          </select>
        </div>

        <div class="iskalnik-polje">
          <label for="stevilo_oseb" data-i18n="search.persons_label">≈†tevilo oseb</label>
          <select id="stevilo_oseb">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>
        </div>

        <button type="submit" class="gumb-isci" data-i18n="search.search_button">I≈°ƒçi</button>
      </form>
    </section>

  <section class="hitra-iskanja">
    <h2 data-i18n="quick_search.title">Hitra izbira kuhinje</h2>
    <div class="gumbi-kategorij">
        <a href="#" class="gumb-kategorija" data-kuhinja="Mesne" data-i18n="cuisine.meat">Mesne jedi</a>
        <a href="#" class="gumb-kategorija" data-kuhinja="Vegi" data-i18n="cuisine.vegetarian">Vegetarijanske jedi</a>
        <a href="#" class="gumb-kategorija" data-kuhinja="Ribje" data-i18n="cuisine.fish">Ribje jedi</a> 
        <a href="#" class="gumb-kategorija" data-kuhinja="Pijaƒça" data-i18n="cuisine.drinks">Pijaƒça</a>
        <a href="#" class="gumb-kategorija" data-kuhinja="Brunch" data-i18n="cuisine.brunch">Brunch</a>
    </div>
</section>

 
    <section class="kartice-restavracij">
      <h2 data-i18n="results.popular_title">Priljubljeno v va≈°i bli≈æini</h2>
      <div class="mreza-kartic" id="restavracije-container">
        <div id="statusKartice" style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">Nalaganje...</div>
      </div>
    </section>

    <section class="kartice-restavracij kartice-izpostavljeno">
        <h3 data-i18n="results.featured_title">Izpostavljeno</h3>
        
        <div class="mreza-kartic" id="mrezaIzpostavljenoKartic">
            <div id="statusIzpostavljenoKartice" style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">Nalaganje...</div>
        </div>
    </section>
    
</main>
    
    <div id="restavracijaModal" class="restavracija-modal">
        <div class="restavracija-vsebina">
            <span class="gumb-zapri-restavracija" id="zapriRestavracijaModal">√ó</span>
            
            <div id="modalSlika" class="slika-glava"></div>
            
            <div class="podrobnosti-tekst">
                <h2 id="modalIme">Ime Restavracije</h2>
                
                <div class="info-vrstica">
                    <span id="modalKuhinja"><i class="fas fa-utensils"></i> Kuhinja</span>
                    <span id="modalLokacija"><i class="fas fa-map-marker-alt"></i> Mesto</span>
                    <span id="modalOcena"><i class="fas fa-star"></i> Ocena</span>
                </div>
                
                <p id="modalOpis" class="opis-restavracije">Opis restavracije...</p>
            </div>
            
            <div class="rezervacija-vnosna-polja">
                <div class="vnosno-polje">
                    <label for="modalOsebe" data-i18n="modal.reservation_persons">≈†t. oseb:</label>
                    <select id="modalOsebe" class="input-rezervacija">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>

                <div class="vnosno-polje">
                    <label for="modalDatum" data-i18n="modal.reservation_date">Datum:</label>
                    <input type="text" id="modalDatum" class="input-rezervacija" placeholder="" readonly>
                </div>

                <input type="hidden" data-reserv-id="" value="">
                
                </div>
            <div class="modal-tabs">
                <div class="modal-tab active" data-tab="meni" data-i18n="modal.tab_menu">Meni</div>
                <div class="modal-tab" data-tab="aktualnaPonudba" data-i18n="modal.tab_special_offer">Aktualna Ponudba</div> <div class="modal-tab" data-tab="galerija" data-i18n="modal.tab_gallery">Slike & Zemljevid</div>
                <div class="modal-tab" data-tab="ocene" data-i18n="modal.tab_reviews">Ocene (0)</div>
            </div>

            <div class="modal-vsebina-ovoj">
                <div class="modal-vsebina-skrol">
                    <div id="tabMeni" class="tab-content active">
                        <div class="meni-seznam">
                            <ul id="modalMeni">
                                </ul>
                        </div>
                    </div>

                    <div id="tabAktualnaPonudba" class="tab-content">
                        <h4 data-i18n="modal.special_offer_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Posebna ponudba restavracije</h4>
                        <p id="modalAktualnaPonudbaOpis" data-i18n="modal.special_offer_default">
                            Trenutno ni aktivne posebne ponudbe ali sezonskega menija.
                        </p>
                        </div>

                    <div id="tabGalerija" class="tab-content">
                        <h4 data-i18n="modal.gallery_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Galerija slik</h4>
                        <div id="galerijaSlike" class="galerija-slike">
                            </div>
                        
                        <h4 data-i18n="modal.map_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; margin-top: 20px;">Zemljevid Lokacije</h4>
                        <div class="zemljevid-ovoj">
                            <iframe id="modalZemljevid" src="about:blank" allowfullscreen="" loading="lazy" aria-label="Zemljevid lokacije restavracije"></iframe>
                        </div>
                    </div>

                    <div id="tabOcene" class="tab-content">
                        <p data-i18n="modal.no_reviews">Trenutno ni na voljo podrobnih ocen za prikaz.</p>
                    </div>
                </div>
            </div>
            
            <div style="padding: 0 25px 25px 25px;">
                <div id="prosteUreRezultati" class="proste-ure-rezultati" style="margin-bottom: 15px; border-top: 1px solid #eee; padding-top: 15px; text-align: center;">
                    <p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>
                </div>
                
                <button class="gumb-rezerviraj-modal" data-i18n="modal.reserve_button">Rezerviraj mizo</button>
            </div>
        </div>
    </div>
    
<div class="login-modal" id="loginModal">
    <div class="login-content">
      <span class="close-modal" id="zapriModal">√ó</span>

      <div class="login-tabs">
        <div class="login-tab active" id="tabPrijava" data-i18n="modal.login_tab">Prijava</div>
        <div class="login-tab" id="tabRegistracija" data-i18n="modal.register_tab">Registracija</div>
      </div>

      <form class="login-form active" id="formPrijava">
        <input type="email" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po≈°ta" required>
        <input type="password" data-i18n="[placeholder]modal.password_placeholder" placeholder="Geslo" required>
        <button type="submit" data-i18n="modal.login_button">Prijavi se</button>
      </form>

      <form class="login-form" id="formRegistracija">
        <input type="text" data-i18n="[placeholder]modal.name_placeholder" placeholder="Ime in priimek" required>
        <input type="email" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po≈°ta" required>
        <input type="password" data-i18n="[placeholder]modal.password_placeholder" placeholder="Geslo" required>
        
        <div class="form-group-checkbox">
            <input type="checkbox" id="pogojiStrinjanje" name="pogojiStrinjanje" required>
            <label for="pogojiStrinjanje">
                <span data-i18n="registration.pogoji_strinjanje">Strinjam se s </span>
                <a href="splosni-pogoji.html" target="_blank" data-i18n="registration.splosni_pogoji_link">Splo≈°nimi pogoji</a>
                <span data-i18n="registration.in_politiko"> in </span>
                <a href="politika-zasebnosti.html" target="_blank" data-i18n="registration.politika_zasebnosti_link">Politiko zasebnosti</a>.
                <span class="required-star">*</span>
            </label>
        </div>
        <button type="submit" data-i18n="modal.register_button">Ustvari raƒçun</button>
      </form>
    </div>
  </div>
  
  <div class="duration-modal" id="durationModal">
      <div class="duration-content">
          <span class="close-modal" id="zapriDurationModal">√ó</span>
          
          <h3 data-i18n="modal.reservation_modal.title">Izberite trajanje obiska</h3>
          
          <label data-i18n="modal.reservation_modal.duration_label">Kako dolgo ≈æelite ostati?</label>
          
          <div class="duration-opcije" id="durationOpcije">
              
              <div class="duration-opcija" data-duration="0.5">
                  <input type="radio" id="dur_0_5" name="duration" value="0.5">
                  <label for="dur_0_5" data-i18n="modal.reservation_modal.duration_0_5h">Pol ure (30 min)</label>
              </div>
              
              <div class="duration-opcija selected" data-duration="1.0">
                  <input type="radio" id="dur_1" name="duration" value="1.0" checked>
                  <label for="dur_1" data-i18n="modal.reservation_modal.duration_1h">1 ura</label>
              </div>
              
              <div class="duration-opcija" data-duration="1.5">
                  <input type="radio" id="dur_1_5" name="duration" value="1.5">
                  <label for="dur_1_5" data-i18n="modal.reservation_modal.duration_1_5h">1 ura in pol (90 min)</label>
              </div>
              
              <div class="duration-opcija" data-duration="2.0">
                  <input type="radio" id="dur_2" name="duration" value="2.0">
                  <label for="dur_2" data-i18n="modal.reservation_modal.duration_2h">2 uri</label>
              </div>
          </div>
          
          <button id="potrdiTrajanjeGumb" class="gumb-potrdi-trajanje" data-i18n="modal.reservation_modal.confirm_button">Potrdi trajanje in nadaljuj</button>
      </div>
  </div>

  <div class="warning-modal" id="warningModal">
      <div class="warning-content">
          <div class="warning-icon-wrapper">
              <i class="fas fa-exclamation-triangle warning-icon"></i>
          </div>
          
          <h3 data-i18n="warning.title">Opozorilo</h3>
          
          <p id="warningMessage" data-i18n="warning.default_message">
            Prosimo, da upo≈°tevate, da so prikazane informacije o razpolo≈æljivosti in cenah zgolj informativne narave.
          </p>
          
          <button id="gumbRazumem" class="gumb-razumem" data-i18n="warning.understand_button">Razumem</button>
      </div>
  </div>

<footer class="noga">
    <!-- GUMB ZA PREKLOP (Vidno samo na mobilnem) -->
    <button id="footerToggleBtn" class="footer-toggle-btn" aria-expanded="false" aria-controls="nogaVsebinaSkrita" aria-label="Prika≈æi/Skrij vsebino noge">
        <!-- Ikona treh pikic (SVG) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
    </button>
    
    <!-- NOVI KONTEJNER: Vsa vsebina, ki se skrije/prika≈æe ob kliku na gumb -->
    <div id="nogaVsebinaSkrita" class="noga-vsebina-skrita">
        <div class="noga-vsebina">

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="o-rentyo-vsebina" data-i18n="footer.about_company_title">O Rentyo Gourmet</h4>
                <ul id="o-rentyo-vsebina" class="noga-linki">
                    <!-- POSODOBLJENO: Uporaba realnih href-ov za navigacijo v istem zavihku -->
                    <li><a href="o-nas.html" data-i18n="footer.about_us" data-i18n-href="footer.about_us_href">O nas</a></li>
                    <li><a href="kontakt.html" data-i18n="footer.contact" data-i18n-href="footer.contact_href">Kontakt</a></li>
                    <li><a href="kariera.html" data-i18n="footer.career" data-i18n-href="footer.career_href">Kariera</a></li>
                    <li><a href="mediji.html" data-i18n="footer.media_press" data-i18n-href="footer.media_press_href">Mediji / Press kotiƒçek</a></li>
                </ul>
            </div>

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="pravne-info-vsebina" data-i18n="footer.legal_info_title">Pravne Informacije</h4>
                <ul id="pravne-info-vsebina" class="noga-linki">
                    <!-- POSODOBLJENO: Uporaba realnih href-ov -->
                    <li><a href="politika-zasebnosti.html" data-i18n="footer.privacy_policy" data-i18n-href="footer.privacy_policy_href">Politika zasebnosti</a></li>
                    <li><a href="politika-piskotkov.html" data-i18n="footer.cookie_policy" data-i18n-href="footer.cookie_policy_href">Politika Pi≈°kotkov</a></li>
                    <li><a href="pogoji-uporabe.html" data-i18n="footer.terms_of_use" data-i18n-href="footer.terms_of_use_href">Pogoji Uporabe</a></li>
                    <li><a href="pravno-obvestilo.html" data-i18n="footer.legal_notice" data-i18n-href="footer.legal_notice_href">Pravno Obvestilo</a></li>
                    <li><a href="pravne-informacije.html" data-i18n="footer.legal_info_title" data-i18n-href="footer.legal_info_href">Pravne Informacije</a></li>
                </ul>
            </div>
            
            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="partnerstva-vsebina" data-i18n="footer.partnerships_title">Partnerstva</h4>
                <ul id="partnerstva-vsebina" class="noga-linki">
                    <!-- POSODOBLJENO: Uporaba realnih href-ov -->
                    <li><a href="za-partnerje.html" data-i18n="footer.for_partners" data-i18n-href="footer.for_partners_href">Za Partnerje</a></li>
                </ul>
            </div>

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="social-vsebina" data-i18n="footer.connect_title">Pove≈æi se z nami</h4>
                <ul id="social-vsebina" class="noga-linki">
                    <!-- Predpostavljamo, da so to zunanje povezave in bi morale odpreti nov zavihek, 
                         ƒçe vodijo na zunanje socialne strani. Lahko dodate target="_blank", ƒçe ≈æelite, sicer pustimo standardno. -->
                    <li><a href="https://www.facebook.com/people/Rentyo-Gourmet/61581337694663/" target="_blank">Facebook</a></li>
                    <li><a href="https://www.instagram.com/rentyo.gourmet/" target="_blank">Instagram</a></li>
                    <li><a href="https://www.tiktok.com/@rentyo_travel?lang=sl" target="_blank">TikTok</a></li>
                    <li><a href="https://linkedin.com/company/rentyogourmet" target="_blank">LinkedIn</a></li>
                    <li><a href="https://wa.me/385989023144" target="_blank">WhatsApp</a></li>
                    <li><a href="mailto:info@rentyo.eu">Email</a></li>
                </ul>
            </div>
        </div> <!-- Konec .noga-vsebina (navigacijski stolpci) -->
        
<div class="noga-dodatno-info" style="text-align: center; font-size: 0.875rem; margin-bottom: 1rem;">
            
            <p style="margin-bottom: 0.5rem;">
                <span data-i18n="footer.payment_info_prefix">Varno plaƒçilo, ki ga omogoƒça</span>
                <a href="" target="_blank" style="text-decoration: none; color: inherit; font-weight: bold;">Stripe</a>.
            </p>
            
            <div class="stripe-logo" style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                <a href="" target="_blank" aria-label="Stripe Payment Processing">
                    <img src="Stripe.png" alt="Stripe" style="display:inline-block; height: 45px;"> 
                </a>
                
                <a href="#" aria-label="Visa Card Accepted" style="cursor: default;">
                    <img src="Visa.png" alt="Visa" style="display:inline-block; height: 24px;">
                </a>
                
                <a href="#" aria-label="Mastercard Accepted" style="cursor: default;">
                    <img src="Mastercard.png" alt="Mastercard" style="display:inline-block; height: 24px;">
                </a>
            </div>
        </div>
        
        <div class="noga-avtorske-pravice" style="text-align: center; font-size: 0.875rem;">
            <span data-i18n="footer.copyright_text">¬© 2025 Rentyo Gourmet. Vse pravice pridr≈æane.</span>
        </div>
    </div>
</footer>

<div id="cookie-consent-banner" class="cookie-banner hidden">
    <div class="banner-content">
        
        <div class="banner-text-group">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon-cookie" viewBox="0 0 20 20" fill="currentColor" width="24" height="24">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" />
            </svg>
            
            <p class="text-message">
                <span data-i18n="cookieConsent.message"></span>
                
                <a 
                    href="#" 
                    class="link-more-info" 
                    data-i18n-url="cookieConsent.moreInfoLink.url"
                    data-i18n="cookieConsent.moreInfoLink.text">
                </a>
            </p>
        </div>

        <div class="banner-button-group">
            <button id="decline-cookies" class="btn-decline" data-i18n="cookieConsent.buttons.0.text">
                </button>
            
            <button id="accept-cookies" class="btn-accept" data-i18n="cookieConsent.buttons.1.text">
                </button>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/sl.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/de.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/hr.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/it.js"></script>
  
<script>
// =================================================================
// 0. GLOBALNE INICIALIZACIJE IN OSNOVNE SPREMENLJIVKE
// =================================================================

// API BASE URL
const API_BASE_URL = 'https://rentyo-gourmet-spletna-stran.onrender.com/api';

// GLOBALNE SPREMENLJIVKE ZA PODATKE IN STANJE
let allRestavracije = [];
let MOCK_IZPOSTAVLJENO_RAW = []; 
let currentFilterKuhinja = ''; 
let globalSelectedTime = null; 
let currentRestaurantId = null; 
let globalSelectedMizaId = null; 
let globalSelectedMizaIme = null; 

// üî• NOVA GLOBALNA SPREMENLJIVKA ZA LOKACIJO UPORABNIKA
let userLocation = null; 
const DEFAULT_LAT = 46.0569; // Ljubljana, kot privzeto, ƒçe ni lokacije
const DEFAULT_LON = 14.5058;

// GLOBALNE DEFINICIJE DOM ELEMENTOV (Ohranjene, ƒçe so definirane v HTML)
const modal = document.getElementById("loginModal");
const closeBtn = document.getElementById("zapriModal");
const tabPrijava = document.getElementById("tabPrijava");
const tabRegistracija = document.getElementById("tabRegistracija");
const formPrijava = document.getElementById("formPrijava");
const formRegistracija = document.getElementById("formRegistracija");
const openBtnDesktop = document.getElementById("odpriPrijavoDesktop");
const profilMeniDesktop = document.getElementById("profilMeniDesktop");
const gumbOdjavaDesktop = document.getElementById("gumbOdjavaDesktop");
const openBtnMobilni = document.getElementById("odpriPrijavoMobilni");
const profilMeniMobilni = document.getElementById("profilMeniMobilni");
const gumbOdjavaMobilni = document.getElementById("gumbOdjavaMobilni");
const mobilniMeni = document.getElementById('mobilniMeni'); 
const hamburgerGumb = document.getElementById('hamburgerGumb');
const mrezaKarticDiv = document.getElementById('restavracije-container'); 
const statusKarticeDiv = document.getElementById('statusKartice');
const mrezaIzpostavljenoKarticDiv = document.getElementById('mrezaIzpostavljenoKartic');
const restavracijaModal = document.getElementById('restavracijaModal');
const zapriRestavracijaModal = document.getElementById('zapriRestavracijaModal');
const modalSlika = document.getElementById('modalSlika');
const modalIme = document.getElementById('modalIme');
const modalKuhinja = document.getElementById('modalKuhinja');
const modalLokacija = document.getElementById('modalLokacija');
const modalOcena = document.getElementById('modalOcena');
const modalOpis = document.getElementById('modalOpis');
const modalTabs = document.querySelectorAll('.modal-tab');
const modalMeni = document.getElementById('modalMeni');
const galerijaSlikeDiv = document.getElementById('galerijaSlike');
const modalZemljevid = document.getElementById('modalZemljevid');
const durationModal = document.getElementById("durationModal");
const zapriDurationModal = document.getElementById("zapriDurationModal");
const durationOpcije = document.getElementById("durationOpcije");
const potrdiTrajanjeGumb = document.getElementById("potrdiTrajanjeGumb");
const warningModal = document.getElementById("warningModal");
const gumbRazumem = document.getElementById("gumbRazumem");
const modalDatumInput = document.getElementById('modalDatum');
const modalOsebeInput = document.getElementById('modalOsebe');
const gumbRezervirajModal = document.querySelector('.gumb-rezerviraj-modal'); 
const iskalnik = document.querySelector('.iskalnik');


// =================================================================
// I. POMO≈ΩNE FUNKCIJE IN GEOLOKACIJA 
// =================================================================

function generateStarsHTML(rating) {
    const fullStar = '‚òÖ'; 
    const maxStars = 5;
    const roundedRating = Math.round(rating);

    let starsHTML = '';
    for (let i = 1; i <= maxStars; i++) {
        if (i <= roundedRating) {
            starsHTML += `<span style="color: #ff9900;">${fullStar}</span>`;
        } else {
            starsHTML += `<span style="color: #e0e0e0;">${fullStar}</span>`;
        }
    }
    return starsHTML;
}

/**
 * Izraƒçuna razdaljo med dvema koordinatama (Haversinova formula)
 * @returns Razdalja v kilometrih (km).
 */
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Polmer Zemlje v kilometrih
    const dLat = (lat2 - lat1) * (Math.PI / 180);
    const dLon = (lon2 - lon1) * (Math.PI / 180);
    const a = 
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = R * c; // Razdalja v km
    return distance;
}

const prikaziSporocilo = (msg, type = 'info', duration = 4000) => { 
    console.log(`[Toaster Sporoƒçilo] ${type}: ${msg}`);
    
    const container = document.getElementById('toaster-container');
    if (!container) {
        console.error("Toaster container (id='toaster-container') ni najden v HTML-ju.");
        return;
    }

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let iconClass = '';
    if (type === 'success') iconClass = 'fas fa-check-circle';
    else if (type === 'error') iconClass = 'fas fa-exclamation-triangle';
    else if (type === 'warning') iconClass = 'fas fa-exclamation-circle';
    else iconClass = 'fas fa-info-circle'; 

    toast.innerHTML = `
        <div>
            <span class="toast-icon"><i class="${iconClass}"></i></span>
            <span>${msg}</span>
        </div>
    `;

    container.prepend(toast); 
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 10); 

    setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => {
            toast.remove();
        }, { once: true });
    }, duration);
    
    toast.addEventListener('click', () => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => {
            toast.remove();
        }, { once: true });
    });
};

const preimenujOsebe = () => {
    const select = document.getElementById("stevilo_oseb");
    if (select && typeof i18next !== "undefined") {
        Array.from(select.options).forEach((option) => {
            const count = parseInt(option.value);
            const translationKey = "search.person_singular"; 
            option.textContent = i18next.t(translationKey, { count: count });
        });
    }
};

function generirajCasovneOpcije() {
  const select = document.getElementById("cas");
  if (!select) return; 
  for (let h = 10; h <= 23; h++) {
    let c1 = `${h.toString().padStart(2, "0")}:00`;
    let c2 = `${h.toString().padStart(2, "0")}:30`;
    select.add(new Option(c1, c1));
    if (h < 23) select.add(new Option(c2, c2));
  }
  select.value = "19:00";
}

const updateContent = () => {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const options = el.getAttribute("data-i18n-options") ? JSON.parse(el.getAttribute("data-i18n-options")) : {};

    if (key.startsWith("[placeholder]")) el.placeholder = i18next.t(key.replace("[placeholder]", ""), options);
    else el.textContent = i18next.t(key, options);
  });
  if(i18next && i18next.exists("app.title")) document.title = i18next.t("app.title");
  preimenujOsebe();
};

const getAuthHeaders = () => {
    const headers = { 'Content-Type': 'application/json' };
    const token = localStorage.getItem('zeton');
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    return headers;
};

const formatirajDatumZaBackend = (datumPrikaz) => {
    if (!datumPrikaz || datumPrikaz.length !== 10) return null;
    try {
        const [dan, mesec, leto] = datumPrikaz.split('.');
        // API priƒçakuje format YYYY-MM-DD
        return `${leto}-${mesec.padStart(2, '0')}-${dan.padStart(2, '0')}`;
    } catch (e) {
        console.error("Napaka pri formatiranju datuma:", e);
        return null;
    }
};

/**
 * Pridobitev lokacije uporabnika in preraƒçun razdalj.
 */
function getUserLocation() {
    const storedLocation = localStorage.getItem('userLocation');
    if (storedLocation) {
        userLocation = JSON.parse(storedLocation);
        console.log("Lokacija pridobljena iz localStorage.");
        return; 
    }
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                userLocation = {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
                localStorage.setItem('userLocation', JSON.stringify(userLocation));
                console.log(`Lokacija uspe≈°no pridobljena in shranjena: ${userLocation.lat}, ${userLocation.lon}`);
                // Po pridobitvi lokacije ponovno renderiramo restavracije, da se posodobi razdalja
                filterAndRenderRestavracije();
            },
            (error) => {
                console.warn(`Napaka pri pridobivanju lokacije: ${error.message}`);
                userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON };
                prikaziSporocilo(i18next.t('messages.location_denied') || 'Lokacija ni na voljo. Razdalje so izraƒçunane iz privzete toƒçke.', 'warning');
            },
            { enableHighAccuracy: false, timeout: 5000, maximumAge: 0 }
        );
    } else {
        console.log("Geolokacija v brskalniku ni podprta.");
        userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON };
    }
}


// =================================================================
// II. LOGIKA PRIJAVE/ODJAVE IN MODALOV ZA UPORABNIKE
// =================================================================

const setLoginStatus = (isLoggedIn) => {
    if (!isLoggedIn) {
        localStorage.removeItem('zeton');
        localStorage.removeItem('jeLastnik');
        localStorage.removeItem('telefon'); 
        localStorage.removeItem('ime'); 
    }
    
    if (isLoggedIn) {
        if(openBtnDesktop) openBtnDesktop.style.display = "none"; 
        if(profilMeniDesktop) profilMeniDesktop.style.display = "flex"; 
        if(openBtnMobilni) openBtnMobilni.style.display = "none"; 
        if(profilMeniMobilni) profilMeniMobilni.style.display = "flex"; 
    } else {
        if(openBtnDesktop) openBtnDesktop.style.display = "flex"; 
        if(profilMeniDesktop) profilMeniDesktop.style.display = "none"; 
        if(openBtnMobilni) openBtnMobilni.style.display = "flex"; 
        if(profilMeniMobilni) profilMeniMobilni.style.display = "none"; 
    }
};

const checkInitialLoginStatus = () => {
    const isLoggedIn = localStorage.getItem('zeton') !== null;
    setLoginStatus(isLoggedIn);
};
checkInitialLoginStatus(); 

// --- LISTENERJI (Se izvedejo ob DOMContentLoaded) ---
document.addEventListener('DOMContentLoaded', () => { 
    
    const openModalListeners = [openBtnDesktop, openBtnMobilni].filter(btn => btn !== null);
    openModalListeners.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            if(modal) modal.classList.add("active");
            if(mobilniMeni) mobilniMeni.classList.remove('active'); 
        });
    });

    if(closeBtn) closeBtn.addEventListener("click", () => modal.classList.remove("active"));
    if(modal) window.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.remove("active");
    });

    if (tabPrijava && tabRegistracija && formPrijava && formRegistracija) {
        tabPrijava.addEventListener("click", () => {
          tabPrijava.classList.add("active");
          tabRegistracija.classList.remove("active");
          formPrijava.classList.add("active");
          formRegistracija.classList.remove("active");
        });

        tabRegistracija.addEventListener("click", () => {
          tabRegistracija.classList.add("active");
          tabPrijava.classList.remove("active");
          formRegistracija.classList.add("active");
          formPrijava.classList.remove("active");
        });
    }

    if (formRegistracija) {
        const pogojiCheckbox = document.getElementById('pogojiStrinjanje');
        const gumbRegistracija = formRegistracija.querySelector('button[type="submit"]');

        if (pogojiCheckbox && gumbRegistracija) {
            gumbRegistracija.disabled = !pogojiCheckbox.checked;
            pogojiCheckbox.addEventListener('change', function() {
                gumbRegistracija.disabled = !this.checked;
            });
        }
    }

    if(formPrijava) formPrijava.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = formPrijava.querySelector('input[type="email"]').value;
        const geslo = formPrijava.querySelector('input[type="password"]').value;
        try {
            const res = await fetch(`${API_BASE_URL}/auth/prijava`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, geslo })
            });
            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('zeton', data.zeton); 
                const jeLastnik = data.zelastnik !== undefined ? data.zelastnik : data.jeLastnik; 
                localStorage.setItem('jeLastnik', jeLastnik); 
                if (data.ime) localStorage.setItem('ime', data.ime); 
                if (data.telefon) localStorage.setItem('telefon', data.telefon); 
                
                setLoginStatus(true); 
                if(modal) modal.classList.remove("active");
                prikaziSporocilo(i18next.t('messages.login_success') || 'Uspe≈°na prijava!', 'success');
            } else {
                prikaziSporocilo(data.msg || i18next.t('messages.login_failed') || 'Prijava neuspe≈°na.', 'error');
            }
        } catch (err) {
            console.error("Napaka pri klicu prijave:", err);
            prikaziSporocilo(i18next.t('messages.server_error') || 'Napaka stre≈ænika pri prijavi.', 'error');
        }
    });

    if(formRegistracija) formRegistracija.addEventListener("submit", async (e) => {
        e.preventDefault();
        const pogojiCheckbox = document.getElementById('pogojiStrinjanje');
        if (!pogojiCheckbox || !pogojiCheckbox.checked) {
            prikaziSporocilo(i18next.t('messages.pogoji_required') || 'Za registracijo morate sprejeti Splo≈°ne pogoje.', 'error');
            return;
        }
        const imeInput = formRegistracija.querySelector('input[name="ime"]') || formRegistracija.querySelector('input[type="text"]');
        const emailInput = formRegistracija.querySelector('input[type="email"]');
        const gesloInput = formRegistracija.querySelector('input[type="password"]');
        const ime = imeInput ? imeInput.value.trim() : '';
        const email = emailInput ? emailInput.value.trim() : '';
        const geslo = gesloInput ? gesloInput.value.trim() : '';
        if (!ime || !email || !geslo) {
            prikaziSporocilo(i18next.t('messages.required_fields_missing') || 'Vnesite vsa polja!', 'error');
            return; 
        }
        const jeLastnik = false; 
        const cena = 0; 
        const telefon = '040123456'; 
        
        try {
            const res = await fetch(`${API_BASE_URL}/auth/registracija`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ime, email, geslo, jeLastnik, cena, telefon })
            });
            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('zeton', data.zeton); 
                localStorage.setItem('jeLastnik', jeLastnik); 
                localStorage.setItem('ime', ime); 
                localStorage.setItem('telefon', telefon); 
                
                setLoginStatus(true); 
                if(modal) modal.classList.remove("active");
                prikaziSporocilo(i18next.t('messages.registration_success') || 'Uspe≈°na registracija!', 'success');
            } else {
                prikaziSporocilo(data.msg || i18next.t('messages.registration_failed') || 'Registracija neuspe≈°na.', 'error');
            }
        } catch (err) {
            console.error("Napaka pri klicu registracije:", err);
            prikaziSporocilo(i18next.t('messages.server_error') || 'Napaka stre≈ænika pri registraciji.', 'error');
        }
    });
        
    const logoutListeners = [gumbOdjavaDesktop, gumbOdjavaMobilni].filter(btn => btn !== null);
    logoutListeners.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            setLoginStatus(false);
            if(mobilniMeni) mobilniMeni.classList.remove('active'); 
            window.location.href = 'index.html'; 
        });
    });

    // üî• POPRAVEK ZA GLAVNI MOBILNI MENI (HAMBURGER V GLAVI)
    if(hamburgerGumb && mobilniMeni) {
        hamburgerGumb.addEventListener('click', () => {
            mobilniMeni.classList.toggle('active');
            const icon = hamburgerGumb.querySelector('i');
            if (icon) {
                if (mobilniMeni.classList.contains('active')) {
                    icon.classList.remove('fa-ellipsis-h');
                    icon.classList.add('fa-times'); 
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-ellipsis-h'); 
                }
            }
            // Opcijsko: Prepreƒçi scroll, ko je meni odprt
            document.body.classList.toggle('menu-open', mobilniMeni.classList.contains('active'));
        });
    }

    // LOGIKA REZERVACIJSKEGA MODALA (API klic)
    
    const currentLang = i18next.language; 
    if (modalDatumInput && typeof flatpickr !== "undefined") {
        flatpickr(modalDatumInput, {
            dateFormat: "d.m.Y", 
            altInput: true,
            altFormat: "d.m.Y",
            locale: currentLang, 
            minDate: "today", 
            onChange: function(selectedDates, dateStr, instance) {
                modalDatumInput.setAttribute('data-reserv-datum', dateStr);
                globalSelectedTime = null; 
                
                const prosteUreRezultati = document.getElementById('prosteUreRezultati'); 
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
                    '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
                updateContent();
            }
        });
    }

    if (gumbRezervirajModal) {
        gumbRezervirajModal.onclick = null; 
        gumbRezervirajModal.addEventListener('click', () => {
            
            const prosteUreRezultati = document.getElementById('prosteUreRezultati'); 
            const izbranDatum = modalDatumInput ? modalDatumInput.value : null; 
            const steviloOseb = modalOsebeInput ? modalOsebeInput.value : null;

            if (globalSelectedTime) {
                odpriDurationModal();
                return;
            }

            if (!currentRestaurantId) {
                const errorMsg = i18next.t('messages.no_restaurant_selected') || 'Restavracija ni izbrana.';
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p style="color: red;">${errorMsg}</p>`;
                return;
            }

            if (!izbranDatum) {
                const warningMsg = i18next.t('messages.select_reservation_date') || 'Prosimo, izberite datum.';
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p style="color: red;">${warningMsg}</p>`;
                return;
            }
            
            if(prosteUreRezultati) {
                prosteUreRezultati.innerHTML = '';
                prosteUreRezultati.innerHTML = `<p data-i18n="messages.loading_availability">Preverjam razpolo≈æljivost...</p>`;
            }
            
            const datumZaBackend = formatirajDatumZaBackend(izbranDatum); 

            const dataToSend = {
                restavracijaId: currentRestaurantId,
                datum: datumZaBackend, 
                stevilo_oseb: parseInt(steviloOseb),
            };
            
            if (!datumZaBackend) {
                 console.error("Neveljaven datum za backend:", izbranDatum);
                 if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p class="alert alert-danger">Napaka: Neveljaven datum format. Izberite ponovno.</p>`;
                 return;
            }

            fetch(`${API_BASE_URL}/restavracije/proste_ure`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            })
            .then(async response => {
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Klic neuspe≈°en - Status:', response.status, 'Odgovor stre≈ænika:', errorText);
                    throw new Error(i18next.t('messages.server_error_detailed', { status: response.status }) || `Napaka stre≈ænika: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const prosteUreRezultati = document.getElementById('prosteUreRezultati'); 
                let ureHTML = '';
                
                if (data.mize && data.mize.length > 0) {
                    const prikazaneUre = new Set();
                    ureHTML += `<p style="margin-bottom: 10px;" data-i18n="messages.available_times_found">Na voljo proste ure za ${izbranDatum}:</p>`;
                    ureHTML += '<div class="gumbi-proste-ure">';
                    
                    data.mize.forEach(miza => {
                        if (miza.prosteUre) { 
                             miza.prosteUre.forEach(ura => {
                                const uraFloat = parseFloat(ura);
                                const ure = Math.floor(uraFloat);
                                const minute = Math.round((uraFloat - ure) * 60);
                                const uraFormat = `${ure.toString().padStart(2, "0")}:${minute.toString().padStart(2, "0")}`;
                                
                                const mizaIdValue = miza.mizaId || miza._id || null; 
                                
                                if (!prikazaneUre.has(uraFormat) && mizaIdValue) {
                                    const mizaIme = miza.ime || 'Miza'; 
                                    
                                    ureHTML += `<button type="button" class="gumb-ura" data-time="${uraFormat}" data-miza-id="${mizaIdValue}" data-miza-ime="${mizaIme}">${uraFormat}</button>`;
                                    
                                    prikazaneUre.add(uraFormat);
                                }
                            });
                        }
                    });

                    ureHTML += '</div>';
                    
                } else {
                    ureHTML = `<p class="alert alert-warning">${data.msg || i18next.t('messages.no_times_available') || 'Na ≈æalost ni prostih ur.'}</p>`;
                }
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = ureHTML;
                updateContent(); 
                setupTimeSlotListeners(); 

            })
            .catch(error => {
                const prosteUreRezultati = document.getElementById('prosteUreRezultati'); 
                console.error('Konƒçna napaka pri pridobivanju prostih ur:', error.message);
                
                const errorMsg = error.message.includes('messages.server_error') 
                    ? error.message 
                    : (i18next.t('messages.server_error') || 'Napaka stre≈ænika pri preverjanju ur.'); 
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p class="alert alert-danger">${errorMsg}</p>`;
            });
            
        });
    }
}); // Konec DOMContentLoaded

// =================================================================
// III. LOGIKA SOGLASJA ZA PI≈†KOTKE
// =================================================================

const CONSENT_COOKIE_NAME = 'user_consent_given';
const BANNER_ID = 'cookie-consent-banner';
const EXPIRATION_DAYS = 365; 

function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for(let i=0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function setCookie(value) {
    const date = new Date();
    date.setTime(date.getTime() + (EXPIRATION_DAYS * 24 * 60 * 60 * 1000));
    const expires = "; expires=" + date.toUTCString();
    document.cookie = CONSENT_COOKIE_NAME + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
}

function initializeCookieConsent() {
    const banner = document.getElementById(BANNER_ID);
    const existingConsent = getCookie(CONSENT_COOKIE_NAME);

    if (!banner) return console.error("Cookie banner element not found.");

    if (!existingConsent) {
        banner.classList.remove('hidden');
        const content = banner.querySelector('.banner-content'); 
        if (content) {
            content.classList.add('slide-in-up');
        }

        const acceptBtn = document.getElementById('accept-cookies');
        if(acceptBtn) acceptBtn.addEventListener('click', () => {
            setCookie('accepted');
            banner.classList.add('hidden');
            console.log("Soglasje sprejeto.");
        });

        const declineBtn = document.getElementById('decline-cookies');
        if(declineBtn) declineBtn.addEventListener('click', () => {
            setCookie('declined');
            banner.classList.add('hidden');
            console.log("Soglasje zavrnjeno.");
        });

    } else {
        banner.classList.add('hidden');
    }
}
window.onload = initializeCookieConsent;

// =================================================================
// IV. LOGIKA KARTIC RESTAVRACIJ 
// =================================================================

// 1. Renderiranje Ene Kartice (ZA PRILJUBLJENO)
function renderCard(restavracija) {
    const card = document.createElement('div');
    card.className = 'kartica';
    card.setAttribute('data-id', restavracija._id || restavracija.id);
    
    const restavracijaIme = restavracija.imeRestavracije || 'Neznano Ime';
    const slikaUrl = restavracija.urlSlike || 'https://via.placeholder.com/300x200?text=Slika+ni+na+voljo'; 
    
    // üî• Interna ocena (va≈° obstojeƒçi sistem z zvezdicami)
    const internaOcena = restavracija.ocena_povprecje || 0;
    const ratingDisplay = `${generateStarsHTML(internaOcena)} <span class="ocena-stevilka">(${(internaOcena).toFixed(1)})</span>`;

    // --- NOVO: Googlova ocena ---
    const googleRating = restavracija.googleRating || 0;
    const googleReviewCount = restavracija.googleReviewCount || 0;
    
    let googleRatingHTML = '';
    if (googleRating > 0) {
        // üî• POPRAVEK: Pridobimo preveden tekst za "Google mnenj" v JS kot ƒçisti niz
        const translatedReviewsText = i18next.t('messages.google_reviews') || 'Google mnenj';
        
        googleRatingHTML = `
            <p class="google-ocena">
                <i class="fab fa-google" style="color: #4285F4;"></i> 
                <span>${googleRating.toFixed(1)}/5 (${googleReviewCount} ${translatedReviewsText})</span>
            </p>
        `;
    }
    // ----------------------------
    
    // üî• LOGIKA ZA IZRAƒåUN RAZDALJE
    let oddaljenostKm = '';
    const restavracijaLat = restavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const restavracijaLon = restavracija.lokacija?.coordinates?.[0] || DEFAULT_LON;
    
    if (userLocation) {
         // Izraƒçun razdalje med uporabnikom in restavracijo
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            restavracijaLat, 
            restavracijaLon
        );
        
        oddaljenostKm = Math.round(distance).toString(); 

    } else {
        // ƒåe ni lokacije, uporabimo privzeto razdaljo/prazno vrednost
        oddaljenostKm = i18next.t('results.distance_unknown') || '...';
    }
    
    const oddaljenostHTML = `<span class="oddaljenost"><i class="fas fa-location-arrow"></i> ${oddaljenostKm} km</span>`;
    if (oddaljenostKm === '...') {
         oddaljenostHTML = `<span class="oddaljenost" data-i18n="results.distance_unknown" style="opacity: 0.7;"><i class="fas fa-location-arrow"></i> ${oddaljenostKm}</span>`;
    }
    
    const status = restavracija.razpolozljivost_status || (Math.random() > 0.8 ? 'tomorrow' : 'available');
    const cas = restavracija.razpolozljivost_cas || '19:00';
    let razpolozljivostTextKey;
    let isAvailable = true;
    
    if (status === 'available') {
        razpolozljivostTextKey = i18next.t('results.available_today', { time: cas });
    } else if (status === 'tomorrow') {
        razpolozljivostTextKey = i18next.t('results.available_tomorrow', { time: cas });
        isAvailable = false; 
    } else {
        razpolozljivostTextKey = i18next.t('results.unavailable');
        isAvailable = false;
    }

    const razpolozljivostHTML = `
        <div class="razpolozljivost-ovoj ${!isAvailable ? 'zasedeno' : ''}">
            <p data-i18n="${status === 'available' ? 'results.available_today' : status === 'tomorrow' ? 'results.available_tomorrow' : 'results.unavailable'}" data-i18n-options='{"time": "${cas}"}'>${razpolozljivostTextKey}</p>
        </div>
    `;
    
    card.innerHTML = `
        <img src="${slikaUrl}" alt="${restavracijaIme}" class="kartica-slika" onerror="this.onerror=null;this.src='https://via.placeholder.com/300x200?text=Slika+ni+na+voljo';">
        <div class="kartica-vsebina">
            <h3>${restavracijaIme}</h3>
            
            <div class="info-ocena-oddaljenost">
                <p class="ocena">${ratingDisplay}</p>
                
                ${googleRatingHTML} 
                
                ${oddaljenostHTML}
            </div>
            
            ${razpolozljivostHTML} 
        </div>
    `;
    
    card.addEventListener('click', (e) => {
        if (e.target.classList.contains('gumb-rezervacija')) {
             return;
        }
        prikaziPodrobnosti(restavracija);
    });
    
    return card;
}

// 2. Renderiranje Ene Kartice (ZA IZPOSTAVLJENO)
function renderFeaturedCard(restavracija) {
    const card = document.createElement('div');
    card.className = 'kartica kartica-izpostavljeno';
    card.setAttribute('data-id', restavracija._id || restavracija.id);
    card.addEventListener('click', () => prikaziPodrobnosti(restavracija));

    const restavracijaIme = restavracija.imeRestavracije || 'Neznano Ime';
    const slikaUrl = restavracija.urlSlike || restavracija.mainImageUrl || 'https://via.placeholder.com/300x200?text=Slika+ni+na+voljo';

    card.innerHTML = `
        <div class="slika-kartice" style="background-image: url('${slikaUrl}')"></div>
        <div class="vsebina-kartice-izpostavljeno">
            <h3>${restavracijaIme}</h3>
        </div>
    `;
    return card;
}

// 3. Filtriranje in Prikaz (PRILJUBLJENO)
function filterAndRenderRestavracije(optionalFilteredList) {
    if (!mrezaKarticDiv || !statusKarticeDiv) return;

    const listToRender = optionalFilteredList || allRestavracije;
    
    const filtered = listToRender.filter(r => {
        if (currentFilterKuhinja === '') return true; 
        return r.deviznaKuhinja === currentFilterKuhinja; 
    });

    mrezaKarticDiv.innerHTML = '';
    statusKarticeDiv.textContent = '';
    
    if (filtered.length === 0) {
        statusKarticeDiv.textContent = i18next.t('messages.no_restaurants_found') || 'Ni najdenih restavracij.'; 
        return;
    }

    filtered.forEach(restavracija => {
        mrezaKarticDiv.appendChild(renderCard(restavracija));
    });
    
    updateContent(); 
}

// 4. Prikaz Izpostavljenih Restavracij
function renderFeaturedRestavracije() {
    if (!mrezaIzpostavljenoKarticDiv) return;
    
    mrezaIzpostavljenoKarticDiv.innerHTML = '';
    
    if (MOCK_IZPOSTAVLJENO_RAW.length === 0) {
        mrezaIzpostavljenoKarticDiv.innerHTML = '<div style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">' + (i18next.t('messages.no_restaurants_found') || 'Ni izpostavljenih restavracij.') + '</div>'; 
        return;
    }
    
    MOCK_IZPOSTAVLJENO_RAW.forEach(restavracija => {
        mrezaIzpostavljenoKarticDiv.appendChild(renderFeaturedCard(restavracija));
    });
    
    updateContent();
}

// 5. Nastavitev Gumbov za Hitro Iskanje Listenerji 
function setupKuhinjaFiltersListeners() {
    document.querySelectorAll('.gumb-kategorija').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            document.querySelectorAll('.gumb-kategorija').forEach(b => b.classList.remove('active'));
            
            const novaKuhinja = btn.getAttribute('data-kuhinja');
            if (currentFilterKuhinja === novaKuhinja) {
                currentFilterKuhinja = ''; 
            } else {
                btn.classList.add('active'); 
                currentFilterKuhinja = novaKuhinja;
            }
            
            filterAndRenderRestavracije();
        });
    });
}

if(iskalnik) iskalnik.addEventListener('submit', (e) => {
    e.preventDefault();
    filterAndRenderRestavracije();
});


// 6. Glavna funkcija za nalaganje (PRAVI API KLIC) 
async function loadRestavracije() {
    if (!mrezaKarticDiv) return; 

    const API_CALL_URL = `${API_BASE_URL}/restavracije/privzeto`; 
    
    if(statusKarticeDiv) statusKarticeDiv.textContent = i18next.t('messages.searching', { criteria: '...' }) || 'I≈°ƒçem restavracije...'; 
    
    try {
        const response = await fetch(API_CALL_URL);
        
        if (!response.ok) {
            throw new Error(`Stre≈ænik je vrnil status ${response.status}`);
        }
        
        const data = await response.json();
        
        allRestavracije = data; 
        MOCK_IZPOSTAVLJENO_RAW = allRestavracije.slice(0, 3); 
        
        setupKuhinjaFiltersListeners();
        filterAndRenderRestavracije();
        renderFeaturedRestavracije(); 
        
        if(statusKarticeDiv) statusKarticeDiv.textContent = ''; 

    } catch (error) {
        console.error("Napaka pri nalaganju restavracij iz API-ja:", error);
        
        if(statusKarticeDiv) {
            statusKarticeDiv.textContent = i18next.t('messages.search_error') || 'Napaka pri nalaganju restavracij.'; 
            statusKarticeDiv.style.display = 'block';
        }
    }
}


// =================================================================
// V. POPRAVKI IN DODATNA LOGIKA ZA NOGO (FOOTER)
// =================================================================

document.addEventListener('DOMContentLoaded', () => { 
    
    // LOGIKA 1: Razkritje celotne vsebine noge (ƒçe imate gumb za celotno nogo)
    const footerToggleBtn = document.querySelector('.footer-toggle-btn');
    const nogaVsebinaSkrita = document.querySelector('.noga-vsebina-skrita');
    
    if (footerToggleBtn && nogaVsebinaSkrita) {
        footerToggleBtn.addEventListener('click', () => {
            nogaVsebinaSkrita.classList.toggle('active');
            
            // Logika za menjavo ikone v gumbu noge (ƒçe jo uporabljate)
            const ikona = footerToggleBtn.querySelector('i') || footerToggleBtn.querySelector('svg');
            if (ikona) {
               // To je odvisno od va≈°e implementacije ikon (fa-chevron-down/up, fa-plus/minus, itd.)
               // Pustimo to pri miru, ƒçe ni specificirano, da se izognemo napaki.
            }
        });
    }

    // LOGIKA 2: Akordion za posamezne sekcije v nogi (za naslove in linke)
    document.querySelectorAll('.noga-sekcija .noga-naslov').forEach(naslov => {
        naslov.addEventListener('click', (e) => {
            e.preventDefault(); 
            
            // Poi≈°ƒçi element, ki ga je treba razkriti (.noga-linki)
            const linki = naslov.nextElementSibling; 

            if (linki && linki.classList.contains('noga-linki')) {
                // Preklopi razred 'active', ki ga CSS uporabi za razkritje vsebine (max-height)
                linki.classList.toggle('active');
                
                // Dodaj/odstrani active razred na naslovu za CSS styling (npr. vrtenje ikone)
                naslov.classList.toggle('active');

                // Opcijsko: Zapri druge sekcije, ƒçe ≈æelite, da je akordion ekskluziven
                document.querySelectorAll('.noga-sekcija .noga-linki').forEach(otherLinki => {
                    if (otherLinki !== linki && otherLinki.classList.contains('active')) {
                        otherLinki.classList.remove('active');
                        // Tudi odstrani active iz naslova druge sekcije
                        const otherNaslov = otherLinki.previousElementSibling;
                        if (otherNaslov && otherNaslov.classList.contains('noga-naslov')) {
                            otherNaslov.classList.remove('active');
                        }
                    }
                });
            }
        });
    });

}); 


// =================================================================
// VI. LOGIKA MODALA RESTAVRACIJE
// =================================================================

// Funkcija, ki napolni modal s podatki in ga odpre
function prikaziPodrobnosti(restavracija) {
    
    currentRestaurantId = restavracija._id || restavracija.id; 
    const reservIdInput = document.querySelector('[data-reserv-id]');
    if (reservIdInput) reservIdInput.value = currentRestaurantId; 

    const restavracijaIme = restavracija.imeRestavracije || 'Neznano Ime';
    const kuhinja = restavracija.deviznaKuhinja || 'Neznano';
    const slikaUrl = restavracija.urlSlike || restavracija.mainImageUrl || 'https://via.placeholder.com/300x200?text=Slika+ni+na+voljo';
    const opis = restavracija.opis || restavracija.glavniOpis || ''; 
    
    // Lokacija restavracije
const lon = restavracija.lokacija?.coordinates?.[0] || DEFAULT_LON; 
const lat = restavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
const gpsString = `${lat.toFixed(4)},${lon.toFixed(4)}`; 

// üéØ IZRAƒåUN RAZDALJE ZA MODALNO OKNO
let prikazLokacije = '';

if (userLocation) {
     // Izraƒçun razdalje med uporabnikom in restavracijo
    const distance = getDistance(
        userLocation.lat, 
        userLocation.lon, 
        lat, 
        lon
    );
    
    // Zaokro≈æitev na celo ≈°tevilo (brez decimalk)
    const oddaljenostKm = Math.round(distance); 
    
    // Ustvarimo HTML za prikaz razdalje
    prikazLokacije = `<i class="fas fa-location-arrow"></i> ${oddaljenostKm} km`;
    
} else {
    // ƒåe lokacija uporabnika ni znana, prika≈æemo koordinate restavracije.
    prikazLokacije = `<i class="fas fa-map-marker-alt"></i> ${gpsString}`;
    // Opomba: ƒåe imate i18n, bi tukaj lahko bil tudi: i18next.t('results.distance_unknown') + ' ' + gpsString
}
// ------------------------------------

// Polnjenje Glavnih podrobnosti
if(modalSlika) modalSlika.style.backgroundImage = `url(${slikaUrl})`;
if(modalIme) modalIme.textContent = restavracijaIme;
if(modalKuhinja) modalKuhinja.innerHTML = `<i class="fas fa-utensils"></i> ${kuhinja}`;

// üî• KLJUƒåNA SPREMEMBA: Uporabimo izraƒçunano spremenljivko 'prikazLokacije'
if(modalLokacija) modalLokacija.innerHTML = prikazLokacije; 

if(modalOcena) modalOcena.innerHTML = `<i class="fas fa-star"></i> ${(restavracija.ocena_povprecje || 0).toFixed(1)}`;
if(modalOpis) modalOpis.textContent = opis;

    // Generiranje Menija (Ostane enako)
    if(modalMeni) {
        modalMeni.innerHTML = '';
        const menuObj = restavracija.meni || {}; 
        
        let hasMenu = false;
        
        for (const kategorija in menuObj) {
            const items = menuObj[kategorija]; 
            
            if (kategorija === 'tedenska_ponudba') {
                continue; 
            }
            
            if (Array.isArray(items) && items.length > 0) {
                hasMenu = true;
                if (kategorija !== 'osnovni_meni') {
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = kategorija;
                    modalMeni.appendChild(categoryHeader);
                }

                const ul = document.createElement('ul');
                items.forEach(item => {
                    const li = document.createElement('li');
                    
                    let desnaVrednost = '';
                    if (item.cena !== undefined && item.cena !== null) {
                        desnaVrednost = `${item.cena} ‚Ç¨`; 
                    } else if (item.opis) {
                        desnaVrednost = item.opis; 
                    } else {
                        desnaVrednost = ''; 
                    }

                    li.innerHTML = `
                        <div style="display: flex; justify-content: space-between; width: 100%;">
                            <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                            <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                        </div>
                    `;
                    ul.appendChild(li);
                });
                modalMeni.appendChild(ul);
            }
        }
        
        if (!hasMenu) {
            modalMeni.innerHTML = '<li class="text-gray-500"><span data-i18n="modal.no_menu">Meni ≈°e ni na voljo.</span></li>';
        }
    }
    
    // Polnjenje zavihka Aktualna Ponudba (Ostane enako)
    const ponudbaItems = restavracija.meni?.tedenska_ponudba || [];
    const modalAktualnaPonudbaDiv = document.getElementById('tabAktualnaPonudba'); 
    
    if (modalAktualnaPonudbaDiv) {
        let ponudbaHtml = '';
        if (ponudbaItems.length > 0) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '0';
            ponudbaItems.forEach(item => {
                let desnaVrednost = '';
                if (item.cena !== undefined && item.cena !== null) {
                    desnaVrednost = `${item.cena} ‚Ç¨`;
                } else if (item.opis) {
                    desnaVrednost = item.opis;
                } else {
                    desnaVrednost = '';
                }

                const li = document.createElement('li');
                li.style.listStyle = 'none';
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                        <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                    </div>
                `;
                ul.appendChild(li);
            });
            modalAktualnaPonudbaDiv.innerHTML = '';
            modalAktualnaPonudbaDiv.appendChild(ul);
        } else {
            modalAktualnaPonudbaDiv.innerHTML = '<p class="text-gray-500"><span data-i18n="modal.no_special_offer">Aktualna ponudba trenutno ni na voljo.</span></p>';
        }
    }
    
    // Generiranje Galerije in Zemljevida (Ostane enako)
    if(galerijaSlikeDiv) {
        galerijaSlikeDiv.innerHTML = '<p class="text-gray-500">Ni dodatnih slik za prikaz.</p>';
    }

    if (modalZemljevid) {
       modalZemljevid.src = `https://maps.google.com/maps?q=${lat},${lon}&hl=sl&z=15&output=embed`;
    }
    
    // Resetiraj prikaz prostih ur
    const prosteUreRezultati = document.getElementById('prosteUreRezultati');
    if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
        '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
        
    globalSelectedTime = null; 
    
    // Resetiraj na prvi zavihek (Meni)
    const defaultTab = document.querySelector('.modal-tab[data-tab="meni"]');
    if(defaultTab) defaultTab.click();

    // Odpri modal
    if(restavracijaModal) restavracijaModal.classList.add('active');
    updateContent(); 
}

// Zapiranje modala (Ostane enako)
if(zapriRestavracijaModal) zapriRestavracijaModal.addEventListener('click', () => {
    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(modalZemljevid) modalZemljevid.src = 'about:blank';
    currentRestaurantId = null; 
    globalSelectedMizaId = null; 
});

if(restavracijaModal) window.addEventListener('click', (e) => {
    if (e.target === restavracijaModal) {
        restavracijaModal.classList.remove('active');
        if(modalZemljevid) modalZemljevid.src = 'about:blank';
        currentRestaurantId = null; 
        globalSelectedMizaId = null; 
    }
});

// LOGIKA ZAVIHKOV (Ostane enako)
modalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');
        modalTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        const targetElementId = `tab${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`;
        const targetElement = document.getElementById(targetElementId);
        if (targetElement) targetElement.classList.add('active');
    });
});

// =================================================================
// VII. LOGIKA REZERVACIJE IN TRAJANJA
// =================================================================

/**
 * Kritiƒçna funkcija za izvedbo API klica rezervacije.
 */
window.handleIzvedbaRezervacije = async (podatki) => {

    if (!localStorage.getItem('zeton')) {
        prikaziSporocilo(i18next.t('messages.login_required') || 'Za rezervacijo morate biti prijavljeni.', 'error');
        if(modal) modal.classList.add("active");
        return;
    }
    
    const url = `${API_BASE_URL}/restavracije/ustvari_rezervacijo`;

    try {
        prikaziSporocilo(i18next.t('messages.reserving', { cas: podatki.casStart, stevilo: podatki.stevilo_oseb }), 'info');

        const payload = {
            restavracijaId: podatki.restavracijaId,
            mizaId: podatki.mizaId,
            imeGosta: podatki.imeGosta,
            telefon: podatki.telefon,
            stevilo_oseb: parseInt(podatki.stevilo_oseb),
            datum: formatirajDatumZaBackend(podatki.datumPrikaz), 
            casStart: podatki.casStart, 
            trajanjeUr: podatki.trajanjeUr 
        };
        
        console.log("Poslani podatki za rezervacijo:", payload);

        const response = await fetch(url, {
            method: 'POST',
            headers: getAuthHeaders(),
            body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (response.ok) {
            
            // Poenostavljeno sporocilo
            const uspehMsg = i18next.t('messages.reservation_success_minimal', { 
                cas: podatki.casStart
            }) || `Rezervacija uspe≈°na ob ${podatki.casStart}!`;
            
            prikaziSporocilo(uspehMsg, 'success');
            
            if(durationModal) durationModal.classList.remove('active');
            if(restavracijaModal) restavracijaModal.classList.remove('active');
            loadRestavracije();
        } else {
            prikaziSporocilo(data.msg || i18next.t('messages.reservation_failed') || 'Rezervacija ni uspela.', 'error');
        }

    } catch (error) {
        console.error('Napaka pri API klicu za rezervacijo:', error);
        prikaziSporocilo(i18next.t('messages.server_connection_error_retry') || 'Napaka stre≈ænika pri rezervaciji.', 'error');
    }
}


// Odpre modal za izbiro trajanja
window.odpriDurationModal = () => {
    if (!currentRestaurantId || !globalSelectedTime || !globalSelectedMizaId) { 
        console.error("Napaka: Ni izbrane restavracije, ƒçasa ali mize za rezervacijo.");
        prikaziSporocilo(i18next.t('messages.select_time_and_table_required') || "Napaka: Prosimo, izberite ƒças rezervacije in mizo.", 'error');
        if(restavracijaModal) restavracijaModal.classList.add('active'); 
        return;
    }

    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(durationModal) durationModal.classList.add('active');
}

// Zapre modal za izbiro trajanja
const zapriDurationModalHandler = () => {
    if(durationModal) durationModal.classList.remove('active');
    if(restavracijaModal) restavracijaModal.classList.add('active'); 
};
if(zapriDurationModal) zapriDurationModal.addEventListener('click', zapriDurationModalHandler);
if(durationModal) window.addEventListener("click", (e) => {
  if (e.target === durationModal) zapriDurationModalHandler();
});


// Vizualno oznaƒçevanje izbrane opcije in izbira radio gumba (Ostane enako)
if(durationOpcije) durationOpcije.querySelectorAll('.duration-opcija').forEach(opcijaDiv => {
    opcijaDiv.addEventListener('click', () => {
        durationOpcije.querySelectorAll('.duration-opcija').forEach(d => d.classList.remove('selected'));
        opcijaDiv.classList.add('selected');
        const radio = opcijaDiv.querySelector('input[type="radio"]');
        if (radio) radio.checked = true;
    });
});

// Handler za klik na gumb za uro
const timeButtonClickHandler = (e) => {
    const timeButtons = document.querySelectorAll('#prosteUreRezultati .gumb-ura');
    timeButtons.forEach(btn => btn.classList.remove('selected'));
    
    globalSelectedTime = e.target.getAttribute('data-time');
    globalSelectedMizaId = e.target.getAttribute('data-miza-id'); 
    globalSelectedMizaIme = e.target.getAttribute('data-miza-ime'); 
    
    e.target.classList.add('selected');
    odpriDurationModal(); 
};


// Listenerji za izbrano uro
function setupTimeSlotListeners() {
    const timeButtons = document.querySelectorAll('#prosteUreRezultati .gumb-ura');
    timeButtons.forEach(button => {
        button.removeEventListener('click', timeButtonClickHandler); 
        button.addEventListener('click', timeButtonClickHandler); 
    });
}

// Funkcija za potrditev rezervacije
const potrdiRezervacijo = () => {
    
    const modalDatumInput = document.getElementById('modalDatum'); 
    const modalOsebeInput = document.getElementById('modalOsebe'); 

    if (!currentRestaurantId) {
        alert(i18next.t('messages.no_restaurant_selected') || "Napaka: Restavracija ni izbrana!");
        return;
    }
    
    const datumPrikaz = modalDatumInput ? modalDatumInput.value : null; 
    const steviloOseb = modalOsebeInput ? modalOsebeInput.value : null; 
    const casStart = globalSelectedTime; 
    const mizaId = globalSelectedMizaId;
    const mizaIme = globalSelectedMizaIme;
    
    const izbranoTrajanjeElement = durationModal ? durationModal.querySelector('input[name="duration"]:checked') : null;
    const trajanje = izbranoTrajanjeElement ? parseFloat(izbranoTrajanjeElement.value) : 1.5; 
    
    const imeGosta = localStorage.getItem('ime') || 'Testni Rezervant';
    const telefon = localStorage.getItem('telefon') || '040123456'; 
    
    if (!datumPrikaz || !casStart || !steviloOseb || !mizaId) { 
        
        prikaziSporocilo(i18next.t('messages.required_fields_missing_time_miza') || 'Izpolnite vsa polja in **IZBERITE URO/MIZO** na prej≈°njem koraku.', 'error');
        
        if(durationModal) durationModal.classList.remove('active');
        if(restavracijaModal) restavracijaModal.classList.add('active'); 
        return;
    }
    
    if(durationModal) durationModal.classList.remove('active');
    
    console.log("=========================================");
    console.log(i18next.t('messages.reserving', { stevilo: steviloOseb, cas: casStart }));
    console.log(`Podatki za rezervacijo: Restavracija ID: ${currentRestaurantId}, Datum: ${datumPrikaz}, Osebe: ${steviloOseb}, Trajanje: ${trajanje} ur, Miza ID: ${mizaId}`);
    console.log("=========================================");

    const rezervacijaPodatki = {
        restavracijaId: currentRestaurantId,
        datumPrikaz: datumPrikaz, 
        stevilo_oseb: steviloOseb, 
        casStart: casStart, 
        trajanjeUr: trajanje,
        mizaId: mizaId, 
        mizaIme: mizaIme,
        imeGosta: imeGosta,
        telefon: telefon,
    };

    handleIzvedbaRezervacije(rezervacijaPodatki);
}

// =================================================================
// VIII. LOGIKA OPOZORILNEGA OKNA
// =================================================================

function prikaziOpozoriloObZagonu() {
    if (warningModal && !localStorage.getItem('warningDismissed')) {
        if (gumbRazumem) {
            warningModal.classList.add('active');
        }
    }
}

if(gumbRazumem) gumbRazumem.addEventListener('click', () => {
    if(warningModal) warningModal.classList.remove('active');
    localStorage.setItem('warningDismissed', 'true');
});


// Listener za gumb Potrdi Trajanje / Rezerviraj Mizo
if (potrdiTrajanjeGumb) {
    potrdiTrajanjeGumb.addEventListener('click', (e) => {
        e.preventDefault(); 
        potrdiRezervacijo();
    });
}

// =================================================================
// IX. ZAGON IN INITIALIZATION
// =================================================================

const setupLanguageSwitcher = () => {
  const selectDesktop = document.getElementById("izbiraJezikaDesktop");
  const selectMobilni = document.getElementById("izbiraJezikaMobilni");
  
  const selects = [selectDesktop, selectMobilni].filter(s => s !== null);

  if (selects.length === 0 || typeof i18next === 'undefined') return;

  const savedLang = localStorage.getItem('i18nextLng');
  const currentLang = savedLang || i18next.language;

  selects.forEach(select => select.value = currentLang); 

  selects.forEach(select => {
      select.addEventListener("change", (e) => {
        const newLang = e.target.value;
        localStorage.setItem('i18nextLng', newLang); 
        selects.filter(s => s !== e.target).forEach(s => s.value = newLang);
        
        i18next.changeLanguage(newLang, (err) => {
          if (err) return console.error(err);
          updateContent();
        });
      });
  });
};

// ZAGON i18next
if (typeof i18next !== 'undefined' && typeof i18nextHttpBackend !== 'undefined') {
    i18next.use(i18nextHttpBackend).init(
      {
        lng: localStorage.getItem('i18nextLng') || "sl",
        fallbackLng: "sl",
        backend: { loadPath: "./i18n/{{lng}}.json" },
      },
      (err) => {
        if (err) console.error(err);
        updateContent();
        setupLanguageSwitcher();
        generirajCasovneOpcije(); 
        
        // Inicializacija geolokacije pred nalaganjem restavracij
        getUserLocation();
        loadRestavracije(); 
        
        prikaziOpozoriloObZagonu(); 
      }
    );
}

// ZAGON DATE PICKERJA
if(typeof flatpickr !== "undefined") {
    flatpickr("#datum", {
      dateFormat: "d. m. Y",
      minDate: "today",
    });
}
    
</script>
    
    <div id="toaster-container">
        </div>

</body>
</html>