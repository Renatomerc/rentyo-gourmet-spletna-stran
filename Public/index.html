<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="app.title">Iskanje Restavracij - Gourmet & Experience</title>

  <link rel="stylesheet" href="style.css" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
  />
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/23.11.5/i18next.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-http-backend/2.5.2/i18nextHttpBackend.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.2.1/i18nextBrowserLanguageDetector.min.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
    /*
     * ========================================================================
     * I. STILI ZA PASICO PIKOTKOV (KRITI캛NI STILI - NA ZA캛ETKU)
     * ========================================================================
     */
    
    /* Osnovno resetiranje/stil za celotno stran - prilagojeno va코emu telesu */
    body {
        font-family: Arial, sans-serif;
    }

    /* Pasica za soglasje (glavni vsebnik) */
    .cookie-banner {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 50;
        padding: 1rem; /* p-4 */
        transition: all 0.5s ease-in-out;
    }

    /* Stanje, ko je pasica skrita */
    .cookie-banner.hidden {
        display: none;
    }

    /* Kontejner vsebine pasice */
    .banner-content {
        max-width: 64rem; /* max-w-4xl (1024px) */
        margin-left: auto;
        margin-right: auto;
        background-color: #ffffff; /* bg-white */
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* shadow-2xl */
        border-radius: 3rem; /* rounded-lg */
        padding: 1.25rem; /* p-5 */
        display: flex;
        flex-direction: column; /* flex-col */
        align-items: center;
        justify-content: space-between;
        row-gap: 0.75rem; /* space-y-3 */
        border: 2px solid #333;
    }

    /* Prilagoditev za ve캜je zaslone (md:flex-row) */
    @media (min-width: 768px) {
        .banner-content {
            flex-direction: row;
            row-gap: 0;
        }
    }

    /* Skupina besedila in ikone */
    .banner-text-group {
        display: flex;
        align-items: center;
        column-gap: 0.75rem; /* space-x-3 */
        color: #4b5563; /* text-gray-700 */
    }

    /* Ikona pi코kotka */
    .icon-cookie {
        height: 1.5rem; /* h-6 */
        width: 1.5rem; /* w-6 */
        color: #4edaa9; /* text-emerald-500 */
        flex-shrink: 0;
    }

    /* Sporo캜ilo */
    .text-message {
        font-size: 0.875rem; /* text-sm */
        margin: 0;
    }

    /* Povezava "Preberi ve캜" */
    .link-more-info {
        color: #4edaa9; /* text-emerald-600 */
        font-weight: 500; /* font-medium */
        margin-left: 0.25rem; /* ml-1 */
        text-decoration: none;
        transition: color 150ms ease-in-out;
                      /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .link-more-info:hover {
        color: #4edaa9; /* hover:text-emerald-800 */
    }

    /* Skupina gumbov */
    .banner-button-group {
        display: flex;
        column-gap: 0.75rem; /* space-x-3 */
        flex-shrink: 0;
    }

    /* Osnovni stil za gumbe */
    .banner-button-group button {
        padding: 0.5rem 1rem; /* px-4 py-2 */
        font-size: 0.875rem; /* text-sm */
        font-weight: 600; /* font-semibold */
        border-radius: 5rem; /* rounded-lg */
        transition: background-color 150ms ease-in-out, box-shadow 150ms ease-in-out;
        border: none;
        cursor: pointer;
        /* Odstrani moder poudarek za mobilne naprave */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
                      /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    /* Gumb za zavrnitev (Decline) */
    .btn-decline {
        color: #4b5563; /* text-gray-600 */
        background-color: #f3f4f6; /* bg-gray-100 */
                      /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .btn-decline:hover {
        background-color: #e5e7eb; /* hover:bg-gray-200 */
    }

    /* Gumb za sprejem (Accept) */
    .btn-accept {
        color: #ffffff; /* text-white */
        background-color: #4edaa9; /* bg-emerald-600 */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-md */
    }

    .btn-accept:hover {
        background-color: #27a378; /* hover:bg-emerald-700 */
    }

    /* Animacija, da se pasica elegantno pojavi (slide-in-up) */
    .slide-in-up {
        animation: slideInUp 0.5s ease-out forwards;
    }
    @keyframes slideInUp {
        from { 
            transform: translateY(100%); 
            opacity: 0; 
        }
        to { 
            transform: translateY(0); 
            opacity: 1; 
        }
    }
    
    /*
     * ========================================================================
     * II. OSTALI STILI (MODALI, KARTICE, ITD.)
     * ========================================================================
     */

    /* ===== MODAL ZA PRIJAVO / REGISTRACIJO (OSTANE NESPREMENJENO) ===== */
    .login-modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      overflow-y: auto; 
    }

    .login-modal.active {
      display: flex;
    }

    .login-content {
      background: #fff;
      padding: 30px;
      border-radius: 16px;
      width: 350px;
      max-width: 90%;
      text-align: center;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      animation: fadeIn 0.3s ease;
      margin: 50px auto; 
    }

    @media (max-width: 600px) {
        .login-content {
            padding: 20px;
            margin: 20px auto;
        }
    }


    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-tabs {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .login-tab {
      flex: 1;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
      border-bottom: 2px solid transparent;
      transition: 0.2s;
                /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .login-tab.active {
      
      color: #20c0bd;
      border-bottom: 2px solid #20c0bd; /* Dodan border za aktiven tab */
    }

    .login-form {
      display: none;
    }

    .login-form.active {
      display: block;
    }

    .login-form input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      /* POPRAVEK ZA ZOOM: Nastavimo velikost pisave na 16px, da prepre캜imo avtomatsko pove캜avo */
      font-size: 16px !important; 
    }

    /* ----------------------------------------------------------------- */
    /* 游댠 NOVI STILI ZA POGOJE IN ONEMOGO캛EN GUMB 游댠 */
    /* ----------------------------------------------------------------- */

    .form-group-checkbox {
        display: flex;
        align-items: flex-start; /* Poravnaj kljukico in besedilo na za캜etek */
        margin-bottom: 15px; /* Dodamo malo razmika pod kljukico */
        text-align: left;
    }

    .form-group-checkbox input[type="checkbox"] {
        width: auto; /* Kljukica naj ne zavzame celotne 코irine */
        margin-right: 8px;
        margin-top: 3px; /* Lahka prilagoditev za vertikalno poravnavo */
        border-radius: 4px;
        accent-color: #20c0bd; /* Barva kljukice */
                  /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .form-group-checkbox label {
        font-size: 0.85rem;
        color: #555;
        line-height: 1.4;
        cursor: pointer;
                  /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .form-group-checkbox a {
        color: #20c0bd;
        font-weight: bold;
        text-decoration: none;
        transition: color 0.2s;
        
    }

    .form-group-checkbox a:hover {
        color: #169b99;
        text-decoration: underline;
        
    }

    .required-star {
        color: red;
        margin-left: 2px;
        font-weight: bold;
    }

    /* Stil za gumb za oddajo */
    .login-form button {
      width: 100%; /* Nastavite 코irino na 100% za bolj코i mobilni videz */
      padding: 10px;
      border: none;
      border-radius: 8px;
      background-color: #20c0bd;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
                /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .login-form button:hover:not(:disabled) {
      background-color: #169b99;
    }

    /* Poseben stil, ko je gumb onemogo캜en (disabled) */
    .login-form button:disabled {
        background-color: #cccccc; /* Svetlo siva, da je o캜itno onemogo캜eno */
        color: #888888;
        cursor: not-allowed;
        box-shadow: none;
    }
    /* ----------------------------------------------------------------- */
    /* 游댠 KONEC NOVIH STILOV 游댠 */
    /* ----------------------------------------------------------------- */

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 35px;
      font-weight: bold;
      cursor: pointer;
      color: #333;
      border-radius: 50%;
      display: flex; /* Uporabimo flexbox za centriranje X-a */
      justify-content: center; /* Centriraj X horizontalno */
      align-items: center; /* Centriraj X vertikalno */
      transition: background-color 0s ease, color 0s ease;
      z-index: 10000;

      /* >>> KLJU캛NE SPREMEMBE ZA CENTRIRANJE ZNAKA 'X' <<< */
      line-height: 1; /* Pomembno: Odstranimo privzeti razmik vrstic, ki potiska X navzdol */
      /* 캛e je X 코e vedno malo previsoko/prenizko, lahko prilagodite s tem: */
      /* transform: translateY(-1px); */ /* Poskusi to, 캜e je potrebno malo navzgor/navzdol */
    }

      
        
        /* ===== MODAL ZA TRAJANJE OBISKA (NOV STIL) ===== */
        .duration-modal {
          display: none;
          position: fixed;
          z-index: 9999;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7); /* Temnej코e ozadje za opozorilo */
          justify-content: center;
          align-items: center;
          overflow-y: auto;
        }

        .duration-modal.active {
          display: flex;
        }

        .duration-content {
          background: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 380px;
          max-width: 90%;
          text-align: left;
          box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
          position: relative;
          animation: fadeIn 0.3s ease;
          margin: 50px auto;
        }

        .duration-content h3 {
            color: #4edaa9;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.4rem;
            text-align: center;
        }

        .duration-content label {
            display: block;
            margin-bottom: 0px;
            font-weight: bold;
            color: #333;
            font-size: 0.9rem;
        }
        
        .duration-opcije {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .duration-opcija {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            color: #333;
        }
        
        .duration-opcija:hover {
            border-color: #4edaa9;
            background-color: #ffffff;
        }

        .duration-opcija input[type="radio"] {
            margin-right: 15px;
            /* Skrijemo standardni radio gumb in ga stiliziramo */
            appearance: none; 
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #aaa;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }
        
        .duration-opcija input[type="radio"]:checked {
            border-color: #333;
        }
        
        .duration-opcija input[type="radio"]:checked::before {
            content: '';
            width: 10px;
            height: 10px;
            background-color: #333;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block;
        }
        
        .duration-opcija.selected {
            border-color: #4edaa9;
            background-color: #4edaa9; /* Dodamo rahel odtenek za bolj코o vidljivost izbrane opcije */
            /* Zamenjaj barvo poudarka za la쬵o berljivost */
            border-color: #4edaa9; 
            /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
        }
        
        .duration-opcija.selected input[type="radio"]:checked {
            border-color: #333;
        }

        .duration-opcija.selected input[type="radio"]:checked::before {
            background-color: #333;
        }


        .gumb-potrdi-trajanje {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background-color: #4edaa9;
            color: #333;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
        }

        .gumb-potrdi-trajanje:hover {
            background-color: #33b688;
        }
        /* Slogi za opomnik o QR kodi in to캜kah znotraj modalnega okna */
.duration-content .qr-reminder-text {
    margin-top: 15px; /* Odmik od gumba */
    font-size: 1em;
    color: #666; /* Nevtralno sivo besedilo */
    text-align: center;
    border-top: 1px solid #dddddd; /* Ne쬹a lo캜ilna 캜rta nad besedilom */
    padding-top: 15px;
}
        
        /* ======================================================= */
        /* V. CUSTOM WARNING MODAL - NOVO OBLIKOVANJE ZA OPOZORILO */
        /* ======================================================= */
        
        .warning-modal {
          display: none;
          position: fixed;
          z-index: 10000; /* Najvi코ji z-index */
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          justify-content: center;
          align-items: center;
          overflow-y: auto;
          /* Dopolnitev stila za animacijo ob prikazu/skrivanju */
          opacity: 0;
          transition: opacity 0.3s ease;
        }

        .warning-modal.active {
          display: flex;
          opacity: 1;
        }

        .warning-content {
          background: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 350px;
          max-width: 90%;
          text-align: center;
          box-shadow: 0 5px 30px rgba(0, 0, 0, 0.4);
          position: relative;
          animation: fadeIn 0.3s ease;
          margin: 50px auto;
          /* Dopolnitev: 캛e je modal aktiven, se animacija izvede */
          transform: scale(0.95);
          transition: transform 0.3s ease;
        }

        .warning-modal.active .warning-content {
            transform: scale(1);
        }
        
        .warning-icon-wrapper {
            margin: 0 auto 20px;
            width: 60px;
            height: 60px;
            background-color: #ffedcc; /* Svetlo rumeno/oran쬹o ozadje */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ffcc66;
        }

        .warning-icon {
            font-size: 32px;
            color: #ff9900; /* Mo캜na oran쬹a barva ikone (fas fa-exclamation-triangle) */
        }

        .warning-content h3 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .warning-content p {
            color: #555;
            margin-bottom: 25px;
        }

        .gumb-razumem {
            width: 60%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background-color: #20c0bd; /* Uporabimo glavno barvo projekta */
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .gumb-razumem:hover {
            background-color: #169b99;
        }

        /* ===== GUMBI V GLAVI (OSTANE NESPREMENJENO) ===== */
        .gumb-prijava, 
        .gumb-profil, 
        /*... ostalo oblikovanje od tu naprej ostane popolnoma nespremenjeno ...*/
        .gumb-odjava {
          display: inline-flex;
          align-items: center;
          gap: 5px;
          padding: 4px 12px;
          border-radius: 25px;
          font-weight: bold;
          text-decoration: none;
          transition: background-color 0.2s, color 0.2s, border-color 0.2s;
          white-space: nowrap;
          font-size: 14px;
        }

        .gumb-prijava,
        .gumb-profil {
          background-color: #333;
          color: white;
          border: 1px solid #333;
        }

        .gumb-prijava:hover, 
        .gumb-profil:hover {
          background-color: #575757;
          border-color: #575757;
        }
        
        .gumb-odjava {
          background-color: transparent;
          color: #333;
          border: 1px solid #333;
        }
        
        .gumb-odjava:hover {
          background-color: #dadada;
          color: #575757;
          border-color: #575757;
        }

        .profil-ovoj {
          display: flex;
          align-items: center;
          gap: 10px; 
        }
        
     /* ===== KARTICA RESTAVRACIJE (PRILJUBLJENO - VE캛JA KARTICA) ===== */
        .kartica {
            border: 1px solid #ececec;
            
            /* SPREMENJENO: Lo캜ene lastnosti za radius vsakega vogala */
            border-top-left-radius: 10px;    /* Radius zgoraj levo */
            border-top-right-radius: 10px;   /* Radius zgoraj desno */
            border-bottom-right-radius: 20px; /* Radius spodaj desno */
            border-bottom-left-radius: 20px;  /* Radius spodaj levo */
            
            /* Prej코nja enotna lastnost: border-radius: 10px; */
            
            overflow: hidden; 
            box-shadow: 10 5px 5px rgb(0, 0, 0);
            transition: transform 0.0s, box-shadow 0.0s;
            background-color: rgb(255, 255, 255);
            display: flex;
            flex-direction: column;
            cursor: pointer;
            /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
        }

        .kartica:hover {
            transform: translateY(0px);
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.0);
        }

        .kartica-slika {
            width: 100%;
            height: 150px; 
            object-fit: cover;
            background-color: #f5f5f5; 
        }

        .kartica-vsebina {
            padding: 15px;
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
        }

        .kartica-vsebina h3 {
            font-size: 0.9rem; 
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        /* NOVI STIL: Ovoj za oceno in oddaljenost */
        .info-ocena-oddaljenost {
            display: flex;
            flex-wrap: wrap; /* Klju캜no za prelom vrstice */
            justify-content: space-between; /* Klju캜no za lo캜itev ocene in razdalje */
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 0px solid #e0e0e0;
        }

        .kartica-vsebina .ocena {
            /* INTERNA OCENA: Order 1 (levo zgoraj) */
            order: 1; 
            font-size: 0.8rem;
            color: #333; 
            margin: 0;
            font-weight: bold;
        }

        .kartica-vsebina .ocena span.ocena-stevilka {
            color: #333; 
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* Stil za navidezno oddaljenost */
        .oddaljenost {
            /* RAZDALJA: Order 2 (desno zgoraj, ob interni oceni) */
            order: 2; 
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .oddaljenost i {
            color: #1f1f1f; /* Ikona v modri barvi */
        }

        /* Stil za Google oceno na kartici */
        .kartica .google-ocena {
            /* GOOGLE OCENA: Order 3 in 100% 코irina (nova vrstica) */
            order: 3; 
            width: 100%; 
            
            font-size: 0.8rem;
            font-weight: bold; 
            color: #333; 
            margin-top: 5px; 
            margin-bottom: 0;
            display: flex;
            align-items: center;
        }

        .kartica .google-ocena .fab.fa-google {
            font-size: 0.9em; 
            margin-right: 4px; 
            color: #4285F4; /* Googlova modra */
        }


        /* Stil za polje razpolo쬷jivosti (Ostane na dnu) */
        .razpolozljivost-ovoj {
            margin-top: auto; /* Pritisne ga na dno */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 0px;
            border-radius: 6px;
            background-color: white; /* Svetlo zeleno/turkizno ozadje */
            border: 1px solid white;
        }

        .razpolozljivost-ovoj strong {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 5px;
            display: block;
        }

        .razpolozljivost-ovoj span {
            font-size: 0.85rem;
            font-weight: bold;
            color: #1a9e9a; /* Temnej코a zelena/turkizna */
        }

        .razpolozljivost-ovoj.zasedeno {
             background-color: white; /* Svetlo rde캜e ozadje */
             border: 1px solid white;
        }

        .razpolozljivost-ovoj.zasedeno span {
            color: #dc3545; 
        }
        
        /* Gumb rezervacija (캜e bi bil) */
        .gumb-rezervacija {
            display: block;
            width: 100%;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            background-color: #20c0bd; 
            color: white;
            font-weight: bold;
            text-decoration: none;
            transition: background-color 0.2s;
            margin-top: 10px; 
            cursor: pointer;
        }

        .gumb-rezervacija:hover {
            background-color: #1a9e9a;
        }
        
   /* ======================================================= */
    /* NOVO: KARTICA IZPOSTAVLJENO (MANJㅁ KARTICA) */
    /* ======================================================= */
    .kartica-izpostavljeno {
        /* Nadomesti pravila osnovne .kartica */
        display: flex;
        flex-direction: column;
        overflow: hidden;
        
        /* SPREMENJENO: Lo캜ene lastnosti za radius vsakega vogala */
        border-top-left-radius: 10px;    /* Radius zgoraj levo */
        border-top-right-radius: 10px;   /* Radius zgoraj desno */
        border-bottom-right-radius: 20px; /* Radius spodaj desno */
        border-bottom-left-radius: 20px;  /* Radius spodaj levo */
        
        /* Prej코nja enotna lastnost: border-radius: 10px; */
        
        width: 100%;
        height: 250px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        background-color: #88d82d; /* Svetlo ozadje */
        transition: box-shadow 0.2s, transform 0.2s;
        border: 0px solid #333;
    }

    .kartica-izpostavljeno:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(0px);
        
        
    }

    /* SPREMENJENO: Zmanj코ano na 50px za 코e manj코o vi코ino slike */
    .kartica-izpostavljeno .slika-kartice {
        width: 100%;
        height: 220px; 
        background-size: cover;
        background-position: center;
        background-color: #f5f5f5;
    }

    /* SPREMENJENO: Zmanj코an padding na 6px */
    .kartica-izpostavljeno .vsebina-kartice-izpostavljeno {
        padding: 10px; 
        text-align: center;
    }

    /* SPREMENJENO: Zmanj코ana velikost pisave na 0.85rem */
    .kartica-izpostavljeno .vsebina-kartice-izpostavljeno h3 {
        font-size: 0.9rem; 
        font-weight: 600;
        margin: 0;
        color: #333;
        white-space: nowrap; 
        overflow: hidden;
        text-overflow: ellipsis; 
        
    }

    
    /* ======================================================= */
    /* MODAL PODROBNOSTI RESTAVRACIJE (OSTANE NESPREMENJENO) */
    /* ======================================================= */
    .restavracija-modal {
        display: none; 
        position: fixed; 
        z-index: 9990; 
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto; 
        background-color: rgba(0, 0, 0, 0.7); 
        justify-content: center;
        align-items: flex-start; 
        padding: 50px 0; 
    }

    .restavracija-modal.active {
        display: flex;
    }

    .restavracija-vsebina {
        background-color: #fefefe;
        margin: auto; 
        padding: 0;
        border-radius: 12px;
        width: 90%;
        max-width: 800px; 
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: modalSlide 0.4s ease-out;
        min-height: 450px;
    }
    
    @keyframes modalSlide {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
    }

/* GUMB ZA ZAPIRANJE (X) */
.gumb-zapri-restavracija {
    position: absolute;
    top: 15px;
    right: 15px;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 35px;
    font-weight: bold;
    cursor: pointer;
    z-index: 9991; 
    transition: background-color 0s;
    /* >>> KLJU캛NI POPRAVEK ZA CENTRIRANJE ZNAKA 'X' <<< */
    line-height: 1; 
    /* Opcijski mikro-popravek, 캜e je X 코e vedno rahlo prenizko zaradi pisave */
    /* Poskusite dodati to, 캜e je potrebno: */
    /* transform: translateY(-1px); */ 
    /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
}
.gumb-zapri-restavracija:hover {
    background-color: transparent;
}

    .slika-glava {
        width: 100%;
        height: 300px;
        background-size: cover;
        background-position: center;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        position: relative;
    }
    
    .podrobnosti-tekst {
        padding: 25px;
        padding-bottom: 0;
    }

    .podrobnosti-tekst h2 {
        font-size: 2rem;
        margin-bottom: 10px;
        color: #333;
    }
    
    /* Prilagoditev velikosti naslova na mobilnem telefonu */
    @media (max-width: 600px) {
        .restavracija-vsebina {
            margin: 20px 10px; 
        }
        .podrobnosti-tekst h2 {
            font-size: 1.5rem;
        }
    }

    .info-vrstica {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        font-size: 0.95rem;
        color: #666;
        flex-wrap: wrap;
    }
    
    .info-vrstica > span {
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .info-vrstica i {
        color: #333;
    }

    .opis-restavracije {
        font-size: 1rem;
        color: #555;
        line-height: 1.6;
        margin-bottom: 20px;
    }

 .gumb-rezerviraj-modal {
        display: block;
        width: 60%;
        padding: 10px;
        margin-top: 25px;
        text-align: center;
        border-radius: 20px;
        background-color: #1BC0BB; 
        color: #333;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        transition: background-color 0.2s;
        cursor: pointer;
        /* 游녢 DODAJTE TA KLJU캛NI AGRESIVNI POPRAVEK ZA ANDROID 游녢 */
        border: none !important; /* Odstrani morebitne robove */
        outline: none !important; /* Odstrani fokusni obro캜 */
        box-shadow: none !important; /* Odstrani morebitno senco ob pritisku */
        -moz-appearance: none; /* Za Firefox/Starej코e brskalnike */
        -webkit-appearance: none; /* Za Chrome/Android */
        appearance: none; /* Standardno */
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
        
        /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
        -webkit-tap-highlight-color: transparent;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }
    .gumb-rezerviraj-modal:hover {
        background-color: #148a86;
        color: white;
        font-size: 1rem;
        font-weight: 600;
    }
    /* 游녢 Tega NE potrebujete ve캜, saj so pravila 쬰 v osnovnem bloku! 游녢 */
    /* .gumb-rezerviraj-modal:focus {
        outline: none; 
        box-shadow: none; 
    } */
    /* 游녡 ZAKLJU캛EK: ODSTRANITE TA BLOK 游녡 */

    /* ======================================================= */
    /* ZAVIHKE (TABS) - OSTANE NESPREMENJENO */
    /* ======================================================= */
    .modal-tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-top: 15px;
        padding: 0 25px;
        background-color: #ffffff; 
        overflow-x: auto; 
        -webkit-overflow-scrolling: touch; 
    }
    
    .modal-tab {
        flex-shrink: 0; 
        padding: 5px 20px; 
        border-radius: 25px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600; 
        color: #333;
        border-bottom: 0px solid transparent;
        transition: color 0.0s, border-bottom-color 0.0s, background-color 0.0s;
        margin-right: 5px; 
        white-space: nowrap; 
        position: relative;
    }
    
    .modal-tab.active {
        color: #ffffff;
        border-bottom-color: none;
        background-color: #1BC0BB;
        border-radius: 25px;
        margin-bottom: 0px; 
        box-shadow: 0 0px 0px rgba(0,0,0,0.05);
        /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }
    
    .modal-tab:not(.active):hover {
        color: #333;
        background-color: #ffff;
    }

    .modal-vsebina-ovoj {
        padding: 25px;
    }
    
    .modal-vsebina-skrol {
        max-height: 60vh; 
        overflow-y: auto; 
        padding-right: 15px; 
    }
    
    @media (max-width: 600px) {
        .modal-vsebina-skrol {
            max-height: 70vh; 
        }
    }


    .tab-content {
        display: none;
        animation: tabFadeIn 0.3s ease;
        padding-top: 10px;
    }
    .tab-content.active {
        display: block;
    }

    @keyframes tabFadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    /* Meni */
    .meni-seznam ul {
        list-style: none;
        padding: 0;
    }
    
    .meni-seznam ul li {
        padding: 10px 0;
        border-bottom: 1px dashed #eee;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }
    
    .meni-seznam ul li:last-child {
        border-bottom: none;
    }

    .meni-seznam ul li strong {
        display: block;
        color: #333;
        font-size: 14px;
        font-weight: 500; 
    }

    /* Slike in Zemljevid */
  .galerija-slike {
    /* 1. Klju캜no: Uporabite Flexbox za eno vodoravno vrstico */
    display: flex;
    
    /* 2. Klju캜no: Omogo캜i vodoravno drsenje, ko vsebina prese쬰 코irino */
    overflow-x: scroll;
    
    /* 3. Dolo캜ite razmik med slikami (namesto gap/space-x) */
    gap: 1rem; 
    
    padding: 1rem;
    margin-bottom: 20px;
}

/* Pravila za posamezni element, ki vsebuje sliko */
.galerija-slike > div {
    flex-shrink: 0;
    
    /* Zagotovite FIKSNO kvadratno vi코ino: */
    width: 140px !important; /* Dodan !important */
    height: 140px !important; /* Dodan !important */
    
    position: relative;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); 
}

/* Pravila za IMG tag znotraj DIVa */
.galerija-slike img {
    /* Raztegnite sliko, da POPOLNOMA zapolni 120x120px okvir */
    width: 100% !important; /* Dodan !important */
    height: 100% !important; /* Dodan !important */
    
    object-fit: cover !important; /* Zagotovite, da se izre쬰 in ne deformira */
    cursor: pointer;
    transition: opacity 0.3s;
}

.galerija-slike img:hover {
    opacity: 0.9;
}

    /* 游댠 POPRAVEK ZA LEAFLET: Ciljamo tudi na novi ovoj #map-container */
    .zemljevid-ovoj,
    #map-container {
        width: 100%;
        /* Pove캜ana vi코ina za bolj코i prikaz navodil za pot (Routing Machine) */
        height: 400px; 
        background-color: #eee;
        border-radius: 8px;
        overflow: hidden;
        /* Dodamo position, 캜e je potrebno za z-index in absolutno pozicioniranje notranjih elementov Leafleta */
        position: relative; 
    }
    
    /* 游댠 NOVO PRAVILO: Zagotovimo, da Leaflet div zavzame celoten prostor */
    #leaflet-map {
        width: 100%;
        height: 100%;
        /* z-index je klju캜en, da se kontrolniki prika쬰jo nad vsem ostalim v modalu */
        z-index: 1; 
    }

    /* Ohranjena pravila za stare iframe, 캜e jih 코e kje uporabljate */
    .zemljevid-ovoj iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    
    /* PRILAGODITEV ZA MOBILNE NAPRAVE (do 480px) */
    @media (max-width: 480px) {
        .modal-tabs {
            padding: 0 10px; 
        }
        
        .modal-tab {
             padding: 10px 15px; 
        }
        
        .modal-vsebina-ovoj {
            padding: 15px; 
        }
        
        .podrobnosti-tekst {
            padding: 15px 15px 0 15px;
        }
        
        .slika-glava {
            height: 180px; 
        }
        
        .galerija-slike {
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 5px;
        }
        .galerija-slike img {
            height: 80px;
        }
        
        /* 游댠 POPRAVEK ZA MOBILNI ZEMLJEVID */
        .zemljevid-ovoj,
        #map-container {
            height: 300px; /* Prilagoditev vi코ine za mobilni zaslon */
        }
    }
    
    /* ======================================================= */
    /* MOBILNI MENI LOGIKA ZA MOBILNI POGLED (do 768px) */
    /* ======================================================= */
    
    .hamburger-gumb {
        display: none;
        background: none;
        border: none;
        font-size: 26px;
        cursor: pointer;
        color: #222222;
        padding: 0;
        z-index: 1000;
    }
    
    .mobilni-meni {
        display: none;
    }
    
    .glava .akcije {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    @media (max-width: 768px) {
        .glava {
            justify-content: space-between;
            padding: 10px 20px;
            position: relative; 
        }

        .glava .akcije {
            display: none; 
        }

        .hamburger-gumb {
            display: block; 
        }

        .mobilni-meni {
            position: absolute;
            top: 100%; 
            right: 0;
            width: 60%; 
            max-width: 200px;
            background-color: white;
            border-top: 0px solid #eee;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 999;
            padding: 15px;
            flex-direction: column;
            gap: 10px;
            transform: translateX(100%); 
            transition: transform 0.3s ease-out;
            border-bottom-left-radius: 8px;
        }

        .mobilni-meni.active {
            display: flex;
            transform: translateX(0); 
        }
        
        /* Gumbi Prijava/Odjava/Profil */
        .mobilni-meni .gumb-prijava {
            width: 55%;
            justify-content: center;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 20px;
            background-color: #575757; 
            border-color: #575757;
            align-self: center; 
                      /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
        }
        
        .mobilni-meni .profil-ovoj {
             display: flex;
             flex-direction: column;
             gap: 10px;
             width: 100%;
             align-items: center; 
        }

        .mobilni-meni .gumb-profil,
        .mobilni-meni .gumb-odjava {
            width: 55%; 
            justify-content: center;
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 20px;
            transition: all 0.2s;
            
        }
        
        .mobilni-meni .gumb-profil {
            background-color: #575757;
            border-color: #575757;
        }

        .mobilni-meni .gumb-odjava {
            color: #555;
            border: 1px solid #ccc;
        }

        .mobilni-meni .gumb-odjava:hover {
            background-color: #f5f5f5;
            color: #333;
            border-color: #aaa;
        }


        .mobilni-meni .jezik-ovoj {
            display: flex;
            align-items: center;
            padding: 10px 0;
            gap: 10px;
            border-top: 1px solid #eee;
            margin-top: 5px;
            padding-top: 15px;
            width: 100%;
            justify-content: center; 
        }
        
        /* POPRAVEK JEZIKA NA MOBILNEM: Manj코i, brez robov */
        .mobilni-meni .jezik-ovoj select {
            flex-grow: 0; /* Ne raste naj, da ostane majhen */
            width: auto;
            min-width: 60px; /* Minimalna 코irina */
            padding: 6px 8px; /* Zmanj코an padding */
            font-size: 14px;
            font-weight: bold;
            color: #555;
            background-color: #f7f7f7; /* Svetlo ozadje */
            border: none; /* Odstranjen okvir */
            border-radius: 6px; /* Majhen zaokro쬰n rob */
            appearance: none; 
            /* Uporabimo manj코o, diskretno pu코캜ico */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23555%22%20d%3D%22M287%20197.8%20L146.2%2057%20L5.4%20197.8%20L48.6%20241%20L146.2%20143.4%20L243.8%20241%20L287%20197.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 5px center;
            background-size: 8px auto; /* Manj코a pu코캜ica */
            padding-right: 20px; /* Dodaten padding za pu코캜ico */
            box-shadow: none;
                      /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
        }
        
        /* 캛e je izbirnik jezika premajhen, ga centraliziramo */
        .mobilni-meni .jezik-ovoj i {
            color: #777;
        }
    }

    /* ========================================================= */
    /* 游댠游댠游댠 NOVO: STILI ZA REZERVACIJSKA POLJA V MODALU 游댠游댠游댠 */
    /* ========================================================= */

    .rezervacija-vnosna-polja {
        display: flex; /* Polja postavimo v vrsto */
        gap: 20px;
        margin: 20px 25px; /* Dodan razmik okoli polj (gor/dol, levo/desno) */
        padding: 15px 0;
        border-top: 1px solid #eee; 
        border-bottom: 1px solid #eee;
    }
    
    @media (max-width: 600px) {
        .rezervacija-vnosna-polja {
            flex-direction: column; /* Na mobilnem postavimo pod seboj */
            gap: 15px;
            margin: 15px 15px; 
            padding: 30px 0;
        }
    }

    .vnosno-polje {
        flex: 1; 
        display: flex;
        flex-direction: column;
        
    }

   .input-rezervacija {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 20px; /* Ohranimo zaobljene robove */
    font-size: 16px;
    cursor: pointer;
    background-color: white;
    
    /* 游녢 DODANE LASTNOSTI ZA STANDARDIZACIJO VIDEZA SELECT ELEMENTA 游녢 */
    
    /* 1. Odstranitev privzetega videza (Kriv za razliko med Safarijem in Chromom) */
    -webkit-appearance: none; /* Za Safari/Chrome */
    -moz-appearance: none;    /* Za Firefox */
    appearance: none;         /* Standard */
    
    /* 2. Dodajanje pu코캜ice po meri (ker je bila privzeta odstranjena) */
    /* Uporabimo pu코캜ico SVG v Base64 */
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23333333' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center; /* Premaknjeno nekoliko levo od roba */
    background-size: 12px;
    
    /* 3. Prepre캜itev, da padding vpliva na velikost (preventivno) */
    box-sizing: border-box; 
    
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */ 
    
    /* 游녢 DODATKI, KI STE JIH 콯E IMELI 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
}

    .vnosno-polje label {
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
        font-size: 0.9rem;
    }
    
    /* Stil za kontejner, kamor se vstavijo gumbi (ure) */
    .proste-ure-rezultati {
        min-height: 40px; 
        padding: 15px 25px; /* Dodan padding, da je v enakem obmo캜ju kot vsebina modala */
        text-align: center;
    }
    
    @media (max-width: 600px) {
        .proste-ure-rezultati {
             padding: 15px 15px; 
        }
    }

    /* Kontejner za gumbe, ko jih JavaScript ustvari */
    .gumbi-proste-ure {
        display: flex;
        gap: 10px;
        flex-wrap: wrap; 
        justify-content: center;
        padding-top: 10px;
    }

    /* Stil za gumb ure (klju캜en, da se prika쬰jo lepi gumbi za ure) */
    .gumb-ura {
        background-color: #ffffff;
        color: #333;
        border: 1px solid #333;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 500;
        transition: background-color 0.2s, border-color 0.2s;
        font-size: 14px;
        flex-shrink: 0;
        /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }

    .gumb-ura:hover {
        background-color: #4edaa9;
        border: 1px solid #4edaa9; /* Rde캜 rob kot poudarek */
    
    }

    /* Stil za izbran gumb ure */
    .gumb-ura.selected {
        background-color: #4edaa9; /* Barva poudarka */
        color: #333;
        border-color: #33b688;
        font-weight: bold;
    }
 /* =================================================== */
/* GLOBALNI STILI ZA NOGO (veliki zasloni) */
/* =================================================== */
.noga {
    background-color: #2c2c2c; /* Temna podlaga, kot na sliki */
    color: #cccccc;
    padding: 15px 5%; /* Horizontalni padding za odmik od robov */
    font-size: 14px;
}

.noga-vsebina {
    display: flex; /* Razporedi sekcije v vrsto na velikih zaslonih */
    justify-content: space-between;
    padding-bottom: 20px;
    border-bottom: 1px solid #444; /* Lo캜ilo nad pla캜ili/avtorskimi pravicami */
}

.noga-sekcija {
    flex: 1; /* Enaka 코irina za vse sekcije na velikih zaslonih */
    padding-right: 20px;
}

.noga-naslov {
    color: #ffffff;
    font-size: 16px;
    margin-bottom: 15px;
    font-weight: bold;
    /* Poka쬰, da je klikabilen */
    cursor: pointer; 
    /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
}

.noga-linki {
    list-style: none;
    padding: 0;
    margin: 0;
    /* Povezave so privzeto vidne na velikih zaslonih */
    /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
}

.noga-linki li {
    margin-bottom: 8px;
}

.noga-linki a {
    color: #cccccc;
    text-decoration: none;
    transition: color 0.2s;
}

.noga-linki a:hover {
    color: #ffffff;
}

/* Skrijemo ikono preklopa na velikih zaslonih (캜e je bila prej vklju캜ena) */
.noga-naslov:after {
    content: none !important;
}

/* =================================================== */
/* DODATNA INFORMACIJA (Pla캜ila in Avtorske pravice) */
/* =================================================== */
.noga-dodatno-info {
    padding-top: 20px;
}

.noga-dodatno-info p {
    margin-bottom: 10px;
    color: #a0a0a0;
}

.noga-avtorske-pravice {
    text-align: center;
    padding-top: 15px;
    font-size: 12px;
}

.stripe-logo img {
    height: 20px; 
    margin-right: 5px;
    /* Filtriramo, da so ikone bele, 캜e so originali barvni */
    filter: invert(80%); 
}

/* --------------------------------------------------- */
/* MOBILNI PRIKAZ (MEDIA QUERY: do 768px) */
/* Omogo캜a akordion za posamezne sekcije */
/* --------------------------------------------------- */
@media screen and (max-width: 768px) {
    
    /* 1. Gumb za preklop (tri pike) */
    .footer-toggle-btn {
        display: block; 
        width: 100%;
        background: none;
        border: none;
        color: white;
        text-align: right;
        padding: 10px 0;
        cursor: pointer;
        outline: none;
        margin-bottom: 5px;
        /* 游녢 DODAJTE TA DVA PRAVILA ZA ODSTRANITEV MODREGA POUDARKA NA MOBILNIH NAPRAVAH 游녢 */
    -webkit-tap-highlight-color: transparent;
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    /* 游녡 ZAKLJU캛EK DODATKOV 游녡 */
    }
    .footer-toggle-btn svg {
        vertical-align: middle;
        color: #cccccc; 
        
    }
    
    /* 2. Skrivanje celotne vsebine (.noga-vsebina-skrita) */
    .noga-vsebina-skrita {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out;
        padding: 0;
        border-top: none; 
    }

    /* Prikaz celotne vsebine, ko je gumb aktiven */
    .noga-vsebina-skrita.active {
        max-height: 2000px; 
        padding-top: 15px;
        padding-bottom: 15px;
        border-top: 1px solid #444; 
    }
    
    /* 3. Preureditev vsebine znotraj skrite sekcije */
    .noga-vsebina {
        display: block; 
        border-bottom: none; 
        padding-bottom: 0;
    }
    
    /* Sekcije znotraj noge naj bodo med seboj lo캜ene */
    .noga-sekcija {
        border-bottom: 1px solid #444; 
        padding: 10px 0;
        padding-right: 0;
    }
    
    /* 游멆잺 POPRAVEK ZA AKORDION: Omogo캜i preklapljanje s pomo캜jo JS */
    .noga-linki {
        /* Sedaj mora biti privzeto skrito za akordion */
        max-height: 0 !important; 
        overflow: hidden !important; 
        transition: max-height 0.3s ease-out !important;
        padding-top: 0 !important; 
    }

    /* 游멆잺 STANJE PRIKAZA: Ko JS doda razred active */
    .noga-linki.active {
        max-height: 500px !important; /* Dovolj visoko, da se prika쬰 */
        padding-top: 10px !important; 
    }

    /* Odstranimo ikono za preklop akordiona na posameznih naslovih */
    .noga-naslov:after {
        content: none !important;
    }
    
    /* Poskrbimo, da je prostor okoli pla캜il videti dobro */
    .noga-dodatno-info {
        border-top: 1px solid #444; 
        padding-top: 15px;
        padding-bottom: 5px;
    }
}

/* 4. Skrijemo gumb na namiznem prikazu */
@media screen and (min-width: 769px) {
    .footer-toggle-btn {
        display: none;
    }
}
/* ========================================= */
/* OBLIKOVANJE ZA TOASTER OBVESTILA */
/* ========================================= */

#toaster-container {
    position: fixed;
    top: 20px; /* Ali bottom: 20px, 캜e 쬰lite, da so spodaj */
    right: 20px;
    z-index: 10000; /* Poskrbite, da je nad vsem */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.toast {
    padding: 15px 20px;
    color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transform: translateX(100%);
    transition: opacity 0.3s ease-out, transform 0.4s ease-out;
    max-width: 300px;
    min-width: 200px;
}

.toast.show {
    opacity: 1;
    transform: translateX(0);
}

.toast.success {
    background-color: #4CAF50; /* Zelena za uspeh */
}

.toast.error {
    background-color: #f44336; /* Rde캜a za napako */
}

.toast.info {
    background-color: #2196F3; /* Modra za info */
}

.toast.warning {
    background-color: #ff9800; /* Oran쬹a za opozorilo */
}

.toast-icon {
    margin-right: 10px;
}
/* ========================================= */
/* POPRAVLJEN STIL ZA GUMB NAZAJ (Kot na profilni strani) */
/* ========================================= */

.gumb-nazaj {
    /* Za vsak primer, da se prepisjo obstojeca pravila */
    all: unset; /* Odstrani vsa obstoje캜a stila brskalnika/predloge */
    
    /* Postavitev */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    
    /* Velikost in oblika kroga */
    width: 35px; /* Malce manj코i krog */
    height: 35px;
    border-radius: 50%; /* Naredi krog */
    
    /* Barve in obroba */
    background-color: #333; /* Prosojno ozadje */
    border: 1px solid #333; /* Tanek 캜rn okvir */
    color: #ffffff; /* 캛rna pu코캜ica */
    
    /* Pisava in velikost pu코캜ice */
    font-family: Arial, sans-serif; /* Ali pisava, ki jo uporabljate drugje */
    font-size: 18px; /* Malce manj코a pu코캜ica */
    font-weight: normal; /* Manj debela pu코캜ica */
    
    /* Prepre캜imo izbiro teksta (pu코캜ice) */
    user-select: none;
    
    /* Dodamo malo razmika od robov, da ni stisnjen */
    margin: 0 10px; /* Ali prilagodite po potrebi */

    /* Omogo캜imo pozicioniranje, 캜e bo potrebno */
    position: relative;
    z-index: 10;
}

/* Ob pritisku */
.gumb-nazaj:hover {
    background-color: #717171; /* Rahlo sivo ozadje ob hoverju */
    border-color: #717171; /* Malce temnej코i okvir */
    color: #ffffff; /* Malce temnej코a pu코캜ica */
}

/* Stil za vsebnik, da gumb ni na levi stisnjen do konca (opcijsko) */
.gumb-nazaj-vsebnik {
    padding-left: 20px; /* Ali kakorkoli druga캜e centrirate/poravnate */
    padding-bottom: 10px;
    /* 캛e je treba, lahko dodate 'position: relative;' ali 'display: flex;' za bolj코e pozicioniranje */
}
/* ODSTRANI MODER OKVIR PRI DOTIKU V NATIVE ANDROIDU */
/* To pravilo odstrani privzeti highlight, ki ga ustvarja WebView na Androidu */
* {
    -webkit-tap-highlight-color: transparent !important;
    /* Opomba: 캛e zgornje ne deluje, poskusite dodati 코e spodnje */
    outline: none !important;
}
/* ============================================= */
/* STILIRANJE MODALNEGA OKNA (Socialna Prijava)  */
/* ============================================= */

/* Stil za lo캜ilno 캜rto "Ali pa se prijavite z:" */
.social-login-separator {
    text-align: center;
    margin: 15px 0;
    font-size: 0.9em;
    color: #888;
    position: relative;
}

.social-login-separator span {
    background-color: #fff;
    padding: 0 10px;
    position: relative;
    z-index: 10;
}

.social-login-separator::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: #ddd;
    z-index: 5;
}

/* Stil za container gumbov */
.social-login-buttons {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    justify-content: center;
}

/* Splo코ni stil socialnih gumbov */
.gumb-prijava-social {
    flex: 1; /* Omogo캜i, da se gumba razdelita enakomerno */
    padding: 10px 15px;
    border-radius: 8px;
    border: 1px solid #ddd;
    background-color: #fff;
    color: #333;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* Razmik med ikono in besedilom */
}

.gumb-prijava-social:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
}

/* Stil za Google gumb (ikona) */
.gumb-prijava-social i.fa-google {
    color: #fafafa; /* Google rde캜a */
}

/* Stil za Apple gumb */
.gumb-prijava-social.apple {
    background-color: #000;
    color: #fff;
    border-color: #000;
}

.gumb-prijava-social.apple i.fa-apple {
    color: #fff;
}
/* ================================================= */
/* 7. SLOGI ZA VELIKO AKCIJSKO SLIKO (NEW FEATURE) */
/* ================================================= */

.velika-akcija-slika {
    /* OMEJITEV IRINE: Namesto 100vw zdaj uporablja fiksno 코irino (npr. 90%) 
       ali maksimalno 코irino (npr. 1200px) in avtomatski rob za centriranje. */
    width: 90%; 
    max-width: 1200px;
    margin: 2rem auto; /* Centriranje z avtomatskim robom in dodajanje razmika */
    
    /* Vi코ina (nastavljiva) */
    height: 70vh; /* Vi코ina na desktopu (prilagodite po 쬰lji) */
    
   /* DODATEK: Nastavljiv radius vsakega vogala posebej */

/* 캛e 쬰lite nadzorovati vsak vogal posebej, uporabite te lastnosti:
   Vrstni red je: Zgoraj levo, Zgoraj desno, Spodaj desno, Spodaj levo
*/

/* Primer nastavitve: */
border-top-left-radius: 280px;
border-top-right-radius: 280px;
border-bottom-right-radius: 20px;
border-bottom-left-radius: 280px;

/* Prej코nja enotna vrednost je zdaj zakomentirana:
   border-radius: 50px;
*/

overflow: hidden; /* Zagotovi, da se ozadje ne razlije 캜ez zaobljene robove */
    
    background-image: url('Oglasna-slika.png'); /* Uporabite pravo sliko! */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    
    /* Flexbox za centriranje vsebine znotraj sekcije */
    display: flex;
    justify-content: center;
    align-items: center;
    
    /* Dodamo temen prekrivni sloj za bolj코o berljivost teksta (gradient od temnega proti bolj temnemu) */
    position: relative; /* KLJU캛NO: Nastavi element za referenco absolutno pozicioniranemu otroku (.ikona-ospredje) */
    padding: 2rem;
    box-sizing: border-box;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0); /* Neobvezno: za lep코i vizualni u캜inek */
}

/* DODATEK: Stil za IKONO (Slika-app.png) v ospredju */
.ikona-ospredje {
    /* Pozicionira element glede na najbli쬵ega star코a z position: relative (.velika-akcija-slika) */
    position: absolute; 
    
    /* Postavitev v desni spodnji kot z 20px odmikom */
    right: 20px; 
    bottom: 20px; 
    
    /* Velikost ikone. Spreminjajte width/height za prilagoditev velikosti! */
    width: 100px; /* Prilagodite 코irino za pove캜anje/zmanj코anje */
    height: auto; 
    
    /* Z-index zagotovi, da je ikona vidna nad vso vsebino in prekrivnim slojem */
    z-index: 10; 
    
    /* Neobvezno: Dodajte rahel radius, da ikona ni ostro kvadratna */
    border-radius: 15px; 
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}


.velika-akcija-slika::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(130, 247, 35, 0.078); /* Temen prekrivni sloj */
    z-index: 1;
}

.akcija-vsebina {
    position: relative;
    z-index: 2; /* Postavi vsebino nad prekrivni sloj */
    text-align: center;
    max-width: 800px;
    padding: 1rem;
    margin-bottom: 0; /* Odstranjeno, ker gumba ni ve캜 */
}

.akcija-vsebina h2 {
    font-size: clamp(1.5rem, 4vw, 3rem); /* Odzivna velikost naslova */
    font-weight: 600;
    color: #fefefe; /* Svetel tekst za kontrast */
    margin-bottom: 0.5rem;
    text-shadow: 1px 1px 3px rgba(255, 255, 255, 0);
}

.akcija-vsebina h3 {
    font-size: clamp(1.5rem, 2vw, 1.8rem); /* Odzivna velikost podnaslova */
    margin-bottom: 0; /* Odstranjeno, ker gumba ni ve캜 */
    font-weight: 400;
    color: #88d82d; /* Svetel tekst za kontrast */
}

/* ODSTRANJENA sta bila .gumb-odkrij in .gumb-odkrij:hover bloka */


/* ======================================= */
/* PRILAGODITEV ZA MOBILNE NAPRAVE (PWA) */
/* ======================================= */

@media (max-width: 768px) {
    .velika-akcija-slika {
        /* Pove캜amo vi코ino, da je na mobilnih napravah bolj opazno */
        height: 50vh; 
        /* Na mobilnem lahko uporabimo skoraj polno 코irino, vendar pustimo majhen rob za PWA izgled */
        width: 95%; 
        margin-left: auto; /* Ponovno centriranje */
        margin-right: auto; /* Ponovno centriranje */
        padding: 1rem;
    }
    
    /* Prilagoditev velikosti ikone za mobilne naprave */
    .ikona-ospredje {
        width: 100px; /* Manj코a ikona na mobilnih napravah */
        right: 10px;
        bottom: 10px;
    }

    .akcija-vsebina {
        padding: 0.5rem;
    }
}
/* Dodano oblikovanje za kartico z oceno (Review Card) */
.review-card {
    /* Uporaba tega stila je bolj코a kot samo 'border-b' */
    border: 1px solid #b8b8b8; /* Lahka siva obroba okoli kartice */
    border-radius: 20px; /* Zaobljeni robovi kartice */
    padding: 1.5rem; /* Notranji rob znotraj okvirja */
    margin-bottom: 1.5rem; /* Razmik med karticami */
    background-color: #ffffff; /* Belo ozadje za vsako kartico */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* Ne쬹a senca za 'dvignjen' videz */
}

/* Stilizacija imena avtorja in datuma znotraj review-card */
.review-card .author-name {
    font-weight: bold;
    color: var(--rmlk-modra); /* Uporabimo va코o modro barvo za poudarek */
    font-size: 1.1em;
    margin-bottom: 0.25rem;
    display: block; /* Omogo캜a, da ime zavzame svojo vrstico */
}

.review-card .review-date {
    color: #6c757d; /* Diskretna siva za datum */
    font-size: 0.9em;
    margin-bottom: 0.75rem;
    display: block;
}

/* Stilizacija zvezdic, 캜e so v lo캜enem elementu (npr. <span class="stars">) */
/* V va코i kodi je to verjetno 쬰 narejeno s slikami ali znaki, ki jih je treba preveriti */
.review-card .stars {
    color: #ffc107; /* Zlata barva za zvezdice */
    font-size: 1.1em;
    margin-right: 0.5rem;
}

/* Stilizacija besedila komentarja */
.review-card .review-text {
    margin-top: 1rem;
    color: #333333;
}
/* Definirajte to spremenljivko na vrhu va코e datoteke :root {} */
/* :root { --rmlk-siva: #f4f4f4; } */

/* --- NOVI SLOGI ZA SEKCIJO GOURMET EXPLORE --- */
.gourmet-explore {
    padding: 4rem 2rem 2rem;
    text-align: center;
    background-color: var(--rmlk-siva);
}

.gourmet-explore h2 {
    color: var(--rmlk-modra);
    margin-bottom: 2.5rem;
    font-size: 2rem;
    font-weight: 700;
}

/* Nastavljiv border-radius za vsak vogal */
.country-card {
    --card-radius-tl: 20px;
    --card-radius-tr: 20px;
    --card-radius-bl: 20px;
    --card-radius-br: 20px;

    position: relative;
    border-top-left-radius: var(--card-radius-tl);
    border-top-right-radius: var(--card-radius-tr);
    border-bottom-left-radius: var(--card-radius-bl);
    border-bottom-right-radius: var(--card-radius-br);

    overflow: hidden;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease;

    /* Popravek: proporcialna vi코ina */
    aspect-ratio: 4 / 3; /* 코irina : vi코ina */
    width: 100%;
}


/* Grid kartic */
.country-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
}

/* Hover efekt */
.country-card:hover {
    box-shadow: 0 8px 25px rgba(14, 43, 78, 0.25);
}

.card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.45s ease;
    position: relative;
    z-index: 2; /* nad silhueto */
}

.country-card:hover .card-image {
    transform: scale(1.03);
}

.card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.106);
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 0.3s ease;
    z-index: 3; /* nad sliko in silhueto */
}

.country-card:hover .card-overlay {
    background: rgba(14, 43, 78, 0.55);
}

.card-title {
    color: #fff;
    font-size: 1.5rem;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    z-index: 4;
}

/* --- RESPONSIVE: Na telefonih vi코ina kartice manj코a --- */
@media (max-width: 768px) {
    .country-card {
        aspect-ratio: 1 / 1; /* kvadrat na mobilnih */
    }

    .country-cards-container {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    /* Silhueta manj코a na telefonih */
    .country-card[data-experience-code="wine"] .wine-silhouette {
        width: 50px;
    }
}

/* Stil za veliko sekcijo akcije */
.velika-akcija-slika {
    margin-bottom: 2rem;
}

/* --- NOVI SLOGI ZA REZULTATE V MODALU --- */
.restavracija-vsebina #modalResultsContainer {
    z-index: 10;
    padding: 1rem 1rem 0 1rem;
    padding-right: 0;
}

#modalResultsContainer h3 {
    color: var(--rmlk-modra);
    margin-bottom: 1rem;
    font-size: 1.5rem;
    font-weight: 700;
    border-bottom: 2px solid #ddd;
    padding-bottom: 10px;
}

.mreza-rezultatov-modal {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;

    max-height: 70vh;
    overflow-y: auto;
    padding-right: 15px;
    padding-bottom: 1rem;
}

.mreza-rezultatov-modal .kartica {
    margin: 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.restavracija-vsebina #modalSlika.hidden,
.restavracija-vsebina .podrobnosti-tekst.hidden {
    display: none !important;
}

/* Uporaba SVG clipPath za silhueto steklenice */
.country-card[data-experience-code="wine"] .bottle-clipped {
    clip-path: url(#maskBottle);
    -webkit-clip-path: url(#maskBottle); /* za Chrome/Safari */
}
/* Dodajte to v va코 <style> blok ali styles.css */
@keyframes highlight-flash {
    0% { box-shadow: 0 0 0 0 rgba(32, 192, 189, 0.7); border: 2px solid rgba(32, 192, 189, 0.5); }
    50% { box-shadow: 0 0 15px 5px rgba(32, 192, 189, 0.9); border: 2px solid #20c0bd; }
    100% { box-shadow: 0 0 0 0 rgba(32, 192, 189, 0); border: 2px solid transparent; }
}

.highlighted-card {
    animation: highlight-flash 1.5s ease-out;
}



  </style>
</head>

<body>

    <header class="glava">
        <div class="logotip">
            <a href="#" id="map-icon-link" class="icon-link">
                <i class="fas fa-map-marked-alt map-icon" aria-label="Prika쬴 zemljevid"></i>
            </a>
        </div>

        <div id="map-modal" class="map-overlay">
            <div class="map-content">
                <button id="close-map-btn" class="close-btn">&times;</button>
                <div id="large-map-container">
                    <p style="text-align: center; padding-top: 50px;">Tukaj bo velik, interaktiven zemljevid.</p>
                </div>
            </div>
        </div>
        
        <div class="akcije" id="desktopAkcije"> 
          <a href="#" id="odpriPrijavoDesktop" class="gumb-prijava" data-i18n="header.login">
            <i class="fas fa-user"></i> Prijava
          </a>

          <div class="profil-ovoj" id="profilMeniDesktop" style="display: none;">
            <a href="profil.html" class="gumb-profil" data-i18n="header.profile">
              <i class="fas fa-user-circle"></i> Moj Profil
            </a>
            <a href="#" id="gumbOdjavaDesktop" class="gumb-odjava" data-i18n="header.logout">
              <i class="fas fa-sign-out-alt"></i> Odjava
            </a>
          </div>
          <div class="jezik-ovoj" id="jezikOvojDesktop">
            <i class="fas fa-globe"></i>
            <select class="izbira-jezika" id="izbiraJezikaDesktop">
              <option value="sl">SL</option>
              <option value="en">EN</option>
              <option value="de">DE</option>
              <option value="hr">HR</option>
              <option value="it">IT</option>
              <option value="fr">FR</option>
            </select>
          </div>
        </div>
        
    <button class="hamburger-gumb" id="hamburgerGumb">
        <i class="fas fa-ellipsis-h"></i>
    </button>

        <div class="mobilni-meni" id="mobilniMeni">
            <a href="#" id="odpriPrijavoMobilni" class="gumb-prijava" data-i18n="header.login">
                <i class="fas fa-user"></i> Prijava
            </a>

            <div class="profil-ovoj" id="profilMeniMobilni" style="display: none;">
                <a href="profil.html" class="gumb-profil" data-i18n="header.profile">
                    <i class="fas fa-user-circle"></i> Moj Profil
                </a>
                <a href="#" id="gumbOdjavaMobilni" class="gumb-odjava" data-i18n="header.logout">
                    <i class="fas fa-sign-out-alt"></i> Odjava
                </a>
            </div>
            
            <div class="jezik-ovoj" id="jezikOvojMobilni">
                <i class="fas fa-globe"></i>
                <select class="izbira-jezika" id="izbiraJezikaMobilni">
                    <option value="sl">SL</option>
                    <option value="en">EN</option>
                    <option value="de">DE</option>
                    <option value="hr">HR</option>
                    <option value="it">IT</option>
                    <option value="fr">FR</option>
                </select>
            </div>
        </div>

    </header>

    <main>
        <section class="naslovna-slika">
          <h1 data-i18n="hero.title">Gourmet & Experience</h1>
        </section>

        <section class="iskalnik-sekcija">
          <form class="iskalnik">
            <div class="iskalnik-polje">
              <label for="restavracija_mesto" data-i18n="search.restaurant_city_label">Restavracija ali mesto</label>
              <input type="text" id="restavracija_mesto" data-i18n="[placeholder]search.restaurant_city_placeholder" placeholder="Vnesite ime ali mesto">
            </div>

            <div class="iskalnik-polje">
              <label for="datum" data-i18n="search.date_label">Datum</label>
              <input type="text" id="datum" data-i18n="[placeholder]search.date_placeholder" placeholder="Izberite datum">
            </div>

            <div class="iskalnik-polje">
              <label for="cas" data-i18n="search.time_label">캛as rezervacije</label>
              <select id="cas">
                <option value="" disabled selected data-i18n="search.select_time">Izberi 캜as</option>
              </select>
            </div>

            <div class="iskalnik-polje">
              <label for="stevilo_oseb" data-i18n="search.persons_label">맚evilo oseb</label>
              <select id="stevilo_oseb">
                <option value="1">1</option>
                <option value="2" selected>2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
              </select>
            </div>

            <button type="submit" class="gumb-isci" data-i18n="search.search_button">I코캜i</button>
          </form>
        </section>

        <section class="hitra-iskanja">
            <h2 data-i18n="quick_search.title">Hitra izbira kuhinje</h2>
            <div class="gumbi-kategorij">
                <a href="#" class="gumb-kategorija" data-kuhinja="Mesne" data-i18n="cuisine.meat">Mesne jedi</a>
                <a href="#" class="gumb-kategorija" data-kuhinja="Vegi" data-i18n="cuisine.vegetarian">Vegetarijanske jedi</a>
                <a href="#" class="gumb-kategorija" data-kuhinja="Ribje" data-i18n="cuisine.fish">Ribje jedi</a>
                <a href="#" class="gumb-kategorija" data-kuhinja="Pija캜a" data-i18n="cuisine.drinks">Pija캜a</a>
                <a href="#" class="gumb-kategorija" data-kuhinja="Brunch" data-i18n="cuisine.brunch">Brunch</a>
            </div>
        </section>

        <section class="kartice-restavracij hidden" id="rezultatiIskanjaSekcija">
            
            <div class="gumb-nazaj-vsebnik">
                <button id="gumbNazaj" class="gumb-nazaj ikona-nazaj" onclick="handlePrikaziPrivzete()">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            
            <h2 id="naslovRezultatov" data-i18n="results.search_title">Rezultati iskanja</h2>
            <div class="mreza-kartic" id="rezultatiIskanja">
            </div>
        </section>

        <section class="kartice-restavracij" id="privzeteRestavracijeSekcija">
            <h2 data-i18n="results.popular_title">Priljubljeno v va코i bli쬴ni</h2>
            <div class="mreza-kartic" id="restavracije-container">
                <div id="statusKartice" style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">Nalaganje...</div>
            </div>
        </section>

        <section class="kartice-restavracij kartice-izpostavljeno">
            <h3 data-i18n="results.featured_title">Izpostavljeno</h3>
            
            <div class="mreza-kartic" id="mrezaIzpostavljenoKartic">
                <div id="statusIzpostavljenoKartice" style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">Nalaganje...</div>
            </div>
        </section>
        
        <!-- NOV DODATEK: Velika sekcija za izpostavljene akcije -->
        <section class="velika-akcija-slika" id="akcijeBanner">
            
            <img src="Simbol-app.png" alt="Slika aplikacije/ikona" class="ikona-ospredje">

            <div class="akcija-vsebina">
                <h2 data-i18n="action_banner.title">Aktualne Akcije in Posebna Ponudba</h2>
            </div>
        </section>

        <section class="gourmet-explore" id="gourmetExploreSection">
            <h2 data-i18n="gourmet_explore.title">Razi코캜i nepozabna do쬴vetja</h2>
            <div class="country-cards-container">
                
               <a href="experience.html?code=fine-dining" class="country-card" data-experience-code="fine-dining">
    <img src="Fine-dining.png" alt="Vrhunska kulinarika" class="card-image">
    <div class="card-overlay">
        <span class="card-title" data-i18n="experience.fine_dining">Vrhunska kulinarika</span>
    </div>
</a>

   <a href="wine.html" class="country-card-link">
        <div class="country-card" data-experience-code="wine">
            <div class="wine-silhouette"></div> 
            <img src="Wine-tasting.png" alt="Degustacija vin" class="card-image">
            <div class="card-overlay">
                <span class="card-title" data-i18n="experience.wine">Degustacija vin</span>
            </div>
        </div>
    </a>

    <a href="sea.html" class="country-card-link">
        <div class="country-card" data-experience-code="sea">
            <img src="images/experiences/sea.jpg" alt="Morska do쬴vetja" class="card-image">
            <div class="card-overlay">
                <span class="card-title" data-i18n="experience.sea">Morska do쬴vetja</span>
            </div>
        </div>
    </a>

    <a href="romantic.html" class="country-card-link">
        <div class="country-card" data-experience-code="romantic">
            <img src="Romanticna-dozivetja.png" alt="Romanti캜na do쬴vetja" class="card-image">
            <div class="card-overlay">
                <span class="card-title" data-i18n="experience.romantic">Romanti캜na do쬴vetja</span>
            </div>
        </div>
    </a>

</section>


    
</main>
    
   <div id="restavracijaModal" class="restavracija-modal">
    <div class="restavracija-vsebina">
        <span class="gumb-zapri-restavracija" id="zapriRestavracijaModal">칑</span>
        
        <div id="modalSlika" class="slika-glava"></div>
        
        <div class="podrobnosti-tekst">
            <h2 id="modalIme">Ime Restavracije</h2>
            
            <div class="info-vrstica">
                <span id="modalKuhinja"><i class="fas fa-utensils"></i> Kuhinja</span>
                <span id="modalLokacija"><i class="fas fa-map-marker-alt"></i> Mesto</span>
                <span id="modalOcena"><i class="fas fa-star"></i> Ocena</span>
            </div>
            
            <p id="modalOpis" class="opis-restavracije">Opis restavracije...</p>
        </div>
        
        <div class="rezervacija-vnosna-polja">
            <div class="vnosno-polje">
                <label for="modalOsebe" data-i18n="modal.reservation_persons">맚. oseb:</label>
                <select id="modalOsebe" class="input-rezervacija">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                </select>
            </div>

            <div class="vnosno-polje">
                <label for="modalDatum" data-i18n="modal.reservation_date">Datum:</label>
                <input type="text" id="modalDatum" class="input-rezervacija" placeholder="" readonly>
            </div>

            <input type="hidden" data-reserv-id="" value="">
            
        </div>
        
        <div style="padding: 0 25px 25px 25px;">
            <div id="prosteUreRezultati" class="proste-ure-rezultati" style="margin-bottom: 15px; padding-top: 15px; text-align: center;">
                <p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>
            </div>
            
            <button class="gumb-rezerviraj-modal" data-i18n="modal.reserve_button">Rezerviraj mizo</button>
        </div>
        
        <div class="modal-tabs">
            <div class="modal-tab active" data-tab="meni" data-i18n="modal.tab_menu">Meni</div>
            <div class="modal-tab" data-tab="aktualnaPonudba" data-i18n="modal.tab_special_offer">Aktualna Ponudba</div> 
            <div class="modal-tab" data-tab="galerija" data-i18n="modal.tab_gallery">Slike & Zemljevid</div>
            <div class="modal-tab" data-tab="ocene" data-i18n="modal.tab_reviews">Ocene (0)</div>
        </div>

        <div class="modal-vsebina-ovoj">
            <div class="modal-vsebina-skrol">
                <div id="tabMeni" class="tab-content active">
                    <div class="meni-seznam">
                        <ul id="modalMeni">
                            </ul>
                    </div>
                </div>

                <div id="tabAktualnaPonudba" class="tab-content">
                    <h4 data-i18n="modal.special_offer_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Posebna ponudba restavracije</h4>
                    <p id="modalAktualnaPonudbaOpis" data-i18n="modal.special_offer_default">
                        Trenutno ni aktivne posebne ponudbe ali sezonskega menija.
                    </p>
                    </div>

                <div id="tabGalerija" class="tab-content">
                    <h4 data-i18n="modal.gallery_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 15px;">Galerija slik</h4>
                    <div id="galerijaSlike" class="galerija-slike">
                        </div>
                    
                    <h4 data-i18n="modal.map_title" style="font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; margin-top: 20px;">Zemljevid Lokacije</h4>
                    <div class="zemljevid-ovoj">
                        <iframe id="modalZemljevid" src="about:blank" allowfullscreen="" loading="lazy" aria-label="Zemljevid lokacije restavracije"></iframe>
                    </div>
                </div>

                <div id="tabOcene" class="tab-content">
                    <p data-i18n="modal.no_reviews">Trenutno ni na voljo podrobnih ocen za prikaz.</p>
                </div>
            </div>
        </div>
        
        </div>
</div>
    
<div class="login-modal" id="loginModal">
    <div class="login-content">
      <span class="close-modal" id="zapriModal">칑</span>

      <div class="login-tabs">
        <div class="login-tab active" id="tabPrijava" data-i18n="modal.login_tab">Prijava</div>
        <div class="login-tab" id="tabRegistracija" data-i18n="modal.register_tab">Registracija</div>
      </div>

      <form class="login-form active" id="formPrijava">
        <input type="email" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po코ta" required>
        <input type="password" data-i18n="[placeholder]modal.password_placeholder" placeholder="Geslo" required>
        <button type="submit" data-i18n="modal.login_button">Prijavi se</button>
        
        <!-- ============================================= -->
        <!-- NOV DODATEK: GUMBI ZA SOCIALNO PRIJAVO -->
        <!-- ============================================= -->
        <div class="social-login-separator">
            <span data-i18n="modal.or_sign_in_with">Ali pa se prijavite z:</span>
        </div>
        
        <div class="social-login-buttons">
            <!-- GUMB ZA GOOGLE PRIJAVO -->
            <button type="button" class="gumb-prijava-social" id="google-sign-in-btn">
                <i class="fab fa-google"></i> Google
            </button>
            
            <!-- GUMB ZA APPLE PRIJAVO (Za iOS je nujen) -->
            <button type="button" class="gumb-prijava-social apple" id="apple-sign-in-btn">
                <i class="fab fa-apple"></i> Apple
            </button>
            
            <!-- Opomba: Na캜eloma bi lahko dodali 코e Facebook, 캜e 쬰lite -->
        </div>
        <!-- ============================================= -->
        
      </form>

      <form class="login-form" id="formRegistracija">
        <input type="text" data-i18n="[placeholder]modal.name_placeholder" placeholder="Ime in priimek" required>
        <input type="email" data-i18n="[placeholder]modal.email_placeholder" placeholder="E-po코ta" required>
        <input type="password" data-i18n="[placeholder]modal.password_placeholder" placeholder="Geslo" required>
        
        <div class="form-group-checkbox">
            <input type="checkbox" id="pogojiStrinjanje" name="pogojiStrinjanje" required>
            <label for="pogojiStrinjanje">
                <span data-i18n="registration.pogoji_strinjanje">Strinjam se s </span>
                <a href="splosni-pogoji.html" target="_blank" data-i18n="registration.splosni_pogoji_link">Splo코nimi pogoji</a>
                <span data-i18n="registration.in_politiko"> in </span>
                <a href="politika-zasebnosti.html" target="_blank" data-i18n="registration.politika_zasebnosti_link">Politiko zasebnosti</a>.
                <span class="required-star">*</span>
            </label>
        </div>
        <button type="submit" data-i18n="modal.register_button">Ustvari ra캜un</button>
      </form>
    </div>
</div>
  
 <div class="duration-modal" id="durationModal">
      <div class="duration-content">
          <span class="close-modal" id="zapriDurationModal">칑</span>
          
          <h3 data-i18n="modal.reservation_modal.title">Izberite trajanje obiska</h3>
          
          <label data-i18n="modal.reservation_modal.duration_label">Kako dolgo 쬰lite ostati?</label>
          
          <div class="duration-opcije" id="durationOpcije">
              
              <div class="duration-opcija" data-duration="0.5">
                  <input type="radio" id="dur_0_5" name="duration" value="0.5">
                  <label for="dur_0_5" data-i18n="modal.reservation_modal.duration_0_5h">Pol ure (30 min)</label>
              </div>
              
              <div class="duration-opcija selected" data-duration="1.0">
                  <input type="radio" id="dur_1" name="duration" value="1.0" checked>
                  <label for="dur_1" data-i18n="modal.reservation_modal.duration_1h">1 ura</label>
              </div>
              
              <div class="duration-opcija" data-duration="1.5">
                  <input type="radio" id="dur_1_5" name="duration" value="1.5">
                  <label for="dur_1_5" data-i18n="modal.reservation_modal.duration_1_5h">1 ura in pol (90 min)</label>
              </div>
              
              <div class="duration-opcija" data-duration="2.0">
                  <input type="radio" id="dur_2" name="duration" value="2.0">
                  <label for="dur_2" data-i18n="modal.reservation_modal.duration_2h">2 uri</label>
              </div>
          </div>
          
          <button id="potrdiTrajanjeGumb" class="gumb-potrdi-trajanje" data-i18n="modal.reservation_modal.confirm_button">Potrdi trajanje in nadaljuj</button>
          
          <p class="qr-reminder-text" data-i18n="modal.reservation_modal.qr_reminder">
              Ne pozabite: ob prihodu skenirajte QR kodo in pridobite to캜ke!
          </p>
      </div>
  </div>

  <div class="warning-modal" id="warningModal">
      <div class="warning-content">
          <div class="warning-icon-wrapper">
              <i class="fas fa-exclamation-triangle warning-icon"></i>
          </div>
          
          <h3 data-i18n="warning.title">Opozorilo</h3>
          
          <p id="warningMessage" data-i18n="warning.default_message">
            Prosimo, da upo코tevate, da so prikazane informacije o razpolo쬷jivosti in cenah zgolj informativne narave.
          </p>
          
          <button id="gumbRazumem" class="gumb-razumem" data-i18n="warning.understand_button">Razumem</button>
      </div>
  </div>

<footer class="noga">
    <!-- GUMB ZA PREKLOP (Vidno samo na mobilnem) -->
    <button id="footerToggleBtn" class="footer-toggle-btn" aria-expanded="false" aria-controls="nogaVsebinaSkrita" aria-label="Prika쬴/Skrij vsebino noge">
        <!-- Ikona treh pikic (SVG) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
    </button>
    
    <!-- NOVI KONTEJNER: Vsa vsebina, ki se skrije/prika쬰 ob kliku na gumb -->
    <div id="nogaVsebinaSkrita" class="noga-vsebina-skrita">
        <div class="noga-vsebina">

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="o-rentyo-vsebina" data-i18n="footer.about_company_title">O Rentyo Gourmet</h4>
                <ul id="o-rentyo-vsebina" class="noga-linki">
                    <!-- POSODOBLJENO: Uporaba realnih href-ov za navigacijo v istem zavihku -->
                    <li><a href="o-nas.html" data-i18n="footer.about_us" data-i18n-href="footer.about_us_href">O nas</a></li>
                    <li><a href="kontakt.html" data-i18n="footer.contact" data-i18n-href="footer.contact_href">Kontakt</a></li>
                    <li><a href="kariera.html" data-i18n="footer.career" data-i18n-href="footer.career_href">Kariera</a></li>
                    <li><a href="mediji.html" data-i18n="footer.media_press" data-i18n-href="footer.media_press_href">Mediji / Press koti캜ek</a></li>
                </ul>
            </div>

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="pravne-info-vsebina" data-i18n="footer.legal_info_title">Pravne Informacije</h4>
                <ul id="pravne-info-vsebina" class="noga-linki">
                    <!-- POSODOBLJENO: Uporaba realnih href-ov -->
                    <li><a href="politika-zasebnosti.html" data-i18n="footer.privacy_policy" data-i18n-href="footer.privacy_policy_href">Politika zasebnosti</a></li>
                    <li><a href="politika-piskotkov.html" data-i18n="footer.cookie_policy" data-i18n-href="footer.cookie_policy_href">Politika Pi코kotkov</a></li>
                    <li><a href="pogoji-uporabe.html" data-i18n="footer.terms_of_use" data-i18n-href="footer.terms_of_use_href">Pogoji Uporabe</a></li>
                    <li><a href="pravno-obvestilo.html" data-i18n="footer.legal_notice" data-i18n-href="footer.legal_notice_href">Pravno Obvestilo</a></li>
                    <li><a href="pravne-informacije.html" data-i18n="footer.legal_info_title" data-i18n-href="footer.legal_info_href">Pravne Informacije</a></li>
                </ul>
            </div>
            
            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="partnerstva-vsebina" data-i18n="footer.partnerships_title">Partnerstva</h4>
                <ul id="partnerstva-vsebina" class="noga-linki">
                    <!-- POSODOBLJENO: Uporaba realnih href-ov -->
                    <li><a href="za-partnerje.html" data-i18n="footer.for_partners" data-i18n-href="footer.for_partners_href">Za Partnerje</a></li>
                </ul>
            </div>

            <div class="noga-sekcija noga-accordion">
                <h4 class="noga-naslov" data-target="social-vsebina" data-i18n="footer.connect_title">Pove쬴 se z nami</h4>
                <ul id="social-vsebina" class="noga-linki">
                    <!-- Predpostavljamo, da so to zunanje povezave in bi morale odpreti nov zavihek, 
                         캜e vodijo na zunanje socialne strani. Lahko dodate target="_blank", 캜e 쬰lite, sicer pustimo standardno. -->
                    <li><a href="https://www.facebook.com/people/Rentyo-Gourmet/61581337694663/" target="_blank">Facebook</a></li>
                    <li><a href="https://www.instagram.com/rentyo.gourmet/" target="_blank">Instagram</a></li>
                    <li><a href="https://www.tiktok.com/@rentyo_travel?lang=sl" target="_blank">TikTok</a></li>
                    <li><a href="https://linkedin.com/company/rentyogourmet" target="_blank">LinkedIn</a></li>
                    <li><a href="https://wa.me/385989023144" target="_blank">WhatsApp</a></li>
                    <li><a href="mailto:info@rentyo.eu">Email</a></li>
                </ul>
            </div>
        </div> <!-- Konec .noga-vsebina (navigacijski stolpci) -->
        
<div class="noga-dodatno-info" style="text-align: center; font-size: 0.875rem; margin-bottom: 1rem;">
            
            <p style="margin-bottom: 0.5rem;">
                <span data-i18n="footer.payment_info_prefix">Varno pla캜ilo, ki ga omogo캜a</span>
                <a href="" target="_blank" style="text-decoration: none; color: inherit; font-weight: bold;">Stripe</a>.
            </p>
            
            <div class="stripe-logo" style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                <a href="" target="_blank" aria-label="Stripe Payment Processing">
                    <img src="Stripe.png" alt="Stripe" style="display:inline-block; height: 45px;"> 
                </a>
                
                <a href="#" aria-label="Visa Card Accepted" style="cursor: default;">
                    <img src="Visa.png" alt="Visa" style="display:inline-block; height: 24px;">
                </a>
                
                <a href="#" aria-label="Mastercard Accepted" style="cursor: default;">
                    <img src="Mastercard.png" alt="Mastercard" style="display:inline-block; height: 24px;">
                </a>
            </div>
        </div>
        
        <div class="noga-avtorske-pravice" style="text-align: center; font-size: 0.875rem;">
            <span data-i18n="footer.copyright_text">춸 2025 Rentyo Gourmet. Vse pravice pridr쬬ne.</span>
        </div>
    </div>
</footer>

<div id="cookie-consent-banner" class="cookie-banner hidden" style="display: none !important;" data-capacitor-remove-on-native="true">
    <div class="banner-content">
        
        <div class="banner-text-group">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon-cookie" viewBox="0 0 20 20" fill="currentColor" width="24" height="24">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" />
            </svg>
            
            <p class="text-message">
                <span data-i18n="cookieConsent.message"></span>
                
                <a 
                    href="#" 
                    class="link-more-info" 
                    data-i18n-url="cookieConsent.moreInfoLink.url"
                    data-i18n="cookieConsent.moreInfoLink.text">
                </a>
            </p>
        </div>

        <div class="banner-button-group">
            <button id="decline-cookies" class="btn-decline" data-i18n="cookieConsent.buttons.0.text">
                </button>
            
            <button id="accept-cookies" class="btn-accept" data-i18n="cookieConsent.buttons.1.text">
                </button>
        </div>
    </div>
</div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/sl.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/de.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/hr.js"></script> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/it.js"></script>
  
<script>
// =================================================================
// 0. GLOBALNE INICIALIZACIJE IN OSNOVNE SPREMENLJIVKE
// =================================================================

// API BASE URL
const API_BASE_URL = 'https://rentyo-gourmet-spletna-stran.onrender.com/api';

// GLOBALNE SPREMENLJIVKE ZA PODATKE IN STANJE
let allRestavracije = [];
let MOCK_IZPOSTAVLJENO_RAW = []; 
let currentFilterKuhinja = ''; 
let globalSelectedTime = null; 
let currentRestaurantId = null; 
let globalSelectedMizaId = null; 
let globalSelectedMizaIme = null; 

// 游댠 NOVA GLOBALNA SPREMENLJIVKA ZA ZEMLJEVID (Leaflet)
let map = null; 

// 游댠 NOVA GLOBALNA SPREMENLJIVKA ZA LOKACIJO UPORABNIKA
let userLocation = null; 
const DEFAULT_LAT = 46.0569; // Ljubljana, kot privzeto, 캜e ni lokacije
const DEFAULT_LON = 14.5058;
const FALLBACK_IMAGE_URL = 'https://placehold.co/300x200?text=Slika+ni+na+voljo';


// GLOBALNE DEFINICIJE DOM ELEMENTOV (Ohranjene, 캜e so definirane v HTML)
const modal = document.getElementById("loginModal");
const closeBtn = document.getElementById("zapriModal");
const tabPrijava = document.getElementById("tabPrijava");
const tabRegistracija = document.getElementById("tabRegistracija");
const formPrijava = document.getElementById("formPrijava");
const formRegistracija = document.getElementById("formRegistracija");
const openBtnDesktop = document.getElementById("odpriPrijavoDesktop");
const profilMeniDesktop = document.getElementById("profilMeniDesktop");
const gumbOdjavaDesktop = document.getElementById("gumbOdjavaDesktop");
const openBtnMobilni = document.getElementById("odpriPrijavoMobilni");
const profilMeniMobilni = document.getElementById("profilMeniMobilni");
const gumbOdjavaMobilni = document.getElementById("gumbOdjavaMobilni");
const mobilniMeni = document.getElementById('mobilniMeni'); 
const hamburgerGumb = document.getElementById('hamburgerGumb');
const mrezaKarticDiv = document.getElementById('restavracije-container'); 
const statusKarticeDiv = document.getElementById('statusKartice');
const mrezaIzpostavljenoKarticDiv = document.getElementById('mrezaIzpostavljenoKartic');
const restavracijaModal = document.getElementById('restavracijaModal');
const zapriRestavracijaModal = document.getElementById('zapriRestavracijaModal');
const modalSlika = document.getElementById('modalSlika');
const modalIme = document.getElementById('modalIme');
const modalKuhinja = document.getElementById('modalKuhinja');
const modalLokacija = document.getElementById('modalLokacija');
const modalOcena = document.getElementById('modalOcena');
const modalOpis = document.getElementById('modalOpis');
const modalTabs = document.querySelectorAll('.modal-tab');
const modalMeni = document.getElementById('modalMeni');
const galerijaSlikeDiv = document.getElementById('galerijaSlike');
const modalZemljevid = document.getElementById('modalZemljevid');
const durationModal = document.getElementById("durationModal");
const zapriDurationModal = document.getElementById("zapriDurationModal");
const durationOpcije = document.getElementById("durationOpcije");
const potrdiTrajanjeGumb = document.getElementById("potrdiTrajanjeGumb");
const warningModal = document.getElementById("warningModal");
const gumbRazumem = document.getElementById("gumbRazumem");
const modalDatumInput = document.getElementById('modalDatum');
const modalOsebeInput = document.getElementById('modalOsebe');
const gumbRezervirajModal = document.querySelector('.gumb-rezerviraj-modal'); 
const iskalnik = document.querySelector('.iskalnik');
const prosteUreRezultati = document.getElementById('prosteUreRezultati'); 
const tabOcene = document.getElementById('tabOcene'); // Element za ocene
// 游댠 POPRAVLJENI ID-ji iz va코ega HTML-ja
const googleLoginBtn = document.getElementById('google-sign-in-btn'); 
const appleLoginBtn = document.getElementById('apple-sign-in-btn');   


// =================================================================
// I. POMO콯NE FUNKCIJE IN GEOLOKACIJA 
// =================================================================

function generateStarsHTML(rating) {
    const fullStar = '驕'; 
    const maxStars = 5;
    const roundedRating = Math.round(rating);

    let starsHTML = '';
    for (let i = 1; i <= maxStars; i++) {
        if (i <= roundedRating) {
            starsHTML += `<span style="color: #20c0bd;">${fullStar}</span>`;
        } else {
            starsHTML += `<span style="color: #e0e0e0;">${fullStar}</span>`;
        }
    }
    return starsHTML;
}

/**
 * Izra캜una razdaljo med dvema koordinatama (Haversinova formula)
 * @returns Razdalja v kilometrih (km).
 */
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Polmer Zemlje v kilometrih
    const dLat = (lat2 - lat1) * (Math.PI / 180);
    const dLon = (lon2 - lon1) * (Math.PI / 180);
    const a = 
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = R * c; // Razdalja v km
    return distance;
}

const prikaziSporocilo = (msg, type = 'info', duration = 4000) => { 
    console.log(`[Toaster Sporo캜ilo] ${type}: ${msg}`);
    
    const container = document.getElementById('toaster-container');
    if (!container) {
        console.error("Toaster container (id='toaster-container') ni najden v HTML-ju.");
        return;
    }

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let iconClass = '';
    if (type === 'success') iconClass = 'fas fa-check-circle';
    else if (type === 'error') iconClass = 'fas fa-exclamation-triangle';
    else if (type === 'warning') iconClass = 'fas fa-exclamation-circle';
    else iconClass = 'fas fa-info-circle'; 

    toast.innerHTML = `
        <div>
            <span class="toast-icon"><i class="${iconClass}"></i></span>
            <span>${msg}</span>
        </div>
    `;

    container.prepend(toast); 
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 10); 

    setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => {
            toast.remove();
        }, { once: true });
    }, duration);
    
    toast.addEventListener('click', () => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => {
            toast.remove();
        }, { once: true });
    });
};

const preimenujOsebe = () => {
    const select = document.getElementById("stevilo_oseb");
    if (select && typeof i18next !== "undefined") {
        Array.from(select.options).forEach((option) => {
            const count = parseInt(option.value);
            const translationKey = "search.person_singular"; 
            option.textContent = i18next.t(translationKey, { count: count });
        });
    }
};

function generirajCasovneOpcije() {
  const select = document.getElementById("cas");
  if (!select) return; 
  for (let h = 10; h <= 23; h++) {
    let c1 = `${h.toString().padStart(2, "0")}:00`;
    let c2 = `${h.toString().padStart(2, "0")}:30`;
    select.add(new Option(c1, c1));
    if (h < 23) select.add(new Option(c2, c2));
  }
  select.value = "19:00";
}

const updateContent = () => {
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const options = el.getAttribute("data-i18n-options") ? JSON.parse(el.getAttribute("data-i18n-options")) : {};

    if (key.startsWith("[placeholder]")) el.placeholder = i18next.t(key.replace("[placeholder]", ""), options);
    else el.textContent = i18next.t(key, options);
  });
  if(i18next && i18next.exists("app.title")) document.title = i18next.t("app.title");
  preimenujOsebe();
};

const getAuthHeaders = () => {
    const headers = { 'Content-Type': 'application/json' };
    const token = localStorage.getItem('zeton');
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    return headers;
};

const formatirajDatumZaBackend = (datumPrikaz) => {
    if (!datumPrikaz || datumPrikaz.length !== 10) return null;
    try {
        const [dan, mesec, leto] = datumPrikaz.split('.');
        // API pri캜akuje format YYYY-MM-DD
        return `${leto}-${mesec.padStart(2, '0')}-${dan.padStart(2, '0')}`;
    } catch (e) {
        console.error("Napaka pri formatiranju datuma:", e);
        return null;
    }
};

/**
 * Pridobitev lokacije uporabnika in prera캜un razdalj.
 */
function getUserLocation() {
    const storedLocation = localStorage.getItem('userLocation');
    if (storedLocation) {
        userLocation = JSON.parse(storedLocation);
        console.log("Lokacija pridobljena iz localStorage.");
        return; 
    }
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                userLocation = {
                    lat: position.coords.latitude,
                    lon: position.coords.longitude
                };
                localStorage.setItem('userLocation', JSON.stringify(userLocation));
                console.log(`Lokacija uspe코no pridobljena in shranjena: ${userLocation.lat}, ${userLocation.lon}`);
                // Po pridobitvi lokacije ponovno renderiramo restavracije, da se posodobi razdalja
                filterAndRenderRestavracije();
            },
            (error) => {
                console.warn(`Napaka pri pridobivanju lokacije: ${error.message}`);
                userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON };
                prikaziSporocilo(i18next.t('messages.location_denied') || 'Lokacija ni na voljo. Razdalje so izra캜unane iz privzete to캜ke.', 'warning');
            },
            { enableHighAccuracy: false, timeout: 5000, maximumAge: 0 }
        );
    } else {
        console.log("Geolokacija v brskalniku ni podprta.");
        userLocation = { lat: DEFAULT_LAT, lon: DEFAULT_LON };
    }
}

// =================================================================
// II. LOGIKA PRIJAVE/ODJAVE, MODALOV IN SOCIALNA PRIJAVA
// =================================================================

const setLoginStatus = (isLoggedIn) => {
    if (!isLoggedIn) {
        localStorage.removeItem('zeton');
        localStorage.removeItem('jeLastnik');
        localStorage.removeItem('telefon'); 
        localStorage.removeItem('ime'); 
    }
    
    if (isLoggedIn) {
        if(openBtnDesktop) openBtnDesktop.style.display = "none"; 
        if(profilMeniDesktop) profilMeniDesktop.style.display = "flex"; 
        if(openBtnMobilni) openBtnMobilni.style.display = "none"; 
        if(profilMeniMobilni) profilMeniMobilni.style.display = "flex"; 
    } else {
        if(openBtnDesktop) openBtnDesktop.style.display = "flex"; 
        if(profilMeniDesktop) profilMeniDesktop.style.display = "none"; 
        if(openBtnMobilni) openBtnMobilni.style.display = "flex"; 
        if(profilMeniMobilni) profilMeniMobilni.style.display = "none"; 
    }
};

const checkInitialLoginStatus = () => {
    const isLoggedIn = localStorage.getItem('zeton') !== null;
    setLoginStatus(isLoggedIn);
};
checkInitialLoginStatus(); 

/**
 * Skupna funkcija za obravnavo socialne prijave (Google/Apple)
 * @param {string} provider - 'google' ali 'apple'
 */
const handleSocialLogin = (provider) => {
    const callbackUrl = encodeURIComponent(window.location.href);

    // Klic na API za za캜etek Oauth2 procesa
    // Stre쬹ik (API_BASE_URL) naj bi nato sam poskrbel za preusmeritev na Oauth portal
    // in nazaj na va코o spletno stran z 쬰tonom.
    window.location.href = `${API_BASE_URL}/auth/${provider}?redirectUrl=${callbackUrl}`;
};

/**
 * Preveri URL ob nalaganju strani za podatke o prijavi (캜e nas je stre쬹ik preusmeril nazaj).
 */
const checkUrlForAuthToken = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const zeton = urlParams.get('zeton');
    const jeLastnik = urlParams.get('jeLastnik');
    const ime = urlParams.get('ime');
    const telefon = urlParams.get('telefon');
    const status = urlParams.get('status');

    if (zeton) {
        localStorage.setItem('zeton', zeton);
        // Pretvori jeLastnik v boolean
        if (jeLastnik !== null) {
            localStorage.setItem('jeLastnik', jeLastnik === 'true' || jeLastnik === '1');
        } else {
            localStorage.removeItem('jeLastnik');
        }
        if (ime) localStorage.setItem('ime', ime);
        if (telefon) localStorage.setItem('telefon', telefon);

        setLoginStatus(true);
        prikaziSporocilo(i18next.t('messages.login_success') || 'Uspe코na prijava!', 'success');
        
        // O캜isti URL parametre
        const newUrl = window.location.pathname; 
        window.history.replaceState({}, document.title, newUrl);
        
        // Ponovno nalaganje restavracij ali kaj podobnega, 캜e je potrebno
        // filterAndRenderRestavracije(); 
    } else if (status === 'error') {
        const msg = urlParams.get('msg') || i18next.t('messages.social_login_failed') || 'Prijava z zunanjim ponudnikom neuspe코na.';
        prikaziSporocilo(msg, 'error');
        // O캜isti URL parametre
        const newUrl = window.location.pathname; 
        window.history.replaceState({}, document.title, newUrl);
    }
};


// --- LISTENERJI (Se izvedejo ob DOMContentLoaded) ---
document.addEventListener('DOMContentLoaded', () => { 
    
    // Preveri, ali so v URL-ju parametri prijave (Za social login)
    checkUrlForAuthToken();

    // Dodaj poslu코alce za Google in Apple z uporabo pravilnih ID-jev
    if (googleLoginBtn) {
        googleLoginBtn.addEventListener('click', () => handleSocialLogin('google'));
    }
    if (appleLoginBtn) {
        appleLoginBtn.addEventListener('click', () => handleSocialLogin('apple'));
    }

    const openModalListeners = [openBtnDesktop, openBtnMobilni].filter(btn => btn !== null);
    openModalListeners.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            if(modal) modal.classList.add("active");
            if(mobilniMeni) mobilniMeni.classList.remove('active'); 
        });
    });

    if(closeBtn) closeBtn.addEventListener("click", () => modal.classList.remove("active"));
    if(modal) window.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.remove("active");
    });

    if (tabPrijava && tabRegistracija && formPrijava && formRegistracija) {
        tabPrijava.addEventListener("click", () => {
          tabPrijava.classList.add("active");
          tabRegistracija.classList.remove("active");
          formPrijava.classList.add("active");
          formRegistracija.classList.remove("active");
        });

        tabRegistracija.addEventListener("click", () => {
          tabRegistracija.classList.add("active");
          tabPrijava.classList.remove("active");
          formRegistracija.classList.add("active");
          formPrijava.classList.remove("active");
        });
    }

    if (formRegistracija) {
        const pogojiCheckbox = document.getElementById('pogojiStrinjanje');
        const gumbRegistracija = formRegistracija.querySelector('button[type="submit"]');

        if (pogojiCheckbox && gumbRegistracija) {
            gumbRegistracija.disabled = !pogojiCheckbox.checked;
            pogojiCheckbox.addEventListener('change', function() {
                gumbRegistracija.disabled = !this.checked;
            });
        }
    }

    if(formPrijava) formPrijava.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = formPrijava.querySelector('input[type="email"]').value;
        const geslo = formPrijava.querySelector('input[type="password"]').value;
        try {
            const res = await fetch(`${API_BASE_URL}/auth/prijava`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, geslo })
            });
            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('zeton', data.zeton); 
                const jeLastnik = data.zelastnik !== undefined ? data.zelastnik : data.jeLastnik; 
                localStorage.setItem('jeLastnik', jeLastnik); 
                if (data.ime) localStorage.setItem('ime', data.ime); 
                if (data.telefon) localStorage.setItem('telefon', data.telefon); 
                
                setLoginStatus(true); 
                if(modal) modal.classList.remove("active");
                prikaziSporocilo(i18next.t('messages.login_success') || 'Uspe코na prijava!', 'success');
            } else {
                prikaziSporocilo(data.msg || i18next.t('messages.login_failed') || 'Prijava neuspe코na.', 'error');
            }
        } catch (err) {
            console.error("Napaka pri klicu prijave:", err);
            prikaziSporocilo(i18next.t('messages.server_error') || 'Napaka stre쬹ika pri prijavi.', 'error');
        }
    });

    if(formRegistracija) formRegistracija.addEventListener("submit", async (e) => {
        e.preventDefault();
        const pogojiCheckbox = document.getElementById('pogojiStrinjanje');
        if (!pogojiCheckbox || !pogojiCheckbox.checked) {
            prikaziSporocilo(i18next.t('messages.pogoji_required') || 'Za registracijo morate sprejeti Splo코ne pogoje.', 'error');
            return;
        }
        const imeInput = formRegistracija.querySelector('input[name="ime"]') || formRegistracija.querySelector('input[type="text"]');
        const emailInput = formRegistracija.querySelector('input[type="email"]');
        const gesloInput = formRegistracija.querySelector('input[type="password"]');
        const ime = imeInput ? imeInput.value.trim() : '';
        const email = emailInput ? emailInput.value.trim() : '';
        const geslo = gesloInput ? gesloInput.value.trim() : '';
        if (!ime || !email || !geslo) {
            prikaziSporocilo(i18next.t('messages.required_fields_missing') || 'Vnesite vsa polja!', 'error');
            return; 
        }
        const jeLastnik = false; 
        const cena = 0; 
        const telefon = '040123456'; 
        
        try {
            const res = await fetch(`${API_BASE_URL}/auth/registracija`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ime, email, geslo, jeLastnik, cena, telefon })
            });
            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('zeton', data.zeton); 
                localStorage.setItem('jeLastnik', jeLastnik); 
                localStorage.setItem('ime', ime); 
                localStorage.setItem('telefon', telefon); 
                
                setLoginStatus(true); 
                if(modal) modal.classList.remove("active");
                prikaziSporocilo(i18next.t('messages.registration_success') || 'Uspe코na registracija!', 'success');
            } else {
                prikaziSporocilo(data.msg || i18next.t('messages.registration_failed') || 'Registracija neuspe코na.', 'error');
            }
        } catch (err) {
            console.error("Napaka pri klicu registracije:", err);
            prikaziSporocilo(i18next.t('messages.server_error') || 'Napaka stre쬹ika pri registraciji.', 'error');
        }
    });
        
    const logoutListeners = [gumbOdjavaDesktop, gumbOdjavaMobilni].filter(btn => btn !== null);
    logoutListeners.forEach(btn => {
        btn.addEventListener("click", (e) => {
            e.preventDefault();
            setLoginStatus(false);
            if(mobilniMeni) mobilniMeni.classList.remove('active'); 
            window.location.href = 'index.html'; 
        });
    });

    // 游댠 POPRAVEK ZA GLAVNI MOBILNI MENI (HAMBURGER V GLAVI)
    if(hamburgerGumb && mobilniMeni) {
        hamburgerGumb.addEventListener('click', () => {
            mobilniMeni.classList.toggle('active');
            const icon = hamburgerGumb.querySelector('i');
            if (icon) {
                if (mobilniMeni.classList.contains('active')) {
                    icon.classList.remove('fa-ellipsis-h');
                    icon.classList.add('fa-times'); 
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-ellipsis-h'); 
                }
            }
            // Opcijsko: Prepre캜i scroll, ko je meni odprt
            document.body.classList.toggle('menu-open', mobilniMeni.classList.contains('active'));
        });
    }

    // LOGIKA REZERVACIJSKEGA MODALA (API klic)
    
    const currentLang = i18next.language; 
    if (modalDatumInput && typeof flatpickr !== "undefined") {
        flatpickr(modalDatumInput, {
            dateFormat: "d.m.Y", 
            altInput: true,
            altFormat: "d.m.Y",
            locale: currentLang, 
            minDate: "today", 
            onChange: function(selectedDates, dateStr, instance) {
                modalDatumInput.setAttribute('data-reserv-datum', dateStr);
                globalSelectedTime = null; 
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
                    '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
                updateContent();
            }
        });
    }

    if (gumbRezervirajModal) {
        gumbRezervirajModal.onclick = null; 
        gumbRezervirajModal.addEventListener('click', () => {
            
            const izbranDatum = modalDatumInput ? modalDatumInput.value : null; 
            const steviloOseb = modalOsebeInput ? modalOsebeInput.value : null;

            if (globalSelectedTime && globalSelectedMizaId) { // 캛e je 캜as in miza 쬰 izbrana
                odpriDurationModal();
                return;
            }

            if (!currentRestaurantId) {
                const errorMsg = i18next.t('messages.no_restaurant_selected') || 'Restavracija ni izbrana.';
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p style="color: red;">${errorMsg}</p>`;
                return;
            }

            if (!izbranDatum) {
                const warningMsg = i18next.t('messages.select_reservation_date') || 'Prosimo, izberite datum.';
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p style="color: red;">${warningMsg}</p>`;
                return;
            }
            
            if(prosteUreRezultati) {
                prosteUreRezultati.innerHTML = '';
                prosteUreRezultati.innerHTML = `<p data-i18n="messages.loading_availability">Preverjam razpolo쬷jivost...</p>`;
            }
            
            const datumZaBackend = formatirajDatumZaBackend(izbranDatum); 

            const dataToSend = {
                restavracijaId: currentRestaurantId,
                datum: datumZaBackend, 
                stevilo_oseb: parseInt(steviloOseb),
            };
            
            if (!datumZaBackend) {
                 console.error("Neveljaven datum za backend:", izbranDatum);
                 if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p class="alert alert-danger">Napaka: Neveljaven datum format. Izberite ponovno.</p>`;
                 return;
            }

            fetch(`${API_BASE_URL}/restavracije/proste_ure`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dataToSend)
            })
            .then(async response => {
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Klic neuspe코en - Status:', response.status, 'Odgovor stre쬹ika:', errorText);
                    throw new Error(i18next.t('messages.server_error_detailed', { status: response.status }) || `Napaka stre쬹ika: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                
                let ureHTML = '';
                
                if (data.mize && data.mize.length > 0) {
                    const prikazaneUre = new Set();
                    ureHTML += `<p style="margin-bottom: 10px;" data-i18n="messages.available_times_found">Na voljo proste ure za ${izbranDatum}:</p>`;
                    ureHTML += '<div class="gumbi-proste-ure">';
                    
                    data.mize.forEach(miza => {
                        if (miza.prosteUre) { 
                             miza.prosteUre.forEach(ura => {
                                const uraFloat = parseFloat(ura);
                                const ure = Math.floor(uraFloat);
                                const minute = Math.round((uraFloat - ure) * 60);
                                const uraFormat = `${ure.toString().padStart(2, "0")}:${minute.toString().padStart(2, "0")}`;
                                
                                const mizaIdValue = miza.mizaId || miza._id || null; 
                                
                                // Prika쬰mo vse edinstvene ure, ne glede na mizo.
                                if (!prikazaneUre.has(uraFormat) && mizaIdValue) {
                                    const mizaIme = miza.ime || 'Miza'; 
                                    
                                    // Gumbu dodamo ID mize, da vemo, katero mizo rezerviramo
                                    ureHTML += `<button type="button" class="gumb-ura" data-time="${uraFormat}" data-miza-id="${mizaIdValue}" data-miza-ime="${mizaIme}">${uraFormat}</button>`;
                                    
                                    prikazaneUre.add(uraFormat);
                                }
                            });
                        }
                    });

                    ureHTML += '</div>';
                    
                } else {
                    ureHTML = `<p class="alert alert-warning">${data.msg || i18next.t('messages.no_times_available') || 'Na 쬬lost ni prostih ur.'}</p>`;
                }
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = ureHTML;
                updateContent(); 
                setupTimeSlotListeners(); 

            })
            .catch(error => {
                
                console.error('Kon캜na napaka pri pridobivanju prostih ur:', error.message);
                
                const errorMsg = error.message.includes('messages.server_error') 
                    ? error.message 
                    : (i18next.t('messages.server_error') || 'Napaka stre쬹ika pri preverjanju ur.'); 
                
                if(prosteUreRezultati) prosteUreRezultati.innerHTML = `<p class="alert alert-danger">${errorMsg}</p>`;
            });
            
        });
    }
}); // Konec DOMContentLoaded


// =================================================================
// III. LOGIKA SOGLASJA ZA PIKOTKE
// =================================================================

const CONSENT_COOKIE_NAME = 'user_consent_given';
const BANNER_ID = 'cookie-consent-banner';
const EXPIRATION_DAYS = 365; 

// ---------------------------------------------
// Pomo쬹e funkcije
// ---------------------------------------------
function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for(let i=0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function setCookie(value) {
    const date = new Date();
    date.setTime(date.getTime() + (EXPIRATION_DAYS * 24 * 60 * 60 * 1000));
    const expires = "; expires=" + date.toUTCString();
    document.cookie = CONSENT_COOKIE_NAME + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
}

// ---------------------------------------------
// Glavna funkcija za inicializacijo
// ---------------------------------------------
function initializeCookieConsent() {
    const banner = document.getElementById(BANNER_ID);
    if (!banner) return console.error("Cookie banner element not found.");

    // 救 KLJU캛NA IZBOLJㅁVA: Pasica ostane skrita v Native APP
    if (window.Capacitor && window.Capacitor.isNativePlatform()) {
        return; 
    }

    // Nadaljnja koda se izvaja SAMO, 캜e je to spletna stran (WEB)
    const existingConsent = getCookie(CONSENT_COOKIE_NAME);

    if (!existingConsent) {
        // Pasica se prika쬰 (odstrani se razred 'hidden')
        banner.classList.remove('hidden');
        
        const content = banner.querySelector('.banner-content'); 
        if (content) {
            content.classList.add('slide-in-up');
        }

        const acceptBtn = document.getElementById('accept-cookies');
        if(acceptBtn) acceptBtn.addEventListener('click', () => {
            setCookie('accepted');
            banner.classList.add('hidden');
            console.log("Soglasje sprejeto.");
        });

        const declineBtn = document.getElementById('decline-cookies');
        if(declineBtn) declineBtn.addEventListener('click', () => {
            setCookie('declined');
            banner.classList.add('hidden');
            console.log("Soglasje zavrnjeno.");
        });

    } else {
        banner.classList.add('hidden');
    }
}


// 救 IZVAJANJE: AGRESIVNA NATIVE LOGIKA + OBRATNA LOGIKA ZA WEB

document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById(BANNER_ID);
    if (!banner) return;
    
    // 1. AGRESIVNO SKRIVANJE ZA NATIVE:
    if (window.Capacitor && window.Capacitor.isNativePlatform()) {
        banner.remove(); 
        console.log("Native detected. Pasica prisilno odstranjena iz DOM-a.");
        return; 
    }
    
    // 2. PRIKAZ ZA WEB: 캛e smo na spletu, ro캜no odstranimo prisilni inline stil.
    banner.style.display = ''; 
    
    // Za쬰nemo obstoje캜o logiko, ki preveri pi코kotke in jo prika쬰/skrije po potrebi.
    initializeCookieConsent();

    console.log("Web detected. Inline stil odstranjen, nadaljujemo z logiko pi코kotkov.");
});



// =================================================================
// IV. LOGIKA KARTIC RESTAVRACIJ 
// =================================================================

// 1. Renderiranje Ene Kartice (ZA PRILJUBLJENO)
function renderCard(restavracija) {
    const card = document.createElement('div');
    card.className = 'kartica';
    card.setAttribute('data-id', restavracija._id || restavracija.id);
    
    const restavracijaIme = restavracija.ime || restavracija.name || restavracija.title || restavracija.imeRestavracije || 'Neznano Ime';
    
    // Implementacija dinami캜ne slike
    const urlGlavneSlike = (restavracija.galerija_slik && restavracija.galerija_slik.length > 0)
        ? restavracija.galerija_slik[0] // Uporabi prvo sliko za sli캜ico
        : FALLBACK_IMAGE_URL; 
        
    // Interna ocena 
    const internaOcena = restavracija.ocena_povprecje || 0;
    const ratingDisplay = `${generateStarsHTML(internaOcena)} <span class="ocena-stevilka">(${(internaOcena).toFixed(1)})</span>`;

    // Googlova ocena
    const googleRating = restavracija.googleRating || 0;
    const googleReviewCount = restavracija.googleReviewCount || 0;
    
    let googleRatingHTML = '';
    if (googleRating > 0) {
        const translatedReviewsText = i18next.t('messages.google_reviews') || 'Google mnenj';
        
        googleRatingHTML = `
            <p class="google-ocena">
                <i class="fab fa-google" style="color: #4285F4;"></i> 
                <span>${googleRating.toFixed(1)}/5 (${googleReviewCount} ${translatedReviewsText})</span>
            </p>
        `;
    }
    
    // LOGIKA ZA IZRA캛UN RAZDALJE
    let oddaljenostKm = '';
    const restavracijaLat = restavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const restavracijaLon = restavracija.lokacija?.coordinates?.[0] || DEFAULT_LON;
    
    if (userLocation) {
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            restavracijaLat, 
            restavracijaLon
        );
        
        oddaljenostKm = Math.round(distance).toString(); 

    } else {
        oddaljenostKm = i18next.t('results.distance_unknown') || '...';
    }
    
    let oddaljenostHTML = `<span class="oddaljenost"><i class="fas fa-location-arrow"></i> ${oddaljenostKm} km</span>`;
    if (oddaljenostKm === '...') {
         oddaljenostHTML = `<span class="oddaljenost" data-i18n="results.distance_unknown" style="opacity: 0.7;"><i class="fas fa-location-arrow"></i> ${oddaljenostKm}</span>`;
    }
    
    const status = restavracija.razpolozljivost_status || (Math.random() > 0.8 ? 'tomorrow' : 'available');
    const cas = restavracija.razpolozljivost_cas || '19:00';
    let razpolozljivostTextKey;
    let isAvailable = true;
    
    if (status === 'available') {
        razpolozljivostTextKey = i18next.t('results.available_today', { time: cas });
    } else if (status === 'tomorrow') {
        razpolozljivostTextKey = i18next.t('results.available_tomorrow', { time: cas });
        isAvailable = false; 
    } else {
        razpolozljivostTextKey = i18next.t('results.unavailable');
        isAvailable = false;
    }

    const razpolozljivostHTML = `
        <div class="razpolozljivost-ovoj ${!isAvailable ? 'zasedeno' : ''}">
            <p data-i18n="${status === 'available' ? 'results.available_today' : status === 'tomorrow' ? 'results.available_tomorrow' : 'results.unavailable'}" data-i18n-options='{"time": "${cas}"}'>${razpolozljivostTextKey}</p>
        </div>
    `;
    
    // Kartica HTML
    card.innerHTML = `
        <img src="${urlGlavneSlike}" alt="${restavracijaIme}" class="kartica-slika" onerror="this.onerror=null;this.src='${FALLBACK_IMAGE_URL}';">
        <div class="kartica-vsebina">
            <h3>${restavracijaIme}</h3>
            
            <div class="info-ocena-oddaljenost">
                <p class="ocena">${ratingDisplay}</p>
                
                ${googleRatingHTML} 
                
                ${oddaljenostHTML}
            </div>
            
            ${razpolozljivostHTML} 
        </div>
    `;
    
    card.addEventListener('click', (e) => {
        if (e.target.classList.contains('gumb-rezervacija')) {
             return;
        }
        prikaziPodrobnosti(restavracija);
    });
    
    return card;
}

// 2. Renderiranje Ene Kartice (ZA IZPOSTAVLJENO)
function renderFeaturedCard(restavracija) {
    const card = document.createElement('div');
    card.className = 'kartica kartica-izpostavljeno';
    card.setAttribute('data-id', restavracija._id || restavracija.id);
    card.addEventListener('click', () => prikaziPodrobnosti(restavracija));

    const restavracijaIme = restavracija.imeRestavracije || 'Neznano Ime';
    const slikaUrl = restavracija.urlSlike || restavracija.mainImageUrl || FALLBACK_IMAGE_URL; 

    card.innerHTML = `
        <div class="slika-kartice" style="background-image: url('${slikaUrl}')"></div>
        <div class="vsebina-kartice-izpostavljeno">
            <h3>${restavracijaIme}</h3>
        </div>
    `;
    return card;
}

// 3. Filtriranje in Prikaz (PRILJUBLJENO)
function filterAndRenderRestavracije(optionalFilteredList) {
    if (!mrezaKarticDiv || !statusKarticeDiv) return;

    const listToRender = optionalFilteredList || allRestavracije;
    
    const filtered = listToRender.filter(r => {
        if (currentFilterKuhinja === '') return true; 
        return r.deviznaKuhinja === currentFilterKuhinja; 
    });

    mrezaKarticDiv.innerHTML = '';
    statusKarticeDiv.textContent = '';
    
    if (filtered.length === 0) {
        statusKarticeDiv.textContent = i18next.t('messages.no_restaurants_found') || 'Ni najdenih restavracij.'; 
        return;
    }

    filtered.forEach(restavracija => {
        mrezaKarticDiv.appendChild(renderCard(restavracija));
    });
    
    updateContent(); 
}

// 4. Prikaz Izpostavljenih Restavracij
function renderFeaturedRestavracije() {
    if (!mrezaIzpostavljenoKarticDiv) return;
    
    mrezaIzpostavljenoKarticDiv.innerHTML = '';
    
    if (MOCK_IZPOSTAVLJENO_RAW.length === 0) {
        mrezaIzpostavljenoKarticDiv.innerHTML = '<div style="text-align: center; grid-column: 1 / -1; padding-top: 20px;">' + (i18next.t('messages.no_restaurants_found') || 'Ni izpostavljenih restavracij.') + '</div>'; 
        return;
    }
    
    MOCK_IZPOSTAVLJENO_RAW.forEach(restavracija => {
        mrezaIzpostavljenoKarticDiv.appendChild(renderFeaturedCard(restavracija));
    });
    
    updateContent();
}

// 5. Nastavitev Gumbov za Hitro Iskanje Listenerji 
function setupKuhinjaFiltersListeners() {
    document.querySelectorAll('.gumb-kategorija').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            
            document.querySelectorAll('.gumb-kategorija').forEach(b => b.classList.remove('active'));
            
            const novaKuhinja = btn.getAttribute('data-kuhinja');
            if (currentFilterKuhinja === novaKuhinja) {
                currentFilterKuhinja = ''; 
            } else {
                btn.classList.add('active'); 
                currentFilterKuhinja = novaKuhinja;
            }
            
            filterAndRenderRestavracije();
        });
    });
}

// 5.1 LISTENER ZA GLAVNI ISKALNIK (POPRAVLJEN ZA API KLIC)
if (iskalnik) iskalnik.addEventListener('submit', (e) => {
    e.preventDefault();

    // Pridobivanje vrednosti iz forme 
    const mesto = document.getElementById('restavracija_mesto').value || '';
    const datum = document.getElementById('datum').value || '';
    const cas = document.getElementById('cas').value || '';
    const stevilo_oseb = document.getElementById('stevilo_oseb').value || '1'; 
    
    // KLIC PRAVE FUNKCIJE ZA API ISKANJE
    handleIskanjeRestavracij(e, mesto, datum, cas, stevilo_oseb); 
});


// 6. GLAVNA LOGIKA ISKANJA (KLIC API /isci)
async function handleIskanjeRestavracij(e, mesto, datum, cas, stevilo_oseb, kuhinjaKljuc = '') {
    
    const rezultatiContainer = document.getElementById('rezultatiIskanja');
    const searchSection = document.getElementById('rezultatiIskanjaSekcija');
    const defaultSection = document.getElementById('privzeteRestavracijeSekcija');

    // 游녢 LOGIKA PREKLAPLJANJA SEKCIJ
    if (defaultSection) defaultSection.classList.add('hidden');    // Skrijemo privzeto
    
    // 救 KLJU캛NA SPREMEMBA: Sekcijo rezultatov skrijemo, dokler niso potrjeni rezultati.
    if (searchSection) searchSection.classList.add('hidden'); 
    
    if (rezultatiContainer) {
        // Prikaz sporo캜ila, da potrdimo, da se klic izvaja
        rezultatiContainer.innerHTML = `<div class="p-4 text-center text-blue-500">${i18next.t('messages.searching', { criteria: mesto || '...' })}</div>`;
    }

    const datumZaBackend = formatirajDatumZaBackend(datum); 

    const searchParams = {
        mesto: mesto, 
        datum: datumZaBackend, // Formatiran datum za backend
        cas: cas,
        stevilo_oseb: parseInt(stevilo_oseb),
        kuhinja: kuhinjaKljuc 
    };
    
    const url = `${API_BASE_URL}/restavracije/isci`;

    try {
        const response = await fetch(url, {
            method: 'POST', 
            headers: getAuthHeaders(),
            body: JSON.stringify(searchParams)
        });

        const data = await response.json();

        // =======================================================
        // 救 POPRAVEK LOGIKE FRONT-ENDA 救
        // =======================================================
        if (response.ok) {
            // Preverimo, ali je 'data' array in ima ve캜 kot 0 elementov
            if (Array.isArray(data) && data.length > 0) {
                prikaziRezultate(data); // Po코ljemo celoten 'data' array funkciji prikaziRezultate
                
                // 救 KLJU캛NO: Poka쬰mo celotno sekcijo z rezultati 코ele TUKAJ!
                if (searchSection) searchSection.classList.remove('hidden'); 
                
            } else {
                rezultatiContainer.innerHTML = `<div class="p-4 text-center text-gray-600">${i18next.t('messages.no_restaurants_found_criteria') || '콯al nismo na코li restavracij, ki bi ustrezale va코im kriterijem.'}</div>`;
            }
        } else {
            console.error("API iskanje neuspe코no:", data);
            rezultatiContainer.innerHTML = `<div class="p-4 text-center text-red-600">${data.msg || i18next.t('messages.server_error_search') || 'Napaka stre쬹ika pri iskanju.'}</div>`;
        }

    } catch (error) {
        console.error("Napaka pri klicu iskanja restavracij:", error);
        rezultatiContainer.innerHTML = `<div class="p-4 text-center text-red-600">${i18next.t('messages.server_connection_error') || 'Napaka pri komunikaciji s stre쬹ikom.'}</div>`;
    }
}

// 6.1 POMO콯NA FUNKCIJA ZA PRIKAZ REZULTATOV ISKANJA
function prikaziRezultate(restavracije) {
    const container = document.getElementById('rezultatiIskanja');
    if (!container) return; 

    container.innerHTML = '';
    
    restavracije.forEach(restavracija => {
        container.appendChild(renderCard(restavracija)); // Uporabite va코o funkcijo renderCard!
    });
    
    updateContent(); 
}


// 7. Glavna funkcija za nalaganje (PRAVI API KLIC) 
async function loadRestavracije() {
    if (!mrezaKarticDiv) return; 

    const API_CALL_URL = `${API_BASE_URL}/restavracije/privzeto`; 
    
    if(statusKarticeDiv) statusKarticeDiv.textContent = i18next.t('messages.searching', { criteria: '...' }) || 'I코캜em restavracije...'; 
    
    try {
        const response = await fetch(API_CALL_URL);
        
        if (!response.ok) {
            throw new Error(`Stre쬹ik je vrnil status ${response.status}`);
        }
        
        const data = await response.json();
        
        allRestavracije = data; 
        MOCK_IZPOSTAVLJENO_RAW = allRestavracije.slice(0, 3); 
        
        setupKuhinjaFiltersListeners();
        filterAndRenderRestavracije();
        renderFeaturedRestavracije(); 
        
        if(statusKarticeDiv) statusKarticeDiv.textContent = ''; 

    } catch (error) {
        console.error("Napaka pri nalaganju restavracij iz API-ja:", error);
        
        if(statusKarticeDiv) {
            statusKarticeDiv.textContent = i18next.t('messages.search_error') || 'Napaka pri nalaganju restavracij.'; 
            statusKarticeDiv.style.display = 'block';
        }
    }
}

// 8. LOGIKA PRIKAZA OCEN (PREJ MANJKAJO캛A FUNKCIJA)
function renderReviews(reviews) {
    if (!tabOcene) return; 

    tabOcene.innerHTML = ''; // Po캜isti prej코nje ocene
    
    if (!reviews || reviews.length === 0) {
        tabOcene.innerHTML = `<p class="p-4 text-center text-gray-500" data-i18n="modal.no_reviews">${i18next.t('modal.no_reviews') || 'Ta restavracija 코e nima ocen.'}</p>`;
        updateContent();
        return;
    }
    
    reviews.forEach(review => {
        const reviewElement = document.createElement('div');
        reviewElement.className = 'review-card border-b pb-4 mb-4'; 
        
        const ratingHtml = generateStarsHTML(review.ocena);
        const ime = review.uporabniskoIme || i18next.t('modal.anonymous_user') || 'Neznan Uporabnik';
        
        reviewElement.innerHTML = `
            <div class="flex items-center justify-between mb-2">
                <strong class="text-lg">${ime}</strong>
                <span class="text-sm text-gray-500">${new Date(review.datum).toLocaleDateString()}</span>
            </div>
            <div class="flex items-center mb-2">
                <span class="star-rating mr-2">${ratingHtml}</span>
                <span class="text-sm font-semibold text-gray-700">(${review.ocena.toFixed(1)})</span>
            </div>
            <p class="review-text text-gray-800">${review.komentar || ''}</p>
        `;
        
        tabOcene.appendChild(reviewElement);
    });
    
    updateContent(); // Posodobi morebitno i18n v notranjosti
}


// V. POPRAVKI IN DODATNA LOGIKA ZA NOGO (FOOTER)

document.addEventListener('DOMContentLoaded', () => { 
    
    // LOGIKA 1: Razkritje celotne vsebine noge (캜e imate gumb za celotno nogo)
    const footerToggleBtn = document.querySelector('.footer-toggle-btn');
    const nogaVsebinaSkrita = document.querySelector('.noga-vsebina-skrita');
    
    if (footerToggleBtn && nogaVsebinaSkrita) {
        footerToggleBtn.addEventListener('click', () => {
            nogaVsebinaSkrita.classList.toggle('active');
            
            const ikona = footerToggleBtn.querySelector('i') || footerToggleBtn.querySelector('svg');
            // Logika za menjavo ikone
            if (ikona) { /* ... */ }
        });
    }

    // LOGIKA 2: Akordion za posamezne sekcije v nogi (za naslove in linke)
    document.querySelectorAll('.noga-sekcija .noga-naslov').forEach(naslov => {
        naslov.addEventListener('click', (e) => {
            e.preventDefault(); 
            
            const linki = naslov.nextElementSibling; 

            if (linki && linki.classList.contains('noga-linki')) {
                linki.classList.toggle('active');
                naslov.classList.toggle('active');

                // Zapri druge sekcije
                document.querySelectorAll('.noga-sekcija .noga-linki').forEach(otherLinki => {
                    if (otherLinki !== linki && otherLinki.classList.contains('active')) {
                        otherLinki.classList.remove('active');
                        const otherNaslov = otherLinki.previousElementSibling;
                        if (otherNaslov) otherNaslov.classList.remove('active');
                    }
                });
            }
        });
    });
}); 


// 救 NOVO: POMO콯NA FUNKCIJA ZA PRIDOBIVANJE POLNIH PODROBNOSTI RESTAVRACIJE 救

async function getFullRestaurantDetails(id) {
    if (!id) return null;

    const endpoint = `${API_BASE_URL}/restavracije/${id}`; 
    
    try {
        const response = await fetch(endpoint);
        if (!response.ok) {
            throw new Error(`Napaka pri pridobivanju podrobnosti: ${response.statusText}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error("Napaka pri API klicu za podrobnosti restavracije:", error);
        return null;
    }
}


// VI. LOGIKA MODALA RESTAVRACIJE (DOPOLNJENA Z OCENAMI)

async function prikaziPodrobnosti(restavracija) {
    
    currentRestaurantId = restavracija._id || restavracija.id; 
    const reservIdInput = document.querySelector('[data-reserv-id]');
    if (reservIdInput) reservIdInput.value = currentRestaurantId; 

    // 1. PREVERJANJE IN PRIDOBIVANJE POPOLNIH PODATKOV
    let popolnaRestavracija = restavracija;
    // 救 POPRAVLJENO: Uporaba 'komentarji' namesto 'ocene' za preverjanje manjkajo캜ih podrobnosti
    const isMissingDetails = !restavracija.meni || !restavracija.galerija_slik || !restavracija.komentarji; 

    if (currentRestaurantId && isMissingDetails) {
        if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Nalaganje podrobnosti...'; 

        const fullData = await getFullRestaurantDetails(currentRestaurantId);
        
        if (fullData) {
            popolnaRestavracija = fullData; 
        } else {
            if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Neznano Ime';
            prikaziSporocilo('Napaka pri nalaganju celotnih podrobnosti restavracije.', 'error');
        }
    }

    
    const restavracijaIme = popolnaRestavracija.ime || popolnaRestavracija.imeRestavracije || 'Neznano Ime'; 
    const kuhinja = popolnaRestavracija.deviznaKuhinja || 'Neznano';
    
    const prvaSlikaIzGalerije = popolnaRestavracija.galerija_slik && popolnaRestavracija.galerija_slik.length > 0
        ? popolnaRestavracija.galerija_slik[0]
        : null;

    const slikaUrl = popolnaRestavracija.mainImageUrl || popolnaRestavracija.urlSlike || prvaSlikaIzGalerije || FALLBACK_IMAGE_URL;
    
    const opis = popolnaRestavracija.opis || popolnaRestavracija.glavniOpis || ''; 
    
    const lon = popolnaRestavracija.lokacija?.coordinates?.[0] || DEFAULT_LON; 
    const lat = popolnaRestavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const gpsString = `${lat.toFixed(4)},${lon.toFixed(4)}`; 

    // IZRA캛UN RAZDALJE ZA MODALNO OKNO
    let prikazLokacije = '';

    if (userLocation) {
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            lat, 
            lon
        );
        
        const oddaljenostKm = Math.round(distance); 
        prikazLokacije = `<i class="fas fa-location-arrow"></i> ${oddaljenostKm} km`;
        
    } else {
        prikazLokacije = `<i class="fas fa-map-marker-alt"></i> ${gpsString}`;
    }
    
    // Polnjenje Glavnih podrobnosti
    if(modalSlika) modalSlika.style.backgroundImage = `url(${slikaUrl})`;
    if(modalIme) modalIme.textContent = restavracijaIme;
    if(modalKuhinja) modalKuhinja.innerHTML = `<i class="fas fa-utensils"></i> ${kuhinja}`;

    if(modalLokacija) modalLokacija.innerHTML = prikazLokacije; 

    if(modalOcena) modalOcena.innerHTML = `<i class="fas fa-star"></i> ${(popolnaRestavracija.ocena_povprecje || 0).toFixed(1)}`;
    if(modalOpis) modalOpis.textContent = opis;

    // Generiranje Menija (Uporaba POPOLNA_RESTAVRACIJA)
    if(modalMeni) {
        modalMeni.innerHTML = '';
        const menuObj = popolnaRestavracija.meni || {}; 
        
        let hasMenu = false;
        
        for (const kategorija in menuObj) {
            const items = menuObj[kategorija]; 
            
            if (kategorija === 'tedenska_ponudba') {
                continue; 
            }
            
            if (Array.isArray(items) && items.length > 0) {
                hasMenu = true;
                if (kategorija !== 'osnovni_meni') {
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = kategorija;
                    modalMeni.appendChild(categoryHeader);
                }

                const ul = document.createElement('ul');
                items.forEach(item => {
                    const li = document.createElement('li');
                    
                    let desnaVrednost = '';
                    if (item.cena !== undefined && item.cena !== null) {
                        desnaVrednost = `${item.cena} `; 
                    } else if (item.opis) {
                        desnaVrednost = item.opis; 
                    } else {
                        desnaVrednost = ''; 
                    }

                    li.innerHTML = `
                        <div style="display: flex; justify-content: space-between; width: 100%;">
                            <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                            <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                        </div>
                    `;
                    ul.appendChild(li);
                });
                modalMeni.appendChild(ul);
            }
        }
        
        if (!hasMenu) {
            modalMeni.innerHTML = '<li class="text-gray-500"><span data-i18n="modal.no_menu">Meni 코e ni na voljo.</span></li>';
        }
    }
    
    // Polnjenje zavihka Aktualna Ponudba 
    const ponudbaItems = popolnaRestavracija.meni?.tedenska_ponudba || [];
    const modalAktualnaPonudbaDiv = document.getElementById('tabAktualnaPonudba'); 
    
    if (modalAktualnaPonudbaDiv) {
        if (ponudbaItems.length > 0) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '0';
            ponudbaItems.forEach(item => {
                let desnaVrednost = '';
                if (item.cena !== undefined && item.cena !== null) {
                    desnaVrednost = `${item.cena} `;
                } else if (item.opis) {
                    desnaVrednost = item.opis;
                } else {
                    desnaVrednost = '';
                }

                const li = document.createElement('li');
                li.style.listStyle = 'none';
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                        <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                    </div>
                `;
                ul.appendChild(li);
            });
            modalAktualnaPonudbaDiv.innerHTML = '';
            modalAktualnaPonudbaDiv.appendChild(ul);
        } else {
            modalAktualnaPonudbaDiv.innerHTML = '<p class="text-gray-500"><span data-i18n="modal.no_special_offer">Aktualna ponudba trenutno ni na voljo.</span></p>';
        }
    }
    
  // Generiranje Galerije 
    if(galerijaSlikeDiv) {
        const galerijaSlikaURLS = popolnaRestavracija.galerija_slik || []; 
        
        let galerijaHTML = ''; 

        if (galerijaSlikaURLS.length > 0) {
            
            galerijaSlikaURLS.forEach(url => {
                galerijaHTML += `
                    <div class="relative rounded-lg overflow-hidden shadow-md">
                        <img 
                            src="${url}" 
                            alt="Slika restavracije" 
                            class="absolute top-0 left-0 w-full h-full object-cover cursor-pointer hover:opacity-90 transition duration-300"
                            onclick="openFullSizeImage('${url}')"
                        >
                    </div>
                `;
            });

            galerijaSlikeDiv.innerHTML = galerijaHTML; 

        } else {
            galerijaSlikeDiv.innerHTML = '<p class="text-gray-500 p-4">Ni slik za prikaz.</p>';
        }
    }

// Generiranje Zemljevida (OPOMBA: URL popravljen, vendar morate preveriti format, ki ga zahteva va코 stre쬹ik)
    if (modalZemljevid) {
       modalZemljevid.src = `https://maps.google.com/maps?q=${lat},${lon}&hl=sl&z=15&output=embed`; 
    }
    
    // 救 KLJU캛NO: Klic funkcije za prikaz vseh ocen
    // 救 POPRAVLJENO: Uporaba klju캜a 'komentarji', ki ga vrne API.
    renderReviews(popolnaRestavracija.komentarji); 
    

    // Resetiraj prikaz prostih ur
    if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
        '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
        
    globalSelectedTime = null; 
    globalSelectedMizaId = null; 
    
    // Resetiraj na prvi zavihek (Opis je bolj logi캜en)
    const defaultTab = document.querySelector('.modal-tab[data-tab="opis"]');
    if(defaultTab) defaultTab.click();

    // Odpri modal
    if(restavracijaModal) restavracijaModal.classList.add('active');
    updateContent(); 
}

// Zapiranje modala (Ostane enako)
if(zapriRestavracijaModal) zapriRestavracijaModal.addEventListener('click', () => {
    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(modalZemljevid) modalZemljevid.src = 'about:blank';
    currentRestaurantId = null; 
    globalSelectedMizaId = null; 
});

if(restavracijaModal) window.addEventListener('click', (e) => {
    if (e.target === restavracijaModal) {
        restavracijaModal.classList.remove('active');
        if(modalZemljevid) modalZemljevid.src = 'about:blank';
        currentRestaurantId = null; 
        globalSelectedMizaId = null; 
    }
});

// LOGIKA ZAVIHKOV (Ostane enako)
modalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');
        modalTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        const targetElementId = `tab${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`;
        const targetElement = document.getElementById(targetElementId);
        if (targetElement) targetElement.classList.add('active');
    });
});


// =================================================================
// VII. LOGIKA REZERVACIJE IN TRAJANJA
// =================================================================

/**
 * Kriti캜na funkcija za izvedbo API klica rezervacije.
 */
window.handleIzvedbaRezervacije = async (podatki) => {

    if (!localStorage.getItem('zeton')) {
        prikaziSporocilo(i18next.t('messages.login_required') || 'Za rezervacijo morate biti prijavljeni.', 'error');
        if(modal) modal.classList.add("active");
        return;
    }
    
    const url = `${API_BASE_URL}/restavracije/ustvari_rezervacijo`;

    try {
        prikaziSporocilo(i18next.t('messages.reserving', { cas: podatki.casStart, stevilo: podatki.stevilo_oseb }), 'info');

        const payload = {
            restavracijaId: podatki.restavracijaId,
            mizaId: podatki.mizaId,
            imeGosta: podatki.imeGosta,
            telefon: podatki.telefon,
            stevilo_oseb: parseInt(podatki.stevilo_oseb),
            datum: formatirajDatumZaBackend(podatki.datumPrikaz), 
            casStart: podatki.casStart, 
            trajanjeUr: podatki.trajanjeUr 
        };
        
        const response = await fetch(url, {
            method: 'POST',
            headers: getAuthHeaders(),
            body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (response.ok) {
            
            const uspehMsg = i18next.t('messages.reservation_success_minimal', { 
                cas: podatki.casStart
            }) || `Rezervacija uspe코na ob ${podatki.casStart}!`;
            
            prikaziSporocilo(uspehMsg, 'success');
            
            if(durationModal) durationModal.classList.remove('active');
            if(restavracijaModal) restavracijaModal.classList.remove('active');
            // Ponovno nalaganje restavracij, da se posodobi status razpolo쬷jivosti
            loadRestavracije();
        } else {
            prikaziSporocilo(data.msg || i18next.t('messages.reservation_failed') || 'Rezervacija ni uspela.', 'error');
        }

    } catch (error) {
        console.error('Napaka pri API klicu za rezervacijo:', error);
        prikaziSporocilo(i18next.t('messages.server_connection_error_retry') || 'Napaka stre쬹ika pri rezervaciji.', 'error');
    }
}


// Odpre modal za izbiro trajanja
window.odpriDurationModal = () => {
    if (!currentRestaurantId || !globalSelectedTime || !globalSelectedMizaId) { 
        console.error("Napaka: Ni izbrane restavracije, 캜asa ali mize za rezervacijo.");
        prikaziSporocilo(i18next.t('messages.select_time_and_table_required') || "Napaka: Prosimo, izberite 캜as rezervacije in mizo.", 'error');
        if(restavracijaModal) restavracijaModal.classList.add('active'); 
        return;
    }

    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(durationModal) durationModal.classList.add('active');
}

// Zapre modal za izbiro trajanja
const zapriDurationModalHandler = () => {
    if(durationModal) durationModal.classList.remove('active');
    if(restavracijaModal) restavracijaModal.classList.add('active'); 
};
if(zapriDurationModal) zapriDurationModal.addEventListener('click', zapriDurationModalHandler);
if(durationModal) window.addEventListener("click", (e) => {
  if (e.target === durationModal) zapriDurationModalHandler();
});


// Vizualno ozna캜evanje izbrane opcije in izbira radio gumba (Ostane enako)
if(durationOpcije) durationOpcije.querySelectorAll('.duration-opcija').forEach(opcijaDiv => {
    opcijaDiv.addEventListener('click', () => {
        durationOpcije.querySelectorAll('.duration-opcija').forEach(d => d.classList.remove('selected'));
        opcijaDiv.classList.add('selected');
        const radio = opcijaDiv.querySelector('input[type="radio"]');
        if (radio) radio.checked = true;
    });
});

// Handler za klik na gumb za uro
const timeButtonClickHandler = (e) => {
    const timeButtons = document.querySelectorAll('#prosteUreRezultati .gumb-ura');
    timeButtons.forEach(btn => btn.classList.remove('selected'));
    
    globalSelectedTime = e.target.getAttribute('data-time');
    globalSelectedMizaId = e.target.getAttribute('data-miza-id'); 
    globalSelectedMizaIme = e.target.getAttribute('data-miza-ime'); 
    
    e.target.classList.add('selected');
    odpriDurationModal(); 
};


// Listenerji za izbrano uro
function setupTimeSlotListeners() {
    const timeButtons = document.querySelectorAll('#prosteUreRezultati .gumb-ura');
    timeButtons.forEach(button => {
        button.removeEventListener('click', timeButtonClickHandler); 
        button.addEventListener('click', timeButtonClickHandler); 
    });
}

// Funkcija za potrditev rezervacije
const potrdiRezervacijo = () => {
    
    const modalDatumInput = document.getElementById('modalDatum'); 
    const modalOsebeInput = document.getElementById('modalOsebe'); 

    if (!currentRestaurantId) {
        alert(i18next.t('messages.no_restaurant_selected') || "Napaka: Restavracija ni izbrana!");
        return;
    }
    
    const datumPrikaz = modalDatumInput ? modalDatumInput.value : null; 
    const steviloOseb = modalOsebeInput ? modalOsebeInput.value : null; 
    const casStart = globalSelectedTime; 
    const mizaId = globalSelectedMizaId;
    const mizaIme = globalSelectedMizaIme;
    
    const izbranoTrajanjeElement = durationModal ? durationModal.querySelector('input[name="duration"]:checked') : null;
    // Privzeta vrednost 1.5, 캜e ni izbire
    const trajanje = izbranoTrajanjeElement ? parseFloat(izbranoTrajanjeElement.value) : 1.5; 
    
    const imeGosta = localStorage.getItem('ime') || 'Testni Rezervant';
    const telefon = localStorage.getItem('telefon') || '040123456'; 
    
    if (!datumPrikaz || !casStart || !steviloOseb || !mizaId) { 
        
        prikaziSporocilo(i18next.t('messages.required_fields_missing_time_miza') || 'Izpolnite vsa polja in **IZBERITE URO/MIZO** na prej코njem koraku.', 'error');
        
        if(durationModal) durationModal.classList.remove('active');
        if(restavracijaModal) restavracijaModal.classList.add('active'); 
        return;
    }
    
    if(durationModal) durationModal.classList.remove('active');
    
    const rezervacijaPodatki = {
        restavracijaId: currentRestaurantId,
        datumPrikaz: datumPrikaz, 
        stevilo_oseb: steviloOseb, 
        casStart: casStart, 
        trajanjeUr: trajanje,
        mizaId: mizaId, 
        mizaIme: mizaIme,
        imeGosta: imeGosta,
        telefon: telefon,
    };

    handleIzvedbaRezervacije(rezervacijaPodatki);
}

// =================================================================
// VIII. LOGIKA OPOZORILNEGA OKNA
// =================================================================

function prikaziOpozoriloObZagonu() {
    // Prikaz opozorila samo, 캜e 코e ni bilo potrjeno
    if (warningModal && !localStorage.getItem('warningDismissed')) {
        if (gumbRazumem) {
            warningModal.classList.add('active');
        }
    }
}

if(gumbRazumem) gumbRazumem.addEventListener('click', () => {
    if(warningModal) warningModal.classList.remove('active');
    localStorage.setItem('warningDismissed', 'true');
});


// Listener za gumb Potrdi Trajanje / Rezerviraj Mizo
if (potrdiTrajanjeGumb) {
    potrdiTrajanjeGumb.addEventListener('click', (e) => {
        e.preventDefault(); 
        potrdiRezervacijo();
    });
}

// =================================================================
// 游댠 FUNKCIJA ZA FOKUSIRANJE KARTICE IZ ZEMLJEVIDA
// OPOMBA: Ta funkcija je sedaj verjetno odve캜na, 캜e se namesto nje kli캜e handleOdpriModalPodrobnosti,
// vendar jo pu코캜amo, 캜e jo 코e kli캜ete kje drugje.
// =================================================================
function fokusirajKartico(restavracijaId) {
    if (!restavracijaId) {
        console.error("Napaka: Manjka ID restavracije za fokusiranje kartice.");
        return;
    }

    // 1. Poi코캜emo kontejner kartic
    const mrezaKarticDiv = document.getElementById('mrezaKarticDiv') || document.querySelector('.mreza-restavracij'); 

    if (!mrezaKarticDiv) {
        console.error("Fokus: Manjka kontejner kartic (ID: mrezaKarticDiv).");
        return;
    }
    
    // 2. Poi코캜emo ustrezno kartico po data-id
    const ciljnaKartica = mrezaKarticDiv.querySelector(`[data-id="${restavracijaId}"]`);
    
    if (ciljnaKartica) {
        
        // --- Vizualni poudarek (za nekaj sekund) ---
        ciljnaKartica.classList.add('fokus-animacija');
        
        // Odstranimo animacijo po 3 sekundah
        setTimeout(() => {
            ciljnaKartica.classList.remove('fokus-animacija');
        }, 3000); 

        // --- Pomik na kartico ---
        ciljnaKartica.scrollIntoView({
            behavior: 'smooth', 
            block: 'nearest',   
            inline: 'start'     
        });
        
        console.log(`Fokusirana kartica za ID: ${restavracijaId}`);
        
    } else {
        console.warn(`Kartica z ID: ${restavracijaId} ni najdena za fokusiranje.`);
    }
}


// =================================================================
// 游댠 NOVA FUNKCIJA: Po코iljanje rezervacije v bazo (Mini Rezervacija)
// Tukaj integrirajte kodo za komunikacijo z va코im backendom in MongoDB.
// =================================================================
function posljirezervacijo(restavracijaId, datum, cas, stOseb) {
    if (!restavracijaId || !datum || !stOseb) {
        // 캛as (cas) nastavimo na privzeto vrednost, 캜e ni input polja, zato ga ne preverjamo
        alert("Prosimo, izpolnite 코tevilo oseb in datum za rezervacijo.");
        return;
    }
    
    // Priprava formata datuma (캜e 쬰lite po코iljati v standardnem formatu YYYY-MM-DD)
    // Opomba: Input type="date" 쬰 vrne YYYY-MM-DD.
    
    console.log(`Poskus rezervacije za ID: ${restavracijaId}, Datum: ${datum}, 캛as: ${cas}, Oseb: ${stOseb}`);

    // 游댠游댠 DODAJTE SVOJO FETCH KODO TUKAJ (npr. POST na /api/rezervacija) 游댠游댠
    
    /*
    fetch('/api/rezervacija', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            restavracijaId: restavracijaId,
            datum: datum,
            cas: cas, // Npr. '19:00'
            stOseb: parseInt(stOseb) 
        })
    })
    // ... obdelava odgovora ...
    */
    
    // Za DEMO/Testiranje:
    alert(`Rezervacija za ${stOseb} oseb, ${datum} ob ${cas} (simulirano) uspe코na!`);
    
    // Opcijsko: osve쬴te prikaz
}


// =================================================================
// IX. ZAGON IN INITIALIZATION
// =================================================================

const setupLanguageSwitcher = () => {
// ... (Ostala koda funkcije setupLanguageSwitcher ostane nespremenjena) ...
  const selectDesktop = document.getElementById("izbiraJezikaDesktop");
  const selectMobilni = document.getElementById("izbiraJezikaMobilni");
  
  const selects = [selectDesktop, selectMobilni].filter(s => s !== null);

  if (selects.length === 0 || typeof i18next === 'undefined') return;

  const savedLang = localStorage.getItem('i18nextLng');
  const currentLang = savedLang || i18next.language;

  selects.forEach(select => select.value = currentLang); 

  selects.forEach(select => {
      select.addEventListener("change", (e) => {
        const newLang = e.target.value;
        localStorage.setItem('i18nextLng', newLang); 
        selects.filter(s => s !== e.target).forEach(s => s.value = newLang);
        
        i18next.changeLanguage(newLang, (err) => {
          if (err) return console.error(err);
          updateContent();
        });
      });
  });
};


// Glavna inicializacija, zagnana po nalaganju DOM-a, da ujame vse elemente
document.addEventListener('DOMContentLoaded', () => { 
    // ... (Inicializacija i18next, flatpickr in logika za map modal ostane nespremenjena) ...
    // ZAGON i18next
    if (typeof i18next !== 'undefined' && typeof i18nextHttpBackend !== 'undefined') {
        i18next.use(i18nextHttpBackend).init(
          {
            lng: localStorage.getItem('i18nextLng') || "sl",
            fallbackLng: "sl",
            backend: { loadPath: "./i18n/{{lng}}.json" },
          },
          (err) => {
            if (err) console.error(err);
            updateContent();
            setupLanguageSwitcher();
            generirajCasovneOpcije(); 
            
            // Inicializacija geolokacije pred nalaganjem restavracij
            getUserLocation();
            loadRestavracije(); 
            
            prikaziOpozoriloObZagonu(); 
          }
        );
    }

    // ZAGON DATE PICKERJA za iskalnik
    if(typeof flatpickr !== "undefined") {
        flatpickr("#datum", {
          dateFormat: "d. m. Y",
          minDate: "today",
        });
    }
    
    
// =========================================================
// X. LOGIKA ZA ZEMLJEVID (MAP MODAL) - VKLJU캛ENO Z LEAFLETOM!
// =========================================================
const mapIcon = document.getElementById('map-icon-link');
const mapModal = document.getElementById('map-modal');
// Uporabimo closeBtnMap, da ne pride do konflikta z morebitno globalno spremenljivko 'closeBtn'
const closeBtnMap = document.getElementById('close-map-btn'); 

// 1. Odpiranje modalnega okna ob kliku na ikono
if (mapIcon && mapModal) {
    mapIcon.addEventListener('click', function(e) {
        e.preventDefault(); // Prepre캜i skok na vrh strani
        mapModal.style.display = "block";
        
        // KLJU캛NA LOGIKA: Inicializacija Leaflet se zgodi samo enkrat
        if (map === null) {
            // Sredi코캜e Slovenije in za캜etni zoom (uporaba globalnih konstant)
            const centerCoordinates = [DEFAULT_LAT, DEFAULT_LON]; 
            const initialZoom = 8;
            
            // Inicializiramo zemljevid v divu 'large-map-container'
            map = L.map('large-map-container', { 
                zoomControl: false // 游댠游댠游댠 DODANA NASTAVITEV ZA SKRIVANJE GUMBOV +/-
            }).setView(centerCoordinates, initialZoom);
            
            // Dodamo OpenStreetMap plo코캜ice
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '춸 OpenStreetMap contributors'
            }).addTo(map);

            // 캛e so restavracije 콯E nalo쬰ne, jih dodaj ob inicializaciji mape
            if (typeof allRestavracije !== 'undefined' && allRestavracije.length > 0) {
                console.log("Dodajanje markerjev ob inicializaciji mape (podatki 쬰 nalo쬰ni).");
                dodajMarkerjeRestavracij(map); // Klic brez drugega argumenta
            }
            
            console.log("Leaflet zemljevid inicializiran.");
        }
        
        // POMEMBNO: Prisili Leaflet, da se prerise (ker je bil prej skrit)
        setTimeout(() => {
             map.invalidateSize();
             
             // DODATNO ZAGOTOVILO: Ponovno preverimo in dodamo markerje, 캜e jih 코e ni
             if (map !== null && typeof allRestavracije !== 'undefined' && allRestavracije.length > 0 && (!map.markers || map.markers.getLayers().length === 0)) {
                 console.log("Naknadno dodajanje markerjev, ker so podatki na voljo.");
                 dodajMarkerjeRestavracij(map);
             }
        }, 100); 

        console.log("Modalno okno z zemljevidom odprto.");
    });
}

// 2. Zapiranje modalnega okna ob kliku na gumb 'X'
if (closeBtnMap && mapModal) {
    closeBtnMap.addEventListener('click', function() {
        mapModal.style.display = "none";
        console.log("Modalno okno z zemljevidom zaprto.");
    });
}

// 3. Zapiranje modalnega okna ob kliku izven vsebine (na temno ozadje)
if (mapModal) {
    window.addEventListener('click', function(event) {
        if (event.target === mapModal) {
            mapModal.style.display = "none";
            console.log("Modalno okno z zemljevidom zaprto (klik izven).");
        }
    });
}

// =========================================================
// 游띔 ODSTRANJENA CELOTNA LOGIKA ZA ZAVIHKI V MODALU RESTAVRACIJE
// (Ta logika je pripadala modalu, ki ga sedaj ne potrebujemo)
// =========================================================


}); // Konec glavnega DOMContentLoaded bloka


// =================================================================
// VI. LOGIKA MODALA RESTAVRACIJE (VAㅁ ORIGINALNA FUNKCIJA)
// =================================================================

async function prikaziPodrobnosti(restavracija) {
    
    currentRestaurantId = restavracija._id || restavracija.id; 
    const reservIdInput = document.querySelector('[data-reserv-id]');
    if (reservIdInput) reservIdInput.value = currentRestaurantId; 

    // 1. PREVERJANJE IN PRIDOBIVANJE POPOLNIH PODATKOV
    let popolnaRestavracija = restavracija;
    // 救 POPRAVLJENO: Uporaba 'komentarji' namesto 'ocene' za preverjanje manjkajo캜ih podrobnosti
    const isMissingDetails = !restavracija.meni || !restavracija.galerija_slik || !restavracija.komentarji; 

    if (currentRestaurantId && isMissingDetails) {
        if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Nalaganje podrobnosti...'; 

        const fullData = await getFullRestaurantDetails(currentRestaurantId);
        
        if (fullData) {
            popolnaRestavracija = fullData; 
        } else {
            if(modalIme) modalIme.textContent = restavracija.ime || restavracija.imeRestavracije || 'Neznano Ime';
            prikaziSporocilo('Napaka pri nalaganju celotnih podrobnosti restavracije.', 'error');
        }
    }

    
    const restavracijaIme = popolnaRestavracija.ime || popolnaRestavracija.imeRestavracije || 'Neznano Ime'; 
    const kuhinja = popolnaRestavracija.deviznaKuhinja || 'Neznano';
    
    const prvaSlikaIzGalerije = popolnaRestavracija.galerija_slik && popolnaRestavracija.galerija_slik.length > 0
        ? popolnaRestavracija.galerija_slik[0]
        : null;

    const slikaUrl = popolnaRestavracija.mainImageUrl || popolnaRestavracija.urlSlike || prvaSlikaIzGalerije || FALLBACK_IMAGE_URL;
    
    const opis = popolnaRestavracija.opis || popolnaRestavracija.glavniOpis || ''; 
    
    const lon = popolnaRestavracija.lokacija?.coordinates?.[0] || DEFAULT_LON; 
    const lat = popolnaRestavracija.lokacija?.coordinates?.[1] || DEFAULT_LAT; 
    const gpsString = `${lat.toFixed(4)},${lon.toFixed(4)}`; 

    // IZRA캛UN RAZDALJE ZA MODALNO OKNO
    let prikazLokacije = '';

    if (userLocation) {
        const distance = getDistance(
            userLocation.lat, 
            userLocation.lon, 
            lat, 
            lon
        );
        
        const oddaljenostKm = Math.round(distance); 
        prikazLokacije = `<i class="fas fa-location-arrow"></i> ${oddaljenostKm} km`;
        
    } else {
        prikazLokacije = `<i class="fas fa-map-marker-alt"></i> ${gpsString}`;
    }
    
    // Polnjenje Glavnih podrobnosti
    if(modalSlika) modalSlika.style.backgroundImage = `url(${slikaUrl})`;
    if(modalIme) modalIme.textContent = restavracijaIme;
    if(modalKuhinja) modalKuhinja.innerHTML = `<i class="fas fa-utensils"></i> ${kuhinja}`;

    if(modalLokacija) modalLokacija.innerHTML = prikazLokacije; 

    if(modalOcena) modalOcena.innerHTML = `<i class="fas fa-star"></i> ${(popolnaRestavracija.ocena_povprecje || 0).toFixed(1)}`;
    if(modalOpis) modalOpis.textContent = opis;

    // Generiranje Menija (Uporaba POPOLNA_RESTAVRACIJ A)
    if(modalMeni) {
        modalMeni.innerHTML = '';
        const menuObj = popolnaRestavracija.meni || {}; 
        
        let hasMenu = false;
        
        for (const kategorija in menuObj) {
            const items = menuObj[kategorija]; 
            
            if (kategorija === 'tedenska_ponudba') {
                continue; 
            }
            
            if (Array.isArray(items) && items.length > 0) {
                hasMenu = true;
                if (kategorija !== 'osnovni_meni') {
                    const categoryHeader = document.createElement('h4');
                    categoryHeader.textContent = kategorija;
                    modalMeni.appendChild(categoryHeader);
                }

                const ul = document.createElement('ul');
                items.forEach(item => {
                    const li = document.createElement('li');
                    
                    let desnaVrednost = '';
                    if (item.cena !== undefined && item.cena !== null) {
                        desnaVrednost = `${item.cena} `; 
                    } else if (item.opis) {
                        desnaVrednost = item.opis; 
                    } else {
                        desnaVrednost = ''; 
                    }

                    li.innerHTML = `
                        <div style="display: flex; justify-content: space-between; width: 100%;">
                            <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                            <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                        </div>
                    `;
                    ul.appendChild(li);
                });
                modalMeni.appendChild(ul);
            }
        }
        
        if (!hasMenu) {
            modalMeni.innerHTML = '<li class="text-gray-500"><span data-i18n="modal.no_menu">Meni 코e ni na voljo.</span></li>';
        }
    }
    
    // Polnjenje zavihka Aktualna Ponudba 
    const ponudbaItems = popolnaRestavracija.meni?.tedenska_ponudba || [];
    const modalAktualnaPonudbaDiv = document.getElementById('tabAktualnaPonudba'); 
    
    if (modalAktualnaPonudbaDiv) {
        if (ponudbaItems.length > 0) {
            const ul = document.createElement('ul');
            ul.style.paddingLeft = '0';
            ponudbaItems.forEach(item => {
                let desnaVrednost = '';
                if (item.cena !== undefined && item.cena !== null) {
                    desnaVrednost = `${item.cena} `;
                } else if (item.opis) {
                    desnaVrednost = item.opis;
                } else {
                    desnaVrednost = '';
                }

                const li = document.createElement('li');
                li.style.listStyle = 'none';
                li.innerHTML = `
                    <div style="display: flex; justify-content: space-between; width: 100%;">
                        <strong style="flex-shrink: 1;">${item.jed || 'Jed'}</strong> 
                        <span style="flex-shrink: 0; margin-left: 15px;">${desnaVrednost}</span>
                    </div>
                `;
                ul.appendChild(li);
            });
            modalAktualnaPonudbaDiv.innerHTML = '';
            modalAktualnaPonudbaDiv.appendChild(ul);
        } else {
            modalAktualnaPonudbaDiv.innerHTML = '<p class="text-gray-500"><span data-i18n="modal.no_special_offer">Aktualna ponudba trenutno ni na voljo.</span></p>';
        }
    }
    
  // Generiranje Galerije 
    if(galerijaSlikeDiv) {
        const galerijaSlikaURLS = popolnaRestavracija.galerija_slik || []; 
        
        let galerijaHTML = ''; 

        if (galerijaSlikaURLS.length > 0) {
            
            galerijaSlikaURLS.forEach(url => {
                galerijaHTML += `
                    <div class="relative rounded-lg overflow-hidden shadow-md">
                        <img 
                            src="${url}" 
                            alt="Slika restavracije" 
                            class="absolute top-0 left-0 w-full h-full object-cover cursor-pointer hover:opacity-90 transition duration-300"
                            onclick="openFullSizeImage('${url}')"
                        >
                    </div>
                `;
            });

            galerijaSlikeDiv.innerHTML = galerijaHTML; 

        } else {
            galerijaSlikeDiv.innerHTML = '<p class="text-gray-500 p-4">Ni slik za prikaz.</p>';
        }
    }

// Generiranje Zemljevida (OPOMBA: URL popravljen, vendar morate preveriti format, ki ga zahteva va코 stre쬹ik)
    if (modalZemljevid) {
       modalZemljevid.src = `https://maps.google.com/maps?q=${lat},${lon}&hl=sl&z=15&output=embed`; 
    }
    
    // 救 KLJU캛NO: Klic funkcije za prikaz vseh ocen
    // 救 POPRAVLJENO: Uporaba klju캜a 'komentarji', ki ga vrne API.
    renderReviews(popolnaRestavracija.komentarji); 
    

    // Resetiraj prikaz prostih ur
    if(prosteUreRezultati) prosteUreRezultati.innerHTML = 
        '<p data-i18n="messages.check_availability_prompt">Proste ure se bodo prikazale, ko kliknete Rezerviraj mizo.</p>';
        
    globalSelectedTime = null; 
    globalSelectedMizaId = null; 
    
    // Resetiraj na prvi zavihek (Opis je bolj logi캜en)
    const defaultTab = document.querySelector('.modal-tab[data-tab="opis"]');
    if(defaultTab) defaultTab.click();

    // Odpri modal
    if(restavracijaModal) restavracijaModal.classList.add('active');
    updateContent(); 
}


// Zapiranje modala (Ostane enako)
if(zapriRestavracijaModal) zapriRestavracijaModal.addEventListener('click', () => {
    if(restavracijaModal) restavracijaModal.classList.remove('active');
    if(modalZemljevid) modalZemljevid.src = 'about:blank';
    currentRestaurantId = null; 
    globalSelectedMizaId = null; 
});

if(restavracijaModal) window.addEventListener('click', (e) => {
    if (e.target === restavracijaModal) {
        restavracijaModal.classList.remove('active');
        if(modalZemljevid) modalZemljevid.src = 'about:blank';
        currentRestaurantId = null; 
        globalSelectedMizaId = null; 
    }
});

// LOGIKA ZAVIHKOV (Ostane enako)
modalTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        const targetTab = tab.getAttribute('data-tab');
        modalTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        const targetElementId = `tab${targetTab.charAt(0).toUpperCase() + targetTab.slice(1)}`;
        const targetElement = document.getElementById(targetElementId);
        if (targetElement) targetElement.classList.add('active');
    });
});


// =================================================================
// POMO콯NE FUNKCIJE (IZVEN DOMContentLoaded BLOKA) - TUKAJ JIH MORAMO IMETI!
// =================================================================

/**
 * 游댠游댠 NOVA POVEZOVALNA FUNKCIJA: handleOdpriModalPodrobnosti
 * PREMAKNJENA SEM, DA JE DOSTOPNA Leaflet markerjem in ne spro쬬 napake!
 * Poi코캜e celoten objekt restavracije in pokli캜e va코o funkcijo prikaziPodrobnosti(objekt).
 * @param {Event | null} event - Dogodek klika (lahko je null za klic z zemljevida).
 * @param {string} restavracijaId - ID restavracije.
 */
function handleOdpriModalPodrobnosti(event, restavracijaId) {
    if (event) {
        event.preventDefault(); 
    }
    
    if (!restavracijaId) {
        console.error("Napaka: Manjka ID restavracije za odpiranje modala.");
        return;
    }

    // 1. Poi코캜emo objekt restavracije v globalnem polju allRestavracije
    const restavracijaObj = allRestavracije.find(r => (r._id === restavracijaId || r.id === restavracijaId));
    
    if (restavracijaObj) {
        console.log(`Prikazujem podrobnosti za restavracijo: ${restavracijaObj.ime || restavracijaObj.imeRestavracije}`);
        
        // 2. Kli캜emo va코o originalno funkcijo za prikaz modala
        prikaziPodrobnosti(restavracijaObj);
        
    } else {
        console.error(`Napaka: Objekt restavracije z ID ${restavracijaId} ni bil najden v allRestavracije.`);
        if (typeof prikaziSporocilo === 'function') {
             prikaziSporocilo('Napaka: Podatki restavracije niso na voljo.', 'error');
        }
    }
}


/**
 * Pomo쬹a funkcija za zagotavljanje pravilne poti do slike.
 * Preveri, ali pot vsebuje 'images/', 캜e ne, jo doda, razen 캜e je 쬰 polna pot (npr. http/https).
 * @param {string} url - Relativna pot do slike.
 * @returns {string} Absolutna ali popravljena relativna pot.
 */
function getAbsoluteImageUrl(url) {
    if (!url || url.startsWith('http')) {
        return url;
    }
    // Preverite, ali pot 쬰 vsebuje "images/" ali je to 쬰 del poti
    if (url.startsWith('images/') || url.startsWith('/images/')) {
        return url;
    }
    // V primeru, da je podatek iz hotels.json (bled-mp-1.jpg)
    return `images/${url}`;
}


// Pomo쬹a funkcija za vrnitev na privzeto sekcijo
function handlePrikaziPrivzete() {
    const searchSection = document.getElementById('rezultatiIskanjaSekcija');
    const defaultSection = document.getElementById('privzeteRestavracijeSekcija');
    
    if (searchSection) {
        searchSection.classList.add('hidden');
    }
    
    if (defaultSection) {
        defaultSection.classList.remove('hidden'); 
        defaultSection.style.display = ''; 
    }
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}


/**
 * 游띔 ODSTRANJENA KLJU캛NA FUNKCIJA: prikaziMeniPodatke
 */
/*
function prikaziMeniPodatke(restavracijaObjekt) { 
    // ... Stara logika za menije je odstranjena ...
}
*/


/**
 * 游띔 ODSTRANJENA IMPLEMENTACIJA ZA PRIKAZ MODALNEGA OKNA
 */
/*
function prikaziRestavracijoModal(restavracijaObjekt) {
    // ... Stara logika modala je odstranjena ...
}
*/


// =================================================================
// 游댠 POSODOBLJENA POMO콯NA FUNKCIJA: Dodajanje markerjev (Tooltips + Odpiranje Modala)
// Markerji sedaj ob kliku odprejo modal s podrobnostmi (handleOdpriModalPodrobnosti).
// =================================================================
function dodajMarkerjeRestavracij(leafletMap) {
    const dataToUse = (typeof allRestavracije !== 'undefined' ? allRestavracije : []);
    
    if (!leafletMap || dataToUse.length === 0) {
        return;
    }

    // 1. O캜istimo stare markerje in inicializiramo featureGroup
    if (leafletMap.markers) {
        leafletMap.markers.clearLayers();
    } else {
        leafletMap.markers = L.featureGroup().addTo(leafletMap);
    }
    
    let bounds = []; 

    // 2. Iteriramo skozi vse restavracije
    dataToUse.forEach(restavracija => {
        if (restavracija.lokacija && restavracija.lokacija.coordinates && restavracija.lokacija.coordinates.length === 2) {
            
            const lng = parseFloat(restavracija.lokacija.coordinates[0]); 
            const lat = parseFloat(restavracija.lokacija.coordinates[1]); 
            
            // 游댠 ID, ki ga uporablja funkcija handleOdpriModalPodrobnosti
            const restavracijaId = restavracija._id || restavracija.id; 
            const restavracijaIme = restavracija.imeRestavracije || restavracija.ime || restavracija.title || 'Neznano Ime';
            
            const ocena = parseFloat(restavracija.ocena_povprecje || restavracija.googleRating || 0);
            const ocenaPrikaz = ocena > 0 ? ocena.toFixed(1) : 'N/A';
            
            // Dodan CSS razred 'map-poudarek' za la쬵e stiliziranje v CSS-ju
            let poudarek = ocena >= 4.5 ? '<p class="map-poudarek" style="color: #c90000; font-weight: bold; margin-top: 5px; margin-bottom: 0; font-size: 0.80em;">YOU MUST TRY</p>' : '';
            
            // --- TOOLTIP VSEBINA (Vizualni prikaz nad markerjem) ---
            const tooltipContent = `
                <div class="map-tooltip-content" style="text-align: center; padding: 5px;">
                    <p class="tooltip-name" style="font-weight: bold; margin: 0 0 5px 0; font-size: 1em;">${restavracijaIme}</p>
                    
                    <p class="tooltip-rating" style="margin: 0;">
                        <span style="color: gold; font-size: 1.2em;">驕</span> 
                        <span style="font-weight: 700; font-size: 1.4em;">${ocenaPrikaz}</span>
                    </p>
                    
                    ${poudarek}
                </div>
            `;
            
            const marker = L.marker([lat, lng]) 
                // Pove쬰mo Tooltip za prikaz imena/ocene
                .bindTooltip(tooltipContent, {
                    permanent: true,     
                    direction: 'top',    
                    offset: [0, -15], 
                    className: 'map-restaurant-tooltip' // Klju캜ni razred za CSS
                });
                
            leafletMap.markers.addLayer(marker);
            
            // 游댠 KLJU캛NO: Dodamo poslu코alca za klik za odpiranje modala!
            marker.on('click', function(e) {
                // 캛e funkcija handleOdpriModalPodrobnosti ni definirana, prepre캜imo, da se stran osve쬴/sko캜i na vrh.
                if (typeof handleOdpriModalPodrobnosti !== 'function') {
                    console.error("Napaka: Funkcija handleOdpriModalPodrobnosti ni dosegljiva. Preverite obseg definicije.");
                    return; // Prekinemo, 캜e funkcija ne obstaja
                }

                // Prepre캜imo morebitne privzete Leaflet dogodke za ta klik 
                if (e.originalEvent) {
                    e.originalEvent.stopPropagation();
                }

                // 1. ZAPIRANJE MODALA Z ZEMLJEVIDOM JE ODSTRANJENO! (Da ostane odprt)
                /* const mapModal = document.getElementById('map-modal');
                if (mapModal) {
                    mapModal.style.display = "none";
                }
                */
                
                // 2. Pokli캜emo funkcijo za odpiranje modala podrobnosti
                // Sedaj je ta funkcija globalno dostopna in bo poklicala prikaziPodrobnosti
                handleOdpriModalPodrobnosti(null, restavracijaId); 
            });
            
            bounds.push([lat, lng]);
        }
    });

    // 3. Prilagoditev pogleda (Zoom & Center)
    if (bounds.length > 0) {
        leafletMap.fitBounds(bounds, {
            padding: [0, 0] // 游댠 POPRAVLJENO: Padding nastavljen na 0, da se odstrani beli rob okoli zemljevida
        });
    }
}
</script>
    <div id="toaster-container">
    </div>

</body>
</html>